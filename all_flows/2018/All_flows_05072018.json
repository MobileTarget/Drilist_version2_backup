[{"id":"fd45fa66.787ec8","type":"tab","label":"Create Tree Structure","disabled":false,"info":""},{"id":"6f1d88a3.034e28","type":"tab","label":"Dev2 API","disabled":false,"info":""},{"id":"3924c8eb.2bafc8","type":"tab","label":"Generic Save post","disabled":false,"info":""},{"id":"b5aea0cd.480f6","type":"tab","label":"Generic Get"},{"id":"77744b11.7b9024","type":"tab","label":"Dummy Flows","disabled":false,"info":""},{"id":"51119cab.bd09e4","type":"tab","label":"Login API "},{"id":"b32e01b.0ab74","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"9bc76fe1.908c7","type":"tab","label":"Page1","disabled":false,"info":""},{"id":"48313844.d96e98","type":"tab","label":"Flow 5","disabled":false,"info":""},{"id":"288c8934.beba76","type":"tab","label":"https://flows.nodered.org/flow/7d4b5c1189c8f5df3a1f","disabled":false,"info":""},{"id":"f8194c72.aaf9c","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"6e6ca2b2.e479bc","type":"twilio-api","z":"","sid":"AC909f1981261f4461abbc7985bd202897","from":"12312259665","name":"Twilio SMS Service"},{"id":"757913d8.cc993c","type":"twilio-api","z":"","sid":"AC909f1981261f4461abbc7985bd202897","from":"12312259665 ","name":"Drilist SMS service"},{"id":"75f5dc74.886e64","type":"twilio-api","z":"","sid":"AC909f1981261f4461abbc7985bd202897","from":"12312259665 ","name":"Drilist SMS service"},{"id":"1ceb100b.a8aaa","type":"twilio-api","z":"","sid":"AC909f1981261f4461abbc7985bd202897","from":"12312259665 ","name":"Drilist SMS service"},{"id":"7e2208b1.db0108","type":"inject","z":"fd45fa66.787ec8","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":132,"y":117,"wires":[["3c981a51.980ef6"]]},{"id":"3c981a51.980ef6","type":"function","z":"fd45fa66.787ec8","name":"data.js","func":"var init_load = [\n\t\t{\n            payload: {\n                user_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id, 72858af0dce6542155ddde7f3457c3e4\n                portal_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id,\n                node_name: \"testGroup\", //group_name_company,\n                data_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id,\n                master_parents: [], //tree_owner_id,\n                tree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\",\n                node_id: null, //node_id,\n                target: \"grand\",\n                parent_node_name: \"EmployeeBranch\"\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\nreturn msg;\n","outputs":1,"noerr":0,"x":310,"y":100,"wires":[["fc241cb6.72076","1728be94.31fd11"]]},{"id":"1728be94.31fd11","type":"Tree View","z":"fd45fa66.787ec8","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":522,"y":116,"wires":[["425624df.d2b3ac"]]},{"id":"425624df.d2b3ac","type":"debug","z":"fd45fa66.787ec8","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":770,"y":200,"wires":[]},{"id":"fc241cb6.72076","type":"debug","z":"fd45fa66.787ec8","name":"output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":494,"y":58,"wires":[]},{"id":"4f5a435f.38a9ec","type":"comment","z":"fd45fa66.787ec8","name":"Create company (Root)","info":"","x":140,"y":40,"wires":[]},{"id":"2d802281.11fbfe","type":"function","z":"fd45fa66.787ec8","name":"data.js","func":"var system_id = \"9383e6b4a09ebd50328bdf4ead9ab555\", //\"system_id\"; // user \n\tcompany_id = \"5af5dc1046a975faaed6a8d2d44126d1\", // Company Reminderbot Id \n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n\n\nvar init_load = [\n\t\t{\n\t\t\t// set up grandfather for get_page\n\t\t\t//0\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get_page,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for get_node_name_tree\n\t\t\t//1\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for add_to_node_name_tree\n\t\t\t//2\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_add,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for delete_from_node_name_tree\n\t\t\t//3\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_del,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n// \t\t// system_id create system_id company node_name\n// \t\t// set up grandfather for \"company\"\n// \t\t// at the same time add those to the actions created above -- note companies can add, get, delete, get page\n// \t\t//4\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: [name_get_page + system_id, name_add + system_id, name_del + system_id, name_get+ system_id],\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n\t\t// system_id add reminder_bot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n\t\t// company id ie reminderbot_id is now authroized to company stuff\n\t\t//5\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: system_id,\n\t\t\t\tportal_id: system_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: company_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"parent\",\n\t\t\t\tparent_node_name:\"portal\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_co is now been authorized by reminder_bot_id to do company stuff \n// // \t\t//6\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tdata_id: user_id_co,\n// \t\t\t\tmaster_parents: master_parents,\n// \t\t\t\ttree_owner_id: tree_owner_id,\n// \t\t\t\tnode_id: node_id,\n// \t\t\t\ttarget: \"child\",\n// \t\t\t\tparent_node_name:\"\",\n// \t\t\t},\n// \t\t\tfn_name: fn_name_add\n// \t\t},\n// // \t\t//check if the \"company tree\" got added right\n// // \t\t//7\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t// system_id create system_id employee node_name\n// // \t\t// at the same time add those to the actions created above -- this one per node_name\n// // \t\t// employees cannot delete\n// // \t\t//8\n// \t\t{\n// \t\t    payload :  {\n//              user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tsystem_id, \n// \t\t\t\tmaster_parents: \t[\"get_node_name_tree\"+system_id, \"add_to_node_name_tree\"+system_id], \n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"grand\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// system_id add reminderbot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n// // \t\t//9\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tcompany_id, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\" ,\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_employee has not been authorized to do reminderbot_id employee stuff\n// // \t\t//10\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_employee, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// view results of group_name_company\n// \t\t//11\n// \t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t//12\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_co, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// \t\t//13\n// \t\t\t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n\n\n// // \t\t// #14\n// // \t\t//add page to existing company record\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\tgroup_name_page, // the id of the page is like reminder_bot\n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\t\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t//15\n// // \t\t// add specific ITEMS to this company/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//16\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem2, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// \t\t//17\n// \t\t// add parent of page to employees\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\tgroup_name_page, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t}, \n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// 18\n// // \t\t// add specific ITEMS to this employee/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//19\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,//true,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//20\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//21\n// \t\t//now get\n// \t\t{\n// \t\t    payload :  {\n// \t\t        user_id: \t\t    user_id_employee, //or user_id_co\n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tpage_id:  \t\t\tgroup_name_page,\n// \t\t\t\tfilter: \t\t\tnull\n// \t\t},\n// \t\t\tfn_name:fn_get_page\n// \t\t},\n// \t\t{\n// \t\t    payload: {\n// \t\t        user_id: user_id_employee, //or user_id_co\n// \t\t        portal_id: company_id,\n// \t\t        page_id: group_name_page,\n// \t\t        filter: [group_name_employee, group_name_company] //group_name_company\n// \t\t    },\n// \t\t    fn_name: fn_get_page\n// \t\t}\n\t];\n\n// var init_load = [\n    // {\n    //     payload: {\n    //         user_id: system_id,\n    //         portal_id: company_id,\n    //         node_name: group_name_employee,\n    //         data_id: \"51fd8f4edcac9037a23548efd2805586\",\n    //         master_parents: master_parents,\n    //         tree_owner_id: tree_owner_id,\n    //         node_id: node_id,\n    //         target: \"child\",\n    //         parent_node_name: \"\",\n    //     },\n    //      fn_name: \"add_to_node_name_tree\"\n    // }\n//     {\n//         payload: {\n//             user_id: system_id,\n//             portal_id: system_id,\n//             node_name: group_name_employee,\n//             include_data: false,\n//             include_head: true,\n//             tree_owner_id: system_id\n//         },\n//         fn_name: fn_name_get\n//     }\n// ];\n\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":311,"y":331,"wires":[["29a43d11.14e032"]]},{"id":"d190a76f.b04498","type":"inject","z":"fd45fa66.787ec8","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":132,"y":335,"wires":[["2d802281.11fbfe"]]},{"id":"29a43d11.14e032","type":"Tree View","z":"fd45fa66.787ec8","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":498,"y":324,"wires":[["85d7275a.4c6d68"]]},{"id":"85d7275a.4c6d68","type":"debug","z":"fd45fa66.787ec8","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":680,"y":324,"wires":[]},{"id":"d043cfb5.0aed6","type":"comment","z":"fd45fa66.787ec8","name":"Create database functions for company (Root)","info":"","x":206,"y":272,"wires":[]},{"id":"4c38e057.f811c","type":"function","z":"fd45fa66.787ec8","name":"data.js","func":"var init_load = [\n\t\t{\n            payload: {\n                user_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id,\n                portal_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id,\n                node_name: \"testGroup\",\n                data_id: \"ef1176ca84ab3d1d2ff86d4cbe2d890c\", //company_id\n                master_parents: [],\n                tree_owner_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //tree_owner_id,\n                node_id: null,\n                target: \"parent\",\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\", //fn_name_add\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":295,"y":528,"wires":[["8c6a3f22.62eab"]]},{"id":"49deba56.63a3c4","type":"inject","z":"fd45fa66.787ec8","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":116,"y":532,"wires":[["4c38e057.f811c"]]},{"id":"8c6a3f22.62eab","type":"Tree View","z":"fd45fa66.787ec8","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":482,"y":521,"wires":[["11493495.4df98b"]]},{"id":"11493495.4df98b","type":"debug","z":"fd45fa66.787ec8","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":664,"y":521,"wires":[]},{"id":"ee88354d.2c6468","type":"comment","z":"fd45fa66.787ec8","name":"Create parent (Portals)","info":"","x":120,"y":469,"wires":[]},{"id":"61362678.d23778","type":"function","z":"fd45fa66.787ec8","name":"data.js","func":"var init_load = [\n\t\t {\n            payload: {\n                user_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id,\n                portal_id: \"ef1176ca84ab3d1d2ff86d4cbe2d890c\", //company_id,\n                node_name: \"page1\",\n                data_id: \"05fa3f81abd0abf3d6463a47342110c2\",// *CHANGE THIS *, \n                master_parents: [], //should be array in nature\n                tree_owner_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //tree_owner_id,\n                node_id: null,\n                target: \"child\",\n                parent_node_name: \"\",\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":292,"y":700,"wires":[["f5be77b0.62b548"]]},{"id":"76d1f890.568528","type":"inject","z":"fd45fa66.787ec8","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":112,"y":703,"wires":[["61362678.d23778"]]},{"id":"f5be77b0.62b548","type":"Tree View","z":"fd45fa66.787ec8","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":478,"y":692,"wires":[["81baf01.a43ad1","e159cd32.010cb"]]},{"id":"81baf01.a43ad1","type":"debug","z":"fd45fa66.787ec8","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":660,"y":692,"wires":[]},{"id":"50e12579.43b0dc","type":"comment","z":"fd45fa66.787ec8","name":"Create child (Field Data)","info":"","x":116,"y":640,"wires":[]},{"id":"eb2b9f34.21231","type":"function","z":"fd45fa66.787ec8","name":"data.js","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id, 0e5b7ed337ed1bf69f61549a4c8f11df\n\t\t\t\tportal_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id,\n\t\t\t\tnode_name: \"testGroup\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:true,\n\t\t\t\ttree_owner_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":860,"wires":[["5c41c586.37810c"]]},{"id":"d9fa063.1a976f8","type":"inject","z":"fd45fa66.787ec8","name":"","topic":"start","payload":"start1","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":863,"wires":[["eb2b9f34.21231"]]},{"id":"5c41c586.37810c","type":"Tree View","z":"fd45fa66.787ec8","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":476,"y":842,"wires":[["e905353d.0d4668"]]},{"id":"e905353d.0d4668","type":"debug","z":"fd45fa66.787ec8","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":658,"y":852,"wires":[]},{"id":"f8d46cd0.9e526","type":"comment","z":"fd45fa66.787ec8","name":"Fetch data","info":"","x":74,"y":800,"wires":[]},{"id":"f824c88.b845138","type":"http in","z":"6f1d88a3.034e28","name":"/api/loginscreen","url":"/api/loginscreen","method":"get","upload":false,"swaggerDoc":"","x":102,"y":102,"wires":[["a7c1fcff.f4dc8"]]},{"id":"a7c1fcff.f4dc8","type":"function","z":"6f1d88a3.034e28","name":"Tree Params","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id,\n\t\t\t\tportal_id: \"343872812e70987406017b4f833fa8be\", //system_id,\n\t\t\t\tnode_name: \"testGroup\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:false,\n\t\t\t\ttree_owner_id: \"0e5b7ed337ed1bf69f61549a4c8f11df\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":307.0000114440918,"y":107.00000381469727,"wires":[["e42c51cc.eeae7"]]},{"id":"e42c51cc.eeae7","type":"Tree View","z":"6f1d88a3.034e28","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":462.0000228881836,"y":109.00000476837158,"wires":[["7ab218d2.546c98"]]},{"id":"f1fcbdb8.5438f","type":"inject","z":"6f1d88a3.034e28","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":101,"y":165,"wires":[["a7c1fcff.f4dc8"]]},{"id":"7ab218d2.546c98","type":"function","z":"6f1d88a3.034e28","name":"Create Query","func":"// msg.payload = init_load ;\nnode.warn(msg.payload);\nvar myArr = [];\nvar data = [];\nmsg.payload[0].result.forEach(function(val,key){\n    if(val.my_display_attributes){\n        \n        data.push({\n            meta_data: {\n                to_page_id: val.my_display_attributes.to_page_id,\n                from_page_id: val.my_display_attributes.from_page_id,\n                header: val.my_display_attributes.header_template_id,\n                details: val.my_display_attributes.detail_id,\n                footer: val.my_display_attributes.footer_template_id\n            },\n            child_meta: {\n                to_page_id: val.my_child_display_attributes.to_page_id,\n                from_page_id: val.my_child_display_attributes.from_page_id,\n                header: val.my_child_display_attributes.header_template_id,\n                details: val.my_child_display_attributes.detail_id,\n                footer: val.my_child_display_attributes.footer_template_id\n            },\n            \n            page_id: null,\n            details: {\n                table: val.table,\n                value: val.value,\n                type: val.type,\n                required: val.required,\n                display_defualt: val.display_defualt,\n                seq: val.seq,\n                votes: val.votes,\n            }\n        });\n        \n        if(val.my_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.header_template_id});\n        }\n        if(val.my_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_display_attributes.detail_id});\n        }\n        if(val.my_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.footer_template_id});\n        }\n        if(val.my_child_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.header_template_id});\n        }\n        if(val.my_child_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.detail_id});\n        }\n        if(val.my_child_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.footer_template_id});\n        }\n        \n        \n        \n    }\n   \n})\n\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\nmsg.resData=data;\nnode.warn(msg);\nreturn msg;\n","outputs":1,"noerr":0,"x":646,"y":107.99999809265137,"wires":[["e6aa4864.ab8ef8"]]},{"id":"e6aa4864.ab8ef8","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":348.00000762939453,"y":157.0000114440918,"wires":[["67efec8a.217934"]]},{"id":"b03cab70.286238","type":"debug","z":"6f1d88a3.034e28","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":793.0935173034668,"y":212.7676181793213,"wires":[]},{"id":"67efec8a.217934","type":"function","z":"6f1d88a3.034e28","name":"Add templates into response","func":"// msg.payload = init_load ;\nnode.warn(msg);\nmsg.resData.forEach(function(r_val,r_key){\n    msg.payload.docs.forEach(function(val,key){\n        var meta=msg.resData[r_key].meta_data;\n        var child=msg.resData[r_key].child_meta;\n        for (var prop in meta) {\n            if (meta.hasOwnProperty(prop) && meta[prop] === val._id) {\n                \n                meta[prop]=val.html;\n            }\n        }\n        \n        for (var child_prop in child) {\n            if (child.hasOwnProperty(child_prop) && child[child_prop] === val._id) {\n                \n                child[child_prop]=val.html;\n            }\n        }\n        \n        msg.resData[r_key].meta_data=meta;\n        msg.resData[r_key].child_meta=child;\n    })\n})\n\n\nmsg.payload=msg.resData;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":588.9999732971191,"y":160.00001525878906,"wires":[["b03cab70.286238","58640779.0f5788"]]},{"id":"58640779.0f5788","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":833.0000114440918,"y":161.0000286102295,"wires":[]},{"id":"dbf461eb.9e48f","type":"inject","z":"77744b11.7b9024","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":148,"y":110,"wires":[["856926fe.715818"]]},{"id":"dfb7f8b6.d72208","type":"debug","z":"77744b11.7b9024","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":718,"y":110,"wires":[]},{"id":"856926fe.715818","type":"function","z":"77744b11.7b9024","name":"search","func":"//var query = msg.payload_content.query;\nmsg.payload = {\n    query   : \"table:template\", //\"table:template\",\n    sort: \"_id<string>\"\n};\nreturn msg;\n\n","outputs":1,"noerr":0,"x":178,"y":210,"wires":[["d78a67a5.e304f8"]]},{"id":"d78a67a5.e304f8","type":"cloudant in","z":"77744b11.7b9024","name":"filterBy","cloudant":"","database":"dev-platform2","service":"dev-platform2-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":318.4961035847664,"y":209.80860334262252,"wires":[["c2ef2af9.9bd888","16495fdc.aa782"]]},{"id":"c2ef2af9.9bd888","type":"function","z":"77744b11.7b9024","name":"res","func":"var response = msg.payload;\n    query    = msg.payload_content.query ;\nif(isEmpty(response)){\n    msg.payload = {status: 200, error: false, msg: \"No Record found.\", data: []};\n}else{\n    if(response.length){\n        var users = [] ;\n        for(var i=0; i < response.length; i++){\n            if(response[i].virtual_phone){\n                if(response[i].virtual_phone.toString().search(query.toString()) > - 1){\n                    users.push(response[i]);\n                }\n            }\n        }\n        msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: users};    \n    }else{\n        msg.payload = {status: 200, error: false, msg: \"No Record found.\", data: []};\n    }\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":518,"y":210,"wires":[["dfb7f8b6.d72208"]]},{"id":"16495fdc.aa782","type":"debug","z":"77744b11.7b9024","name":"NewDebug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":380,"y":314,"wires":[]},{"id":"8aa25d74.53ee7","type":"comment","z":"6f1d88a3.034e28","name":"API to get login page","info":"","x":146.5,"y":42,"wires":[]},{"id":"2cc5a91d.0260d6","type":"inject","z":"77744b11.7b9024","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":104,"y":485,"wires":[["94be18e.8690ae8"]]},{"id":"94be18e.8690ae8","type":"function","z":"77744b11.7b9024","name":"search","func":"//var query = msg.payload_content.query;\nmsg.payload = {\n    \n   \"selector\": {\n      \"$or\": [\n         {\n            \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n         },\n         {\n            \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n         }\n      ]\n   }\n\n};\nreturn msg;\n\n","outputs":1,"noerr":0,"x":287,"y":490,"wires":[["d63645f6.c32338"]]},{"id":"d63645f6.c32338","type":"http request","z":"77744b11.7b9024","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":486,"y":482,"wires":[["94f8ebb3.85ae98"]]},{"id":"94f8ebb3.85ae98","type":"debug","z":"77744b11.7b9024","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":737.0935363769531,"y":475.767578125,"wires":[]},{"id":"44550306.2b7fbc","type":"comment","z":"77744b11.7b9024","name":"Search query column name","info":"","x":184.5,"y":49,"wires":[]},{"id":"e2f9529f.311db","type":"comment","z":"77744b11.7b9024","name":"Search query to multiple records based in _id","info":"","x":210.5,"y":437,"wires":[]},{"id":"23a1ab1c.524364","type":"inject","z":"77744b11.7b9024","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":97,"y":609,"wires":[["b8d849fc.ccace8"]]},{"id":"b8d849fc.ccace8","type":"function","z":"77744b11.7b9024","name":"","func":"var a=5;\nnode.warn(\"is it working?\",a);\n\nreturn msg;","outputs":1,"noerr":0,"x":271.5,"y":610,"wires":[["2f1788fe.ec1148"]]},{"id":"2f1788fe.ec1148","type":"debug","z":"77744b11.7b9024","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":443,"y":606,"wires":[]},{"id":"5a4bbb74.9fdf24","type":"function","z":"51119cab.bd09e4","name":"phone","func":"msg.payload = {\n    query: \"table:users AND virtual_phone:\" + msg.user_data.phone\n};\n\nnode.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":492.0000114440918,"y":182.99999809265137,"wires":[["fbaf5605.d97998"]]},{"id":"85a945ea.01fa78","type":"debug","z":"51119cab.bd09e4","name":"Going to save user if not found in db","active":true,"tosidebar":true,"console":false,"complete":"payload","x":489,"y":287,"wires":[]},{"id":"a24f52d8.70283","type":"function","z":"51119cab.bd09e4","name":"Merge data for update","func":"var db_data = msg.db_output, user_data = msg.user_data, payload = {};\nnode.warn(msg);\nmsg.verification_code = rand();\n\nif(isEmpty(db_data)) {\n    var userObj = {\n        table       : \"users\",\n        access_token:  null,\n        phone       :  parseInt(user_data.phone),\n        virtual_phone: parseInt(user_data.phone),\n        security_level: 0,\n        firstname         : parseInt(user_data.phone) || \"\",\n        lastname          : \"\",\n        code:         msg.verification_code,\n        type: {\n            \"public\": \"public\"\n        },\n        data: {},\n        device_id: msg.user_data.device_id || \"\",\n        push_accepted: msg.push_accepted || 1\n    };\n}else {\n    var userObj = db_data[0];\n    \n    userObj.phone           = userObj.phone || parseInt(user_data.phone) ;\n    userObj.virtual_phone   = userObj.virtual_phone || parseInt(user_data.phone) ;\n    userObj.long_url        = userObj.long_url || \"\";\n    userObj.access_token    = userObj.access_token ;\n    userObj.security_level  = userObj.security_level;\n    userObj.email           = userObj.email || \"\";\n    userObj.firstname       = userObj.firstname || \"\";\n    userObj.lastname        = userObj.lastname || \"\";\n    userObj.code            = msg.verification_code;\n    userObj.data            = userObj.data;\n    userObj.image           = userObj.image || \"\";\n    userObj.device_id       = msg.user_data.device_id || userObj.device_id;\n    userObj.push_accepted   = msg.push_accepted || userObj.push_accepted;\n}\n\n\n\nmsg.security_level = userObj.security_level ;\nmsg.payload={docs: []};\nmsg.payload.docs.push(userObj);\n\nreturn msg;\n\nfunction rand() {\n    return Math.floor(1000 + Math.random() * 9000);\n}\n\nfunction token() {\n    return new Date().getTime() + \".\" +Math.random().toString(36).substr(2) ;\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n","outputs":1,"noerr":0,"x":180,"y":320,"wires":[["85a945ea.01fa78","3178c028.48b66","3570503f.5e9d9"]]},{"id":"3b032e46.990442","type":"http in","z":"51119cab.bd09e4","name":"","url":"/api/login","method":"post","upload":false,"swaggerDoc":"","x":98.00000381469727,"y":181.00000095367432,"wires":[["3cdf1950.2334d6","93578087.8cced"]]},{"id":"3cdf1950.2334d6","type":"change","z":"51119cab.bd09e4","name":"Move to user_data","rules":[{"t":"move","p":"payload","pt":"msg","to":"user_data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":180,"wires":[["5a4bbb74.9fdf24"]]},{"id":"fbaf5605.d97998","type":"cloudant in","z":"51119cab.bd09e4","name":"get user by phone","cloudant":"","database":"dev-platform2","service":"dev-platform2-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":668.9999694824219,"y":178.99999237060547,"wires":[["1450a953.b45247"]]},{"id":"1450a953.b45247","type":"change","z":"51119cab.bd09e4","name":"Move to db_output","rules":[{"t":"move","p":"payload","pt":"msg","to":"db_output","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":953,"y":178,"wires":[["a24f52d8.70283"]]},{"id":"6df43139.a5891","type":"cloudant out","z":"51119cab.bd09e4","name":"save user to db","cloudant":"","database":"dev-platform2","service":"dev-platform2-cloudantNoSQLDB","payonly":true,"operation":"insert","x":427.00003814697266,"y":337.0000400543213,"wires":[]},{"id":"50a0ffd0.eb1fe","type":"http in","z":"51119cab.bd09e4","name":"","url":"/api/verify","method":"get","upload":false,"swaggerDoc":"","x":102,"y":763,"wires":[["3a764a89.a0ac16","cc39aa21.8d2aa8"]]},{"id":"3a764a89.a0ac16","type":"change","z":"51119cab.bd09e4","name":"Move to request_data","rules":[{"t":"move","p":"payload","pt":"msg","to":"request_data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":327,"y":764,"wires":[["59c628dd.3d6058"]]},{"id":"59c628dd.3d6058","type":"function","z":"51119cab.bd09e4","name":"2. user_phone","func":"node.warn(msg);\nif(isEmpty(msg.request_data.phone)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`phone` is required to fullfil request\", data: null};\n}else if(isEmpty(msg.request_data.code)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`code` is required to fullfil request\", data: null};\n }else if(isEmpty(msg.request_data.device_id)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`device_id` is required to fullfil request\", data: null};\n}else if(isEmpty(msg.request_data.push_accepted)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`push_accepted` is required to fullfil request\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.payload = {\n        query: \"table: users AND virtual_phone:\"+ msg.request_data.phone\n    };    \n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n","outputs":1,"noerr":0,"x":527,"y":764,"wires":[["6d7a27c8.893ce8"]]},{"id":"3178c028.48b66","type":"switch","z":"51119cab.bd09e4","name":"security_level","property":"security_level","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":2,"x":414.0000457763672,"y":382.00004863739014,"wires":[["2a7d53e0.dced7c"],["8dd43d44.14e72"]]},{"id":"954696c.bafd768","type":"cloudant in","z":"51119cab.bd09e4","name":"get user by token","cloudant":"","database":"dev-platform2","service":"dev-platform2-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":908.9999694824219,"y":802.0000305175781,"wires":[["1a1b0d87.0a7ff2"]]},{"id":"1a1b0d87.0a7ff2","type":"change","z":"51119cab.bd09e4","name":"Move to db_user","rules":[{"t":"move","p":"payload","pt":"msg","to":"db_user","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":209,"y":844,"wires":[["f995c04.e3c714"]]},{"id":"f995c04.e3c714","type":"function","z":"51119cab.bd09e4","name":"check verify code","func":"var db_data = msg.db_user, request_data = msg.request_data;\nvar response = {};\n\nfunction check_obj(obj){\n    if(obj === null || obj === undefined){\n        return 0;\n    }else{\n        return Object.keys(obj).length;\n    }\n}\n\nif(check_obj(db_data) > 0) {\n    var db_code = db_data[0].code;\n    //db_code = \"1234\";\n    if(String(db_data[0].virtual_phone).length == 5){\n        if(request_data.code == 1234){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        } \n    }else if(String(db_data[0].virtual_phone).length > 7 &&  String(db_data[0].virtual_phone).length <= 12){\n        if(parseInt(request_data.code) == db_code){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        } \n    }else{\n        if(request_data.code == db_code){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        }    \n    }\n}\nelse{\n    response.status = \"fail\";\n    response.msg = \"Invalid Token\";\n}\n\nnode.warn(response)\nmsg.payload = response;\n\nreturn msg;","outputs":1,"noerr":0,"x":469,"y":844,"wires":[["52edf381.58a6ec"]]},{"id":"9e383d70.2aaf3","type":"http response","z":"51119cab.bd09e4","name":"API Result","x":1029.0000305175781,"y":980.0000381469727,"wires":[]},{"id":"52edf381.58a6ec","type":"switch","z":"51119cab.bd09e4","name":"Status","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"success","vt":"str"},{"t":"eq","v":"fail","vt":"str"}],"checkall":"true","outputs":2,"x":249,"y":924,"wires":[["8e55d130.557ca"],["d8229085.52795"]]},{"id":"a6a9a5db.99d908","type":"function","z":"51119cab.bd09e4","name":"2. return menu page","func":"var response = {\n    \"page_id\":  return_page_id(msg.payload.virtual_phone),\n    \"access_token\": msg.access_token,\n    \"user_id\":  msg.payload._id,\n    \"status\":   \"valid\"\n};\nmsg.payload = response;\nreturn msg;\n\nfunction return_page_id(number){\n    if(number){\n        if( ( Number(number) === 12313426657) || (Number(number) === 12068835352) ){ //Jessica Rohloff/Kyle  Number then return 26\n            return 26 ;//stumped category page......\n        }else{\n            return 2; //category page \n        }\n    }else{\n        node.warn(\"When user virtual_phone is undefined in verification process.\");\n        return 1; //else login page\n    }\n}","outputs":1,"noerr":0,"x":759,"y":944,"wires":[["9e383d70.2aaf3","5ad72049.6639"]]},{"id":"8e2caf7e.f0c3c","type":"cloudant out","z":"51119cab.bd09e4","name":"update security level","cloudant":"","database":"dev-platform2","service":"dev-platform2-cloudantNoSQLDB","payonly":true,"operation":"insert","x":779,"y":884,"wires":[]},{"id":"8e55d130.557ca","type":"function","z":"51119cab.bd09e4","name":"Merge data for update","func":"var db_data = msg.db_user[0] ,\n    body    = msg.request_data ;\n    \nmsg.access_token = token();\n\ndb_data.access_token   = msg.access_token;\ndb_data.security_level = 1 ;\ndb_data.device_token = populate_device_token(db_data.device_token, body) ;\ndb_data.push_accepted = parseInt(body.push_accepted) || 1 ;\n\nmsg.payload = db_data;\nreturn msg;\n\n\nfunction token() {\n    return new Date().getTime() + \".\" +Math.random().toString(36).substr(2) ;\n}\n\nfunction populate_device_token(device_detail, req_body){\n    if(isEmpty(device_detail)){\n        if( (req_body.device_id == \"Web View\") || (req_body.device_type == \"Web Browser\")){\n            return {};\n        }else{\n            var temp = {};\n            temp[req_body.device_fingerprint] = {\n              device_type: req_body.device_type ,\n              device_id  : req_body.device_id\n            };\n            return temp ;\n        }\n    }else{\n        var local_temp = {};\n        local_temp[req_body.device_fingerprint] = {\n          device_type: req_body.device_type ,\n          device_id  : req_body.device_id\n        };\n        return Object.assign(device_detail, local_temp);\n    }    \n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":479,"y":924,"wires":[["a6a9a5db.99d908","8e2caf7e.f0c3c"]]},{"id":"d8229085.52795","type":"function","z":"51119cab.bd09e4","name":"1. return login page","func":"var payload = {\n    \"page_id\":  1,\n    \"status\":   \"invalid\"\n};\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":479,"y":1004,"wires":[["c996ddac.ed9d8","7c856c9f.706c74"]]},{"id":"93578087.8cced","type":"debug","z":"51119cab.bd09e4","name":"API Login ","active":true,"tosidebar":true,"console":false,"complete":"true","x":269,"y":142.99999237060547,"wires":[]},{"id":"cc39aa21.8d2aa8","type":"debug","z":"51119cab.bd09e4","name":"Verify screeen","active":true,"console":"false","complete":"true","x":326,"y":703,"wires":[]},{"id":"2a7d53e0.dced7c","type":"function","z":"51119cab.bd09e4","name":"11. return verify page & ac","func":"var req_body = msg.user_data ;\nnode.warn(\"test\");\nif(msg.user_data.phone){\n  \n    if(String(msg.user_data.phone).length === 4){\n        msg.sendverification = \"no_need_to_send\";\n        msg.api_response = {\n            \"page_id\":      11,\n            \"code\" : msg.verification_code\n        };\n    }else{\n        if(String(msg.user_data.phone).length >= 7 && String(msg.user_data.phone).length <= 12){\n            msg.sendverification = \"need_to_send_verification\" ;\n            msg.api_response = {\n                \"page_id\":      11,\n                \"code\" : msg.verification_code\n            };    \n        }else{\n            msg.sendverification = \"no_need_to_send\" ;\n            msg.api_response = {\n                \"page_id\":      1,\n                \"code\" : msg.verification_code,\n                \"msg\"  : \"Invalid phone number\"\n            };\n        }\n    }\n}else{\n    msg.sendverification = \"no_need_to_send\" ;\n    msg.api_response = {\n                \"page_id\":      1,\n                \"code\" : msg.verification_code,\n                \"msg\"  : \"Invalid phone number\"\n            };\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":675.88671875,"y":343.48828125,"wires":[["72119193.7aa5e"]]},{"id":"72119193.7aa5e","type":"switch","z":"51119cab.bd09e4","name":"","property":"sendverification","propertyType":"msg","rules":[{"t":"eq","v":"need_to_send_verification","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":937.515625,"y":361.25,"wires":[["35a957ea.458b68"],["7e91672b.62bab8"]]},{"id":"35a957ea.458b68","type":"function","z":"51119cab.bd09e4","name":"send sms code","func":"var user_data = msg.user_data;\nvar code = msg.verification_code || 1234;\nmsg.topic = user_data.phone || 12145644732;\nmsg.payload = \"Your verification code for the DoMeNow app is : \" + code;\n\nreturn msg;","outputs":1,"noerr":0,"x":1120.515625,"y":313,"wires":[["847004da.8741b8","a7b30f2b.35c5","513105ec.22f65c"]]},{"id":"847004da.8741b8","type":"debug","z":"51119cab.bd09e4","name":"Responded via Twilio","active":true,"console":"false","complete":"true","x":1410.515625,"y":336,"wires":[]},{"id":"dc47dbcc.029898","type":"http response","z":"51119cab.bd09e4","name":"API Result","x":1545.515625,"y":236.25,"wires":[]},{"id":"a7b30f2b.35c5","type":"change","z":"51119cab.bd09e4","name":"change","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1367.3828125,"y":236.16796875,"wires":[["dc47dbcc.029898"]]},{"id":"7e91672b.62bab8","type":"change","z":"51119cab.bd09e4","name":"change","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1099.640625,"y":370.1640625,"wires":[["ffa81b4.49df6e8","92834ddd.bf31"]]},{"id":"ffa81b4.49df6e8","type":"http response","z":"51119cab.bd09e4","name":"Api result","x":1371.62499076128,"y":387.15234177559614,"wires":[]},{"id":"92834ddd.bf31","type":"debug","z":"51119cab.bd09e4","name":"api_response ","active":true,"console":"false","complete":"payload","x":1385,"y":432,"wires":[]},{"id":"c996ddac.ed9d8","type":"debug","z":"51119cab.bd09e4","name":"login page return again","active":true,"tosidebar":true,"console":false,"complete":"payload","x":733.8333969116211,"y":1085.0000705718994,"wires":[]},{"id":"5ad72049.6639","type":"debug","z":"51119cab.bd09e4","name":"menu page return ","active":true,"console":"false","complete":"payload","x":1046.8334045410156,"y":929.0000178019206,"wires":[]},{"id":"6d7a27c8.893ce8","type":"switch","z":"51119cab.bd09e4","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_SUCCESS","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":699.8333435058594,"y":733.6667175292969,"wires":[["954696c.bafd768"],["26f89028.5c951","2fefd434.8028cc"]]},{"id":"26f89028.5c951","type":"http response","z":"51119cab.bd09e4","name":"","x":872.8333435058594,"y":738.6667175292969,"wires":[]},{"id":"c3b94ddc.c5ba5","type":"comment","z":"51119cab.bd09e4","name":"Following code referes to \"/api/verfiy\" endpoint. which whill check if verfiy code is valid or not if valid then re-direct to Category screen else re-direct back to login screen","info":"","x":567.2421875,"y":638.59375,"wires":[]},{"id":"b32615d4.300398","type":"comment","z":"51119cab.bd09e4","name":"Login `/api/login` flow is following. To check existing number , send verification code, re-direct to verification screen are done by following code.","info":"","x":503.2421875,"y":76.6015625,"wires":[]},{"id":"8dd43d44.14e72","type":"function","z":"51119cab.bd09e4","name":"send sms code","func":"node.warn(msg)\nvar user_data = msg.payload.docs[0];\nvar code = user_data.code || 1234;\nmsg.topic = user_data.virtual_phone || 12145644732;\nmsg.payload = \"Your verification code for the Dri List app is : \" + code;\n\n\nmsg.api_response = {\n    \"page_id\":      11,\n    \"code\" : user_data.code\n};\n        \nreturn msg;","outputs":1,"noerr":0,"x":620.333324432373,"y":492.0000305175781,"wires":[["68dbd89e.fca588","6b286a5a.48b0e4","a754f892.2a9b28"]]},{"id":"68dbd89e.fca588","type":"debug","z":"51119cab.bd09e4","name":"Responded via Twilio","active":true,"tosidebar":true,"console":false,"complete":"true","x":884.3333129882812,"y":516,"wires":[]},{"id":"6b286a5a.48b0e4","type":"change","z":"51119cab.bd09e4","name":"change","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":844.2005767822266,"y":412.16796875,"wires":[["38398a70.0617d6"]]},{"id":"38398a70.0617d6","type":"http response","z":"51119cab.bd09e4","name":"API Result","x":1019.3333129882812,"y":416.25,"wires":[]},{"id":"7c856c9f.706c74","type":"http response","z":"51119cab.bd09e4","name":"response","x":694.125,"y":1036.8984375,"wires":[]},{"id":"2fefd434.8028cc","type":"debug","z":"51119cab.bd09e4","name":"","active":true,"console":"false","complete":"false","x":892.8333435058594,"y":696.6666669845581,"wires":[]},{"id":"a754f892.2a9b28","type":"twilio out","z":"51119cab.bd09e4","service":"_ext_","twilio":"6e6ca2b2.e479bc","from":"","number":"","name":"","x":873.5,"y":468,"wires":[]},{"id":"513105ec.22f65c","type":"twilio out","z":"51119cab.bd09e4","service":"_ext_","twilio":"6e6ca2b2.e479bc","from":"","number":"","name":"","x":1398,"y":284,"wires":[]},{"id":"e159cd32.010cb","type":"function","z":"fd45fa66.787ec8","name":"data.js","func":"node.warn(msg)\n\t\n// msg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":607,"y":739,"wires":[[]]},{"id":"6e0e33d1.06a31c","type":"comment","z":"b32e01b.0ab74","name":"Create `Grand parent` records i.e (company/groups)","info":"","x":268,"y":59,"wires":[]},{"id":"6c284755.3427d8","type":"Tree View","z":"b32e01b.0ab74","database":"master_table","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":629.0000190734863,"y":79.01040267944336,"wires":[["9ef87bb1.e84c58"]]},{"id":"a3cb9543.e3f288","type":"inject","z":"b32e01b.0ab74","name":"start","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"x":153.0000228881836,"y":136.01043510437012,"wires":[["9e3313c1.06855"]]},{"id":"9ef87bb1.e84c58","type":"debug","z":"b32e01b.0ab74","name":"output","active":true,"console":"false","complete":"payload","x":814.0000190734863,"y":78.01041030883789,"wires":[]},{"id":"5a8cdfb9.d1f51","type":"function","z":"b32e01b.0ab74","name":"init_load","func":"var system_id = \"0e5b7ed337ed1bf69f61549a4c8f11df\", //\"system_id\"; // user \n\tcompany_id = \"343872812e70987406017b4f833fa8be\", // Company Reminderbot Id \n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n\n\nvar init_load = [\n\t\t{\n\t\t\t// set up grandfather for get_page\n\t\t\t//0\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get_page,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for get_node_name_tree\n\t\t\t//1\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for add_to_node_name_tree\n\t\t\t//2\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_add,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for delete_from_node_name_tree\n\t\t\t//3\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_del,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n// \t\t// system_id create system_id company node_name\n// \t\t// set up grandfather for \"company\"\n// \t\t// at the same time add those to the actions created above -- note companies can add, get, delete, get page\n// \t\t//4\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: [name_get_page + system_id, name_add + system_id, name_del + system_id, name_get+ system_id],\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n\t\t// system_id add reminder_bot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n\t\t// company id ie reminderbot_id is now authroized to company stuff\n\t\t//5\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: system_id,\n\t\t\t\tportal_id: system_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: company_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"parent\",\n\t\t\t\tparent_node_name:\"portal\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_co is now been authorized by reminder_bot_id to do company stuff \n// // \t\t//6\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tdata_id: user_id_co,\n// \t\t\t\tmaster_parents: master_parents,\n// \t\t\t\ttree_owner_id: tree_owner_id,\n// \t\t\t\tnode_id: node_id,\n// \t\t\t\ttarget: \"child\",\n// \t\t\t\tparent_node_name:\"\",\n// \t\t\t},\n// \t\t\tfn_name: fn_name_add\n// \t\t},\n// // \t\t//check if the \"company tree\" got added right\n// // \t\t//7\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t// system_id create system_id employee node_name\n// // \t\t// at the same time add those to the actions created above -- this one per node_name\n// // \t\t// employees cannot delete\n// // \t\t//8\n// \t\t{\n// \t\t    payload :  {\n//              user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tsystem_id, \n// \t\t\t\tmaster_parents: \t[\"get_node_name_tree\"+system_id, \"add_to_node_name_tree\"+system_id], \n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"grand\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// system_id add reminderbot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n// // \t\t//9\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tcompany_id, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\" ,\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_employee has not been authorized to do reminderbot_id employee stuff\n// // \t\t//10\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_employee, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// view results of group_name_company\n// \t\t//11\n// \t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t//12\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_co, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// \t\t//13\n// \t\t\t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n\n\n// // \t\t// #14\n// // \t\t//add page to existing company record\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\tgroup_name_page, // the id of the page is like reminder_bot\n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\t\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t//15\n// // \t\t// add specific ITEMS to this company/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//16\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem2, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// \t\t//17\n// \t\t// add parent of page to employees\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\tgroup_name_page, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t}, \n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// 18\n// // \t\t// add specific ITEMS to this employee/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//19\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,//true,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//20\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//21\n// \t\t//now get\n// \t\t{\n// \t\t    payload :  {\n// \t\t        user_id: \t\t    user_id_employee, //or user_id_co\n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tpage_id:  \t\t\tgroup_name_page,\n// \t\t\t\tfilter: \t\t\tnull\n// \t\t},\n// \t\t\tfn_name:fn_get_page\n// \t\t},\n// \t\t{\n// \t\t    payload: {\n// \t\t        user_id: user_id_employee, //or user_id_co\n// \t\t        portal_id: company_id,\n// \t\t        page_id: group_name_page,\n// \t\t        filter: [group_name_employee, group_name_company] //group_name_company\n// \t\t    },\n// \t\t    fn_name: fn_get_page\n// \t\t}\n\t];\n\n// var init_load = [\n    // {\n    //     payload: {\n    //         user_id: system_id,\n    //         portal_id: company_id,\n    //         node_name: group_name_employee,\n    //         data_id: \"51fd8f4edcac9037a23548efd2805586\",\n    //         master_parents: master_parents,\n    //         tree_owner_id: tree_owner_id,\n    //         node_id: node_id,\n    //         target: \"child\",\n    //         parent_node_name: \"\",\n    //     },\n    //      fn_name: \"add_to_node_name_tree\"\n    // }\n//     {\n//         payload: {\n//             user_id: system_id,\n//             portal_id: system_id,\n//             node_name: group_name_employee,\n//             include_data: false,\n//             include_head: true,\n//             tree_owner_id: system_id\n//         },\n//         fn_name: fn_name_get\n//     }\n// ];\n\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":443.99999237060547,"y":115.01040458679199,"wires":[["6c284755.3427d8","16123cca.509083"]]},{"id":"9e3313c1.06855","type":"function","z":"b32e01b.0ab74","name":"data.js","func":"var\n\tsystem_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // user\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\"; // detail associated with task above\n\nvar object = {\n    node_original1: {\n    \t\"f1b5ed9577f69c6b131d94a46b39044f\": {\n    \t\t\"_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"access_token\": \"1515420557174.o0i9pckra2xtxt6s9v28lrf6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 1234,\n    \t  \t\"virtual_phone\": 11234,\n    \t  \t\"email\": \"admin@drilist.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"admin\",\n    \t  \t\"lastname\": \"user\",\n    \t  \t\"code\": 9489,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"device_token\": {},\n    \t  \t\"push_accepted\": 1\n    \t},\n    \t\"fa1785333117ba7c06b9020a6d3c0079\": {\n    \t\t\"_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"access_token\": \"1505915176652.8bwoh8j7fft8jjpa59zjb57b9\",\n    \t  \t\"phone\": 12312259665,\n    \t  \t\"firstname\": \"Reminder\",\n    \t  \t\"lastname\": \"Bot\",\n    \t  \t\"virtual_phone\": 12312259665,\n    \t  \t\"security_level\": 1,\n    \t  \t\"code\": 6440,\n    \t  \t\"type\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"long_url\": \"\",\n    \t  \t\"email\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"timezone\": \"America/Los_Angeles\"\n    \t},\n    \t\"da9976858d8bda52021754cf1909a327\": {\n    \t\t\"_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"table\": \"users\",\n      \t\t\"long_url\": \"\",\n    \t  \t\"user_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"access_token\": \"1512367299166.6gs5wh40wadlyvaniqi3jfko6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 917696016749,\n    \t  \t\"virtual_phone\": 917696016749,\n    \t  \t\"email\": \"mss.parveensachdeva@gmail.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Parveen\",\n    \t  \t\"lastname\": \"Sachdeva\",\n    \t  \t\"code\": 6501,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\",\n    \t    \t\"admin\": \"admin\",\n    \t    \t\"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"9C23D678-F1CA-44A1-AACB-B0871FFBF920\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {}\n    \t},\n    \t\"0a9b50963bc76018418ffd857d551ced\": {\n    \t\t\"_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"user_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"access_token\": \"1514977855897.ppl38hod8cea08dabzzrggb9\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 12145644732,\n    \t  \t\"virtual_phone\": 12145644732,\n    \t  \t\"email\": \"roger@dri.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Roger\",\n    \t  \t\"lastname\": \"Colburn\",\n    \t  \t\"code\": 9512,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\",\n    \t\t    \"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {},\n    \t  \t\"timezone\": \"America/New_York\"\n    \t},\n    \t\"2_0\": {\n    \t\t\"_id\": \"2_0\",\n    \t\t\"table\": \"task_table\",\n    \t  \t\"task_name\": \"Categories\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_page_id\": 0,\n    \t  \t\"page_id\": 2,\n    \t  \t\"parent_id\": 0,\n    \t  \t\"header_template_id\": \"2_h\",\n    \t  \t\"detail_template_id\": \"2_d\",\n    \t  \t\"footer_template_id\": \"2_f\",\n    \t  \t\"timeout_id\": null,\n    \t  \t\"child_default_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"child_default_task_name\": \"sub_category_task\",\n    \t  \t\"date_created\": \"2017-03-15T10:29:39.453Z\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"category\": \"Categories\",\n    \t  \t\"additional_data_fn\": \"N/A\",\n    \t  \t\"optional_data\": \"\\\"{}\\\"\",\n    \t  \t\"required_data\": \"\\\"{}\\\"\",\n    \t  \t\"offline_expiration_time\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"status\": 1\n    \t},\n    \t\"2_3\": {\n    \t\t\"_id\": \"2_3\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"child_task_id\": \"\",\n      \t\t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": \"9092618242e9895441bc9e978fa15098\",\n    \t  \t\"page_id\": 2,\n    \t  \t\"to_page_id\": 5,\n    \t  \t\"synchronized\": \"true\",\n    \t  \t\"processed\": \"true\",\n    \t  \t\"status\": \"active\",\n    \t  \t\"read\": \"true\",\n    \t  \t\"display_if_empty\": \"true\",\n    \t  \t\"due_date\": \"2017-03-01T04:47:28.084Z\",\n    \t  \t\"offline_expiration_seconds\": 3600,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t    \t\"message\": \"My Chats\"\n    \t  \t},\n    \t  \t\"watson_incoming\": {},\n    \t  \t\"timeout\": {},\n    \t  \t\"user_calculated\": {},\n      \t\t\"location\": [],\n    \t  \t\"defaults\": {\n    \t    \t\"parent\": null,\n    \t    \t\"all_children\": null\n    \t  \t},\n    \t  \t\"count_status\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count_if\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"createdAt\": 1493708443709,\n    \t  \t\"page_ids\": [2]\n    \t},\n    \t\"c01a40e0a39ab7071c72d422a5c96104\": {\n    \t\t\"_id\": \"c01a40e0a39ab7071c72d422a5c96104\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"intent_task_id\": \"2_0\",\n    \t  \t\"child_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": null,\n    \t  \t\"page_id\": 2,\n    \t  \t\"from_page_id\": 1,\n    \t  \t\"to_page_id\": 1502774414284,\n    \t  \t\"synchronized\": 0,\n    \t  \t\"processed\": 0,\n    \t  \t\"status\": 0,\n    \t  \t\"read\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"date_created\": \"2017-08-15T05:20:14.284Z\",\n    \t  \t\"offline_expiration_seconds\": 0,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"private\": \"private\"\n    \t  \t},\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"from_user\": {\n    \t\t    \"firstname\": \"ABC\",\n    \t\t    \"lastname\": \"Burgers\",\n    \t\t    \"email\": \"abc@burgers.com\",\n    \t\t    \"phone\": 11906\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t\t    \"note\": \"Company Owner Section\",\n    \t\t    \"message\": \"ReminderBot\"\n    \t  \t},\n    \t  \t\"template\": {\n    \t    \t\"details\": {\n    \t\t      \"_id\": \"2_d\",\n    \t\t      \"_rev\": \"7-0a8d302a193c0c3770a76652750d7bbb\",\n    \t\t      \"table\": \"template\",\n    \t\t      \"name\": \"Detail\",\n    \t\t      \"html\": \"\",\n    \t\t      \"js\": \"\"\n    \t    \t}\n    \t  },\n    \t  \"timeout\": {},\n    \t  \"user_calculate\": {},\n    \t  \"location\": {},\n    \t  \"default\": {\n    \t    \"parent\": null,\n    \t    \"allchildren\": null\n    \t  },\n    \t  \"count_status\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"count\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 1\n    \t  },\n    \t  \"count_if\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"createdAt\": 1502774414284,\n    \t  \"page_ids\": [2]\n    \t}\n    },\n//     node_original1 : {\n// \t\tsystem_id: {\n// \t\t\t\"_id\": system_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": system_id\n// \t\t},\n// \t\tcompany_id: {\n// \t\t\t\"_id\": company_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\tuser_id_co: {\n// \t\t\t\"_id\": user_id_co,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_co\n// \t\t},\n// \t\tuser_id_employee: {\n// \t\t\t\"_id\": user_id_employee,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_employee\n// \t\t},\n// \t\tgroup_name_page: {\n// \t\t\t\"_id\": group_name_page,\n// \t\t\t\"table\": \"task\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem1: {\n// \t\t\t\"_id\": item1,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem2: {\n// \t\t\t\"_id\": item2,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t}\n// \t},\n    node_original2: {\n\t\t\"987\": {\n\t\t\t\"_id\": \"987\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"999\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testname111\": {\n\t\t\t\"_id\": \"testname111\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testname\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"444\": {\n\t\t\t\"_id\": \"444\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"666\": {\n\t\t\t\"_id\": \"666\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"1001\": {\n\t\t\t\"_id\": \"1001\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"AAA\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"AAA\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1002\": {\n\t\t\t\"_id\": \"1002\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"history\": [],\n\t\t\t\"node_name\": \"\",\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"BBB\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"BBB\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1003\": {\n\t\t\t\"_id\": \"1003\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"CCC\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"CCC\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"444\"],\n\t\t\t\"ancestors\": [\"987\", \"444\"]\n\t\t},\n\t\t\"1004\": {\n\t\t\t\"_id\": \"1004\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"DDD\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"DDD\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"666\"],\n\t\t\t\"ancestors\": [\"987\", \"666\"]\n\t\t},\n\t\t\"999\": {\n\t\t\t\"_id\": \"999\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"AAA\": {\n\t\t\t\"_id\": \"AAA\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"BBB\": {\n\t\t\t\"_id\": \"BBB\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"CCC\": {\n\t\t\t\"_id\": \"CCC\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"DDD\": {\n\t\t\t\"_id\": \"DDD\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"111\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testfnsystem_id\": {\n\t\t\t\"_id\": \"testfn\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testfn\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"get_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"get_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"get node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"add_to_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"add_to_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"add to node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_from_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"delete_from_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete from node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"delete_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"create_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"create_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"create node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"companiessystem_id\": {\n\t\t\t\"_id\": \"companies\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"companies\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"reminderbot_company_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_company_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"companies\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id]\n\t\t},\n\t\t\"company_reminder_user123_id\": {\n\t\t\t\"_id\": \"company_reminder_user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_company_auth_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\"]\n\t\t},\n\t\t\"employee_actionssystem_id\": {\n\t\t\t\"_id\": \"employee_actions\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employee actions\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employeesystem_id\": {\n\t\t\t\"_id\": \"employee\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employees\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"employee_actions\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id]\n\t\t},\n\t\t\"reminderbot_employee_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_employee_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id]\n\t\t},\n\t\t\"reminderbot_employees_id\": {\n\t\t\t\"_id\": \"reminderbot_employees_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_employee_auth_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\"]\n\t\t},\n\t\t\"employee222_perm_id\": {\n\t\t\t\"_id\": \"employee222_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee222_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"employee333_perm_id\": {\n\t\t\t\"_id\": \"employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"sub_employee333_perm_id\": {\n\t\t\t\"_id\": \"sub_employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\", \"employee444_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee333_perm_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\", \"reminderbot_employees_id\", \"employee333_perm_id\", \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employee333_id\": {\n\t\t\t\"_id\": \"employee333_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee222_id\": {\n\t\t\t\"_id\": \"employee222_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee444_id\": {\n\t\t\t\"_id\": \"employee444_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee555_id\": {\n\t\t\t\"_id\": \"employee555_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"user123_id\"],\n\t\t\t\"ancestors\": [\"user123_id\"]\n\t\t},\n\t\t\"user123_id\": {\n\t\t\t\"_id\": \"user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"reminderbot_id\": {\n\t\t\t\"_id\": \"reminderbot_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id\": {\n\t\t\t\"_id\": \"old\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"old\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id_child\": {\n\t\t\t\"_id\": \"oldsystem_id_child\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"old\" + system_id, \"employee555_id\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"employee555_id\", \"user123_id\"]\n\t\t},\n\t\t\"oldsystem_id_childchild\": {\n\t\t\t\"_id\": \"oldsystem_id_childchild\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"oldsystem_id_child\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"oldsystem_id_child\", \"employee555_id\", \"user123_id\"]\n\t\t}\n    }\n};\n\n\nmsg.node_original1 = object.node_original1  ;\nmsg.node_original2 = object.node_original2  ;\n\nreturn msg;","outputs":1,"noerr":0,"x":292.99998474121094,"y":135.01040267944336,"wires":[["5a8cdfb9.d1f51","12186e6a.56ee02"]]},{"id":"12186e6a.56ee02","type":"debug","z":"b32e01b.0ab74","name":"data.js","active":true,"console":"false","complete":"true","x":437.18747329711914,"y":167.35065460205078,"wires":[]},{"id":"16123cca.509083","type":"debug","z":"b32e01b.0ab74","name":"init.js","active":true,"console":"false","complete":"true","x":615.1840305328369,"y":133.35760498046875,"wires":[]},{"id":"c73fd882.2a7788","type":"Tree View","z":"b32e01b.0ab74","database":"master_table","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":603.9999961853027,"y":301.99996757507324,"wires":[["881585ef.d89458"]]},{"id":"42b4dedd.4f6fb","type":"inject","z":"b32e01b.0ab74","name":"start","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"x":128,"y":359,"wires":[["1ce0d173.2e654f"]]},{"id":"881585ef.d89458","type":"debug","z":"b32e01b.0ab74","name":"output","active":true,"console":"false","complete":"payload","x":788.9999961853027,"y":300.9999752044678,"wires":[]},{"id":"cc0fd902.5ec948","type":"function","z":"b32e01b.0ab74","name":"init_load","func":"var system_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // Company Reminderbot Id\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n\n\nvar init_load = [\n\t\t{\n            payload: {\n                user_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n                portal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n                node_name: \"testGroup\",\n                data_id: \"fa1785333117ba7c06b9020a6d3c0079\", //company_id\n                master_parents: [],\n                tree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //tree_owner_id,\n                node_id: null,\n                target: \"parent\",\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\", //fn_name_add\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":418.9999694824219,"y":337.9999694824219,"wires":[["1c302ccf.e5e873","c73fd882.2a7788"]]},{"id":"1ce0d173.2e654f","type":"function","z":"b32e01b.0ab74","name":"data.js","func":"var\n\tsystem_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // user\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\"; // detail associated with task above\n\nvar object = {\n    node_original1: {\n    \t\"f1b5ed9577f69c6b131d94a46b39044f\": {\n    \t\t\"_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"access_token\": \"1515420557174.o0i9pckra2xtxt6s9v28lrf6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 1234,\n    \t  \t\"virtual_phone\": 11234,\n    \t  \t\"email\": \"admin@drilist.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"admin\",\n    \t  \t\"lastname\": \"user\",\n    \t  \t\"code\": 9489,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"device_token\": {},\n    \t  \t\"push_accepted\": 1\n    \t},\n    \t\"fa1785333117ba7c06b9020a6d3c0079\": {\n    \t\t\"_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"access_token\": \"1505915176652.8bwoh8j7fft8jjpa59zjb57b9\",\n    \t  \t\"phone\": 12312259665,\n    \t  \t\"firstname\": \"Reminder\",\n    \t  \t\"lastname\": \"Bot\",\n    \t  \t\"virtual_phone\": 12312259665,\n    \t  \t\"security_level\": 1,\n    \t  \t\"code\": 6440,\n    \t  \t\"type\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"long_url\": \"\",\n    \t  \t\"email\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"timezone\": \"America/Los_Angeles\"\n    \t},\n    \t\"da9976858d8bda52021754cf1909a327\": {\n    \t\t\"_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"table\": \"users\",\n      \t\t\"long_url\": \"\",\n    \t  \t\"user_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"access_token\": \"1512367299166.6gs5wh40wadlyvaniqi3jfko6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 917696016749,\n    \t  \t\"virtual_phone\": 917696016749,\n    \t  \t\"email\": \"mss.parveensachdeva@gmail.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Parveen\",\n    \t  \t\"lastname\": \"Sachdeva\",\n    \t  \t\"code\": 6501,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\",\n    \t    \t\"admin\": \"admin\",\n    \t    \t\"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"9C23D678-F1CA-44A1-AACB-B0871FFBF920\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {}\n    \t},\n    \t\"0a9b50963bc76018418ffd857d551ced\": {\n    \t\t\"_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"user_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"access_token\": \"1514977855897.ppl38hod8cea08dabzzrggb9\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 12145644732,\n    \t  \t\"virtual_phone\": 12145644732,\n    \t  \t\"email\": \"roger@dri.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Roger\",\n    \t  \t\"lastname\": \"Colburn\",\n    \t  \t\"code\": 9512,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\",\n    \t\t    \"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {},\n    \t  \t\"timezone\": \"America/New_York\"\n    \t},\n    \t\"2_0\": {\n    \t\t\"_id\": \"2_0\",\n    \t\t\"table\": \"task_table\",\n    \t  \t\"task_name\": \"Categories\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_page_id\": 0,\n    \t  \t\"page_id\": 2,\n    \t  \t\"parent_id\": 0,\n    \t  \t\"header_template_id\": \"2_h\",\n    \t  \t\"detail_template_id\": \"2_d\",\n    \t  \t\"footer_template_id\": \"2_f\",\n    \t  \t\"timeout_id\": null,\n    \t  \t\"child_default_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"child_default_task_name\": \"sub_category_task\",\n    \t  \t\"date_created\": \"2017-03-15T10:29:39.453Z\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"category\": \"Categories\",\n    \t  \t\"additional_data_fn\": \"N/A\",\n    \t  \t\"optional_data\": \"\\\"{}\\\"\",\n    \t  \t\"required_data\": \"\\\"{}\\\"\",\n    \t  \t\"offline_expiration_time\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"status\": 1\n    \t},\n    \t\"2_3\": {\n    \t\t\"_id\": \"2_3\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"child_task_id\": \"\",\n      \t\t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": \"9092618242e9895441bc9e978fa15098\",\n    \t  \t\"page_id\": 2,\n    \t  \t\"to_page_id\": 5,\n    \t  \t\"synchronized\": \"true\",\n    \t  \t\"processed\": \"true\",\n    \t  \t\"status\": \"active\",\n    \t  \t\"read\": \"true\",\n    \t  \t\"display_if_empty\": \"true\",\n    \t  \t\"due_date\": \"2017-03-01T04:47:28.084Z\",\n    \t  \t\"offline_expiration_seconds\": 3600,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t    \t\"message\": \"My Chats\"\n    \t  \t},\n    \t  \t\"watson_incoming\": {},\n    \t  \t\"timeout\": {},\n    \t  \t\"user_calculated\": {},\n      \t\t\"location\": [],\n    \t  \t\"defaults\": {\n    \t    \t\"parent\": null,\n    \t    \t\"all_children\": null\n    \t  \t},\n    \t  \t\"count_status\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count_if\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"createdAt\": 1493708443709,\n    \t  \t\"page_ids\": [2]\n    \t},\n    \t\"c01a40e0a39ab7071c72d422a5c96104\": {\n    \t\t\"_id\": \"c01a40e0a39ab7071c72d422a5c96104\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"intent_task_id\": \"2_0\",\n    \t  \t\"child_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": null,\n    \t  \t\"page_id\": 2,\n    \t  \t\"from_page_id\": 1,\n    \t  \t\"to_page_id\": 1502774414284,\n    \t  \t\"synchronized\": 0,\n    \t  \t\"processed\": 0,\n    \t  \t\"status\": 0,\n    \t  \t\"read\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"date_created\": \"2017-08-15T05:20:14.284Z\",\n    \t  \t\"offline_expiration_seconds\": 0,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"private\": \"private\"\n    \t  \t},\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"from_user\": {\n    \t\t    \"firstname\": \"ABC\",\n    \t\t    \"lastname\": \"Burgers\",\n    \t\t    \"email\": \"abc@burgers.com\",\n    \t\t    \"phone\": 11906\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t\t    \"note\": \"Company Owner Section\",\n    \t\t    \"message\": \"ReminderBot\"\n    \t  \t},\n    \t  \t\"template\": {\n    \t    \t\"details\": {\n    \t\t      \"_id\": \"2_d\",\n    \t\t      \"_rev\": \"7-0a8d302a193c0c3770a76652750d7bbb\",\n    \t\t      \"table\": \"template\",\n    \t\t      \"name\": \"Detail\",\n    \t\t      \"html\": \"\",\n    \t\t      \"js\": \"\"\n    \t    \t}\n    \t  },\n    \t  \"timeout\": {},\n    \t  \"user_calculate\": {},\n    \t  \"location\": {},\n    \t  \"default\": {\n    \t    \"parent\": null,\n    \t    \"allchildren\": null\n    \t  },\n    \t  \"count_status\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"count\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 1\n    \t  },\n    \t  \"count_if\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"createdAt\": 1502774414284,\n    \t  \"page_ids\": [2]\n    \t}\n    },\n//     node_original1 : {\n// \t\tsystem_id: {\n// \t\t\t\"_id\": system_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": system_id\n// \t\t},\n// \t\tcompany_id: {\n// \t\t\t\"_id\": company_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\tuser_id_co: {\n// \t\t\t\"_id\": user_id_co,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_co\n// \t\t},\n// \t\tuser_id_employee: {\n// \t\t\t\"_id\": user_id_employee,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_employee\n// \t\t},\n// \t\tgroup_name_page: {\n// \t\t\t\"_id\": group_name_page,\n// \t\t\t\"table\": \"task\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem1: {\n// \t\t\t\"_id\": item1,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem2: {\n// \t\t\t\"_id\": item2,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t}\n// \t},\n    node_original2: {\n\t\t\"987\": {\n\t\t\t\"_id\": \"987\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"999\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testname111\": {\n\t\t\t\"_id\": \"testname111\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testname\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"444\": {\n\t\t\t\"_id\": \"444\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"666\": {\n\t\t\t\"_id\": \"666\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"1001\": {\n\t\t\t\"_id\": \"1001\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"AAA\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"AAA\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1002\": {\n\t\t\t\"_id\": \"1002\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"history\": [],\n\t\t\t\"node_name\": \"\",\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"BBB\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"BBB\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1003\": {\n\t\t\t\"_id\": \"1003\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"CCC\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"CCC\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"444\"],\n\t\t\t\"ancestors\": [\"987\", \"444\"]\n\t\t},\n\t\t\"1004\": {\n\t\t\t\"_id\": \"1004\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"DDD\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"DDD\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"666\"],\n\t\t\t\"ancestors\": [\"987\", \"666\"]\n\t\t},\n\t\t\"999\": {\n\t\t\t\"_id\": \"999\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"AAA\": {\n\t\t\t\"_id\": \"AAA\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"BBB\": {\n\t\t\t\"_id\": \"BBB\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"CCC\": {\n\t\t\t\"_id\": \"CCC\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"DDD\": {\n\t\t\t\"_id\": \"DDD\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"111\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testfnsystem_id\": {\n\t\t\t\"_id\": \"testfn\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testfn\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"get_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"get_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"get node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"add_to_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"add_to_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"add to node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_from_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"delete_from_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete from node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"delete_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"create_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"create_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"create node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"companiessystem_id\": {\n\t\t\t\"_id\": \"companies\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"companies\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"reminderbot_company_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_company_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"companies\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id]\n\t\t},\n\t\t\"company_reminder_user123_id\": {\n\t\t\t\"_id\": \"company_reminder_user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_company_auth_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\"]\n\t\t},\n\t\t\"employee_actionssystem_id\": {\n\t\t\t\"_id\": \"employee_actions\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employee actions\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employeesystem_id\": {\n\t\t\t\"_id\": \"employee\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employees\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"employee_actions\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id]\n\t\t},\n\t\t\"reminderbot_employee_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_employee_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id]\n\t\t},\n\t\t\"reminderbot_employees_id\": {\n\t\t\t\"_id\": \"reminderbot_employees_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_employee_auth_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\"]\n\t\t},\n\t\t\"employee222_perm_id\": {\n\t\t\t\"_id\": \"employee222_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee222_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"employee333_perm_id\": {\n\t\t\t\"_id\": \"employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"sub_employee333_perm_id\": {\n\t\t\t\"_id\": \"sub_employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\", \"employee444_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee333_perm_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\", \"reminderbot_employees_id\", \"employee333_perm_id\", \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employee333_id\": {\n\t\t\t\"_id\": \"employee333_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee222_id\": {\n\t\t\t\"_id\": \"employee222_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee444_id\": {\n\t\t\t\"_id\": \"employee444_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee555_id\": {\n\t\t\t\"_id\": \"employee555_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"user123_id\"],\n\t\t\t\"ancestors\": [\"user123_id\"]\n\t\t},\n\t\t\"user123_id\": {\n\t\t\t\"_id\": \"user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"reminderbot_id\": {\n\t\t\t\"_id\": \"reminderbot_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id\": {\n\t\t\t\"_id\": \"old\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"old\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id_child\": {\n\t\t\t\"_id\": \"oldsystem_id_child\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"old\" + system_id, \"employee555_id\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"employee555_id\", \"user123_id\"]\n\t\t},\n\t\t\"oldsystem_id_childchild\": {\n\t\t\t\"_id\": \"oldsystem_id_childchild\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"oldsystem_id_child\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"oldsystem_id_child\", \"employee555_id\", \"user123_id\"]\n\t\t}\n    }\n};\n\n\nmsg.node_original1 = object.node_original1  ;\nmsg.node_original2 = object.node_original2  ;\n\nreturn msg;","outputs":1,"noerr":0,"x":267.99996185302734,"y":357.99996757507324,"wires":[["cc0fd902.5ec948","9f84ab21.338088"]]},{"id":"9f84ab21.338088","type":"debug","z":"b32e01b.0ab74","name":"data.js","active":true,"console":"false","complete":"true","x":412.18745040893555,"y":390.34021949768066,"wires":[]},{"id":"1c302ccf.e5e873","type":"debug","z":"b32e01b.0ab74","name":"init.js","active":true,"console":"false","complete":"true","x":590.1840076446533,"y":356.34716987609863,"wires":[]},{"id":"bb72707d.670cd","type":"comment","z":"b32e01b.0ab74","name":"create `parent/portal` record  inside a group/company","info":"","x":249,"y":297,"wires":[]},{"id":"b6e8d6ce.db95f8","type":"Tree View","z":"b32e01b.0ab74","database":"master_table","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":598,"y":559,"wires":[["1ff596c5.586d79"]]},{"id":"388ee685.6f45ea","type":"inject","z":"b32e01b.0ab74","name":"start","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"x":122.00000381469727,"y":616.0000324249268,"wires":[["83cc3f21.db36f"]]},{"id":"1ff596c5.586d79","type":"debug","z":"b32e01b.0ab74","name":"output","active":true,"console":"false","complete":"payload","x":783,"y":558.0000076293945,"wires":[]},{"id":"d42a7bae.503988","type":"function","z":"b32e01b.0ab74","name":"init_load","func":"var system_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // Company Reminderbot Id\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n\n\nvar init_load = [\n\t\t {\n            payload: {\n                user_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n                portal_id: \"fa1785333117ba7c06b9020a6d3c0079\", //company_id,\n                node_name: \"testGroup\",\n                data_id: \"5a8aa4984202e00037000014\",// *CHANGE THIS *,\n                master_parents: [], //should be array in nature\n                tree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //tree_owner_id,\n                node_id: null,\n                target: \"child\",\n                parent_node_name: \"\",\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":412.99997329711914,"y":595.0000019073486,"wires":[["1e4460ee.d1547f","b6e8d6ce.db95f8"]]},{"id":"83cc3f21.db36f","type":"function","z":"b32e01b.0ab74","name":"data.js","func":"var\n\tsystem_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // user\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\"; // detail associated with task above\n\nvar object = {\n    node_original1: {\n    \t\"f1b5ed9577f69c6b131d94a46b39044f\": {\n    \t\t\"_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"access_token\": \"1515420557174.o0i9pckra2xtxt6s9v28lrf6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 1234,\n    \t  \t\"virtual_phone\": 11234,\n    \t  \t\"email\": \"admin@drilist.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"admin\",\n    \t  \t\"lastname\": \"user\",\n    \t  \t\"code\": 9489,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"device_token\": {},\n    \t  \t\"push_accepted\": 1\n    \t},\n    \t\"fa1785333117ba7c06b9020a6d3c0079\": {\n    \t\t\"_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"access_token\": \"1505915176652.8bwoh8j7fft8jjpa59zjb57b9\",\n    \t  \t\"phone\": 12312259665,\n    \t  \t\"firstname\": \"Reminder\",\n    \t  \t\"lastname\": \"Bot\",\n    \t  \t\"virtual_phone\": 12312259665,\n    \t  \t\"security_level\": 1,\n    \t  \t\"code\": 6440,\n    \t  \t\"type\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"long_url\": \"\",\n    \t  \t\"email\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"timezone\": \"America/Los_Angeles\"\n    \t},\n    \t\"da9976858d8bda52021754cf1909a327\": {\n    \t\t\"_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"table\": \"users\",\n      \t\t\"long_url\": \"\",\n    \t  \t\"user_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"access_token\": \"1512367299166.6gs5wh40wadlyvaniqi3jfko6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 917696016749,\n    \t  \t\"virtual_phone\": 917696016749,\n    \t  \t\"email\": \"mss.parveensachdeva@gmail.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Parveen\",\n    \t  \t\"lastname\": \"Sachdeva\",\n    \t  \t\"code\": 6501,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\",\n    \t    \t\"admin\": \"admin\",\n    \t    \t\"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"9C23D678-F1CA-44A1-AACB-B0871FFBF920\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {}\n    \t},\n    \t\"0a9b50963bc76018418ffd857d551ced\": {\n    \t\t\"_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"user_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"access_token\": \"1514977855897.ppl38hod8cea08dabzzrggb9\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 12145644732,\n    \t  \t\"virtual_phone\": 12145644732,\n    \t  \t\"email\": \"roger@dri.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Roger\",\n    \t  \t\"lastname\": \"Colburn\",\n    \t  \t\"code\": 9512,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\",\n    \t\t    \"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {},\n    \t  \t\"timezone\": \"America/New_York\"\n    \t},\n    \t\"2_0\": {\n    \t\t\"_id\": \"2_0\",\n    \t\t\"table\": \"task_table\",\n    \t  \t\"task_name\": \"Categories\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_page_id\": 0,\n    \t  \t\"page_id\": 2,\n    \t  \t\"parent_id\": 0,\n    \t  \t\"header_template_id\": \"2_h\",\n    \t  \t\"detail_template_id\": \"2_d\",\n    \t  \t\"footer_template_id\": \"2_f\",\n    \t  \t\"timeout_id\": null,\n    \t  \t\"child_default_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"child_default_task_name\": \"sub_category_task\",\n    \t  \t\"date_created\": \"2017-03-15T10:29:39.453Z\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"category\": \"Categories\",\n    \t  \t\"additional_data_fn\": \"N/A\",\n    \t  \t\"optional_data\": \"\\\"{}\\\"\",\n    \t  \t\"required_data\": \"\\\"{}\\\"\",\n    \t  \t\"offline_expiration_time\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"status\": 1\n    \t},\n    \t\"2_3\": {\n    \t\t\"_id\": \"2_3\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"child_task_id\": \"\",\n      \t\t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": \"9092618242e9895441bc9e978fa15098\",\n    \t  \t\"page_id\": 2,\n    \t  \t\"to_page_id\": 5,\n    \t  \t\"synchronized\": \"true\",\n    \t  \t\"processed\": \"true\",\n    \t  \t\"status\": \"active\",\n    \t  \t\"read\": \"true\",\n    \t  \t\"display_if_empty\": \"true\",\n    \t  \t\"due_date\": \"2017-03-01T04:47:28.084Z\",\n    \t  \t\"offline_expiration_seconds\": 3600,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t    \t\"message\": \"My Chats\"\n    \t  \t},\n    \t  \t\"watson_incoming\": {},\n    \t  \t\"timeout\": {},\n    \t  \t\"user_calculated\": {},\n      \t\t\"location\": [],\n    \t  \t\"defaults\": {\n    \t    \t\"parent\": null,\n    \t    \t\"all_children\": null\n    \t  \t},\n    \t  \t\"count_status\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count_if\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"createdAt\": 1493708443709,\n    \t  \t\"page_ids\": [2]\n    \t},\n    \t\"c01a40e0a39ab7071c72d422a5c96104\": {\n    \t\t\"_id\": \"c01a40e0a39ab7071c72d422a5c96104\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"intent_task_id\": \"2_0\",\n    \t  \t\"child_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": null,\n    \t  \t\"page_id\": 2,\n    \t  \t\"from_page_id\": 1,\n    \t  \t\"to_page_id\": 1502774414284,\n    \t  \t\"synchronized\": 0,\n    \t  \t\"processed\": 0,\n    \t  \t\"status\": 0,\n    \t  \t\"read\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"date_created\": \"2017-08-15T05:20:14.284Z\",\n    \t  \t\"offline_expiration_seconds\": 0,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"private\": \"private\"\n    \t  \t},\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"from_user\": {\n    \t\t    \"firstname\": \"ABC\",\n    \t\t    \"lastname\": \"Burgers\",\n    \t\t    \"email\": \"abc@burgers.com\",\n    \t\t    \"phone\": 11906\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t\t    \"note\": \"Company Owner Section\",\n    \t\t    \"message\": \"ReminderBot\"\n    \t  \t},\n    \t  \t\"template\": {\n    \t    \t\"details\": {\n    \t\t      \"_id\": \"2_d\",\n    \t\t      \"_rev\": \"7-0a8d302a193c0c3770a76652750d7bbb\",\n    \t\t      \"table\": \"template\",\n    \t\t      \"name\": \"Detail\",\n    \t\t      \"html\": \"\",\n    \t\t      \"js\": \"\"\n    \t    \t}\n    \t  },\n    \t  \"timeout\": {},\n    \t  \"user_calculate\": {},\n    \t  \"location\": {},\n    \t  \"default\": {\n    \t    \"parent\": null,\n    \t    \"allchildren\": null\n    \t  },\n    \t  \"count_status\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"count\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 1\n    \t  },\n    \t  \"count_if\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"createdAt\": 1502774414284,\n    \t  \"page_ids\": [2]\n    \t}\n    },\n//     node_original1 : {\n// \t\tsystem_id: {\n// \t\t\t\"_id\": system_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": system_id\n// \t\t},\n// \t\tcompany_id: {\n// \t\t\t\"_id\": company_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\tuser_id_co: {\n// \t\t\t\"_id\": user_id_co,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_co\n// \t\t},\n// \t\tuser_id_employee: {\n// \t\t\t\"_id\": user_id_employee,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_employee\n// \t\t},\n// \t\tgroup_name_page: {\n// \t\t\t\"_id\": group_name_page,\n// \t\t\t\"table\": \"task\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem1: {\n// \t\t\t\"_id\": item1,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem2: {\n// \t\t\t\"_id\": item2,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t}\n// \t},\n    node_original2: {\n\t\t\"987\": {\n\t\t\t\"_id\": \"987\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"999\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testname111\": {\n\t\t\t\"_id\": \"testname111\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testname\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"444\": {\n\t\t\t\"_id\": \"444\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"666\": {\n\t\t\t\"_id\": \"666\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"1001\": {\n\t\t\t\"_id\": \"1001\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"AAA\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"AAA\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1002\": {\n\t\t\t\"_id\": \"1002\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"history\": [],\n\t\t\t\"node_name\": \"\",\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"BBB\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"BBB\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1003\": {\n\t\t\t\"_id\": \"1003\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"CCC\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"CCC\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"444\"],\n\t\t\t\"ancestors\": [\"987\", \"444\"]\n\t\t},\n\t\t\"1004\": {\n\t\t\t\"_id\": \"1004\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"DDD\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"DDD\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"666\"],\n\t\t\t\"ancestors\": [\"987\", \"666\"]\n\t\t},\n\t\t\"999\": {\n\t\t\t\"_id\": \"999\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"AAA\": {\n\t\t\t\"_id\": \"AAA\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"BBB\": {\n\t\t\t\"_id\": \"BBB\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"CCC\": {\n\t\t\t\"_id\": \"CCC\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"DDD\": {\n\t\t\t\"_id\": \"DDD\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"111\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testfnsystem_id\": {\n\t\t\t\"_id\": \"testfn\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testfn\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"get_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"get_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"get node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"add_to_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"add_to_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"add to node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_from_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"delete_from_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete from node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"delete_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"create_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"create_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"create node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"companiessystem_id\": {\n\t\t\t\"_id\": \"companies\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"companies\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"reminderbot_company_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_company_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"companies\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id]\n\t\t},\n\t\t\"company_reminder_user123_id\": {\n\t\t\t\"_id\": \"company_reminder_user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_company_auth_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\"]\n\t\t},\n\t\t\"employee_actionssystem_id\": {\n\t\t\t\"_id\": \"employee_actions\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employee actions\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employeesystem_id\": {\n\t\t\t\"_id\": \"employee\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employees\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"employee_actions\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id]\n\t\t},\n\t\t\"reminderbot_employee_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_employee_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id]\n\t\t},\n\t\t\"reminderbot_employees_id\": {\n\t\t\t\"_id\": \"reminderbot_employees_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_employee_auth_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\"]\n\t\t},\n\t\t\"employee222_perm_id\": {\n\t\t\t\"_id\": \"employee222_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee222_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"employee333_perm_id\": {\n\t\t\t\"_id\": \"employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"sub_employee333_perm_id\": {\n\t\t\t\"_id\": \"sub_employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\", \"employee444_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee333_perm_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\", \"reminderbot_employees_id\", \"employee333_perm_id\", \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employee333_id\": {\n\t\t\t\"_id\": \"employee333_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee222_id\": {\n\t\t\t\"_id\": \"employee222_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee444_id\": {\n\t\t\t\"_id\": \"employee444_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee555_id\": {\n\t\t\t\"_id\": \"employee555_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"user123_id\"],\n\t\t\t\"ancestors\": [\"user123_id\"]\n\t\t},\n\t\t\"user123_id\": {\n\t\t\t\"_id\": \"user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"reminderbot_id\": {\n\t\t\t\"_id\": \"reminderbot_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id\": {\n\t\t\t\"_id\": \"old\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"old\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id_child\": {\n\t\t\t\"_id\": \"oldsystem_id_child\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"old\" + system_id, \"employee555_id\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"employee555_id\", \"user123_id\"]\n\t\t},\n\t\t\"oldsystem_id_childchild\": {\n\t\t\t\"_id\": \"oldsystem_id_childchild\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"oldsystem_id_child\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"oldsystem_id_child\", \"employee555_id\", \"user123_id\"]\n\t\t}\n    }\n};\n\n\nmsg.node_original1 = object.node_original1  ;\nmsg.node_original2 = object.node_original2  ;\n\nreturn msg;","outputs":1,"noerr":0,"x":261.9999656677246,"y":615,"wires":[["d42a7bae.503988","280ce90c.8c1226"]]},{"id":"280ce90c.8c1226","type":"debug","z":"b32e01b.0ab74","name":"data.js","active":true,"console":"false","complete":"true","x":406.1874542236328,"y":647.3402519226074,"wires":[]},{"id":"1e4460ee.d1547f","type":"debug","z":"b32e01b.0ab74","name":"init.js","active":true,"console":"false","complete":"true","x":584.1840114593506,"y":613.3472023010254,"wires":[]},{"id":"5aabc9c2.b60728","type":"comment","z":"b32e01b.0ab74","name":"Add employess under a group or company.","info":"","x":218,"y":539,"wires":[]},{"id":"2e61ed99.20ec32","type":"comment","z":"b32e01b.0ab74","name":"Delete employess from group using the treesofware","info":"","x":248,"y":769,"wires":[]},{"id":"e43a501b.b5b6","type":"inject","z":"b32e01b.0ab74","name":"start","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"x":108,"y":859,"wires":[["4a4b7d71.5bce94"]]},{"id":"f9586c79.f2d91","type":"function","z":"b32e01b.0ab74","name":"init_load","func":"var system_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // Company Reminderbot Id\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n// user_id: \"f1b5ed9577f69c6b131d94a46b39044f\"\n// portal_id: \"fa1785333117ba7c06b9020a6d3c0079\"\n// node_name: \"EmployeeGroup\"\n// data_id: \"fa1785333117ba7c06b9020a6d3c0079\"\n// tree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\"\n// node_id: null\n// target: \"parent\"\n// parent_node_name: \"\"\n// fn_name: \"delete_from_node_name_tree\"\n\nvar init_load = [\n\t\t {\n            payload: {\n                user_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n                portal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //company_id,\n                node_name: \"EmployeeGroup\",\n                data_id: \"910a45bd11d6392688d40eae1eb65233\",// *CHANGE THIS *,\n                tree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //tree_owner_id,\n                node_id: null,\n                target: \"parent\",\n                parent_node_name: \"\",\n            },\n            fn_name: \"delete_from_node_name_tree\"\n        }\n\t];\n//user_id, portal_id, node_name, data_id, tree_owner_id, node_id, target, parent_node_name, callback\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":398,"y":839,"wires":[["d6ad41f2.8e088","8cf26e82.9b507"]]},{"id":"4a4b7d71.5bce94","type":"function","z":"b32e01b.0ab74","name":"data.js","func":"var\n\tsystem_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // user\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\"; // detail associated with task above\n\nvar object = {\n    node_original1: {\n    \t\"f1b5ed9577f69c6b131d94a46b39044f\": {\n    \t\t\"_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"access_token\": \"1515420557174.o0i9pckra2xtxt6s9v28lrf6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 1234,\n    \t  \t\"virtual_phone\": 11234,\n    \t  \t\"email\": \"admin@drilist.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"admin\",\n    \t  \t\"lastname\": \"user\",\n    \t  \t\"code\": 9489,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"device_token\": {},\n    \t  \t\"push_accepted\": 1\n    \t},\n    \t\"fa1785333117ba7c06b9020a6d3c0079\": {\n    \t\t\"_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"access_token\": \"1505915176652.8bwoh8j7fft8jjpa59zjb57b9\",\n    \t  \t\"phone\": 12312259665,\n    \t  \t\"firstname\": \"Reminder\",\n    \t  \t\"lastname\": \"Bot\",\n    \t  \t\"virtual_phone\": 12312259665,\n    \t  \t\"security_level\": 1,\n    \t  \t\"code\": 6440,\n    \t  \t\"type\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"long_url\": \"\",\n    \t  \t\"email\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"timezone\": \"America/Los_Angeles\"\n    \t},\n    \t\"da9976858d8bda52021754cf1909a327\": {\n    \t\t\"_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"table\": \"users\",\n      \t\t\"long_url\": \"\",\n    \t  \t\"user_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"access_token\": \"1512367299166.6gs5wh40wadlyvaniqi3jfko6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 917696016749,\n    \t  \t\"virtual_phone\": 917696016749,\n    \t  \t\"email\": \"mss.parveensachdeva@gmail.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Parveen\",\n    \t  \t\"lastname\": \"Sachdeva\",\n    \t  \t\"code\": 6501,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\",\n    \t    \t\"admin\": \"admin\",\n    \t    \t\"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"9C23D678-F1CA-44A1-AACB-B0871FFBF920\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {}\n    \t},\n    \t\"0a9b50963bc76018418ffd857d551ced\": {\n    \t\t\"_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"user_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"access_token\": \"1514977855897.ppl38hod8cea08dabzzrggb9\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 12145644732,\n    \t  \t\"virtual_phone\": 12145644732,\n    \t  \t\"email\": \"roger@dri.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Roger\",\n    \t  \t\"lastname\": \"Colburn\",\n    \t  \t\"code\": 9512,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\",\n    \t\t    \"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {},\n    \t  \t\"timezone\": \"America/New_York\"\n    \t},\n    \t\"2_0\": {\n    \t\t\"_id\": \"2_0\",\n    \t\t\"table\": \"task_table\",\n    \t  \t\"task_name\": \"Categories\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_page_id\": 0,\n    \t  \t\"page_id\": 2,\n    \t  \t\"parent_id\": 0,\n    \t  \t\"header_template_id\": \"2_h\",\n    \t  \t\"detail_template_id\": \"2_d\",\n    \t  \t\"footer_template_id\": \"2_f\",\n    \t  \t\"timeout_id\": null,\n    \t  \t\"child_default_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"child_default_task_name\": \"sub_category_task\",\n    \t  \t\"date_created\": \"2017-03-15T10:29:39.453Z\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"category\": \"Categories\",\n    \t  \t\"additional_data_fn\": \"N/A\",\n    \t  \t\"optional_data\": \"\\\"{}\\\"\",\n    \t  \t\"required_data\": \"\\\"{}\\\"\",\n    \t  \t\"offline_expiration_time\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"status\": 1\n    \t},\n    \t\"2_3\": {\n    \t\t\"_id\": \"2_3\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"child_task_id\": \"\",\n      \t\t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": \"9092618242e9895441bc9e978fa15098\",\n    \t  \t\"page_id\": 2,\n    \t  \t\"to_page_id\": 5,\n    \t  \t\"synchronized\": \"true\",\n    \t  \t\"processed\": \"true\",\n    \t  \t\"status\": \"active\",\n    \t  \t\"read\": \"true\",\n    \t  \t\"display_if_empty\": \"true\",\n    \t  \t\"due_date\": \"2017-03-01T04:47:28.084Z\",\n    \t  \t\"offline_expiration_seconds\": 3600,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t    \t\"message\": \"My Chats\"\n    \t  \t},\n    \t  \t\"watson_incoming\": {},\n    \t  \t\"timeout\": {},\n    \t  \t\"user_calculated\": {},\n      \t\t\"location\": [],\n    \t  \t\"defaults\": {\n    \t    \t\"parent\": null,\n    \t    \t\"all_children\": null\n    \t  \t},\n    \t  \t\"count_status\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count_if\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"createdAt\": 1493708443709,\n    \t  \t\"page_ids\": [2]\n    \t},\n    \t\"c01a40e0a39ab7071c72d422a5c96104\": {\n    \t\t\"_id\": \"c01a40e0a39ab7071c72d422a5c96104\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"intent_task_id\": \"2_0\",\n    \t  \t\"child_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": null,\n    \t  \t\"page_id\": 2,\n    \t  \t\"from_page_id\": 1,\n    \t  \t\"to_page_id\": 1502774414284,\n    \t  \t\"synchronized\": 0,\n    \t  \t\"processed\": 0,\n    \t  \t\"status\": 0,\n    \t  \t\"read\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"date_created\": \"2017-08-15T05:20:14.284Z\",\n    \t  \t\"offline_expiration_seconds\": 0,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"private\": \"private\"\n    \t  \t},\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"from_user\": {\n    \t\t    \"firstname\": \"ABC\",\n    \t\t    \"lastname\": \"Burgers\",\n    \t\t    \"email\": \"abc@burgers.com\",\n    \t\t    \"phone\": 11906\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t\t    \"note\": \"Company Owner Section\",\n    \t\t    \"message\": \"ReminderBot\"\n    \t  \t},\n    \t  \t\"template\": {\n    \t    \t\"details\": {\n    \t\t      \"_id\": \"2_d\",\n    \t\t      \"_rev\": \"7-0a8d302a193c0c3770a76652750d7bbb\",\n    \t\t      \"table\": \"template\",\n    \t\t      \"name\": \"Detail\",\n    \t\t      \"html\": \"\",\n    \t\t      \"js\": \"\"\n    \t    \t}\n    \t  },\n    \t  \"timeout\": {},\n    \t  \"user_calculate\": {},\n    \t  \"location\": {},\n    \t  \"default\": {\n    \t    \"parent\": null,\n    \t    \"allchildren\": null\n    \t  },\n    \t  \"count_status\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"count\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 1\n    \t  },\n    \t  \"count_if\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"createdAt\": 1502774414284,\n    \t  \"page_ids\": [2]\n    \t}\n    },\n//     node_original1 : {\n// \t\tsystem_id: {\n// \t\t\t\"_id\": system_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": system_id\n// \t\t},\n// \t\tcompany_id: {\n// \t\t\t\"_id\": company_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\tuser_id_co: {\n// \t\t\t\"_id\": user_id_co,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_co\n// \t\t},\n// \t\tuser_id_employee: {\n// \t\t\t\"_id\": user_id_employee,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_employee\n// \t\t},\n// \t\tgroup_name_page: {\n// \t\t\t\"_id\": group_name_page,\n// \t\t\t\"table\": \"task\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem1: {\n// \t\t\t\"_id\": item1,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem2: {\n// \t\t\t\"_id\": item2,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t}\n// \t},\n    node_original2: {\n\t\t\"987\": {\n\t\t\t\"_id\": \"987\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"999\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testname111\": {\n\t\t\t\"_id\": \"testname111\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testname\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"444\": {\n\t\t\t\"_id\": \"444\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"666\": {\n\t\t\t\"_id\": \"666\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"1001\": {\n\t\t\t\"_id\": \"1001\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"AAA\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"AAA\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1002\": {\n\t\t\t\"_id\": \"1002\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"history\": [],\n\t\t\t\"node_name\": \"\",\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"BBB\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"BBB\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1003\": {\n\t\t\t\"_id\": \"1003\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"CCC\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"CCC\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"444\"],\n\t\t\t\"ancestors\": [\"987\", \"444\"]\n\t\t},\n\t\t\"1004\": {\n\t\t\t\"_id\": \"1004\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"DDD\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"DDD\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"666\"],\n\t\t\t\"ancestors\": [\"987\", \"666\"]\n\t\t},\n\t\t\"999\": {\n\t\t\t\"_id\": \"999\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"AAA\": {\n\t\t\t\"_id\": \"AAA\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"BBB\": {\n\t\t\t\"_id\": \"BBB\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"CCC\": {\n\t\t\t\"_id\": \"CCC\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"DDD\": {\n\t\t\t\"_id\": \"DDD\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"111\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testfnsystem_id\": {\n\t\t\t\"_id\": \"testfn\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testfn\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"get_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"get_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"get node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"add_to_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"add_to_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"add to node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_from_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"delete_from_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete from node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"delete_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"create_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"create_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"create node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"companiessystem_id\": {\n\t\t\t\"_id\": \"companies\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"companies\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"reminderbot_company_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_company_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"companies\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id]\n\t\t},\n\t\t\"company_reminder_user123_id\": {\n\t\t\t\"_id\": \"company_reminder_user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_company_auth_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\"]\n\t\t},\n\t\t\"employee_actionssystem_id\": {\n\t\t\t\"_id\": \"employee_actions\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employee actions\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employeesystem_id\": {\n\t\t\t\"_id\": \"employee\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employees\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"employee_actions\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id]\n\t\t},\n\t\t\"reminderbot_employee_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_employee_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id]\n\t\t},\n\t\t\"reminderbot_employees_id\": {\n\t\t\t\"_id\": \"reminderbot_employees_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_employee_auth_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\"]\n\t\t},\n\t\t\"employee222_perm_id\": {\n\t\t\t\"_id\": \"employee222_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee222_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"employee333_perm_id\": {\n\t\t\t\"_id\": \"employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"sub_employee333_perm_id\": {\n\t\t\t\"_id\": \"sub_employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\", \"employee444_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee333_perm_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\", \"reminderbot_employees_id\", \"employee333_perm_id\", \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employee333_id\": {\n\t\t\t\"_id\": \"employee333_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee222_id\": {\n\t\t\t\"_id\": \"employee222_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee444_id\": {\n\t\t\t\"_id\": \"employee444_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee555_id\": {\n\t\t\t\"_id\": \"employee555_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"user123_id\"],\n\t\t\t\"ancestors\": [\"user123_id\"]\n\t\t},\n\t\t\"user123_id\": {\n\t\t\t\"_id\": \"user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"reminderbot_id\": {\n\t\t\t\"_id\": \"reminderbot_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id\": {\n\t\t\t\"_id\": \"old\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"old\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id_child\": {\n\t\t\t\"_id\": \"oldsystem_id_child\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"old\" + system_id, \"employee555_id\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"employee555_id\", \"user123_id\"]\n\t\t},\n\t\t\"oldsystem_id_childchild\": {\n\t\t\t\"_id\": \"oldsystem_id_childchild\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"oldsystem_id_child\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"oldsystem_id_child\", \"employee555_id\", \"user123_id\"]\n\t\t}\n    }\n};\n\n\nmsg.node_original1 = object.node_original1  ;\nmsg.node_original2 = object.node_original2  ;\n\nreturn msg;","outputs":1,"noerr":0,"x":247.99996185302734,"y":857.9999675750732,"wires":[["f9586c79.f2d91","8c3ba14.278446"]]},{"id":"8c3ba14.278446","type":"debug","z":"b32e01b.0ab74","name":"data.js","active":true,"console":"false","complete":"true","x":392.18745040893555,"y":890.3402194976807,"wires":[]},{"id":"d6ad41f2.8e088","type":"debug","z":"b32e01b.0ab74","name":"init.js","active":true,"console":"false","complete":"true","x":570.1840076446533,"y":856.3471698760986,"wires":[]},{"id":"8cf26e82.9b507","type":"Tree View","z":"b32e01b.0ab74","database":"master_table","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":583.9999961853027,"y":801.9999675750732,"wires":[["31a290c9.39b18"]]},{"id":"31a290c9.39b18","type":"debug","z":"b32e01b.0ab74","name":"output","active":true,"console":"false","complete":"payload","x":768.9999961853027,"y":800.9999752044678,"wires":[]},{"id":"3c2f7187.7270ee","type":"comment","z":"b32e01b.0ab74","name":"Get group employess using the treesofware","info":"","x":228,"y":1039,"wires":[]},{"id":"ad7011b5.ce1ec","type":"inject","z":"b32e01b.0ab74","name":"start","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"x":108,"y":1129,"wires":[["45e05409.2b9a5c"]]},{"id":"e721ed2c.55d44","type":"function","z":"b32e01b.0ab74","name":"init_load","func":"var system_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // Company Reminderbot Id\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n\n\nvar init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tportal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tnode_name: \"testGroup\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:true,\n\t\t\t\ttree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":398.9999694824219,"y":1107.9999694824219,"wires":[["a445e83a.de90f8","7ab2c151.cac4b"]]},{"id":"45e05409.2b9a5c","type":"function","z":"b32e01b.0ab74","name":"data.js","func":"var\n\tsystem_id = \"f1b5ed9577f69c6b131d94a46b39044f\", //\"system_id\"; // user\n\tcompany_id = \"fa1785333117ba7c06b9020a6d3c0079\", // user\n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\"; // detail associated with task above\n\nvar object = {\n    node_original1: {\n    \t\"f1b5ed9577f69c6b131d94a46b39044f\": {\n    \t\t\"_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"f1b5ed9577f69c6b131d94a46b39044f\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"access_token\": \"1515420557174.o0i9pckra2xtxt6s9v28lrf6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 1234,\n    \t  \t\"virtual_phone\": 11234,\n    \t  \t\"email\": \"admin@drilist.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"admin\",\n    \t  \t\"lastname\": \"user\",\n    \t  \t\"code\": 9489,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"device_token\": {},\n    \t  \t\"push_accepted\": 1\n    \t},\n    \t\"fa1785333117ba7c06b9020a6d3c0079\": {\n    \t\t\"_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"access_token\": \"1505915176652.8bwoh8j7fft8jjpa59zjb57b9\",\n    \t  \t\"phone\": 12312259665,\n    \t  \t\"firstname\": \"Reminder\",\n    \t  \t\"lastname\": \"Bot\",\n    \t  \t\"virtual_phone\": 12312259665,\n    \t  \t\"security_level\": 1,\n    \t  \t\"code\": 6440,\n    \t  \t\"type\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"long_url\": \"\",\n    \t  \t\"email\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"timezone\": \"America/Los_Angeles\"\n    \t},\n    \t\"da9976858d8bda52021754cf1909a327\": {\n    \t\t\"_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"table\": \"users\",\n      \t\t\"long_url\": \"\",\n    \t  \t\"user_id\": \"da9976858d8bda52021754cf1909a327\",\n    \t  \t\"access_token\": \"1512367299166.6gs5wh40wadlyvaniqi3jfko6r\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 917696016749,\n    \t  \t\"virtual_phone\": 917696016749,\n    \t  \t\"email\": \"mss.parveensachdeva@gmail.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Parveen\",\n    \t  \t\"lastname\": \"Sachdeva\",\n    \t  \t\"code\": 6501,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\",\n    \t    \t\"admin\": \"admin\",\n    \t    \t\"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"9C23D678-F1CA-44A1-AACB-B0871FFBF920\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {}\n    \t},\n    \t\"0a9b50963bc76018418ffd857d551ced\": {\n    \t\t\"_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"table\": \"users\",\n    \t  \t\"long_url\": \"\",\n    \t  \t\"user_id\": \"0a9b50963bc76018418ffd857d551ced\",\n    \t  \t\"access_token\": \"1514977855897.ppl38hod8cea08dabzzrggb9\",\n    \t  \t\"security_level\": 1,\n    \t  \t\"phone\": 12145644732,\n    \t  \t\"virtual_phone\": 12145644732,\n    \t  \t\"email\": \"roger@dri.com\",\n    \t  \t\"converstation_id\": \"\",\n    \t  \t\"firstname\": \"Roger\",\n    \t  \t\"lastname\": \"Colburn\",\n    \t  \t\"code\": 9512,\n    \t  \t\"password\": \"\",\n    \t  \t\"image\": \"\",\n    \t  \t\"type\": {\n    \t\t    \"public\": \"public\",\n    \t\t    \"admin\": \"admin\",\n    \t\t    \"dri_main\": \"dri_main\"\n    \t  \t},\n    \t  \t\"data\": {},\n    \t  \t\"device_id\": \"Web View\",\n    \t  \t\"push_accepted\": 1,\n    \t  \t\"device_token\": {},\n    \t  \t\"timezone\": \"America/New_York\"\n    \t},\n    \t\"2_0\": {\n    \t\t\"_id\": \"2_0\",\n    \t\t\"table\": \"task_table\",\n    \t  \t\"task_name\": \"Categories\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_page_id\": 0,\n    \t  \t\"page_id\": 2,\n    \t  \t\"parent_id\": 0,\n    \t  \t\"header_template_id\": \"2_h\",\n    \t  \t\"detail_template_id\": \"2_d\",\n    \t  \t\"footer_template_id\": \"2_f\",\n    \t  \t\"timeout_id\": null,\n    \t  \t\"child_default_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"child_default_task_name\": \"sub_category_task\",\n    \t  \t\"date_created\": \"2017-03-15T10:29:39.453Z\",\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"category\": \"Categories\",\n    \t  \t\"additional_data_fn\": \"N/A\",\n    \t  \t\"optional_data\": \"\\\"{}\\\"\",\n    \t  \t\"required_data\": \"\\\"{}\\\"\",\n    \t  \t\"offline_expiration_time\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"status\": 1\n    \t},\n    \t\"2_3\": {\n    \t\t\"_id\": \"2_3\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"child_task_id\": \"\",\n      \t\t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": \"9092618242e9895441bc9e978fa15098\",\n    \t  \t\"page_id\": 2,\n    \t  \t\"to_page_id\": 5,\n    \t  \t\"synchronized\": \"true\",\n    \t  \t\"processed\": \"true\",\n    \t  \t\"status\": \"active\",\n    \t  \t\"read\": \"true\",\n    \t  \t\"display_if_empty\": \"true\",\n    \t  \t\"due_date\": \"2017-03-01T04:47:28.084Z\",\n    \t  \t\"offline_expiration_seconds\": 3600,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"public\": \"public\"\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t    \t\"message\": \"My Chats\"\n    \t  \t},\n    \t  \t\"watson_incoming\": {},\n    \t  \t\"timeout\": {},\n    \t  \t\"user_calculated\": {},\n      \t\t\"location\": [],\n    \t  \t\"defaults\": {\n    \t    \t\"parent\": null,\n    \t    \t\"all_children\": null\n    \t  \t},\n    \t  \t\"count_status\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"count_if\": {\n    \t    \t\"active\": 1,\n    \t    \t\"unread\": 0\n    \t  \t},\n    \t  \t\"createdAt\": 1493708443709,\n    \t  \t\"page_ids\": [2]\n    \t},\n    \t\"c01a40e0a39ab7071c72d422a5c96104\": {\n    \t\t\"_id\": \"c01a40e0a39ab7071c72d422a5c96104\",\n    \t  \t\"table\": \"details\",\n    \t  \t\"intent_task_id\": \"2_0\",\n    \t  \t\"child_task_id\": \"cbf23f2101dfed59bdfe1b57f6bca9a5\",\n    \t  \t\"user_id\": \"fa1785333117ba7c06b9020a6d3c0079\",\n    \t  \t\"from_user_id\": null,\n    \t  \t\"page_id\": 2,\n    \t  \t\"from_page_id\": 1,\n    \t  \t\"to_page_id\": 1502774414284,\n    \t  \t\"synchronized\": 0,\n    \t  \t\"processed\": 0,\n    \t  \t\"status\": 0,\n    \t  \t\"read\": 0,\n    \t  \t\"display_if_empty\": true,\n    \t  \t\"date_created\": \"2017-08-15T05:20:14.284Z\",\n    \t  \t\"offline_expiration_seconds\": 0,\n    \t  \t\"priority\": 1,\n    \t  \t\"type\": {\n    \t    \t\"private\": \"private\"\n    \t  \t},\n    \t  \t\"image\": \"https://upload.wikimedia.org/wikipedia/commons/2/26/512pxIcon-sunset_photo_not_found.png\",\n    \t  \t\"from_user\": {\n    \t\t    \"firstname\": \"ABC\",\n    \t\t    \"lastname\": \"Burgers\",\n    \t\t    \"email\": \"abc@burgers.com\",\n    \t\t    \"phone\": 11906\n    \t  \t},\n    \t  \t\"user_incoming\": {\n    \t\t    \"note\": \"Company Owner Section\",\n    \t\t    \"message\": \"ReminderBot\"\n    \t  \t},\n    \t  \t\"template\": {\n    \t    \t\"details\": {\n    \t\t      \"_id\": \"2_d\",\n    \t\t      \"_rev\": \"7-0a8d302a193c0c3770a76652750d7bbb\",\n    \t\t      \"table\": \"template\",\n    \t\t      \"name\": \"Detail\",\n    \t\t      \"html\": \"\",\n    \t\t      \"js\": \"\"\n    \t    \t}\n    \t  },\n    \t  \"timeout\": {},\n    \t  \"user_calculate\": {},\n    \t  \"location\": {},\n    \t  \"default\": {\n    \t    \"parent\": null,\n    \t    \"allchildren\": null\n    \t  },\n    \t  \"count_status\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"count\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 1\n    \t  },\n    \t  \"count_if\": {\n    \t    \"active\": 1,\n    \t    \"unread\": 0\n    \t  },\n    \t  \"createdAt\": 1502774414284,\n    \t  \"page_ids\": [2]\n    \t}\n    },\n//     node_original1 : {\n// \t\tsystem_id: {\n// \t\t\t\"_id\": system_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": system_id\n// \t\t},\n// \t\tcompany_id: {\n// \t\t\t\"_id\": company_id,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\tuser_id_co: {\n// \t\t\t\"_id\": user_id_co,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_co\n// \t\t},\n// \t\tuser_id_employee: {\n// \t\t\t\"_id\": user_id_employee,\n// \t\t\t\"table\": \"users\",\n// \t\t\t\"user_id\": user_id_employee\n// \t\t},\n// \t\tgroup_name_page: {\n// \t\t\t\"_id\": group_name_page,\n// \t\t\t\"table\": \"task\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem1: {\n// \t\t\t\"_id\": item1,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t},\n// \t\titem2: {\n// \t\t\t\"_id\": item2,\n// \t\t\t\"table\": \"detail\",\n// \t\t\t\"user_id\": company_id\n// \t\t}\n// \t},\n    node_original2: {\n\t\t\"987\": {\n\t\t\t\"_id\": \"987\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"999\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testname111\": {\n\t\t\t\"_id\": \"testname111\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testname\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"444\": {\n\t\t\t\"_id\": \"444\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"666\": {\n\t\t\t\"_id\": \"666\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"987\"],\n\t\t\t\"ancestors\": [\"987\"]\n\t\t},\n\t\t\"1001\": {\n\t\t\t\"_id\": \"1001\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"AAA\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"AAA\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1002\": {\n\t\t\t\"_id\": \"1002\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"history\": [],\n\t\t\t\"node_name\": \"\",\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"BBB\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"BBB\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"testname111\"],\n\t\t\t\"ancestors\": [\"987\", \"testname111\"]\n\t\t},\n\t\t\"1003\": {\n\t\t\t\"_id\": \"1003\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"CCC\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"CCC\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"444\"],\n\t\t\t\"ancestors\": [\"987\", \"444\"]\n\t\t},\n\t\t\"1004\": {\n\t\t\t\"_id\": \"1004\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"DDD\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"DDD\", \"999\"]\n\t\t\t},\n\t\t\t\"parents\": [\"666\"],\n\t\t\t\"ancestors\": [\"987\", \"666\"]\n\t\t},\n\t\t\"999\": {\n\t\t\t\"_id\": \"999\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"xxx\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"AAA\": {\n\t\t\t\"_id\": \"AAA\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"BBB\": {\n\t\t\t\"_id\": \"BBB\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"CCC\": {\n\t\t\t\"_id\": \"CCC\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"testname111\",\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"DDD\": {\n\t\t\t\"_id\": \"DDD\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"assistants\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"333\",\n\t\t\t\"data_id\": \"111\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"testfnsystem_id\": {\n\t\t\t\"_id\": \"testfn\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"testfn\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"get_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"get_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"get node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"add_to_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"add_to_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"add to node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_from_node_name_treesystem_id\": {\n\t\t\t\"_id\": \"delete_from_node_name_tree\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete from node name tree\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"delete_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"delete_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"delete node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"create_node_name_instancesystem_id\": {\n\t\t\t\"_id\": \"create_node_name_instance\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"create node name instance\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"companiessystem_id\": {\n\t\t\t\"_id\": \"companies\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"companies\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"reminderbot_company_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_company_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"companies\" + system_id],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id]\n\t\t},\n\t\t\"company_reminder_user123_id\": {\n\t\t\t\"_id\": \"company_reminder_user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_company_auth_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\"]\n\t\t},\n\t\t\"employee_actionssystem_id\": {\n\t\t\t\"_id\": \"employee_actions\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employee actions\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employeesystem_id\": {\n\t\t\t\"_id\": \"employee\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"employees\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"employee_actions\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id]\n\t\t},\n\t\t\"reminderbot_employee_auth_id\": {\n\t\t\t\"_id\": \"reminderbot_employee_auth_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"reminderbot_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee\" + system_id],\n\t\t\t\"ancestors\": [\"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id]\n\t\t},\n\t\t\"reminderbot_employees_id\": {\n\t\t\t\"_id\": \"reminderbot_employees_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"user123_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"reminderbot_employee_auth_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\"]\n\t\t},\n\t\t\"employee222_perm_id\": {\n\t\t\t\"_id\": \"employee222_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee222_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"employee333_perm_id\": {\n\t\t\t\"_id\": \"employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"company_reminder_user123_id\"],\n\t\t\t\"ancestors\": [\"testfn\" + system_id, \"create_node_name_instance\" + system_id, \"delete_node_name_instance\" + system_id, \"add_to_node_name_tree\" + system_id, \"get_node_name_tree\" + system_id, \"delete_from_node_name_tree\" + system_id, \"companies\" + system_id, \"reminderbot_company_auth_id\", \"company_reminder_user123_id\"]\n\t\t},\n\t\t\"sub_employee333_perm_id\": {\n\t\t\t\"_id\": \"sub_employee333_perm_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": \"reminderbot_id\",\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id, \"reminderbot_id\", \"user123_id\", \"employee333_id\", \"employee444_id\"]\n\t\t\t},\n\t\t\t\"parents\": [\"employee333_perm_id\"],\n\t\t\t\"ancestors\": [\"get_node_name_tree\" + system_id, \"add_to_node_name_tree\" + system_id, \"employee_actions\" + system_id, \"employee\" + system_id, \"reminderbot_employee_auth_id\", \"reminderbot_employees_id\", \"employee333_perm_id\", \"delete_from_node_name_tree\" + system_id]\n\t\t},\n\t\t\"employee333_id\": {\n\t\t\t\"_id\": \"employee333_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee222_id\": {\n\t\t\t\"_id\": \"employee222_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee444_id\": {\n\t\t\t\"_id\": \"employee444_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"employee555_id\": {\n\t\t\t\"_id\": \"employee555_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"user123_id\"],\n\t\t\t\"ancestors\": [\"user123_id\"]\n\t\t},\n\t\t\"user123_id\": {\n\t\t\t\"_id\": \"user123_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": system_id,\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [system_id]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"reminderbot_id\": {\n\t\t\t\"_id\": \"reminderbot_id\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": []\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id\": {\n\t\t\t\"_id\": \"old\" + system_id,\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"old\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee333_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\"]\n\t\t\t},\n\t\t\t\"parents\": [],\n\t\t\t\"ancestors\": []\n\t\t},\n\t\t\"oldsystem_id_child\": {\n\t\t\t\"_id\": \"oldsystem_id_child\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee222_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"old\" + system_id, \"employee555_id\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"employee555_id\", \"user123_id\"]\n\t\t},\n\t\t\"oldsystem_id_childchild\": {\n\t\t\t\"_id\": \"oldsystem_id_childchild\",\n\t\t\t\"table\": \"node\",\n\t\t\t\"node_name\": \"\",\n\t\t\t\"history\": [],\n\t\t\t\"user_id\": system_id,\n\t\t\t\"data_id\": \"employee444_id\",\n\t\t\t\"data_id_lineage\": {\n\t\t\t\t\"data_id\": [\"employee333_id\", \"employee222_id\", \"employee444_id\", system_id]\n\t\t\t},\n\t\t\t\"parents\": [\"oldsystem_id_child\"],\n\t\t\t\"ancestors\": [\"old\" + system_id, \"oldsystem_id_child\", \"employee555_id\", \"user123_id\"]\n\t\t}\n    }\n};\n\n\nmsg.node_original1 = object.node_original1  ;\nmsg.node_original2 = object.node_original2  ;\n\nreturn msg;","outputs":1,"noerr":0,"x":247.99996185302734,"y":1127.9999675750732,"wires":[["e721ed2c.55d44","2a04dc0.878c524"]]},{"id":"2a04dc0.878c524","type":"debug","z":"b32e01b.0ab74","name":"data.js","active":true,"console":"false","complete":"true","x":392.18745040893555,"y":1160.3402194976807,"wires":[]},{"id":"a445e83a.de90f8","type":"debug","z":"b32e01b.0ab74","name":"init.js","active":true,"console":"false","complete":"true","x":570.1840076446533,"y":1126.3471698760986,"wires":[]},{"id":"7ab2c151.cac4b","type":"Tree View","z":"b32e01b.0ab74","database":"master_table","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":583.9999961853027,"y":1071.9999675750732,"wires":[["c7487bde.3b3e98"]]},{"id":"c7487bde.3b3e98","type":"debug","z":"b32e01b.0ab74","name":"output","active":true,"console":"false","complete":"payload","x":768.9999961853027,"y":1070.9999752044678,"wires":[]},{"id":"c93f8653.303a78","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":160,"wires":[["ba3d56ae.e98858"]]},{"id":"ba3d56ae.e98858","type":"function","z":"48313844.d96e98","name":"data.js","func":"var init_load = [\n\t\t{\n            payload: {\n                user_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id, 72858af0dce6542155ddde7f3457c3e4\n                portal_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id,\n                node_name: \"page1\", //group_name_company,\n                data_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id,\n                master_parents: [], //tree_owner_id,\n                tree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\",\n                node_id: null, //node_id,\n                target: \"grand\",\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\" //add_to_node_name_tree\n        }\n\t];\n\t\nmsg.payload = init_load ;\nreturn msg;\n","outputs":1,"noerr":0,"x":298,"y":143,"wires":[["1c5b3d4b.56fe73","6a7c3d6e.110754"]]},{"id":"6a7c3d6e.110754","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":510,"y":159,"wires":[["cf688a3d.1429d8"]]},{"id":"cf688a3d.1429d8","type":"debug","z":"48313844.d96e98","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":758,"y":243,"wires":[]},{"id":"1c5b3d4b.56fe73","type":"debug","z":"48313844.d96e98","name":"output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":482,"y":101,"wires":[]},{"id":"4ec85dfe.a2e164","type":"comment","z":"48313844.d96e98","name":"Create company (Root)","info":"","x":128,"y":83,"wires":[]},{"id":"a4053388.bd531","type":"function","z":"48313844.d96e98","name":"data.js","func":"var init_load = [\n\t\t{\n            payload: {\n                user_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id,\n                portal_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id,\n                node_name: \"page1\",\n                data_id: \"865eaee1e1e8084ecb4f6bc5a23c6fc3\", //company_id\n                master_parents: [],\n                tree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id,\n                node_id: null,\n                target: \"parent\",\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\", //fn_name_add\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":603,"wires":[["303a594c.0d0f96"]]},{"id":"7bee60a0.40a5a","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":131,"y":607,"wires":[["a4053388.bd531"]]},{"id":"303a594c.0d0f96","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":497,"y":596,"wires":[["26c4f8df.fc6b28"]]},{"id":"26c4f8df.fc6b28","type":"debug","z":"48313844.d96e98","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":679,"y":596,"wires":[]},{"id":"c3660761.1a0558","type":"comment","z":"48313844.d96e98","name":"Create parent (Portals)","info":"","x":135,"y":544,"wires":[]},{"id":"e738a13c.862ff","type":"function","z":"48313844.d96e98","name":"data.js","func":"var init_load = [\n\t\t {\n            payload: {\n                user_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id,\n                portal_id: \"865eaee1e1e8084ecb4f6bc5a23c6fc3\", //company_id,\n                node_name: \"page1\",\n                data_id: \"1\",// *CHANGE THIS *, \n                master_parents: [], //should be array in nature\n                tree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //tree_owner_id,\n                node_id: null,\n                target: \"child\",\n                parent_node_name: \"\",\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":803,"wires":[["9863af7a.cc671"]]},{"id":"bc41dd13.6c533","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":806,"wires":[["e738a13c.862ff"]]},{"id":"9863af7a.cc671","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":496,"y":795,"wires":[["b19adbaf.0ec098","c85f36b2.ca99e8"]]},{"id":"b19adbaf.0ec098","type":"debug","z":"48313844.d96e98","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":678,"y":795,"wires":[]},{"id":"18f42bf7.5a5bd4","type":"comment","z":"48313844.d96e98","name":"Create child (Field Data)","info":"","x":134,"y":743,"wires":[]},{"id":"c85f36b2.ca99e8","type":"function","z":"48313844.d96e98","name":"data.js","func":"node.warn(msg)\n\t\n// msg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":625,"y":842,"wires":[[]]},{"id":"3fb105df.01f3ba","type":"function","z":"48313844.d96e98","name":"data.js","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id, 0e5b7ed337ed1bf69f61549a4c8f11df\n\t\t\t\tportal_id: \"576a8193b8ce87b7a1e484293025a039\", //system_id,\n\t\t\t\tnode_name: \"page1\", //group_name_company, testGroup\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:false,\n\t\t\t\ttree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":983,"wires":[["a66669ea.67d488"]]},{"id":"e1bf7438.fbc708","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start1","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":986,"wires":[["3fb105df.01f3ba"]]},{"id":"a66669ea.67d488","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":476,"y":965,"wires":[["6815513b.071d9"]]},{"id":"6815513b.071d9","type":"debug","z":"48313844.d96e98","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":658,"y":975,"wires":[]},{"id":"e5cee04f.8431b","type":"comment","z":"48313844.d96e98","name":"Fetch data","info":"","x":74,"y":923,"wires":[]},{"id":"d311d6c5.832818","type":"http in","z":"48313844.d96e98","name":"/api/page1_new","url":"/api/page1_new","method":"get","upload":false,"swaggerDoc":"","x":99,"y":1195,"wires":[["26df5472.7e9c8c"]]},{"id":"26df5472.7e9c8c","type":"function","z":"48313844.d96e98","name":"Tree Params","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id,\n\t\t\t\tportal_id: \"bd01154659d4e8b1445a4d6fff07f554\", //system_id,\n\t\t\t\tnode_name: \"page1\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:false,\n\t\t\t\ttree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":278,"y":1218,"wires":[["bb5d9e89.38628"]]},{"id":"a595dae7.8d6ce8","type":"http response","z":"48313844.d96e98","name":"","statusCode":"","headers":{},"x":796,"y":1226,"wires":[]},{"id":"bb5d9e89.38628","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":433,"y":1247,"wires":[["33638b5b.db3794"]]},{"id":"d9190f7f.22f6b","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nnode.warn(msg.payload);\nvar data=[];\nmsg.payload[0].result.map(function(val,key){\n    if(val.my_display_attributes){\n        data[key] = {\n            page_id: null,\n            \n            meta_data: {\n                to_page_id: val.my_display_attributes.to_page_id,\n                from_page_id: val.my_display_attributes.from_page_id,\n                header: val.my_display_attributes.header_template_id,\n                details: val.my_display_attributes.detail_id,\n                footer: val.my_display_attributes.footer_template\n            },\n            child_meta: {\n                to_page_id: val.my_child_display_attributes.to_page_id,\n                from_page_id: val.my_child_display_attributes.from_page_id,\n                header: val.my_child_display_attributes.header_template_id,\n                details: val.my_child_display_attributes.detail_id,\n                footer: val.my_child_display_attributes.footer_template\n            },\n            details: [{\n                table: val.table,\n                value: val.value,\n                type: val.type,\n                required: val.required,\n                display_defualt: val.display_defualt,\n                seq: val.seq,\n                votes: val.votes,\n            }]\n        }\n        \n    }\n})\nnode.warn(data)\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"x":606,"y":1231,"wires":[["a595dae7.8d6ce8"]]},{"id":"7a494cb5.e80ab4","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":98,"y":1258,"wires":[["26df5472.7e9c8c"]]},{"id":"4988b688.c229a8","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nnode.warn(msg.payload);\nvar myArr = [];\nvar data = [];\nmsg.payload[0].result.forEach(function(val,key){\n    if(val.my_display_attributes){\n        \n        data.push({\n            meta_data: {\n                to_page_id: val.my_display_attributes.to_page_id,\n                from_page_id: val.my_display_attributes.from_page_id,\n                header: val.my_display_attributes.header_template_id,\n                details: val.my_display_attributes.detail_id,\n                footer: val.my_display_attributes.footer_template_id\n            },\n            child_meta: {\n                to_page_id: val.my_child_display_attributes.to_page_id,\n                from_page_id: val.my_child_display_attributes.from_page_id,\n                header: val.my_child_display_attributes.header_template_id,\n                details: val.my_child_display_attributes.detail_id,\n                footer: val.my_child_display_attributes.footer_template_id\n            },\n            \n            page_id: null,\n            details: {\n                table: val.table,\n                value: val.value,\n                type: val.type,\n                required: val.required,\n                display_defualt: val.display_defualt,\n                seq: val.seq,\n                votes: val.votes,\n            }\n        });\n        \n        if(val.my_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.header_template_id});\n        }\n        if(val.my_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_display_attributes.detail_id});\n        }\n        if(val.my_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.footer_template_id});\n        }\n        if(val.my_child_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.header_template_id});\n        }\n        if(val.my_child_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.detail_id});\n        }\n        if(val.my_child_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.footer_template_id});\n        }\n        \n        \n        \n    }\n   \n})\n\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\nmsg.resData=data;\nnode.warn(msg);\nreturn msg;\n","outputs":1,"noerr":0,"x":603,"y":1277,"wires":[["f6c99bc6.0ad618"]]},{"id":"f6c99bc6.0ad618","type":"http request","z":"48313844.d96e98","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":176,"y":1371,"wires":[["1b6a2815.7356f8"]]},{"id":"e935e089.cf936","type":"debug","z":"48313844.d96e98","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":574.093505859375,"y":1420.767578125,"wires":[]},{"id":"1b6a2815.7356f8","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nnode.warn(msg);\nmsg.resData.forEach(function(r_val,r_key){\n    msg.payload.docs.forEach(function(val,key){\n        var meta=msg.resData[r_key].meta_data;\n        var child=msg.resData[r_key].child_meta;\n        for (var prop in meta) {\n            if (meta.hasOwnProperty(prop) && meta[prop] === val._id) {\n                \n                meta[prop]=val.html;\n            }\n        }\n        \n        for (var child_prop in child) {\n            if (child.hasOwnProperty(child_prop) && child[child_prop] === val._id) {\n                \n                child[child_prop]=val.html;\n            }\n        }\n        \n        msg.resData[r_key].meta_data=meta;\n        msg.resData[r_key].child_meta=child;\n    })\n})\n\n\nmsg.payload=msg.resData;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":1378,"wires":[["e935e089.cf936","d582433e.f6871"]]},{"id":"d582433e.f6871","type":"http response","z":"48313844.d96e98","name":"","statusCode":"","headers":{},"x":754,"y":1364,"wires":[]},{"id":"e3542648.6919f8","type":"comment","z":"48313844.d96e98","name":"API to get list","info":"","x":113.5,"y":1135,"wires":[]},{"id":"33638b5b.db3794","type":"debug","z":"48313844.d96e98","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":584,"y":1163,"wires":[]},{"id":"d7a7422d.5d757","type":"http in","z":"48313844.d96e98","name":"/api/loginscreen_new","url":"/api/loginscreen_new","method":"get","upload":false,"swaggerDoc":"","x":142,"y":1575,"wires":[["a01c5a86.a67a08"]]},{"id":"a01c5a86.a67a08","type":"function","z":"48313844.d96e98","name":"Tree Params","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id,\n\t\t\t\tportal_id: \"865eaee1e1e8084ecb4f6bc5a23c6fc3\", //system_id,\n\t\t\t\tnode_name: \"page1\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:false,\n\t\t\t\ttree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":301,"y":1598,"wires":[["a00ecdb9.98a93"]]},{"id":"618f9a.3dcc8068","type":"http response","z":"48313844.d96e98","name":"","statusCode":"","headers":{},"x":819,"y":1606,"wires":[]},{"id":"92fbe862.a53b78","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nnode.warn(msg.payload);\nvar data=[];\nmsg.payload[0].result.map(function(val,key){\n    if(val.my_display_attributes){\n        data[key] = {\n            page_id: null,\n            \n            meta_data: {\n                to_page_id: val.my_display_attributes.to_page_id,\n                from_page_id: val.my_display_attributes.from_page_id,\n                header: val.my_display_attributes.header_template_id,\n                details: val.my_display_attributes.detail_id,\n                footer: val.my_display_attributes.footer_template\n            },\n            child_meta: {\n                to_page_id: val.my_child_display_attributes.to_page_id,\n                from_page_id: val.my_child_display_attributes.from_page_id,\n                header: val.my_child_display_attributes.header_template_id,\n                details: val.my_child_display_attributes.detail_id,\n                footer: val.my_child_display_attributes.footer_template\n            },\n            details: [{\n                table: val.table,\n                value: val.value,\n                type: val.type,\n                required: val.required,\n                display_defualt: val.display_defualt,\n                seq: val.seq,\n                votes: val.votes,\n            }]\n        }\n        \n    }\n})\nnode.warn(data)\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"x":629,"y":1611,"wires":[["618f9a.3dcc8068"]]},{"id":"5279533f.4f9c4c","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":121,"y":1638,"wires":[["a01c5a86.a67a08"]]},{"id":"a9311a6.2c4f2e8","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nnode.warn(msg.payload);\nvar myArr = [];\nvar data = [];\nmsg.payload[0].result.forEach(function(val,key){\n    if(val.my_display_attributes){\n        \n        data.push({\n            meta_data: {\n                to_page_id: val.my_display_attributes.to_page_id,\n                from_page_id: val.my_display_attributes.from_page_id,\n                header: val.my_display_attributes.header_template_id,\n                details: val.my_display_attributes.detail_id,\n                footer: val.my_display_attributes.footer_template_id\n            },\n            child_meta: {\n                to_page_id: val.my_child_display_attributes.to_page_id,\n                from_page_id: val.my_child_display_attributes.from_page_id,\n                header: val.my_child_display_attributes.header_template_id,\n                details: val.my_child_display_attributes.detail_id,\n                footer: val.my_child_display_attributes.footer_template_id\n            },\n            \n            page_id: null,\n            details: {\n                table: val.table,\n                value: val.value,\n                type: val.type,\n                required: val.required,\n                display_defualt: val.display_defualt,\n                seq: val.seq,\n                votes: val.votes,\n            }\n        });\n        \n        if(val.my_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.header_template_id});\n        }\n        if(val.my_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_display_attributes.detail_id});\n        }\n        if(val.my_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.footer_template_id});\n        }\n        if(val.my_child_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.header_template_id});\n        }\n        if(val.my_child_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.detail_id});\n        }\n        if(val.my_child_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.footer_template_id});\n        }\n        \n        \n        \n    }\n   \n})\n\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\nmsg.resData=data;\nnode.warn(msg);\nreturn msg;\n","outputs":1,"noerr":0,"x":626,"y":1657,"wires":[["48f418ec.8dd508"]]},{"id":"48f418ec.8dd508","type":"http request","z":"48313844.d96e98","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":199,"y":1751,"wires":[["d9aaba6c.419308"]]},{"id":"cbf58716.b13d18","type":"debug","z":"48313844.d96e98","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":597.093505859375,"y":1800.767578125,"wires":[]},{"id":"d9aaba6c.419308","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nnode.warn(msg);\nmsg.resData.forEach(function(r_val,r_key){\n    msg.payload.docs.forEach(function(val,key){\n        var meta=msg.resData[r_key].meta_data;\n        var child=msg.resData[r_key].child_meta;\n        for (var prop in meta) {\n            if (meta.hasOwnProperty(prop) && meta[prop] === val._id) {\n                \n                meta[prop]=val.html;\n            }\n        }\n        \n        for (var child_prop in child) {\n            if (child.hasOwnProperty(child_prop) && child[child_prop] === val._id) {\n                \n                child[child_prop]=val.html;\n            }\n        }\n        \n        msg.resData[r_key].meta_data=meta;\n        msg.resData[r_key].child_meta=child;\n    })\n})\n\n\nmsg.payload=msg.resData;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":423,"y":1758,"wires":[["cbf58716.b13d18","1328f3f7.3820ac"]]},{"id":"1328f3f7.3820ac","type":"http response","z":"48313844.d96e98","name":"","statusCode":"","headers":{},"x":777,"y":1744,"wires":[]},{"id":"f68d0ad3.248d68","type":"comment","z":"48313844.d96e98","name":"API to get login page","info":"","x":166.5,"y":1515,"wires":[]},{"id":"a00ecdb9.98a93","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":474,"y":1614,"wires":[["a9311a6.2c4f2e8"]]},{"id":"2d86f6f0.d5f0fa","type":"function","z":"48313844.d96e98","name":"data.js","func":"var system_id = \"cf58c061ee99b9185f637e57be2bb4ee\", //\"system_id\"; // user \n\tcompany_id = \"865eaee1e1e8084ecb4f6bc5a23c6fc3\", // Company Reminderbot Id \n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n\n\nvar init_load = [\n\t\t{\n\t\t\t// set up grandfather for get_page\n\t\t\t//0\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get_page,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for get_node_name_tree\n\t\t\t//1\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for add_to_node_name_tree\n\t\t\t//2\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_add,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for delete_from_node_name_tree\n\t\t\t//3\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_del,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n// \t\t// system_id create system_id company node_name\n// \t\t// set up grandfather for \"company\"\n// \t\t// at the same time add those to the actions created above -- note companies can add, get, delete, get page\n// \t\t//4\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: [name_get_page + system_id, name_add + system_id, name_del + system_id, name_get+ system_id],\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n\t\t// system_id add reminder_bot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n\t\t// company id ie reminderbot_id is now authroized to company stuff\n\t\t//5\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: system_id,\n\t\t\t\tportal_id: system_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: company_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"parent\",\n\t\t\t\tparent_node_name:\"portal\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_co is now been authorized by reminder_bot_id to do company stuff \n// // \t\t//6\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tdata_id: user_id_co,\n// \t\t\t\tmaster_parents: master_parents,\n// \t\t\t\ttree_owner_id: tree_owner_id,\n// \t\t\t\tnode_id: node_id,\n// \t\t\t\ttarget: \"child\",\n// \t\t\t\tparent_node_name:\"\",\n// \t\t\t},\n// \t\t\tfn_name: fn_name_add\n// \t\t},\n// // \t\t//check if the \"company tree\" got added right\n// // \t\t//7\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t// system_id create system_id employee node_name\n// // \t\t// at the same time add those to the actions created above -- this one per node_name\n// // \t\t// employees cannot delete\n// // \t\t//8\n// \t\t{\n// \t\t    payload :  {\n//              user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tsystem_id, \n// \t\t\t\tmaster_parents: \t[\"get_node_name_tree\"+system_id, \"add_to_node_name_tree\"+system_id], \n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"grand\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// system_id add reminderbot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n// // \t\t//9\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tcompany_id, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\" ,\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_employee has not been authorized to do reminderbot_id employee stuff\n// // \t\t//10\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_employee, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// view results of group_name_company\n// \t\t//11\n// \t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t//12\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_co, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// \t\t//13\n// \t\t\t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n\n\n// // \t\t// #14\n// // \t\t//add page to existing company record\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\tgroup_name_page, // the id of the page is like reminder_bot\n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\t\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t//15\n// // \t\t// add specific ITEMS to this company/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//16\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem2, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// \t\t//17\n// \t\t// add parent of page to employees\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\tgroup_name_page, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t}, \n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// 18\n// // \t\t// add specific ITEMS to this employee/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//19\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,//true,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//20\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//21\n// \t\t//now get\n// \t\t{\n// \t\t    payload :  {\n// \t\t        user_id: \t\t    user_id_employee, //or user_id_co\n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tpage_id:  \t\t\tgroup_name_page,\n// \t\t\t\tfilter: \t\t\tnull\n// \t\t},\n// \t\t\tfn_name:fn_get_page\n// \t\t},\n// \t\t{\n// \t\t    payload: {\n// \t\t        user_id: user_id_employee, //or user_id_co\n// \t\t        portal_id: company_id,\n// \t\t        page_id: group_name_page,\n// \t\t        filter: [group_name_employee, group_name_company] //group_name_company\n// \t\t    },\n// \t\t    fn_name: fn_get_page\n// \t\t}\n\t];\n\n// var init_load = [\n    // {\n    //     payload: {\n    //         user_id: system_id,\n    //         portal_id: company_id,\n    //         node_name: group_name_employee,\n    //         data_id: \"51fd8f4edcac9037a23548efd2805586\",\n    //         master_parents: master_parents,\n    //         tree_owner_id: tree_owner_id,\n    //         node_id: node_id,\n    //         target: \"child\",\n    //         parent_node_name: \"\",\n    //     },\n    //      fn_name: \"add_to_node_name_tree\"\n    // }\n//     {\n//         payload: {\n//             user_id: system_id,\n//             portal_id: system_id,\n//             node_name: group_name_employee,\n//             include_data: false,\n//             include_head: true,\n//             tree_owner_id: system_id\n//         },\n//         fn_name: fn_name_get\n//     }\n// ];\n\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":312,"y":363,"wires":[["8bc1acb7.72d31"]]},{"id":"12f03026.32ae8","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":133,"y":367,"wires":[["2d86f6f0.d5f0fa"]]},{"id":"8bc1acb7.72d31","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":499,"y":356,"wires":[["b7eead89.58678"]]},{"id":"b7eead89.58678","type":"debug","z":"48313844.d96e98","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":681,"y":356,"wires":[]},{"id":"b07ba305.466bb","type":"comment","z":"48313844.d96e98","name":"Create database functions for company (Root)","info":"","x":207,"y":304,"wires":[]},{"id":"6bf5394a.a4a118","type":"http in","z":"48313844.d96e98","name":"/api/getlists1_new","url":"/api/getlists1_new","method":"get","upload":false,"swaggerDoc":"","x":110,"y":1922,"wires":[["3a9cd77a.c93708"]]},{"id":"3a9cd77a.c93708","type":"function","z":"48313844.d96e98","name":"Tree Params","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id,\n\t\t\t\tportal_id: \"865eaee1e1e8084ecb4f6bc5a23c6fc3\", //system_id,\n\t\t\t\tnode_name: \"page1\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:false,\n\t\t\t\ttree_owner_id: \"cf58c061ee99b9185f637e57be2bb4ee\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":279,"y":1945,"wires":[["4a7fc4ff.5bee5c"]]},{"id":"59caf75.8efcd08","type":"http response","z":"48313844.d96e98","name":"","statusCode":"","headers":{},"x":797,"y":1953,"wires":[]},{"id":"4a7fc4ff.5bee5c","type":"Tree View","z":"48313844.d96e98","database":"demo_db","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":434,"y":1974,"wires":[["8cdca954.c13a78"]]},{"id":"8e89196a.184768","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nnode.warn(msg.payload);\nvar data=[];\nmsg.payload[0].result.map(function(val,key){\n    if(val.my_display_attributes){\n        data[key] = {\n            page_id: null,\n            \n            meta_data: {\n                to_page_id: val.my_display_attributes.to_page_id,\n                from_page_id: val.my_display_attributes.from_page_id,\n                header: val.my_display_attributes.header_template_id,\n                details: val.my_display_attributes.detail_id,\n                footer: val.my_display_attributes.footer_template\n            },\n            child_meta: {\n                to_page_id: val.my_child_display_attributes.to_page_id,\n                from_page_id: val.my_child_display_attributes.from_page_id,\n                header: val.my_child_display_attributes.header_template_id,\n                details: val.my_child_display_attributes.detail_id,\n                footer: val.my_child_display_attributes.footer_template\n            },\n            details: [{\n                table: val.table,\n                value: val.value,\n                type: val.type,\n                required: val.required,\n                display_defualt: val.display_defualt,\n                seq: val.seq,\n                votes: val.votes,\n            }]\n        }\n        \n    }\n})\nnode.warn(data)\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"x":607,"y":1958,"wires":[["59caf75.8efcd08"]]},{"id":"f69b694e.3eff38","type":"inject","z":"48313844.d96e98","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":99,"y":1985,"wires":[["3a9cd77a.c93708"]]},{"id":"8cdca954.c13a78","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\n// node.warn(msg.payload);\nvar myArr=[];\nvar data=[];\nmsg.payload[0].result.forEach(function(val,key){\n    if(val.my_display_attributes){\n        \n        data[0] = {\n            meta_data: {\n                to_page_id: val.my_display_attributes.to_page_id,\n                from_page_id: val.my_display_attributes.from_page_id,\n                header: val.my_display_attributes.header_template_id,\n                details: val.my_display_attributes.detail_id,\n                footer: val.my_display_attributes.footer_template_id\n            },\n            child_meta: {\n                to_page_id: val.my_child_display_attributes.to_page_id,\n                from_page_id: val.my_child_display_attributes.from_page_id,\n                header: val.my_child_display_attributes.header_template_id,\n                details: val.my_child_display_attributes.detail_id,\n                footer: val.my_child_display_attributes.footer_template_id\n            },\n            \n            page_id: null,\n            details: [{\n                table: val.table,\n                value: val.value,\n                type: val.type,\n                required: val.required,\n                display_defualt: val.display_defualt,\n                seq: val.seq,\n                votes: val.votes,\n            }]\n        }\n        \n        if(val.my_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.header_template_id});\n        }\n        if(val.my_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_display_attributes.detail_id});\n        }\n        if(val.my_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_display_attributes.footer_template_id});\n        }\n        if(val.my_child_display_attributes.header_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.header_template_id});\n        }\n        if(val.my_child_display_attributes.detail_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.detail_id});\n        }\n        if(val.my_child_display_attributes.footer_template_id){\n            myArr.push({\"_id\": val.my_child_display_attributes.footer_template_id});\n        }\n        \n        \n        \n    }\n})\n\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\nmsg.resData=data;\nnode.warn(msg.payload);\nreturn msg;\n","outputs":1,"noerr":0,"x":604,"y":2004,"wires":[["45860e6.be76df"]]},{"id":"45860e6.be76df","type":"http request","z":"48313844.d96e98","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":177,"y":2098,"wires":[["d7ecd4bb.caf9f8"]]},{"id":"3f153a8e.3eab26","type":"debug","z":"48313844.d96e98","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":575.093505859375,"y":2147.767578125,"wires":[]},{"id":"d7ecd4bb.caf9f8","type":"function","z":"48313844.d96e98","name":"","func":"// msg.payload = init_load ;\nvar meta=msg.resData[0].meta_data;\nvar child=msg.resData[0].child_meta;\nmsg.payload.docs.map(function(val,key){\n    \n    for (var prop in meta) {\n        if (meta.hasOwnProperty(prop) && meta[prop] === val._id) {\n            \n            meta[prop]=val.html;\n        }\n    }\n    \n    for (var child_prop in child) {\n        if (child.hasOwnProperty(child_prop) && child[child_prop] === val._id) {\n            \n            child[child_prop]=val.html;\n        }\n    }\n    \n})\nmsg.resData[0].meta_data=meta;\nmsg.resData[0].child_meta=child;\nmsg.payload=msg.resData;\n\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":401,"y":2105,"wires":[["3f153a8e.3eab26","9d080e6.6df07f"]]},{"id":"9d080e6.6df07f","type":"http response","z":"48313844.d96e98","name":"","statusCode":"","headers":{},"x":755,"y":2091,"wires":[]},{"id":"d7c042cc.5c68d","type":"comment","z":"48313844.d96e98","name":"API to get confirmation page","info":"","x":164.5,"y":1862,"wires":[]},{"id":"c741f028.df1ab","type":"function","z":"48313844.d96e98","name":"phone","func":"msg.payload = {\n    query: \"table:users AND virtual_phone:\" + msg.user_data.phone\n};\n\nnode.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":489.7578239440918,"y":2433,"wires":[["e5e1bf10.7bd0c"]]},{"id":"d29dadb6.63b5b","type":"debug","z":"48313844.d96e98","name":"Going to save user if not found in db","active":true,"tosidebar":true,"console":false,"complete":"payload","x":486.7578125,"y":2537.0000019073486,"wires":[]},{"id":"4a3a1890.645338","type":"function","z":"48313844.d96e98","name":"Merge data for update","func":"var db_data = msg.db_output, user_data = msg.user_data, payload = {};\nnode.warn(msg);\nmsg.verification_code = rand();\n\nif(isEmpty(db_data)) {\n    var userObj = {\n        table       : \"users\",\n        access_token:  null,\n        phone       :  parseInt(user_data.phone),\n        virtual_phone: parseInt(user_data.phone),\n        security_level: 0,\n        firstname         : parseInt(user_data.phone) || \"\",\n        lastname          : \"\",\n        code:         msg.verification_code,\n        type: {\n            \"public\": \"public\"\n        },\n        data: {},\n        device_id: msg.user_data.device_id || \"\",\n        push_accepted: msg.push_accepted || 1\n    };\n}else {\n    var userObj = db_data[0];\n    \n    userObj.phone           = userObj.phone || parseInt(user_data.phone) ;\n    userObj.virtual_phone   = userObj.virtual_phone || parseInt(user_data.phone) ;\n    userObj.long_url        = userObj.long_url || \"\";\n    userObj.access_token    = userObj.access_token ;\n    userObj.security_level  = userObj.security_level;\n    userObj.email           = userObj.email || \"\";\n    userObj.firstname       = userObj.firstname || \"\";\n    userObj.lastname        = userObj.lastname || \"\";\n    userObj.code            = msg.verification_code;\n    userObj.data            = userObj.data;\n    userObj.image           = userObj.image || \"\";\n    userObj.device_id       = msg.user_data.device_id || userObj.device_id;\n    userObj.push_accepted   = msg.push_accepted || userObj.push_accepted;\n}\n\n\n\nmsg.security_level = userObj.security_level ;\nmsg.payload = userObj;\n\nreturn msg;\n\nfunction rand() {\n    return Math.floor(1000 + Math.random() * 9000);\n}\n\nfunction token() {\n    return new Date().getTime() + \".\" +Math.random().toString(36).substr(2) ;\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n","outputs":1,"noerr":0,"x":177.7578125,"y":2570.0000019073486,"wires":[["d29dadb6.63b5b","f4f85fad.b7b94","ae9f9312.f4114"]]},{"id":"8c7fac1c.04a61","type":"http in","z":"48313844.d96e98","name":"","url":"/api/login_new","method":"post","upload":false,"swaggerDoc":"","x":105.75781631469727,"y":2431.000002861023,"wires":[["2645e74.cb7b718","3042c9ab.4a9616"]]},{"id":"2645e74.cb7b718","type":"change","z":"48313844.d96e98","name":"Move to user_data","rules":[{"t":"move","p":"payload","pt":"msg","to":"user_data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":307.7578125,"y":2430.0000019073486,"wires":[["c741f028.df1ab"]]},{"id":"e5e1bf10.7bd0c","type":"cloudant in","z":"48313844.d96e98","name":"get user by phone","cloudant":"","database":"demo_db","service":"dev-platform2-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":666.7577819824219,"y":2428.999994277954,"wires":[["219be3b.14abe1c"]]},{"id":"219be3b.14abe1c","type":"change","z":"48313844.d96e98","name":"Move to db_output","rules":[{"t":"move","p":"payload","pt":"msg","to":"db_output","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":950.7578125,"y":2428.0000019073486,"wires":[["4a3a1890.645338"]]},{"id":"ae9f9312.f4114","type":"cloudant out","z":"48313844.d96e98","name":"save user to db","cloudant":"","database":"demo_db","service":"dev-platform2-cloudantNoSQLDB","payonly":true,"operation":"insert","x":415.75782775878906,"y":2612.0000219345093,"wires":[]},{"id":"788b97aa.c704c8","type":"http in","z":"48313844.d96e98","name":"","url":"/api/verify_new","method":"get","upload":false,"swaggerDoc":"","x":109.7578125,"y":3013.0000019073486,"wires":[["f3586558.9289c8","96ef0c9b.7096a"]]},{"id":"f3586558.9289c8","type":"change","z":"48313844.d96e98","name":"Move to request_data","rules":[{"t":"move","p":"payload","pt":"msg","to":"request_data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":324.7578125,"y":3014.0000019073486,"wires":[["c2205b76.644178"]]},{"id":"c2205b76.644178","type":"function","z":"48313844.d96e98","name":"2. user_phone","func":"node.warn(msg);\nif(isEmpty(msg.request_data.phone)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`phone` is required to fullfil request\", data: null};\n}else if(isEmpty(msg.request_data.code)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`code` is required to fullfil request\", data: null};\n }else if(isEmpty(msg.request_data.device_id)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`device_id` is required to fullfil request\", data: null};\n}else if(isEmpty(msg.request_data.push_accepted)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"`push_accepted` is required to fullfil request\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.payload = {\n        query: \"table: users AND virtual_phone:\"+ msg.request_data.phone\n    };    \n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n","outputs":1,"noerr":0,"x":524.7578125,"y":3014.0000019073486,"wires":[["7c1395bc.c3e7cc"]]},{"id":"f4f85fad.b7b94","type":"switch","z":"48313844.d96e98","name":"security_level","property":"security_level","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":2,"x":419.75782775878906,"y":2673.000026702881,"wires":[["9019b64d.18b218"],["1d8f632e.1ba7fd"]]},{"id":"c10d1305.54c4a","type":"cloudant in","z":"48313844.d96e98","name":"get user by token","cloudant":"","database":"demo_db","service":"dev-platform2-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":906.7577819824219,"y":3052.0000324249268,"wires":[["671f22c9.7f08ac"]]},{"id":"671f22c9.7f08ac","type":"change","z":"48313844.d96e98","name":"Move to db_user","rules":[{"t":"move","p":"payload","pt":"msg","to":"db_user","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":206.7578125,"y":3094.0000019073486,"wires":[["c978f227.99f5a"]]},{"id":"c978f227.99f5a","type":"function","z":"48313844.d96e98","name":"check verify code","func":"var db_data = msg.db_user, request_data = msg.request_data;\nvar response = {};\n\nfunction check_obj(obj){\n    if(obj === null || obj === undefined){\n        return 0;\n    }else{\n        return Object.keys(obj).length;\n    }\n}\n\nif(check_obj(db_data) > 0) {\n    var db_code = db_data[0].code;\n    //db_code = \"1234\";\n    if(String(db_data[0].virtual_phone).length == 5){\n        if(request_data.code == 1234){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        } \n    }else if(String(db_data[0].virtual_phone).length > 7 &&  String(db_data[0].virtual_phone).length <= 12){\n        if(parseInt(request_data.code) == db_code){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        } \n    }else{\n        if(request_data.code == db_code){\n            response.status = \"success\";\n        }else{\n            response.status = \"fail\";\n            response.msg = \"Invalid Code\";\n        }    \n    }\n}\nelse{\n    response.status = \"fail\";\n    response.msg = \"Invalid Token\";\n}\n\nnode.warn(response)\nmsg.payload = response;\n\nreturn msg;","outputs":1,"noerr":0,"x":466.7578125,"y":3094.0000019073486,"wires":[["db31d335.72354"]]},{"id":"42e2c639.10dfb8","type":"http response","z":"48313844.d96e98","name":"API Result","x":1026.7578430175781,"y":3230.0000400543213,"wires":[]},{"id":"db31d335.72354","type":"switch","z":"48313844.d96e98","name":"Status","property":"payload.status","propertyType":"msg","rules":[{"t":"eq","v":"success","vt":"str"},{"t":"eq","v":"fail","vt":"str"}],"checkall":"true","outputs":2,"x":246.7578125,"y":3174.0000019073486,"wires":[["fc27974.736e468"],["aaa87a8d.165d28"]]},{"id":"1954bcf1.a10283","type":"function","z":"48313844.d96e98","name":"2. return menu page","func":"var response = {\n    \"page_id\":  return_page_id(msg.payload.virtual_phone),\n    \"access_token\": msg.access_token,\n    \"user_id\":  msg.payload._id,\n    \"status\":   \"valid\"\n};\nmsg.payload = response;\nreturn msg;\n\nfunction return_page_id(number){\n    if(number){\n        if( ( Number(number) === 12313426657) || (Number(number) === 12068835352) ){ //Jessica Rohloff/Kyle  Number then return 26\n            return 26 ;//stumped category page......\n        }else{\n            return 2; //category page \n        }\n    }else{\n        node.warn(\"When user virtual_phone is undefined in verification process.\");\n        return 1; //else login page\n    }\n}","outputs":1,"noerr":0,"x":756.7578125,"y":3194.0000019073486,"wires":[["42e2c639.10dfb8","c4380a63.470bf8"]]},{"id":"9f76b0cf.1f014","type":"cloudant out","z":"48313844.d96e98","name":"update security level","cloudant":"","database":"demo_db","service":"dev-platform2-cloudantNoSQLDB","payonly":true,"operation":"insert","x":776.7578125,"y":3134.0000019073486,"wires":[]},{"id":"fc27974.736e468","type":"function","z":"48313844.d96e98","name":"Merge data for update","func":"var db_data = msg.db_user[0] ,\n    body    = msg.request_data ;\n    \nmsg.access_token = token();\n\ndb_data.access_token   = msg.access_token;\ndb_data.security_level = 1 ;\ndb_data.device_token = populate_device_token(db_data.device_token, body) ;\ndb_data.push_accepted = parseInt(body.push_accepted) || 1 ;\n\nmsg.payload = db_data;\nreturn msg;\n\n\nfunction token() {\n    return new Date().getTime() + \".\" +Math.random().toString(36).substr(2) ;\n}\n\nfunction populate_device_token(device_detail, req_body){\n    if(isEmpty(device_detail)){\n        if( (req_body.device_id == \"Web View\") || (req_body.device_type == \"Web Browser\")){\n            return {};\n        }else{\n            var temp = {};\n            temp[req_body.device_fingerprint] = {\n              device_type: req_body.device_type ,\n              device_id  : req_body.device_id\n            };\n            return temp ;\n        }\n    }else{\n        var local_temp = {};\n        local_temp[req_body.device_fingerprint] = {\n          device_type: req_body.device_type ,\n          device_id  : req_body.device_id\n        };\n        return Object.assign(device_detail, local_temp);\n    }    \n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":476.7578125,"y":3174.0000019073486,"wires":[["1954bcf1.a10283","9f76b0cf.1f014"]]},{"id":"aaa87a8d.165d28","type":"function","z":"48313844.d96e98","name":"1. return login page","func":"var payload = {\n    \"page_id\":  1,\n    \"status\":   \"invalid\"\n};\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":476.7578125,"y":3254.0000019073486,"wires":[["a67db360.42cb7","8a18f2f3.834fc"]]},{"id":"3042c9ab.4a9616","type":"debug","z":"48313844.d96e98","name":"API Login ","active":true,"console":"false","complete":"true","x":266.7578125,"y":2392.999994277954,"wires":[]},{"id":"96ef0c9b.7096a","type":"debug","z":"48313844.d96e98","name":"Verify screeen","active":true,"console":"false","complete":"true","x":323.7578125,"y":2953.0000019073486,"wires":[]},{"id":"9019b64d.18b218","type":"function","z":"48313844.d96e98","name":"11. return verify page & ac","func":"var req_body = msg.user_data ;\nnode.warn(\"test\");\nif(msg.user_data.phone){\n  \n    if(String(msg.user_data.phone).length === 4){\n        msg.sendverification = \"no_need_to_send\";\n        msg.api_response = {\n            \"page_id\":      11,\n            \"code\" : msg.verification_code\n        };\n    }else{\n        if(String(msg.user_data.phone).length >= 7 && String(msg.user_data.phone).length <= 12){\n            msg.sendverification = \"need_to_send_verification\" ;\n            msg.api_response = {\n                \"page_id\":      11,\n                \"code\" : msg.verification_code\n            };    \n        }else{\n            msg.sendverification = \"no_need_to_send\" ;\n            msg.api_response = {\n                \"page_id\":      1,\n                \"code\" : msg.verification_code,\n                \"msg\"  : \"Invalid phone number\"\n            };\n        }\n    }\n}else{\n    msg.sendverification = \"no_need_to_send\" ;\n    msg.api_response = {\n                \"page_id\":      1,\n                \"code\" : msg.verification_code,\n                \"msg\"  : \"Invalid phone number\"\n            };\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":673.64453125,"y":2593.4882831573486,"wires":[["42ae8c70.be8ed4"]]},{"id":"42ae8c70.be8ed4","type":"switch","z":"48313844.d96e98","name":"","property":"sendverification","propertyType":"msg","rules":[{"t":"eq","v":"need_to_send_verification","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":935.2734375,"y":2611.2500019073486,"wires":[["a96d4413.7c9758"],["3a30cfce.53bd9"]]},{"id":"a96d4413.7c9758","type":"function","z":"48313844.d96e98","name":"send sms code","func":"var user_data = msg.user_data;\nvar code = msg.verification_code || 1234;\nmsg.topic = user_data.phone || 12145644732;\nmsg.payload = \"Your verification code for the DoMeNow app is : \" + code;\n\nreturn msg;","outputs":1,"noerr":0,"x":1118.2734375,"y":2563.0000019073486,"wires":[["8a50f341.13428","fb411364.0a6dd","17cce508.ca405b"]]},{"id":"8a50f341.13428","type":"debug","z":"48313844.d96e98","name":"Responded via Twilio","active":true,"console":"false","complete":"true","x":1408.2734375,"y":2586.0000019073486,"wires":[]},{"id":"ecff540a.f8c0a8","type":"http response","z":"48313844.d96e98","name":"API Result","x":1543.2734375,"y":2486.2500019073486,"wires":[]},{"id":"fb411364.0a6dd","type":"change","z":"48313844.d96e98","name":"change","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1365.140625,"y":2486.1679706573486,"wires":[["ecff540a.f8c0a8"]]},{"id":"3a30cfce.53bd9","type":"change","z":"48313844.d96e98","name":"change","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1097.3984375,"y":2620.1640644073486,"wires":[["7fc6548a.024e9c","154ba06c.3e2b3"]]},{"id":"7fc6548a.024e9c","type":"http response","z":"48313844.d96e98","name":"Api result","x":1369.38280326128,"y":2637.152343682945,"wires":[]},{"id":"154ba06c.3e2b3","type":"debug","z":"48313844.d96e98","name":"api_response ","active":true,"console":"false","complete":"payload","x":1382.7578125,"y":2682.0000019073486,"wires":[]},{"id":"a67db360.42cb7","type":"debug","z":"48313844.d96e98","name":"login page return again","active":true,"tosidebar":true,"console":false,"complete":"payload","x":731.5912094116211,"y":3335.000072479248,"wires":[]},{"id":"c4380a63.470bf8","type":"debug","z":"48313844.d96e98","name":"menu page return ","active":true,"console":"false","complete":"payload","x":1044.5912170410156,"y":3179.0000197092695,"wires":[]},{"id":"7c1395bc.c3e7cc","type":"switch","z":"48313844.d96e98","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_SUCCESS","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":697.5911560058594,"y":2983.6667194366455,"wires":[["c10d1305.54c4a"],["a7e2081e.bea748","7e2da97f.2cc8d8"]]},{"id":"a7e2081e.bea748","type":"http response","z":"48313844.d96e98","name":"","x":870.5911560058594,"y":2988.6667194366455,"wires":[]},{"id":"2cea4ffc.d134a","type":"comment","z":"48313844.d96e98","name":"Following code referes to \"/api/verfiy\" endpoint. which whill check if verfiy code is valid or not if valid then re-direct to Category screen else re-direct back to login screen","info":"","x":565,"y":2888.5937519073486,"wires":[]},{"id":"cdfadf8e.0be52","type":"comment","z":"48313844.d96e98","name":"Login `/api/login` flow is following. To check existing number , send verification code, re-direct to verification screen are done by following code.","info":"","x":501,"y":2326.6015644073486,"wires":[]},{"id":"1d8f632e.1ba7fd","type":"function","z":"48313844.d96e98","name":"send sms code","func":"var user_data = msg.payload;\nvar code = user_data.code || 1234;\nmsg.topic = user_data.virtual_phone || 12145644732;\nmsg.payload = \"Your verification code for the Dri List app is : \" + code;\n\n\nmsg.api_response = {\n    \"page_id\":      11,\n    \"code\" : user_data.code\n};\n        \nreturn msg;","outputs":1,"noerr":0,"x":618.091136932373,"y":2742.0000324249268,"wires":[["70b2ec47.8a5834","a2a5b72b.a74a68","2393459b.dc15aa"]]},{"id":"70b2ec47.8a5834","type":"debug","z":"48313844.d96e98","name":"Responded via Twilio","active":true,"tosidebar":true,"console":false,"complete":"true","x":882.0911254882812,"y":2766.0000019073486,"wires":[]},{"id":"a2a5b72b.a74a68","type":"change","z":"48313844.d96e98","name":"change","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":841.9583892822266,"y":2662.1679706573486,"wires":[["ca3a35bc.1690a8"]]},{"id":"ca3a35bc.1690a8","type":"http response","z":"48313844.d96e98","name":"API Result","x":1017.0911254882812,"y":2666.2500019073486,"wires":[]},{"id":"8a18f2f3.834fc","type":"http response","z":"48313844.d96e98","name":"response","x":691.8828125,"y":3286.8984394073486,"wires":[]},{"id":"7e2da97f.2cc8d8","type":"debug","z":"48313844.d96e98","name":"","active":true,"console":"false","complete":"false","x":890.5911560058594,"y":2946.6666688919067,"wires":[]},{"id":"2393459b.dc15aa","type":"twilio out","z":"48313844.d96e98","service":"_ext_","twilio":"6e6ca2b2.e479bc","from":"","number":"","name":"","x":871.2578125,"y":2718.0000019073486,"wires":[]},{"id":"17cce508.ca405b","type":"twilio out","z":"48313844.d96e98","service":"_ext_","twilio":"6e6ca2b2.e479bc","from":"","number":"","name":"","x":1395.7578125,"y":2534.0000019073486,"wires":[]},{"id":"5b5f7b8b.e76394","type":"inject","z":"9bc76fe1.908c7","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":151,"y":138,"wires":[["583b5880.195a68"]]},{"id":"583b5880.195a68","type":"function","z":"9bc76fe1.908c7","name":"data.js","func":"var init_load = [\n\t\t{\n            payload: {\n                user_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //tree_owner_id, 72858af0dce6542155ddde7f3457c3e4\n                portal_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //tree_owner_id,\n                node_name: \"page1\", //group_name_company,\n                data_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //tree_owner_id,\n                master_parents: [], //tree_owner_id,\n                tree_owner_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\",\n                node_id: null, //node_id,\n                target: \"grand\",\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\nreturn msg;\n","outputs":1,"noerr":0,"x":329,"y":121,"wires":[["afe27145.6e953","70e0a6d4.dc9048"]]},{"id":"70e0a6d4.dc9048","type":"Tree View","z":"9bc76fe1.908c7","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":541,"y":137,"wires":[["446113b0.b60f3c"]]},{"id":"446113b0.b60f3c","type":"debug","z":"9bc76fe1.908c7","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":789,"y":221,"wires":[]},{"id":"afe27145.6e953","type":"debug","z":"9bc76fe1.908c7","name":"output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":513,"y":79,"wires":[]},{"id":"19944069.5d05f","type":"comment","z":"9bc76fe1.908c7","name":"Create company (Root)","info":"","x":159,"y":61,"wires":[]},{"id":"e4ee33aa.3d67b","type":"function","z":"9bc76fe1.908c7","name":"data.js","func":"var system_id = \"e636c111b82ac2ee5a9f2ee446a9fe97\", //\"system_id\"; // user \n\tcompany_id = \"47465f5fb22a9d9b0ec7ef7f72d03768\", // Company Reminderbot Id \n\tuser_id_co = \"da9976858d8bda52021754cf1909a327\", // user\n\tuser_id_employee = \"0a9b50963bc76018418ffd857d551ced\", // user\n\tgroup_name_page = \"2_0\", //task\n\titem1 = \"2_3\", //item1\"; // detail associated with task above\n\titem2 = \"c01a40e0a39ab7071c72d422a5c96104\", // detail associated with task above\n\n\tinclude_data = true,\n\tinclude_head = false,\n\tmaster_parents = [],\n\tgroup_name_company = \"company\",\n\tgroup_name_employee = \"employees\",\n\n\tfn_name_add = \"add_to_node_name_tree\",\n\tfn_name_get = \"get_node_name_tree\",\n\tfn_name_del = \"delete_from_node_name_tree\",\n\tfn_get_page = \"get_page\",\n\tfn_get_page2 = \"get_page2\",\n\t\n\tname_add = \"add_to_node_name_tree\",\n\tname_get = \"get_node_name_tree\",\n\tname_del = \"delete_from_node_name_tree\",\n\tname_get_page = \"get_page\",\n\tnode_id = null,\n\ttree_owner_id = system_id,\n\ttemp_node_company = group_name_company + system_id,\n\ttemp_node_employee = group_name_employee + system_id,\n\ttemp_node_page = group_name_page + system_id;\n\n\nvar init_load = [\n\t\t{\n\t\t\t// set up grandfather for get_page\n\t\t\t//0\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get_page,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for get_node_name_tree\n\t\t\t//1\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_get,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for add_to_node_name_tree\n\t\t\t//2\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_add,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\t\t{\n\t\t\t// set up grandfather for delete_from_node_name_tree\n\t\t\t//3\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: name_del,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n// \t\t// system_id create system_id company node_name\n// \t\t// set up grandfather for \"company\"\n// \t\t// at the same time add those to the actions created above -- note companies can add, get, delete, get page\n// \t\t//4\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: tree_owner_id,\n\t\t\t\tportal_id: tree_owner_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: tree_owner_id,\n\t\t\t\tmaster_parents: [name_get_page + system_id, name_add + system_id, name_del + system_id, name_get+ system_id],\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"grand\",\n\t\t\t\tparent_node_name:\"employees_group\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n\t\t// system_id add reminder_bot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n\t\t// company id ie reminderbot_id is now authroized to company stuff\n\t\t//5\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: system_id,\n\t\t\t\tportal_id: system_id,\n\t\t\t\tnode_name: group_name_company,\n\t\t\t\tdata_id: company_id,\n\t\t\t\tmaster_parents: master_parents,\n\t\t\t\ttree_owner_id: tree_owner_id,\n\t\t\t\tnode_id: node_id,\n\t\t\t\ttarget:\"parent\",\n\t\t\t\tparent_node_name:\"portal\",\n\t\t\t},\n\t\t\tfn_name: fn_name_add\n\t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_co is now been authorized by reminder_bot_id to do company stuff \n// // \t\t//6\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tdata_id: user_id_co,\n// \t\t\t\tmaster_parents: master_parents,\n// \t\t\t\ttree_owner_id: tree_owner_id,\n// \t\t\t\tnode_id: node_id,\n// \t\t\t\ttarget: \"child\",\n// \t\t\t\tparent_node_name:\"\",\n// \t\t\t},\n// \t\t\tfn_name: fn_name_add\n// \t\t},\n// // \t\t//check if the \"company tree\" got added right\n// // \t\t//7\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t// system_id create system_id employee node_name\n// // \t\t// at the same time add those to the actions created above -- this one per node_name\n// // \t\t// employees cannot delete\n// // \t\t//8\n// \t\t{\n// \t\t    payload :  {\n//              user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tsystem_id, \n// \t\t\t\tmaster_parents: \t[\"get_node_name_tree\"+system_id, \"add_to_node_name_tree\"+system_id], \n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"grand\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// system_id add reminderbot_id to system_id company node_name  -- do this one per company -- add more companies similar way\n// // \t\t//9\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tcompany_id, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\" ,\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t// portal_id add a user to system_id comapany node_name -- add more users in similar way \n// // \t\t// user_id_employee has not been authorized to do reminderbot_id employee stuff\n// // \t\t//10\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_employee, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// view results of group_name_company\n// \t\t//11\n// \t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: system_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// // \t\t//12\n// \t\t{\n// \t\t\tpayload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee, \n// \t\t\t\tdata_id: \t\t\tuser_id_co, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// \t\t//13\n// \t\t\t\t\t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: company_id,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:true,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n\n\n// // \t\t// #14\n// // \t\t//add page to existing company record\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\tgroup_name_page, // the id of the page is like reminder_bot\n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\t\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// // \t\t//15\n// // \t\t// add specific ITEMS to this company/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//16\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_company, \n// \t\t\t\tdata_id: \t\t\titem2, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n\n// \t\t//17\n// \t\t// add parent of page to employees\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tsystem_id, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\tgroup_name_page, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"parent\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t}, \n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t// 18\n// // \t\t// add specific ITEMS to this employee/page\n// \t\t{payload :  {user_id: \t\tsystem_id, \n// \t\t\t\tportal_id: \t\t\tgroup_name_page, \n// \t\t\t\tnode_name: \t\t\tgroup_name_employee,\n// \t\t\t\tdata_id: \t\t\titem1, \n// \t\t\t\tmaster_parents: \tmaster_parents,\n// \t\t\t\ttree_owner_id: \t\ttree_owner_id, \n// \t\t\t\tnode_id: \t\t\tnode_id,\n// \t\t\t\ttarget: \t\t\t\"child\",\n// \t\t\t\tparent_node_name: \t\"\",\n// \t\t},\n// \t\t\tfn_name:fn_name_add\n// \t\t},\n// // \t\t//19\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_company,\n// \t\t\t\tinclude_data:false,//true,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//20\n// \t\t{\n// \t\t\tpayload: {\n// \t\t\t\tuser_id: system_id,\n// \t\t\t\tportal_id: group_name_page,\n// \t\t\t\tnode_name: group_name_employee,\n// \t\t\t\tinclude_data:false,\n// \t\t\t\tinclude_head:false,\n// \t\t\t\ttree_owner_id: system_id\n// \t\t},\n// \t\t\tfn_name: fn_name_get\n// \t\t},\n// \t\t//21\n// \t\t//now get\n// \t\t{\n// \t\t    payload :  {\n// \t\t        user_id: \t\t    user_id_employee, //or user_id_co\n// \t\t\t\tportal_id: \t\t\tcompany_id, \n// \t\t\t\tpage_id:  \t\t\tgroup_name_page,\n// \t\t\t\tfilter: \t\t\tnull\n// \t\t},\n// \t\t\tfn_name:fn_get_page\n// \t\t},\n// \t\t{\n// \t\t    payload: {\n// \t\t        user_id: user_id_employee, //or user_id_co\n// \t\t        portal_id: company_id,\n// \t\t        page_id: group_name_page,\n// \t\t        filter: [group_name_employee, group_name_company] //group_name_company\n// \t\t    },\n// \t\t    fn_name: fn_get_page\n// \t\t}\n\t];\n\n// var init_load = [\n    // {\n    //     payload: {\n    //         user_id: system_id,\n    //         portal_id: company_id,\n    //         node_name: group_name_employee,\n    //         data_id: \"51fd8f4edcac9037a23548efd2805586\",\n    //         master_parents: master_parents,\n    //         tree_owner_id: tree_owner_id,\n    //         node_id: node_id,\n    //         target: \"child\",\n    //         parent_node_name: \"\",\n    //     },\n    //      fn_name: \"add_to_node_name_tree\"\n    // }\n//     {\n//         payload: {\n//             user_id: system_id,\n//             portal_id: system_id,\n//             node_name: group_name_employee,\n//             include_data: false,\n//             include_head: true,\n//             tree_owner_id: system_id\n//         },\n//         fn_name: fn_name_get\n//     }\n// ];\n\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":352,"wires":[["d6859ded.58c9"]]},{"id":"d3e8d5ed.142b08","type":"inject","z":"9bc76fe1.908c7","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":151,"y":356,"wires":[["e4ee33aa.3d67b"]]},{"id":"d6859ded.58c9","type":"Tree View","z":"9bc76fe1.908c7","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":517,"y":345,"wires":[["bce86d36.d3714"]]},{"id":"bce86d36.d3714","type":"debug","z":"9bc76fe1.908c7","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":699,"y":345,"wires":[]},{"id":"2d9ce06f.871b6","type":"comment","z":"9bc76fe1.908c7","name":"Create database functions for company (Root)","info":"","x":225,"y":293,"wires":[]},{"id":"5f6d09d6.bc0838","type":"function","z":"9bc76fe1.908c7","name":"data.js","func":"var init_load = [\n\t\t{\n            payload: {\n                user_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id,\n                portal_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id,\n                node_name: \"page1\",\n                data_id: \"3f5af32bbfaf96ad30995f0091217635\", //company_id\n                master_parents: [],\n                tree_owner_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //tree_owner_id,\n                node_id: null,\n                target: \"parent\",\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\", //fn_name_add\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":314,"y":549,"wires":[["33595872.d90cc8"]]},{"id":"30876600.e027aa","type":"inject","z":"9bc76fe1.908c7","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":135,"y":553,"wires":[["5f6d09d6.bc0838"]]},{"id":"33595872.d90cc8","type":"Tree View","z":"9bc76fe1.908c7","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":501,"y":542,"wires":[["853da505.050b68"]]},{"id":"853da505.050b68","type":"debug","z":"9bc76fe1.908c7","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":683,"y":542,"wires":[]},{"id":"271db238.d1a8fe","type":"comment","z":"9bc76fe1.908c7","name":"Create parent (Portals)","info":"","x":139,"y":490,"wires":[]},{"id":"9d8b49fb.35b708","type":"function","z":"9bc76fe1.908c7","name":"data.js","func":"var init_load = [\n\t\t {\n            payload: {\n                user_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id,\n                portal_id: \"47465f5fb22a9d9b0ec7ef7f72d03768\", //company_id,\n                node_name: \"page1\",\n                data_id: \"3b88a98525e7807e2f0be22d74f96372\",// *CHANGE THIS *, \n                master_parents: [], //should be array in nature\n                tree_owner_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //tree_owner_id,\n                node_id: null,\n                target: \"child\",\n                parent_node_name: \"\",\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":311,"y":721,"wires":[["93982de8.b0a65"]]},{"id":"374ed373.340a3c","type":"inject","z":"9bc76fe1.908c7","name":"","topic":"start","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":131,"y":724,"wires":[["9d8b49fb.35b708"]]},{"id":"93982de8.b0a65","type":"Tree View","z":"9bc76fe1.908c7","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":497,"y":713,"wires":[["bc5fa0c1.5dffc","6eb37b87.818cd4"]]},{"id":"bc5fa0c1.5dffc","type":"debug","z":"9bc76fe1.908c7","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":679,"y":713,"wires":[]},{"id":"8eb63c54.92034","type":"comment","z":"9bc76fe1.908c7","name":"Create child (Field Data)","info":"","x":135,"y":661,"wires":[]},{"id":"21a9351d.acd03a","type":"function","z":"9bc76fe1.908c7","name":"data.js","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id, 0e5b7ed337ed1bf69f61549a4c8f11df\n\t\t\t\tportal_id: \"44a4ace65ac971ef850f02fb1c0fb917\", //system_id,\n\t\t\t\tnode_name: \"page1\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:true,\n\t\t\t\ttree_owner_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":309,"y":881,"wires":[["22e7e19e.64141e"]]},{"id":"f3a62abb.1779f8","type":"inject","z":"9bc76fe1.908c7","name":"","topic":"start","payload":"start1","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":129,"y":884,"wires":[["21a9351d.acd03a"]]},{"id":"22e7e19e.64141e","type":"Tree View","z":"9bc76fe1.908c7","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":495,"y":863,"wires":[["fe3d43e4.51e53"]]},{"id":"fe3d43e4.51e53","type":"debug","z":"9bc76fe1.908c7","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":677,"y":873,"wires":[]},{"id":"ac7d5c6e.62e51","type":"comment","z":"9bc76fe1.908c7","name":"Fetch data","info":"","x":93,"y":821,"wires":[]},{"id":"6eb37b87.818cd4","type":"function","z":"9bc76fe1.908c7","name":"data.js","func":"node.warn(msg)\n\t\n// msg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":626,"y":760,"wires":[[]]},{"id":"ac9b6397.182b5","type":"http in","z":"288c8934.beba76","name":"Delete Child","url":"/api/deletechild_old","method":"get","upload":false,"swaggerDoc":"","x":78.0173568725586,"y":89.01041412353516,"wires":[["979e1996.3def78"]]},{"id":"de374e1b.89cfe","type":"cloudant in","z":"288c8934.beba76","name":"Get all docs","cloudant":"","database":"dev-platform2","service":"dev-platform2-cloudantNoSQLDB","search":"_all_","design":"","index":"","x":265.3507614135742,"y":312.4548168182373,"wires":[[]]},{"id":"23a44ba6.622784","type":"http response","z":"288c8934.beba76","name":"Response","statusCode":"","headers":{},"x":749.9285049438477,"y":273.0326089859009,"wires":[]},{"id":"29fb26c9.a1ae8a","type":"http request","z":"288c8934.beba76","name":"deleteDocs","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_bulk_docs","tls":"","x":832.6841125488281,"y":196.67703819274902,"wires":[["23a44ba6.622784"]]},{"id":"ee623612.67b808","type":"function","z":"288c8934.beba76","name":"bulk delete function","func":"node.warn(msg.payload);  \nvar count = msg.payload.docs.length;\nvar list = [];\nvar data_ids = [];\nfor (i=0;i<count;i++) {\n    list.push({\n        _id: msg.payload.docs[i]._id,\n        _rev: msg.payload.docs[i]._rev,\n        _deleted: true\n    });\n    if(msg.req.query.record_id!=msg.payload.docs[i]._id){\n        data_ids.push({\"data_id\":msg.payload.docs[i]._id})\n    }\n    \n}\n\n// if (i == 0) {\n// msg.payload = \"No documents were found.  The database is empty!\";\n// return [null, msg];\n// }\nif(data_ids.length){\n    msg.payload={\n        \"selector\": {\n            \"$or\": data_ids\n        }\n    }\n    msg.deleteList = list; \n}else{\n    msg.payload = {\n                \"docs\": \n                list\n              } \n}\n\n\n\n\nnode.warn(msg);  \nreturn msg;","outputs":1,"noerr":0,"x":335.6841278076172,"y":211.6770362854004,"wires":[["a3e7e646.6c0cb8","bbdc8d92.6c7ec"]]},{"id":"a3e7e646.6c0cb8","type":"debug","z":"288c8934.beba76","name":"","active":true,"tosidebar":true,"console":false,"complete":"false","x":671.6841278076172,"y":319.6771183013916,"wires":[]},{"id":"41a83ae8.0e3404","type":"inject","z":"288c8934.beba76","name":"","topic":"","payload":"start","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":92.18055725097656,"y":192.9618148803711,"wires":[["979e1996.3def78"]]},{"id":"979e1996.3def78","type":"function","z":"288c8934.beba76","name":"Query Object","func":"\nmsg.req = {query:{}}\nmsg.req.query.record_id='44681fe7bd1cdddeb92a34bab50bb680';\nnode.warn(msg);\nmsg.payload={\n    \"selector\": {\n        \"$or\": [\n            {\"_id\": msg.req.query.record_id}, //msg.req.query.record_id\n            {\"data_id\": msg.req.query.record_id},\n            {\"query_data.lineage.edited_node_id\":msg.req.query.record_id}\n        ]\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":267.5243225097656,"y":100.92015838623047,"wires":[["5527ad9c.a1bf84"]]},{"id":"5527ad9c.a1bf84","type":"http request","z":"288c8934.beba76","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":450,"y":60,"wires":[["ee623612.67b808"]]},{"id":"7c8dc8fb.e6c9f8","type":"function","z":"f8194c72.aaf9c","name":"data.js","func":"var init_load = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id, 0e5b7ed337ed1bf69f61549a4c8f11df\n\t\t\t\tportal_id: \"47465f5fb22a9d9b0ec7ef7f72d03768\", //system_id,\n\t\t\t\tnode_name: \"page1\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:true,\n\t\t\t\ttree_owner_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":140,"wires":[["39035ac.d0639a6"]]},{"id":"d3a62581.67af18","type":"inject","z":"f8194c72.aaf9c","name":"","topic":"start","payload":"start1","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":143,"wires":[["7c8dc8fb.e6c9f8"]]},{"id":"39035ac.d0639a6","type":"Tree View","z":"f8194c72.aaf9c","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":496,"y":122,"wires":[["9b36592e.2fa758"]]},{"id":"9b36592e.2fa758","type":"debug","z":"f8194c72.aaf9c","name":"Output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":678,"y":132,"wires":[]},{"id":"1f5af112.a73b5f","type":"comment","z":"f8194c72.aaf9c","name":"Fetch data","info":"","x":94,"y":80,"wires":[]},{"id":"d9113b12.deb058","type":"function","z":"6f1d88a3.034e28","name":"Response","func":"node.warn(msg);\nmsg.payload = msg.payload.docs;\nnode.warn(msg.payload);\nif(msg.payload.length===0){\n    msg.payload={success: false, message: \"No data found\", data: null };\n    msg.recordFound=0;\n    return msg;\n}else{\n    msg.recordFound=1;\n\nvar myArr=[];\nvar dataValues=[];\nvar dataHTML=[];\nvar dataHeader=[];\nvar dataFooter=[];\nvar dataResponse=[];\nmsg.payload.forEach(function(val,key){\n    var contentKeyValue={};\n    \n    //if pulldown have data in value and need to send all option to app\n    if(val.template_config.key_name.default){\n        // contentKeyValue=val.value;\n        for(var key1 in val.value){\n            \n          contentKeyValue={key:key1, value: val.value[key1]};\n        }\n        var dropdown=val.template_config.key_name.value;\n    }else{\n        for(var key2 in val.value){\n          contentKeyValue={key:key2, value: val.value[key2]};\n        }\n    }\n    \n    if(Object.keys(contentKeyValue).length===0){\n        \n        if(val.template_config.key_name.default){\n            contentKeyValue={\"key\":val.template_config.key_name.key, \"value\":val.template_config.key_name.default};\n             var dropdown=val.template_config.key_name.value;\n        }else{\n            contentKeyValue=val.template_config?val.template_config.key_name:'';\n        }\n        \n    }\n    \n    if(val.template_id.edit_templates){\n        var edit_template = {details: val.template_id.edit_templates.detail.details_template_id,\n                            header: val.template_id.edit_templates.header.header_template_id\n        }\n        myArr.push({\"_id\": val.template_id.edit_templates.detail.details_template_id});\n        myArr.push({\"_id\": val.template_id.edit_templates.header.header_template_id});\n    }\n        dataValues.push({content:contentKeyValue, dropdown:dropdown, to_page_id:val.template_config.page_name, id: val._id, edit_template: edit_template, type:val.type, seq:val.seq});\n        \n        //User data wins over default data\n        // // node.warn(dataValues);\n        // if(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id)  !== -1){\n        //     // node.warn(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id))\n        //     // node.warn(msg.payload);\n        //     msg.payload.splice(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id),1)\n        //     // msg.payload.splice(0,1)\n        // }\n        \n        // //User data wins over default data\n        // if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        //     //node.warn(val.query_data.lineage.edited_node_id)\n        //     dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n        // }\n        \n        \n        if(dataHTML.length<1 && val.template_id.front_templates){\n            dataHTML={html:val.template_id.front_templates.detail.details_template_id};\n            myArr.push({\"_id\": val.template_id.front_templates.detail.details_template_id});\n        }\n        \n        if(dataHeader.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            // node.warn(val.list_templates.header.template_ids)\n            dataHeader={html:val.list_templates.header.template_ids[0], from_page_name: 'Home Page', current_page_id: val.page_name,}; //from_page_id: val.page_name,\n            myArr.push({\"_id\": val.list_templates.header.template_ids[0]});\n            \n        }\n        if(dataFooter.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            // node.warn(\"checking footer\")\n            // node.warn(val.list_templates.footer);\n            dataFooter={\n                html:val.list_templates.footer.template_ids[0],\n                add_record_page_template: \"add_record_page_template\"\n                // record_type_pulldown: val.list_templates.footer.add_record_templates.record_type_pulldown,\n                // page_templates: {\n                //   \"text\": val.list_templates.footer.add_record_templates.page_templates.text,\n                //   \"number\": val.list_templates.footer.add_record_templates.page_templates.number,\n                //   \"dropdown\": val.list_templates.footer.add_record_templates.page_templates.dropdown,\n                //   \"boolean\": val.list_templates.footer.add_record_templates.page_templates.boolean,\n                //   \"list\": val.list_templates.footer.add_record_templates.page_templates.list,\n                // }\n            };\n            myArr.push({\"_id\": val.list_templates.footer.template_ids[0]});\n            myArr.push({\"_id\": dataFooter.add_record_page_template});\n            // myArr.push({\"_id\": dataFooter.page_templates.text});\n            // myArr.push({\"_id\": dataFooter.page_templates.number});\n            // myArr.push({\"_id\": dataFooter.page_templates.dropdown});\n            // myArr.push({\"_id\": dataFooter.page_templates.boolean});\n            // myArr.push({\"_id\": dataFooter.page_templates.list});\n            \n        }\n        \n})\n\n//User data wins over default data\n msg.payload.forEach(function(val,key){\n    if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n    }\n })\n        \nnode.warn(dataFooter);        \ndataResponse={header:dataHeader, details:{html:dataHTML,content:dataValues}, footer:dataFooter};\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\nmsg.dataResponse=dataResponse;\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":1031.0174865722656,"y":531.3437485694885,"wires":[["ac56ee86.70551"]]},{"id":"eb52cc44.d9f72","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":998.017448425293,"y":655.343822479248,"wires":[["60b6490.ee5eeb8"]]},{"id":"a61af629.ba1aa8","type":"debug","z":"6f1d88a3.034e28","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1414.0174102783203,"y":715.3438625335693,"wires":[]},{"id":"60b6490.ee5eeb8","type":"function","z":"6f1d88a3.034e28","name":"Assign template to response","func":"// msg.payload = init_load ;\nnode.warn(msg);\n// var meta=msg.resData[0].meta_data;\n// var child=msg.resData[0].child_meta;\nmsg.payload.docs.map(function(val,key){\n    if (msg.dataResponse.header.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.header.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.footer.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.footer.html = val.html;\n    }\n    \n    if (msg.dataResponse.footer.add_record_page_template === val._id) {\n        msg.dataResponse.footer.add_record_page_template = val.html;\n    }\n    \n    // if (msg.dataResponse.footer.page_templates.text === val._id) {\n    //     msg.dataResponse.footer.page_templates.text = val.html;\n    // }\n    // if (msg.dataResponse.footer.page_templates.number === val._id) {\n    //     msg.dataResponse.footer.page_templates.number = val.html;\n    // }\n    // if (msg.dataResponse.footer.page_templates.dropdown === val._id) {\n    //     msg.dataResponse.footer.page_templates.dropdown = val.html;\n    // }\n    // if (msg.dataResponse.footer.page_templates.boolean === val._id) {\n    //     msg.dataResponse.footer.page_templates.boolean = val.html;\n    // }\n    // if (msg.dataResponse.footer.page_templates.list === val._id) {\n    //     msg.dataResponse.footer.page_templates.list = val.html;\n    // }\n    \n    \n    if (msg.dataResponse.details.html.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.details.html.html = val.html;\n        \n    }\n    \n    msg.dataResponse.details.content.forEach(function(editVal,editKey){\n         \n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.details === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.details = val.html;\n           \n            \n        }\n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.header === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.header = val.html;\n            \n        }\n    })\n    \n    \n})\n\nmsg.payload=msg.resData;\nmsg.payload={success: true, message: \"ok\", data: msg.dataResponse };\n\nreturn msg;","outputs":1,"noerr":0,"x":1294.9239311218262,"y":664.5762662887573,"wires":[["a61af629.ba1aa8","9fc2138d.c7abb"]]},{"id":"9fc2138d.c7abb","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":1578.9239311218262,"y":650.5762662887573,"wires":[]},{"id":"86ae49a6.0e5c58","type":"comment","z":"6f1d88a3.034e28","name":"API to get list for Front Page - homepage","info":"","x":738.517333984375,"y":490.3437805175781,"wires":[]},{"id":"d63fec7c.6130a","type":"function","z":"6f1d88a3.034e28","name":"Query","func":"node.warn(msg);\nvar user_id = \"47465f5fb22a9d9b0ec7ef7f72d03768\";\nmsg.payload = {\n    // query: \"page_name:page1 or user_id:\" + user_id\n    // query: \"page_name:page1\"\n    // query: \"page_name:page1 AND (user_id:\"+msg.req.query.user_id + \" OR user_id: 47465f5fb22a9d9b0ec7ef7f72d03768), sort: seq\",\n    // \"sort\":[{\n    //      \"seq:number\":\"desc\"\n    //  }],\n     \n     \"selector\":{\n         \"page_name\":'page1',\n         \"visible\": true,\n         \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': '47465f5fb22a9d9b0ec7ef7f72d03768'}],\n     },\n      \n     \"sort\":[{\n         \"seq:number\":\"asc\"\n     }],\n    //  \"limit\":2\n    \n};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":622.5208282470703,"y":534.0278387069702,"wires":[["ae5483c4.75576"]]},{"id":"a6165eff.36441","type":"function","z":"6f1d88a3.034e28","name":"Response","func":"// msg.payload = init_load ;\nnode.warn(msg);\nvar myArr=[];\nvar dataValues=[];\nvar dataHTML=[];\nvar dataHeader=[];\nvar dataFooter=[];\nvar dataResponse=[];\n\nmsg.payload = msg.payload.docs;\nif(msg.payload.length===0){\n    // msg.payload={\n    //     success: false, \n    //     message: \"No data found\", \n    //     data: {\n    //             \"header\":\n    //             {\n    //                 \"html\":'list_child_h',\n    //                 \"from_page_name\": msg.req.query.from_page_name, \n    //                 \"from_page_id\": msg.req.query.from_page_id,\n    //                 \"current_page_id\" :msg.req.query.current_page_id\n                    \n    //             }\n            \n    //     } \n        \n    // };\n    dataHeader = {\n        \"html\":'list_child_h',\n        \"from_page_name\": msg.req.query.from_page_name, \n        \"from_page_id\": msg.req.query.from_page_id,\n        \"current_page_id\" :msg.req.query.current_page_id\n        \n    }\n    myArr.push({\"_id\": 'list_child_h'});\n    myArr.push({\"_id\": 'list_child_d'});\n    dataHTML={html:'list_child_d'};\n    \n    msg.recordFound=0;\n    \n    dataResponse={header:dataHeader, details:{html:dataHTML,content:[]}, footer:{htmk:null}};\n    // dataResponse={header:dataHeader, details:{html:dataHTML,content:dataValues}, footer:dataFooter};\n    msg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\n\nmsg.dataResponse=dataResponse;\nnode.warn(msg);\nreturn msg;\n}else{\n    msg.recordFound=1;\n}\n\n\n\n// var myArr=[];\n\n// var dataValues=[];\n// var dataHTML=[];\n// var dataHeader=[];\n// var dataFooter=[];\n// var dataResponse=[];\n\nmsg.payload.forEach(function(val,key){\n    \n    var contentKeyValue={};\n   \n    //if pulldown have data in value and need to send all option to app\n    if(val.template_config.key_name.default){\n        // contentKeyValue=val.value;\n        for(var key1 in val.value){\n          contentKeyValue={key:key1, value: val.value[key1]};\n        }\n        var dropdown=val.template_config.key_name.value;\n    }else{ //if its not pulldown\n        for(var key1 in val.value){\n          contentKeyValue={key:key1, value: val.value[key1]};\n        }\n    }\n    \n    //if value is blank \n    if(Object.keys(contentKeyValue).length===0){\n        // contentKeyValue=val.template_config.key_name;\n        if(val.template_config.key_name.default){\n            contentKeyValue={\"key\":val.template_config.key_name.key, \"value\":val.template_config.key_name.default};\n            var dropdown=val.template_config.key_name.value;\n        }else{\n            contentKeyValue=val.template_config.key_name;\n            \n        }\n    }\n    if(val.template_id.edit_templates){\n        var edit_template = {details: val.template_id.edit_templates.detail.details_template_id,\n                            header: val.template_id.edit_templates.header.header_template_id\n        }\n        myArr.push({\"_id\": val.template_id.edit_templates.detail.details_template_id});\n        myArr.push({\"_id\": val.template_id.edit_templates.header.header_template_id});\n    }\n        dataValues.push({content:contentKeyValue,dropdown:dropdown, to_page_id:val.template_config.page_name, id: val._id, edit_template: edit_template, type:val.type, seq:val.seq});\n        \n        // //User data wins over default data\n        // if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        //     dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n            \n        // }\n        // //User data wins over default data\n        // if(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id)  !== -1){\n        //     msg.payload.splice(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id),1)\n        // }\n        \n        if(dataHTML.length<1){\n            dataHTML={html:'list_child_d'};\n            myArr.push({\"_id\": 'list_child_d'});\n        }\n        \n        if(dataHeader.length<1){\n            dataHeader={html:'list_child_h',from_page_id: msg.req.query.from_page_id, from_page_name: msg.req.query.from_page_name, current_page_id:msg.req.query.current_page_id};\n            myArr.push({\"_id\": 'list_child_h'});\n            \n        }\n        // if(dataFooter.length<1){\n        //     dataFooter={html:'list_child_f'};\n        //     myArr.push({\"_id\": 'list_child_f'});\n        // }\n        \n        if(dataFooter.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            // node.warn(\"checking footer\")\n            // node.warn(val.list_templates.footer);\n            dataFooter={\n                html:val.list_templates.footer.template_ids[0],\n                add_record_page_template: \"add_record_page_template\"\n                // record_type_pulldown: val.list_templates.footer.add_record_templates.record_type_pulldown,\n                // page_templates: {\n                //   \"text\": val.list_templates.footer.add_record_templates.page_templates.text,\n                //   \"number\": val.list_templates.footer.add_record_templates.page_templates.number,\n                //   \"dropdown\": val.list_templates.footer.add_record_templates.page_templates.dropdown,\n                //   \"boolean\": val.list_templates.footer.add_record_templates.page_templates.boolean,\n                //   \"list\": val.list_templates.footer.add_record_templates.page_templates.list,\n                // }\n            };\n            myArr.push({\"_id\": val.list_templates.footer.template_ids[0]});\n            myArr.push({\"_id\": dataFooter.add_record_page_template});\n            // myArr.push({\"_id\": dataFooter.page_templates.text});\n            // myArr.push({\"_id\": dataFooter.page_templates.number});\n            // myArr.push({\"_id\": dataFooter.page_templates.dropdown});\n            // myArr.push({\"_id\": dataFooter.page_templates.boolean});\n            // myArr.push({\"_id\": dataFooter.page_templates.list});\n            \n        }\n        \n        \n})\n//User data wins over default data\n msg.payload.forEach(function(val,key){\n    if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n    }\n })\n \nnode.warn(dataValues);\ndataResponse={header:dataHeader, details:{html:dataHTML,content:dataValues}, footer:dataFooter};\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\n\nmsg.dataResponse=dataResponse;\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":942.9998588562012,"y":863.1111708879471,"wires":[["16cd6d21.4a62c3"]]},{"id":"16cd6d21.4a62c3","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":663.0173759460449,"y":936.5661317110062,"wires":[["40a5ba8d.cef244"]]},{"id":"97e9819c.e67f6","type":"debug","z":"6f1d88a3.034e28","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1153.0174140930176,"y":964.5661889314651,"wires":[]},{"id":"40a5ba8d.cef244","type":"function","z":"6f1d88a3.034e28","name":"Assign values to response","func":"node.warn(msg);\nmsg.payload.docs.forEach(function(val,key){\n    if (msg.dataResponse.header.html === val._id) {\n        msg.dataResponse.header.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.footer.html === val._id) {\n        msg.dataResponse.footer.html = val.html;\n    }\n    \n    if (msg.dataResponse.footer.add_record_page_template === val._id) {\n        msg.dataResponse.footer.add_record_page_template = val.html;\n    }\n    \n    if (msg.dataResponse.details.html.html === val._id) {\n        msg.dataResponse.details.html.html = val.html;\n        \n    }\n    msg.dataResponse.details.content.forEach(function(editVal,editKey){\n         \n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.details === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.details = val.html;\n        \n            \n        }\n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.header === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.header = val.html;\n            \n        }\n    })\n    \n})\n\nmsg.payload=msg.resData;\n// msg.payload=msg.dataResponse;\nmsg.payload={success: msg.dataResponse.details.content.length?true:false, message: msg.dataResponse.details.content.length?\"ok\":\"No Data Found\", data: msg.dataResponse };\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":896.9237861633301,"y":933.7986479997635,"wires":[["97e9819c.e67f6","13a54c34.682e54"]]},{"id":"13a54c34.682e54","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":1158.9238348007202,"y":926.7986079454422,"wires":[]},{"id":"9193607a.047b4","type":"comment","z":"6f1d88a3.034e28","name":"API to go to child page - getchild","info":"","x":705.5173568725586,"y":812.5660018920898,"wires":[]},{"id":"dee8f93d.9e2c08","type":"function","z":"6f1d88a3.034e28","name":"Query","func":"node.warn(msg);\nvar user_id = \"47465f5fb22a9d9b0ec7ef7f72d03768\";\nmsg.payload = {\n    // query: \"page_name:'page1' AND user_id:\" + user_id\n    // query: \"page_name:\"+msg.req.query.to_page_id + \" AND user_id:\"+msg.req.query.user_id\n    // query: \"page_name:\"+msg.req.query.to_page_id + \" AND (user_id:\"+msg.req.query.user_id + \" OR user_id: 47465f5fb22a9d9b0ec7ef7f72d03768)\"\n\n    \"selector\":{\n         \"page_name\": msg.req.query.to_page_id,\n          \"visible\": true,\n        //  \"page_name\":\"1528875784705\",\n         \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': '47465f5fb22a9d9b0ec7ef7f72d03768'}],\n     },\n      \n     \"sort\":[{\n         \"seq:number\":\"asc\"\n     }],\n};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":619.5208015441895,"y":859.2500638961792,"wires":[["f3d2e735.d58388"]]},{"id":"473803fe.c07f2c","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":605.9999923706055,"y":1275.7884135246277,"wires":[["c870c6e1.104428"]]},{"id":"835fe2f7.0bb5","type":"debug","z":"6f1d88a3.034e28","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1006.9999809265137,"y":1327.788435459137,"wires":[]},{"id":"c870c6e1.104428","type":"function","z":"6f1d88a3.034e28","name":"Assign values to response","func":"// msg.payload = init_load ;\nnode.warn(msg);\n\nmsg.payload.docs.map(function(val,key){\n    if (msg.dataResponse.header.html === val._id) {\n        msg.dataResponse.header.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.footer.html === val._id) {\n        msg.dataResponse.footer.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.details.html.html === val._id) {\n        msg.dataResponse.details.html.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.footer.add_record_page_template === val._id) {\n        msg.dataResponse.footer.add_record_page_template = val.html;\n    }\n    \n    msg.dataResponse.details.content.forEach(function(editVal,editKey){\n         \n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.details === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.details = val.html;\n           \n            \n        }\n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.header === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.header = val.html;\n            \n        }\n    })\n    \n    \n})\n\nmsg.payload=msg.resData;\nmsg.payload=msg.dataResponse;\n\n// node.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":876.9065074920654,"y":1273.0208078622818,"wires":[["835fe2f7.0bb5","c0bc16f0.d2e238"]]},{"id":"c0bc16f0.d2e238","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":1186.9064750671387,"y":1271.020857334137,"wires":[]},{"id":"28775ee.062f2a2","type":"comment","z":"6f1d88a3.034e28","name":"API to go to back page - back","info":"","x":657.4999847412109,"y":1146.7883739471436,"wires":[]},{"id":"bd4bd0fa.63a23","type":"function","z":"6f1d88a3.034e28","name":"Query","func":"node.warn(msg);\nvar user_id = \"47465f5fb22a9d9b0ec7ef7f72d03768\";\nmsg.payload = {\n    // query: \"page_name:'page1' AND user_id:\" + user_id\n    // query: \"page_name:page1\"\n    // query: \"page_name:page1 AND (user_id:\"+msg.req.query.user_id + \" OR user_id: 47465f5fb22a9d9b0ec7ef7f72d03768)\"\n    \"selector\":{\n         \"page_name\":msg.req.query.back_page_id,\n         \"visible\": true,\n         \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': '47465f5fb22a9d9b0ec7ef7f72d03768'}],\n     },\n      \n     \"sort\":[{\n         \"seq:number\":\"asc\"\n     }],\n    \n};\n\n\nreturn msg;","outputs":1,"noerr":0,"x":586.5034713745117,"y":1193.47243309021,"wires":[["febd6be.9e4d498"]]},{"id":"ac56ee86.70551","type":"switch","z":"6f1d88a3.034e28","name":"","property":"recordFound","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":818.017406463623,"y":619.232723236084,"wires":[["45dc30ff.748ed"],["eb52cc44.d9f72"]]},{"id":"45dc30ff.748ed","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":1004.0174407958984,"y":612.2326545715332,"wires":[]},{"id":"f201f31e.5b1db","type":"function","z":"6f1d88a3.034e28","name":"phone","func":"node.warn(msg);\nif(msg.user_data.params.action=='update'){\n    if(msg.user_data.params.renumberAll){\n        var renumber=[];\n        msg.user_data.params.record.forEach(function(val,key){\n            renumber.push({\"_id\":val.id})\n        })\n        \n        msg.payload = {\n            // query: \"table:users AND virtual_phone:\" + msg.user_data.phone\n            selector: {$or: renumber}\n            // \"_id\": msg.user_data.params.record.id\n        };\n    }else{\n        msg.payload = {\n            // query: \"table:users AND virtual_phone:\" + msg.user_data.phone\n            selector: {\"_id\": msg.user_data.params.record.id}\n            // \"_id\": msg.user_data.params.record.id\n        };\n    }\n    \n    msg.action=\"update\";\n}else{\n    var pageName = '';\n    var edit_templates = {};\n    var front_templates = {};\n    var list_templates = {};\n    var headerTemplate = msg.user_data.params.page_id==='page1'?'front_header':'list_child_h';\n    if(msg.user_data.params.record.recordType=='number'){\n        edit_templates = {\n          \"detail\": {\n            \"details_template_id\": \"edit_text_d\"\n          },\n          \"header\": {\n            \"header_template_id\": \"edit_h\"\n          },\n          \"footer\": {\n            \"footer_template_id\": \"\"\n          }\n        } \n        front_templates = {\n          \"detail\": {\n            \"details_template_id\": \"list_child_d\"\n          }\n        }\n    }else if(msg.user_data.params.record.recordType=='list'){\n        pageName = \"page_\"+String(Date.now());\n        edit_templates = {\n          \"detail\": {\n            \"details_template_id\": \"edit_text_d\"\n          },\n          \"header\": {\n            \"header_template_id\": \"edit_h\"\n          },\n          \"footer\": {\n            \"footer_template_id\": \"\"\n          }\n        }\n        front_templates = {\n          \"detail\": {\n            \"details_template_id\": \"list_child_d\"\n          }\n        }\n        \n        \n        \n        list_templates = {\n            \"header\": {\n              \"template_ids\": [\n                headerTemplate\n              ],\n              \"template_config\": {\n                \"page_name\": \"\"\n              }\n            },\n            \"footer\": {\n              \"template_ids\": [\n                \"footer\"\n              ],\n              \"template_config\": {\n                \"page_name\": \"\"\n              }\n            },\n            \"details\": {\n              \"template_ids\": [\n                \"front_details\"\n              ],\n              \"template_config\": {\n                \"page_name\": \"\"\n              }\n            }\n          }\n  \n    }else{\n        edit_templates = {\n          \"detail\": {\n            \"details_template_id\": \"edit_text_d\"\n          },\n          \"header\": {\n            \"header_template_id\": \"edit_h\"\n          },\n          \"footer\": {\n            \"footer_template_id\": \"\"\n          }\n        } \n        front_templates = {\n          \"detail\": {\n            \"details_template_id\": \"list_child_d\"\n          }\n        }\n    }\n    \n    \n    \n    msg.payload={docs: []};\n    msg.payload.docs.push({\n        // query: \"table:users AND virtual_phone:\" + msg.user_data.phone\n        // selector: {\"_id\": \"18b4ce8a1cb8acb37f4e2e5f1d38ea36\"}\n        // \"_id\": msg.user_data.params.record.id\n      \"table\": msg.user_data.params.record.recordType,\n      \"user_id\": \"47465f5fb22a9d9b0ec7ef7f72d03768\",\n      \"page_name\": msg.user_data.params.page_id,\n      \"from_page_id\": msg.user_data.params.from_page_id,\n      \"reference\": {\n        \"ref1\": \"\"\n      },\n      \"type\": msg.user_data.params.record.recordType,\n      \"value\": {},\n      \"value_id\": \"\",\n      \"visible\": true,\n      \"template_id\": {\n        \"edit_templates\": edit_templates,\n        \"front_templates\": front_templates\n        \n      },\n      \"template_config\": {\n        \"required\": \"false\",\n        \"display_default\": \"\",\n        \"key_name\": {\n          \"key\": msg.user_data.params.record.key?msg.user_data.params.record.key:'v1',\n          \"value\": msg.user_data.params.record.value,\n          \"default\": msg.user_data.params.record.default\n        },\n        \"page_name\": pageName\n      },\n      \"seq\": msg.user_data.params.record.seq,\n      'list_templates': list_templates,\n      \"query_data\": {\n        \"votes\": {},\n        \"lineage\": {\n          \"parent_id\": \"\",\n          \"user_id\": msg.user_data.params.user_id,\n        }\n      }\n\n    });\n    msg.action=\"create\";\n    msg.recordAction = 'create';\n    msg.user_data.params.user_id = \"47465f5fb22a9d9b0ec7ef7f72d03768\";\n}\n\nnode.warn(msg);\n\nreturn msg;","outputs":1,"noerr":0,"x":527.0000801086426,"y":2143.1111736297607,"wires":[["fa161b4a.6e51a8"]]},{"id":"3315ee92.c9e172","type":"http in","z":"6f1d88a3.034e28","name":"Add/Update","url":"/api/update","method":"post","upload":false,"swaggerDoc":"","x":150.9999885559082,"y":2140.1110668182373,"wires":[["a55959ee.31d368"]]},{"id":"29930fb5.0f993","type":"debug","z":"6f1d88a3.034e28","name":"API Login ","active":true,"console":"false","complete":"true","x":880.0001411437988,"y":2371.111617088318,"wires":[]},{"id":"7fe6fc14.0b9f74","type":"comment","z":"6f1d88a3.034e28","name":"Update Records","info":"","x":155.24217224121094,"y":2083.7126245498657,"wires":[]},{"id":"27aae1ca.dac5ce","type":"function","z":"6f1d88a3.034e28","name":"dri_list","func":"\n// msg.payload={docs: []};\n// msg.payload.docs.push({_id: '32828a291d4b6fc97f9eece3436304bf',\n// _rev: '4-c4de94e3f65e72f22094e5a3c06dfd04',\n// visible: false});\n\n// msg.payload.docs.push({_id: '918ed5ab00c473b84dc9d91bd59033e5',\n// _rev: '3-aa73a3454cdaff90f6bf339b6c94dd0a',\n// visible: true});\n\n\n// msg.payload = {};\n// msg.payload ={_id: '918ed5ab00c473b84dc9d91bd59033e5',\n// _rev: '1-c925d2ae866083edd2ed240e310bec4f',\n// visible: false};\n\nnode.warn(msg);\nmsg.payload.docs.forEach(function(numVal, numkey){\n    // node.warn(msg.user_data.params.record.length);\n    if(msg.user_data.params.renumberAll){\n        var indx = msg.user_data.params.record.findIndex(item=>item.id==numVal._id);\n    }\n\n\nif(numVal.user_id==msg.user_data.params.user_id || msg.user_data.params.undo_deleted){\n    //undo deleted record\n    if(msg.user_data.params.undo_deleted){\n        numVal.visible = true;\n    }\n    //if updating sec only\n    if(msg.user_data.params.updateField=='seq'){\n        numVal.seq = msg.user_data.params.renumberAll?msg.user_data.params.record[indx].seq:msg.user_data.params.record.seq;\n        // node.warn(numVal.seq);\n    }else{ //if updating key or value\n    \n        numVal.value={};\n        numVal.value[msg.user_data.params.record.content.key] = msg.user_data.params.record.content.value;\n        node.warn(\"UPDATE KEYS\")\n        // if(numVal.template_config.key_name.default){\n           \n        //     // numVal.value = msg.user_data.params.record.content;\n        //     numVal.value={};\n        //     numVal.value[msg.user_data.params.record.content.key] = msg.user_data.params.record.content.value;\n        //     node.warn(\"UPDATE KEYS\")\n        // }else{\n            \n        //     if(Object.keys(numVal.value).length){\n        //         node.warn(\"UPDATE KEYS2\")\n        //         numVal.value={};\n        //         numVal.value[msg.user_data.params.record.content.key] = msg.user_data.params.record.content.value;\n        //     }else{\n        //         node.warn(\"UPDATE KEYS3\")\n        //         numVal.value[msg.user_data.params.record.content.key] = msg.user_data.params.record.content.value;\n        //     }\n            \n        // }\n    }\n   msg.recordAction = 'update';\n}else{\n     msg.recordAction = 'create';\n     node.warn(\"creating record\")\n    // node.warn(\"cominghere\")\n    if(msg.user_data.params.renumberAll){\n        numVal.value[msg.user_data.params.record[indx].content.key] = msg.user_data.params.record[indx].content.value;\n        numVal.seq = msg.user_data.params.record[indx].seq;\n        \n    }else{\n        numVal.value[msg.user_data.params.record.content.key] = msg.user_data.params.record.content.value;\n        numVal.seq = msg.user_data.params.record.seq;\n        \n    }\n   \n    numVal.user_id = msg.user_data.params.user_id;\n    numVal.query_data.lineage.edited_node_id = numVal._id;\n    numVal.query_data.lineage.user_id = msg.user_data.params.user_id;\n    numVal.reference = {\"ref1\": msg.user_data.params.user_id};\n    \n    \n    \n    // node.warn(msg.user_data.params.record)\n    delete numVal['_id'];\n    delete numVal['_rev'];\n    \n}\n})\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":1020.0000762939453,"y":2126.111391067505,"wires":[["b066acf0.dde1"]]},{"id":"a55959ee.31d368","type":"change","z":"6f1d88a3.034e28","name":"Move to user_data","rules":[{"t":"move","p":"payload","pt":"msg","to":"user_data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":348.9999885559082,"y":2141.1110668182373,"wires":[["f201f31e.5b1db"]]},{"id":"221be7e4.833ad8","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":415.000057220459,"y":2348.111614227295,"wires":[]},{"id":"fa161b4a.6e51a8","type":"switch","z":"6f1d88a3.034e28","name":"dri_list","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"update","vt":"str"},{"t":"eq","v":"create","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":669.0173110961914,"y":2138.5659790039062,"wires":[["407108f3.f4c078"],["b066acf0.dde1"]]},{"id":"9575a3a4.5d1f8","type":"function","z":"6f1d88a3.034e28","name":"Response","func":"node.warn(msg);\nmsg.payload = msg.payload.docs;\nnode.warn(msg.payload.length);\nif(msg.payload.length===0){\n    msg.payload={success: false, message: \"No data found\", data: null };\n    msg.recordFound=0;\n    return msg;\n}else{\n    msg.recordFound=1;\n\nvar myArr=[];\nvar dataValues=[];\nvar dataHTML=[];\nvar dataHeader=[];\nvar dataFooter=[];\nvar dataResponse=[];\nmsg.payload.forEach(function(val,key){\n    // if(val._id==='663ffed9a8b3e19d062dfcfac4a639a1'){\n    var contentKeyValue={};\n    \n    if(val.template_config.key_name.default){\n        // contentKeyValue=val.value;\n        for(var key1 in val.value){\n          contentKeyValue={key:key1, value: val.value[key1]};\n        }\n        var dropdown=val.template_config.key_name.value;\n    }else{\n        for(var key2 in val.value){\n          contentKeyValue={key:key2, value: val.value[key2]};\n        }\n    }\n    \n    // for(var key1 in val.value){\n    //     // node.warn(val.value[key1]);\n    //     contentKeyValue={key:key1, value: val.value[key1]};\n    // }\n    if(Object.keys(contentKeyValue).length===0){\n        \n        if(val.template_config.key_name.default){\n            contentKeyValue={\"key\":val.template_config.key_name.key, \"value\":val.template_config.key_name.default};\n             var dropdown=val.template_config.key_name.value;\n        }else{\n            contentKeyValue=val.template_config.key_name;\n        }\n        \n    }\n    \n    if(val.template_id.edit_templates){\n        var edit_template = {details: val.template_id.edit_templates.detail.details_template_id,\n                            header: val.template_id.edit_templates.header.header_template_id\n        }\n        myArr.push({\"_id\": val.template_id.edit_templates.detail.details_template_id});\n        myArr.push({\"_id\": val.template_id.edit_templates.header.header_template_id});\n    }\n        dataValues.push({content:contentKeyValue, dropdown:dropdown, to_page_id:val.template_config.page_name, id: val._id, edit_template: edit_template, type:val.type, seq:val.seq});\n        \n        // //User data wins over default data\n        // if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        //     dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n            \n        // }\n        // // User data wins over default data\n        // if(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id)  !== -1){\n        //     msg.payload.splice(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id),1)\n        // }\n        \n        \n        if(dataHTML.length<1 && val.template_id.front_templates){\n            dataHTML={html:val.template_id.front_templates.detail.details_template_id};\n            myArr.push({\"_id\": val.template_id.front_templates.detail.details_template_id});\n        }\n        \n        if(dataHeader.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            dataHeader={html:val.list_templates.header.template_ids[0], from_page_name: \"Home Page\", current_page_id:msg.req.query.back_page_id};\n            if(val.from_page_id){\n                dataHeader.from_page_id=val.from_page_id;\n            }\n            myArr.push({\"_id\": val.list_templates.header.template_ids[0]});\n            \n        }else{\n            var header_id = val.back_page_id=='page1'?'front_header': 'list_child_h';\n            dataHeader={html:header_id, from_page_name: \"Home Page\", current_page_id:msg.req.query.back_page_id};\n            if(val.from_page_id){\n                dataHeader.from_page_id=val.from_page_id;\n            }\n            myArr.push({\"_id\": header_id});\n        }\n        \n        if(dataFooter.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            // dataFooter={html:val.list_templates.footer.template_ids[0]};\n            dataFooter={\n                html:val.list_templates.footer.template_ids[0],\n                add_record_page_template: \"add_record_page_template\"\n            };\n            myArr.push({\"_id\": val.list_templates.footer.template_ids[0]});\n            myArr.push({\"_id\": dataFooter.add_record_page_template});\n        }else{\n            dataFooter={\n                html:\"footer\",\n                add_record_page_template: \"add_record_page_template\"\n            };\n            myArr.push({\"_id\": dataFooter.html});\n            myArr.push({\"_id\": dataFooter.add_record_page_template});\n        }\n        \n})\n\n//User data wins over default data\n msg.payload.forEach(function(val,key){\n    if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n    }\n })\n \ndataResponse={header:dataHeader, details:{html:dataHTML,content:dataValues}, footer:dataFooter};\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\nnode.warn(msg);\nmsg.dataResponse=dataResponse;\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":928.0173377990723,"y":1194.7882986068726,"wires":[["473803fe.c07f2c"]]},{"id":"ae5483c4.75576","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":800.0174140930176,"y":533.7882318496704,"wires":[["d9113b12.deb058"]]},{"id":"f3d2e735.d58388","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":781.0173225402832,"y":862.5660592317581,"wires":[["a6165eff.36441"]]},{"id":"febd6be.9e4d498","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":744.0173416137695,"y":1195.1216306686401,"wires":[["9575a3a4.5d1f8"]]},{"id":"b066acf0.dde1","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_bulk_docs","tls":"","x":842.0174293518066,"y":2220.566146850586,"wires":[["a683dec7.7e6d5"]]},{"id":"407108f3.f4c078","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":840.0174407958984,"y":2130.5661277770996,"wires":[["27aae1ca.dac5ce"]]},{"id":"dea404a2.686178","type":"function","z":"6f1d88a3.034e28","name":"Response","func":"node.warn(msg);\nmsg.payload = msg.payload.docs;\n// node.warn(msg.payload);\nif(msg.payload.length===0){\n    msg.payload={success: false, message: \"No data found\", data: null };\n    msg.recordFound=0;\n    return msg;\n}else{\n    msg.recordFound=1;\n\nvar myArr=[];\nvar dataValues=[];\nvar dataHTML=[];\nvar dataHeader=[];\nvar dataFooter=[];\nvar dataResponse=[];\nmsg.payload.forEach(function(val,key){\n    var contentKeyValue={};\n    \n    //if pulldown have data in value and need to send all option to app\n    if(val.template_config.key_name.default){\n        // contentKeyValue=val.value;\n        for(var key1 in val.value){\n            node.warn(key1);\n          contentKeyValue={key:key1, value: val.value[key1]};\n        }\n        var dropdown=val.template_config.key_name.value;\n    }else{\n        for(var key2 in val.value){\n            node.warn(key2);\n          contentKeyValue={key:key2, value: val.value[key2]};\n        }\n    }\n    \n    if(Object.keys(contentKeyValue).length===0){\n        \n        if(val.template_config.key_name.default){\n            contentKeyValue={\"key\":val.template_config.key_name.key, \"value\":val.template_config.key_name.default};\n             var dropdown=val.template_config.key_name.value;\n        }else{\n            contentKeyValue=val.template_config.key_name;\n        }\n        \n    }\n    \n    if(val.template_id.edit_templates){\n        \n        var edit_template = {details: val.template_id.edit_templates.detail.details_template_id,\n                            header: val.template_id.edit_templates.header.header_template_id\n        }\n        \n        myArr.push({\"_id\": val.template_id.edit_templates.detail.details_template_id});\n        myArr.push({\"_id\": val.template_id.edit_templates.header.header_template_id});\n    }\n        dataValues.push({content:contentKeyValue, dropdown:dropdown, to_page_id:val.template_config.page_name, id: val._id, edit_template: edit_template, type:val.type, seq:val.seq});\n        \n        //User data wins over default data\n        // // node.warn(dataValues);\n        // if(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id)  !== -1){\n        //     // node.warn(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id))\n        //     // node.warn(msg.payload);\n        //     msg.payload.splice(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id),1)\n        //     // msg.payload.splice(0,1)\n        // }\n        \n        // //User data wins over default data\n        // if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        //     //node.warn(val.query_data.lineage.edited_node_id)\n        //     dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n        // }\n        \n        // node.warn(val.template_id.front_templates.detail.details_template_id);\n        //         val.template_id.edit_templates.detail.details_template_id\n        \n        if(dataHTML.length<1 && val.template_id.edit_templates){\n            dataHTML={html:val.template_id.edit_templates.detail.details_template_id, from_page_name: 'Home Page'};\n            myArr.push({\"_id\": val.template_id.edit_templates.detail.details_template_id});\n        }\n        \n        \n        if(dataHeader.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            node.warn(val.list_templates)\n            dataHeader={html:val.list_templates.header.template_ids[0],from_page_id: val.page_name, from_page_name: msg.req.query.from_page_name};\n            myArr.push({\"_id\": val.list_templates.header.template_ids[0]});\n            \n        }\n        \n        if(dataFooter.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            dataFooter={html:val.list_templates.footer.template_ids[0]};\n            myArr.push({\"_id\": val.list_templates.footer.template_ids[0]});\n        }\n        \n})\n\n//User data wins over default data\n msg.payload.forEach(function(val,key){\n    if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n    }\n })\n        \n        \ndataResponse={header:dataHeader, details:{html:dataHTML,content:dataValues}, footer:dataFooter};\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\nmsg.dataResponse=dataResponse;\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":899.9999771118164,"y":1563.444312095642,"wires":[["94594667.576f48"]]},{"id":"9c8890e2.29e56","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":818.0000152587891,"y":1669.4444618225098,"wires":[["73516066.1f5af"]]},{"id":"d878a051.3d271","type":"debug","z":"6f1d88a3.034e28","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1280.0001220703125,"y":1704.4444646835327,"wires":[]},{"id":"73516066.1f5af","type":"function","z":"6f1d88a3.034e28","name":"Assign template to response","func":"// msg.payload = init_load ;\nnode.warn(msg);\n// var meta=msg.resData[0].meta_data;\n// var child=msg.resData[0].child_meta;\nmsg.payload.docs.map(function(val,key){\n    if (msg.dataResponse.header.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.header.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.footer.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.footer.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.details.html.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.details.html.html = val.html;\n        \n    }\n    \n    msg.dataResponse.details.content.forEach(function(editVal,editKey){\n         \n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.details === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.details = val.html;\n           \n            \n        }\n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.header === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.header = val.html;\n            \n        }\n    })\n    \n    \n})\n\nmsg.payload=msg.resData;\nmsg.payload={success: true, message: \"ok\", data: msg.dataResponse };\n\nreturn msg;","outputs":1,"noerr":0,"x":1061.9065551757812,"y":1667.676911354065,"wires":[["d878a051.3d271","3d3f5eb9.88b522"]]},{"id":"3d3f5eb9.88b522","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":1300.9065437316895,"y":1660.6769371032715,"wires":[]},{"id":"6c5522c3.43a77c","type":"comment","z":"6f1d88a3.034e28","name":"API to sort the list - sorting","info":"","x":614.5000457763672,"y":1485.4445180892944,"wires":[]},{"id":"57051252.db1bbc","type":"function","z":"6f1d88a3.034e28","name":"Query","func":"node.warn(msg);\n// var user_id = msg.req.query.sorting==='default'?\"47465f5fb22a9d9b0ec7ef7f72d03768\":msg.req.query.user_id;\nvar query={};\nvar default_user = '47465f5fb22a9d9b0ec7ef7f72d03768';\nif(msg.req.query.sorting==='default'){\n    query = {\n        \"page_name\":msg.req.query.pageId,\n        'user_id':default_user,\n        \"visible\": true\n        \n    }\n        \n}else{\n    query = {\n        \"page_name\":msg.req.query.pageId,\n        \"visible\": true,\n        \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': default_user}]};\n}\nmsg.payload = {\n    // query: \"page_name:page1 or user_id:\" + user_id\n    // query: \"page_name:page1\"\n    // query: \"page_name:page1 AND (user_id:\"+msg.req.query.user_id + \" OR user_id: 47465f5fb22a9d9b0ec7ef7f72d03768), sort: seq\",\n    // \"sort\":[{\n    //      \"seq:number\":\"desc\"\n    //  }],\n     \n     \"selector\":query,\n    //  {\n    //      \"page_name\":msg.req.query.pageId,\n    //     //  \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': '47465f5fb22a9d9b0ec7ef7f72d03768'}],\n    //     // 'user_id':user_id\n    //     query\n    //  },\n      \n     \"sort\":[{\n         \"seq:number\":\"asc\"\n     }],\n    //  \"limit\":2\n    \n};\n\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":548.5034790039062,"y":1562.1284217834473,"wires":[["5e286483.09fa2c"]]},{"id":"94594667.576f48","type":"switch","z":"6f1d88a3.034e28","name":"","property":"recordFound","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":636.9999694824219,"y":1647.3332977294922,"wires":[["b8836589.980868"],["9c8890e2.29e56"]]},{"id":"b8836589.980868","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":803.0000038146973,"y":1629.3332958221436,"wires":[]},{"id":"5e286483.09fa2c","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":708.9999141693115,"y":1560.8889999389648,"wires":[["dea404a2.686178"]]},{"id":"43f8a6e2.6ad168","type":"function","z":"6f1d88a3.034e28","name":"dri_list","func":"node.warn(msg);\nvar init_load = [\n\t\t {\n            payload: {\n                user_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id,\n                portal_id: msg.user_data.params.user_id, //company_id,\n                node_name: \"page1\",\n                data_id: msg.payload[0].id,// *CHANGE THIS *, \n                master_parents: [], //should be array in nature\n                tree_owner_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //tree_owner_id,\n                node_id: null,\n                target: \"child\",\n                parent_node_name: \"\",\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\n// return msg;\n\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":408.90627670288086,"y":2410.7890815734863,"wires":[["ee0efc35.5da32"]]},{"id":"ee0efc35.5da32","type":"Tree View","z":"6f1d88a3.034e28","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":558.9062538146973,"y":2409.7889728546143,"wires":[["9c0d6c22.3f857"]]},{"id":"9c0d6c22.3f857","type":"function","z":"6f1d88a3.034e28","name":"dri_list","func":"node.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":718.3507308959961,"y":2408.7886486053467,"wires":[["29930fb5.0f993"]]},{"id":"a683dec7.7e6d5","type":"switch","z":"6f1d88a3.034e28","name":"dri_list","property":"recordAction","propertyType":"msg","rules":[{"t":"eq","v":"update","vt":"str"},{"t":"eq","v":"create","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":155.5243797302246,"y":2380.1326122283936,"wires":[["221be7e4.833ad8","29930fb5.0f993"],["95f1ce79.b6d02","43f8a6e2.6ad168"]]},{"id":"95f1ce79.b6d02","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":407.23975372314453,"y":2462.4552640914917,"wires":[]},{"id":"3570503f.5e9d9","type":"http request","z":"51119cab.bd09e4","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_bulk_docs","tls":"","x":185.90633392333984,"y":551.4549560546875,"wires":[["4265af46.9a57e"]]},{"id":"4265af46.9a57e","type":"function","z":"51119cab.bd09e4","name":"dri_list","func":"node.warn(msg);\nvar init_load = [\n\t\t {\n            payload: {\n                user_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //system_id,\n                portal_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //company_id,\n                node_name: \"page1\",\n                data_id: msg.payload[0].id,// *CHANGE THIS *, \n                master_parents: [], //should be array in nature\n                tree_owner_id: \"e636c111b82ac2ee5a9f2ee446a9fe97\", //tree_owner_id,\n                node_id: null,\n                target: \"child\",\n                parent_node_name: \"\",\n            },\n            fn_name: \"add_to_node_name_tree\"\n        }\n\t];\n\t\nmsg.payload = init_load ;\n//node.warn(msg.payload);\n// return msg;\n\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":314.90625,"y":591.4548377990723,"wires":[["45a633e7.bb0eac"]]},{"id":"45a633e7.bb0eac","type":"Tree View","z":"51119cab.bd09e4","database":"dev-platform2","username":"cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix","password":"426407e26d2a0052c0f3c66c1e809f9465bf7c9671cc0a49bdb5fabd674e1cfc","operation":"prod","x":468.90625,"y":592.4548377990723,"wires":[["6ae8c12.13edf4"]]},{"id":"6ae8c12.13edf4","type":"function","z":"51119cab.bd09e4","name":"dri_list","func":"node.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":621.3507080078125,"y":593.4548377990723,"wires":[[]]},{"id":"fc1cb30e.db879","type":"function","z":"51119cab.bd09e4","name":"dri_list","func":"node.warn(msg);\n\nreturn msg;","outputs":1,"noerr":0,"x":352.90625,"y":422.4548645019531,"wires":[[]]},{"id":"83dcb1f3.ee551","type":"switch","z":"51119cab.bd09e4","name":"dri_list","property":"payload.docs[0]._id","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","repair":false,"outputs":2,"x":143.4027976989746,"y":481.3680763244629,"wires":[["8411b70f.6a3ac8"],["3570503f.5e9d9"]]},{"id":"57dcb9e4.d2c778","type":"function","z":"51119cab.bd09e4","name":"dri_list","func":"\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":458.90625953674316,"y":518.4548320770264,"wires":[[]]},{"id":"8411b70f.6a3ac8","type":"http request","z":"51119cab.bd09e4","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_bulk_docs","tls":"","x":319.9063491821289,"y":474.45496368408203,"wires":[["57dcb9e4.d2c778"]]},{"id":"4b88c327.40140c","type":"http request","z":"288c8934.beba76","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":624.017333984375,"y":92.01041412353516,"wires":[["cb5be7b6.6ec578"]]},{"id":"cb5be7b6.6ec578","type":"function","z":"288c8934.beba76","name":"bulk delete function","func":"node.warn(msg.payload);  \nvar count = msg?msg.payload.docs.length:'0';\n// var list = [];\nvar data_ids = [];\nfor (i=0;i<count;i++) {\n    // node.warn(msg.deleteList.findIndex(item=> item.id == msg.payload.docs[i]._id))\n    if(msg.deleteList.findIndex(item=> item.id == msg.payload.docs[i]._id)===-1){\n        msg.deleteList.push({\n            _id: msg.payload.docs[i]._id,\n            _rev: msg.payload.docs[i]._rev,\n            _deleted: true\n        }); \n    }\n    \n    \n}\n\n// if (i == 0) {\n// msg.payload = \"No documents were found.  The database is empty!\";\n// return [null, msg];\n// }\n\n// msg.payload={\n//     \"selector\": {\n//         \"$or\": data_ids\n//     }\n// }\n\nmsg.payload = {\n                \"docs\": \n                msg.deleteList\n              }\n// msg.deleteList = list; \nnode.warn(msg);  \nreturn msg;","outputs":1,"noerr":0,"x":811.017333984375,"y":95.01041412353516,"wires":[["29fb26c9.a1ae8a"]]},{"id":"bbdc8d92.6c7ec","type":"switch","z":"288c8934.beba76","name":"dri_list","property":"deleteList","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","repair":false,"outputs":2,"x":541.5207748413086,"y":202.9201545715332,"wires":[["4b88c327.40140c"],["29fb26c9.a1ae8a"]]},{"id":"6cfb65fb.9cf0fc","type":"comment","z":"288c8934.beba76","name":"API to Delete Record","info":"","x":120,"y":20,"wires":[]},{"id":"b847bc27.a6806","type":"http in","z":"6f1d88a3.034e28","name":"Delete Child","url":"/api/deletechild","method":"get","upload":false,"swaggerDoc":"","x":158.9999885559082,"y":2641.1111516952515,"wires":[["9b3a3abb.3df328"]]},{"id":"177e9b8b.928a54","type":"http response","z":"6f1d88a3.034e28","name":"Response","statusCode":"","headers":{},"x":908.9999885559082,"y":2641.1111516952515,"wires":[]},{"id":"35906f9f.c1411","type":"function","z":"6f1d88a3.034e28","name":"bulk delete function","func":"node.warn(msg.payload);  \nmsg.payload.docs[0].visible=false;\n// var count = msg.payload.docs.length;\n// var list = [];\n// var data_ids = [];\n// for (i=0;i<count;i++) {\n//     list.push({\n//         _id: msg.payload.docs[i]._id,\n//         _rev: msg.payload.docs[i]._rev,\n//         _deleted: true\n//     });\n//     if(msg.req.query.record_id!=msg.payload.docs[i]._id){\n//         data_ids.push({\"data_id\":msg.payload.docs[i]._id})\n//     }\n    \n// }\n\n// // if (i == 0) {\n// // msg.payload = \"No documents were found.  The database is empty!\";\n// // return [null, msg];\n// // }\n// if(data_ids.length){\n//     msg.payload={\n//         \"selector\": {\n//             \"$or\": data_ids\n//         }\n//     }\n//     msg.deleteList = list; \n// }else{\n//     msg.payload = {\n//                 \"docs\": \n//                 list\n//               } \n// }\n\n\n\n\nnode.warn(msg);  \nreturn msg;","outputs":1,"noerr":0,"x":498.9999885559082,"y":2701.1111516952515,"wires":[["815adbc5.fd5628"]]},{"id":"73d6de53.d33ea","type":"debug","z":"6f1d88a3.034e28","name":"","active":true,"tosidebar":true,"console":false,"complete":"false","x":878.9999885559082,"y":2681.1111516952515,"wires":[]},{"id":"9b3a3abb.3df328","type":"function","z":"6f1d88a3.034e28","name":"Query Object","func":"node.warn(msg);\nmsg.payload={\n    \"selector\": {\n        \"_id\": msg.req.query.record_id\n        // \"$or\": [\n        //     {\"_id\": msg.req.query.record_id}, //msg.req.query.record_id\n        //     // {\"data_id\": msg.req.query.record_id},\n        //     // {\"query_data.lineage.edited_node_id\":msg.req.query.record_id}\n        // ]\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"x":348.50695419311523,"y":2653.020895957947,"wires":[["f9d5f7d0.127098"]]},{"id":"f9d5f7d0.127098","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":530.9826316833496,"y":2612.1007375717163,"wires":[["35906f9f.c1411"]]},{"id":"815adbc5.fd5628","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_bulk_docs","tls":"","x":704.9999656677246,"y":2644.1111516952515,"wires":[["177e9b8b.928a54","73d6de53.d33ea"]]},{"id":"d9c069f7.241058","type":"comment","z":"6f1d88a3.034e28","name":"API to Delete Record (Make Active/inactive)","info":"","x":270.9826316833496,"y":2572.1007375717163,"wires":[]},{"id":"f7cae3e6.8b84c","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":609.0000305175781,"y":1960.5558032989502,"wires":[["803c13c0.c14f3"]]},{"id":"97fa9aca.995288","type":"debug","z":"6f1d88a3.034e28","name":"Search Log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1072.0000381469727,"y":1996.5557947158813,"wires":[]},{"id":"803c13c0.c14f3","type":"function","z":"6f1d88a3.034e28","name":"Assign template to response","func":"// msg.payload = init_load ;\nnode.warn(msg);\n// var meta=msg.resData[0].meta_data;\n// var child=msg.resData[0].child_meta;\nmsg.payload.docs.map(function(val,key){\n    if (msg.dataResponse.header.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.header.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.footer.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.footer.html = val.html;\n        \n    }\n    \n    if (msg.dataResponse.details.html.html === val._id) {\n        // node.warn(meta[prop]);\n        msg.dataResponse.details.html.html = val.html;\n        \n    }\n    \n    msg.dataResponse.details.content.forEach(function(editVal,editKey){\n         \n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.details === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.details = val.html;\n           \n            \n        }\n        if (msg.dataResponse.details.content[editKey].edit_template && msg.dataResponse.details.content[editKey].edit_template.header === val._id) {\n            msg.dataResponse.details.content[editKey].edit_template.header = val.html;\n            \n        }\n    })\n    \n    \n})\n\nmsg.payload=msg.resData;\nmsg.payload={success: true, message: \"ok\", data: msg.dataResponse };\n\nreturn msg;","outputs":1,"noerr":0,"x":849.906494140625,"y":1957.7880926132202,"wires":[["97fa9aca.995288","ebdd25f9.23ae18"]]},{"id":"ebdd25f9.23ae18","type":"http response","z":"6f1d88a3.034e28","name":"","statusCode":"","headers":{},"x":1089.9065246582031,"y":1943.7881183624268,"wires":[]},{"id":"f580b50c.6d2418","type":"comment","z":"6f1d88a3.034e28","name":"API to get deleted records - showdeletedRecords","info":"","x":672.5000457763672,"y":1839.555757522583,"wires":[]},{"id":"cadec980.9dec98","type":"function","z":"6f1d88a3.034e28","name":"Query","func":"node.warn(msg);\n// var user_id = msg.req.query.sorting==='default'?\"47465f5fb22a9d9b0ec7ef7f72d03768\":msg.req.query.user_id;\nvar query={};\nvar default_user = '47465f5fb22a9d9b0ec7ef7f72d03768';\n// var querydata=JSON.parse(msg.req.query); \n// node.warn(JSON.parse(msg.req.query.show_deleted));\nif(msg.req.query.show_deleted===\"true\"){\n    query = {\n        \"page_name\":msg.req.query.pageId,\n        \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': default_user}],\n        \"visible\": false\n        \n    }\n}else{\n    query = {\n        \"page_name\":msg.req.query.pageId,\n        \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': default_user}],\n        \"visible\": true\n    };\n}\nmsg.payload = {\n    // query: \"page_name:page1 or user_id:\" + user_id\n    // query: \"page_name:page1\"\n    // query: \"page_name:page1 AND (user_id:\"+msg.req.query.user_id + \" OR user_id: 47465f5fb22a9d9b0ec7ef7f72d03768), sort: seq\",\n    // \"sort\":[{\n    //      \"seq:number\":\"desc\"\n    //  }],\n     \n     \"selector\":query,\n    //  {\n    //      \"page_name\":msg.req.query.pageId,\n    //     //  \"$or\":[{'user_id':msg.req.query.user_id}, {'user_id': '47465f5fb22a9d9b0ec7ef7f72d03768'}],\n    //     // 'user_id':user_id\n    //     query\n    //  },\n      \n     \"sort\":[{\n         \"seq:number\":\"asc\"\n     }],\n    //  \"limit\":2\n    \n};\n\nnode.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":542.503490447998,"y":1885.2399339675903,"wires":[["73b2b447.7324cc"]]},{"id":"73b2b447.7324cc","type":"http request","z":"6f1d88a3.034e28","name":"SearchFilter","method":"POST","ret":"obj","url":"https://cc56f34b-f581-49b9-a9d7-732fe5c71b9c-bluemix.cloudant.com/dev-platform2/_find","tls":"","x":726.0000305175781,"y":1886.000186920166,"wires":[["a76fa3ab.6255a"]]},{"id":"a76fa3ab.6255a","type":"function","z":"6f1d88a3.034e28","name":"Response","func":"// msg.payload = init_load ;\nnode.warn(msg);\nvar myArr=[];\nvar dataValues=[];\nvar dataHTML=[];\nvar dataHeader=[];\nvar dataFooter=[];\nvar dataResponse=[];\n\nmsg.payload = msg.payload.docs;\nif(msg.payload.length===0){\n    // msg.payload={\n    //     success: false, \n    //     message: \"No data found\", \n    //     data: {\n    //             \"header\":\n    //             {\n    //                 \"html\":'list_child_h',\n    //                 \"from_page_name\": msg.req.query.from_page_name, \n    //                 \"from_page_id\": msg.req.query.from_page_id,\n    //                 \"current_page_id\" :msg.req.query.current_page_id\n                    \n    //             }\n            \n    //     } \n        \n    // };\n    dataHeader = {\n        \"html\":'list_child_h',\n        \"from_page_name\": msg.req.query.from_page_name, \n        \"from_page_id\": msg.req.query.pageId,\n        \"current_page_id\" :msg.req.query.current_page_id\n        \n    }\n    myArr.push({\"_id\": 'list_child_h'});\n    myArr.push({\"_id\": 'list_child_d'});\n    dataHTML={html:'list_child_d'};\n    \n    msg.recordFound=0;\n    \n    dataResponse={header:dataHeader, details:{html:dataHTML,content:[]}, footer:{html:null}};\n    // dataResponse={header:dataHeader, details:{html:dataHTML,content:dataValues}, footer:dataFooter};\n    msg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\n\nmsg.dataResponse=dataResponse;\nnode.warn(msg);\nreturn msg;\n}else{\n    msg.recordFound=1;\n}\n\n\n\n// var myArr=[];\n\n// var dataValues=[];\n// var dataHTML=[];\n// var dataHeader=[];\n// var dataFooter=[];\n// var dataResponse=[];\n\nmsg.payload.forEach(function(val,key){\n    \n    var contentKeyValue={};\n   \n    //if pulldown have data in value and need to send all option to app\n    if(val.template_config.key_name.default){\n        // contentKeyValue=val.value;\n        for(var key1 in val.value){\n          contentKeyValue={key:key1, value: val.value[key1]};\n        }\n        var dropdown=val.template_config.key_name.value;\n    }else{ //if its not pulldown\n        for(var key1 in val.value){\n          contentKeyValue={key:key1, value: val.value[key1]};\n        }\n    }\n    \n    //if value is blank \n    if(Object.keys(contentKeyValue).length===0){\n        // contentKeyValue=val.template_config.key_name;\n        if(val.template_config.key_name.default){\n            contentKeyValue={\"key\":val.template_config.key_name.key, \"value\":val.template_config.key_name.default};\n            var dropdown=val.template_config.key_name.value;\n        }else{\n            contentKeyValue=val.template_config.key_name;\n            \n        }\n    }\n    if(val.template_id.edit_templates){\n        var edit_template = {details: val.template_id.edit_templates.detail.details_template_id,\n                            header: val.template_id.edit_templates.header.header_template_id\n        }\n        myArr.push({\"_id\": val.template_id.edit_templates.detail.details_template_id});\n        myArr.push({\"_id\": val.template_id.edit_templates.header.header_template_id});\n    }\n        dataValues.push({content:contentKeyValue,dropdown:dropdown, to_page_id:val.template_config.page_name, id: val._id, edit_template: edit_template, type:val.type, seq:val.seq});\n        \n        // //User data wins over default data\n        // if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        //     dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n            \n        // }\n        // //User data wins over default data\n        // if(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id)  !== -1){\n        //     msg.payload.splice(msg.payload.findIndex(item=> item._id == val.query_data.lineage.edited_node_id),1)\n        // }\n        \n        if(dataHTML.length<1){\n            dataHTML={html:'list_child_d'};\n            myArr.push({\"_id\": 'list_child_d'});\n        }\n        var frompageid = val.page_name===\"page1\"?\"page1\":val.from_page_id;\n        var from_page_name = msg.req.query.show_deleted===\"true\"?\" Deleted Records\":msg.req.query.from_page_name;\n        if(dataHeader.length<1){\n            dataHeader={html:'list_child_h',from_page_id: frompageid, from_page_name: from_page_name, current_page_id:msg.req.query.current_page_id};\n            myArr.push({\"_id\": 'list_child_h'});\n            \n        }\n        // if(dataFooter.length<1){\n        //     dataFooter={html:'list_child_f'};\n        //     myArr.push({\"_id\": 'list_child_f'});\n        // }\n        \n        if(dataFooter.length<1 && (val.list_templates && Object.keys(val.list_templates).length)){\n            // node.warn(\"checking footer\")\n            // node.warn(val.list_templates.footer);\n            dataFooter={\n                html:val.list_templates.footer.template_ids[0],\n                add_record_page_template: \"add_record_page_template\"\n                // record_type_pulldown: val.list_templates.footer.add_record_templates.record_type_pulldown,\n                // page_templates: {\n                //   \"text\": val.list_templates.footer.add_record_templates.page_templates.text,\n                //   \"number\": val.list_templates.footer.add_record_templates.page_templates.number,\n                //   \"dropdown\": val.list_templates.footer.add_record_templates.page_templates.dropdown,\n                //   \"boolean\": val.list_templates.footer.add_record_templates.page_templates.boolean,\n                //   \"list\": val.list_templates.footer.add_record_templates.page_templates.list,\n                // }\n            };\n            myArr.push({\"_id\": val.list_templates.footer.template_ids[0]});\n            myArr.push({\"_id\": dataFooter.add_record_page_template});\n            // myArr.push({\"_id\": dataFooter.page_templates.text});\n            // myArr.push({\"_id\": dataFooter.page_templates.number});\n            // myArr.push({\"_id\": dataFooter.page_templates.dropdown});\n            // myArr.push({\"_id\": dataFooter.page_templates.boolean});\n            // myArr.push({\"_id\": dataFooter.page_templates.list});\n            \n        }\n        \n        \n})\n//User data wins over default data\n msg.payload.forEach(function(val,key){\n    if(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id)!=-1){\n        dataValues.splice(dataValues.findIndex(item=> item.id == val.query_data.lineage.edited_node_id),1)\n    }\n })\n \nnode.warn(dataValues);\ndataResponse={header:dataHeader, details:{html:dataHTML,content:dataValues}, footer:dataFooter};\nmsg.payload = {\n    \n   \"selector\": {\n    //   \"$or\": [\n    //      {\n    //         \"_id\": \"a770017b0b27b73c9fd004bfc452fabd\"\n    //      },\n    //      {\n    //         \"_id\": \"966d69d4f290dfbc123c0a04895ee2a0\"\n    //      }\n    //   ]\n    \"$or\":myArr\n   }\n\n};\n\nmsg.dataResponse=dataResponse;\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":903.0000610351562,"y":1883.5557689666748,"wires":[["f7cae3e6.8b84c"]]},{"id":"5a73a358.8e429c","type":"http in","z":"3924c8eb.2bafc8","name":"API HANDLER","url":"/master_api_handler","method":"post","swaggerDoc":"","x":85,"y":131.00001525878906,"wires":[["5eacd33a.ba54bc"]]},{"id":"5eacd33a.ba54bc","type":"function","z":"3924c8eb.2bafc8","name":"Handler","func":"var req = msg.payload;\n\nif(isEmpty(req)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"req body must be specified.\", data: null};\n}else{\n    msg.api_response = \"API_SUCCESS\";\n    // if(!(\"api\" in req)){\n    //     msg.api_response = \"API_ERROR\";\n    //     msg.payload = {status: 400, error: true, msg: \"Body must must be wrapped with `api` key.\", data: null};\n    // }else{\n    //     msg.req_body = req.api;\n    // }\n    msg.req_body = populate_content(req.app) ;\n}\nreturn msg;\n\nfunction isEmpty(obj){\n    if(typeof obj === \"object\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\nfunction populate_content(obj){\n    return obj.api;\n}","outputs":1,"noerr":0,"x":245.00001525878906,"y":248.00001525878906,"wires":[["d8b81d2.0e522e"]]},{"id":"d8b81d2.0e522e","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_response","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":371.0000305175781,"y":389.0000305175781,"wires":[["66c40449.35740c"],["28176164.c91bee"]]},{"id":"66c40449.35740c","type":"http response","z":"3924c8eb.2bafc8","name":"","x":525,"y":266.00001525878906,"wires":[]},{"id":"28176164.c91bee","type":"function","z":"3924c8eb.2bafc8","name":"validate body","func":"var body = msg.req_body;\n\nif(isEmpty(body.table)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`table` parameter must be set to save record\", data: null};\n}else if(isEmpty(body.table_data)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`table_data` parameter must be set to save record\", data: null};    \n}else{\n    msg.api_response = \"API_SUCCESS\";\n    msg.payload_table = body.table ;\n    msg.payload_data  = body.table_data ;\n    msg.access_token  = body.access_token ;\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":548,"y":530.0000305175781,"wires":[["37df03ae.77774c"]]},{"id":"37df03ae.77774c","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_response","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":668,"y":673.0000305175781,"wires":[["de9d3f7.101e6c"],["8250fe4.4c74b"]]},{"id":"de9d3f7.101e6c","type":"http response","z":"3924c8eb.2bafc8","name":"","x":784,"y":590.0000152587891,"wires":[]},{"id":"8250fe4.4c74b","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"payload_table","propertyType":"msg","rules":[{"t":"eq","v":"add_detail","vt":"str"},{"t":"eq","v":"delete_detail","vt":"str"},{"t":"eq","v":"update_task","vt":"str"},{"t":"eq","v":"update_user","vt":"str"},{"t":"eq","v":"update_short_detail","vt":"str"},{"t":"eq","v":"add_detail_to_task","vt":"str"},{"t":"eq","v":"add_assistant_to_groups","vt":"str"},{"t":"eq","v":"add_assistant_into_group","vt":"str"},{"t":"eq","v":"update_message_schedule","vt":"str"},{"t":"eq","v":"delete_schedule_message","vt":"str"},{"t":"eq","v":"update_counts","vt":"str"},{"t":"else"}],"checkall":"true","outputs":12,"x":815.0001831054688,"y":940.0001220703125,"wires":[["d39dc2af.8e868"],["96e10578.604ca8"],["50e26ce4.03dc04"],["b74b5a46.beaf28"],["2c546a14.b85a56"],["90fe0291.bf639"],["bcd18f9.265767"],["a837f43.0fb6008"],["a7fa7744.1897e8"],["d83cca2b.0bb218"],["260a2ee4.075282"],["d0c20a2f.c8a8c8"]]},{"id":"d39dc2af.8e868","type":"function","z":"3924c8eb.2bafc8","name":"Create Detail","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1281.9999961853027,"y":51.000041007995605,"wires":[["13c57f60.d30b71"]]},{"id":"d0c20a2f.c8a8c8","type":"function","z":"3924c8eb.2bafc8","name":"UnExpacted Case","func":"msg.payload = {status: 400, error: true, msg: \"`table` field value is unexpacted.\", data: null};\nreturn msg;","outputs":1,"noerr":0,"x":1324.0003509521484,"y":1690.0009388923645,"wires":[["4a7f609.da202a"]]},{"id":"4a7f609.da202a","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1517.0005340576172,"y":1690.0008578300476,"wires":[]},{"id":"a289fb28.a9a7f8","type":"function","z":"3924c8eb.2bafc8","name":"detail_calculation","func":"var big_record_tables   = {} , \n    detail              = {},\n    templates_arr       = msg.templates_arr ,\n    child_task          = isEmpty(msg.child_task_obj) ? null : msg.child_task_obj,\n    timeout             = isEmpty(msg.timeout_obj) ? null : msg.timeout_obj ,\n    location            = isEmpty(msg.location_obj) ? null : msg.location_obj,\n    user                = isEmpty(msg.user_obj) ? null : msg.user_obj,\n    task                = isEmpty(msg.task_obj) ? null : msg.task_obj,\n    user_arr            = msg.users_arr ,\n    form_data           = msg.form_data ,\n    details_arr         = [];\n    msg.doCreate_optional_detail = false ;\n \n     \n    //sort the detail_arr as by created at\n    details_arr =  msg.details_arr.sort(function(a,b){\n        details_arr = details_arr.sort(function(a,b){\n        \treturn (a.createdAt - b.createdAt);\t\n        });\n    });\n    \nbig_record_tables.user  = user ;\nbig_record_tables.task  = task ;\n\n//setting up some obj from big_record_tables\nbig_record_tables.task.details = {\n    timeout : create_timeout_list_obj(timeout, templates_arr, user_arr, \"timeout\") ,\n    user_calculated: create_timeout_list_obj(timeout, templates_arr, user_arr, \"user_calculated\"),\n    location : get_location_obj(location) \n} ;\n\n\n//create detail obj to save into master_table;\ndetail.table                            = \"details\";\ndetail.task_id                          = task.page_id ? [task.page_id] : null ;\ndetail.intent_task_id                   = task._id ;\ndetail.child_task_id                    = task.child_default_task_id || null;\ndetail.user_id                          = user._id || null;\ndetail.from_user_id                     = set_from_user(form_data.from_user_id) ;\n\ndetail.page_id                          = check_number(form_data.page_id) || generate_page_id();\ndetail.from_page_id                     = check_number(form_data.from_page_id) || generate_page_id();\ndetail.to_page_id                       = task.child_default_task_id ? return_page_id(form_data.page_id) : 0;\n\ndetail.synchronized                     = 0 ;\ndetail.processed                        = 0 ;\ndetail.status                           = 0 ;\ndetail.read                             = 0 ;\ndetail.display_if_empty                 = task.display_if_empty || 1;\ndetail.date_created                     = new Date().toJSON() ;\ndetail.due_date                         = big_record_tables.task.details.user_calculated.delivery_due;\ndetail.offline_expiration_seconds       = task.offline_expiration_time ;\ndetail.priority                         = 1;\ndetail.type                             = {\"private\": \"private\"};\ndetail.image                            = task.image ;\ndetail.from_user                        = {\n                                            firstname   : user.firstname || \"\" ,\n                                            lastname    : user.lastname || \"\" ,\n                                            email       : user.email || \"\",\n                                            phone       : user.phone || \"\"\n                                        };\ndetail.user_incoming                    = {\n                                            note    :   form_data.note ,\n                                            message :   form_data.note\n                                        } ;\n\n//as per discussion with client on 11th August evening and on Google doc(DoMeNow) Item 8.0 there is no need of \n//detail.watson_incoming messages. so just commneted here may be nedded in future.\n// detail.watson_incoming                  = { \n//                                             message :   \"Watson response to : \" + form_data.note,\n//                                             response : {},\n                                            \n//                                         } ;\ndetail.template                         = {\n                                            details : get_template(task.detail_template_id, templates_arr)\n                                        };\n\ndetail.timeout                          = big_record_tables.task.details.timeout ;\ndetail.user_calculate                   = big_record_tables.task.details.user_calculated ;\ndetail.location                         = big_record_tables.task.details.location ;\ndetail.default                          = {\n                                            parent : null,\n                                            allchildren: null\n                                        };\ndetail.count_status\t                    = {\n                                            active : 1,\n                                            unread : 0\n                                        };\ndetail.count\t                        = {\n                                            active : 1,\n                                            unread : 1\n                                        };\ndetail.count_if                         = {\n                                            active : 1,\n                                            unread : 0\n                                        };\ndetail.createdAt                        = Number(new Date().getTime()) ;\n\nmsg.template_arr = templates_arr ;\nmsg.payload      = detail ;\n\nif(check_need_to_create_second_detail(form_data.from_user_id)){\n    var second_detail  = JSON.parse(JSON.stringify(detail));\n        second_detail.from_user_id  = form_data.from_user_id[1];\n        second_detail.user_incoming = {\n            note    :   form_data.to_note ,\n            message :   form_data.to_note\n        } ;\n\n        second_detail.watson_incoming = {\n            message :   \"Watson response to : \" + form_data.to_note,\n            response : {},\n        } ;\n        msg.doCreate_optional_detail = true;\n        msg.option_detail = second_detail;\n}\n\nmsg.api_response = {status:200, error: false, msg: \"Record created successfully\", data: detail};\nreturn msg;\n\nfunction create_timeout_list_obj(timeout_obj, templates, users, type){\n    if(timeout_obj === undefined || timeout_obj === null){\n        return {};\n    }\n    \n    switch(type){\n        case \"timeout\" : {\n            if(check_obj(timeout_obj.timeout_list) > 1){\n                var update_obj = JSON.parse(JSON.stringify(timeout_obj)) ;\n                \n                for(var list in timeout_obj.timeout_list){\n                    if(list !== getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        update_obj.timeout_list[list].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[list].delivery_user_ids, users);\n                        update_obj.timeout_list[list].message = timeout_obj.timeout_list[list].message_id ? get_template(timeout_obj.timeout_list[list].message_id, templates) : null;\n                        update_obj.timeout_list[list].from = timeout_obj.timeout_list[list].from_id ? get_template(timeout_obj.timeout_list[list].from_id, templates) : null;\n                    }\n                }\n                delete update_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)];\n                return update_obj ;   \n            }else{\n                return {} ;\n            }\n            break;\n        }\n        \n        case \"user_calculated\" : {\n\n            if(timeout_obj.timeout_list){\n                for(var key in timeout_obj.timeout_list){\n                    if(key == getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        timeout_obj.timeout_list[key].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[key].delivery_user_ids, users);\n                        timeout_obj.timeout_list[key].template = {\n                            message : timeout_obj.timeout_list[key].message_id ? get_template(timeout_obj.timeout_list[key].message_id, templates) : null ,\n                            from    : timeout_obj.timeout_list[key].from_id ? get_template(timeout_obj.timeout_list[key].from_id, templates) : null\n                        };\n                    }\n                }\n\n                return timeout_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)] ; \n            }else{\n                return {} ; \n            }\n            break;\n        }\n        \n        default: {\n            return {};\n        }\n    }\n}\n\nfunction check_obj(obj){\n    if(typeof obj === \"object\"){\n        return Object.keys(obj).length;\n    }else{\n        return 0 ;\n    }\n}\n\nfunction get_location_obj(locations){\n    if(locations === undefined || locations === null){\n        return {};\n    }\n    var obj = {};\n\n    if(locations !== null && locations !== undefined){\n        for(var i=0; i< locations.length; i++){\n            if(locations[i]){\n                obj[locations[i]._id] = locations[i] ;\n            }\n        }\n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction get_template(id, template){\n    if(template === undefined || template === null){\n        return {};\n    }\n    \n    var obj = {} ;\n    if(template !== null){\n        for(var i=0; i< template.length; i++){\n            if(id === template[i]._id){\n                obj = template[i] ;\n            }\n        }    \n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction check_number(n){\n    if(typeof n === \"string\" && n !== \"\"){\n        return parseInt(n);\n    }else{\n        return n ;\n    }\n}\n\nfunction generate_page_id(){\n    return new Date().getTime();\n}\n\nfunction getAttributeByIndex(obj, index){\n  var i = 0;\n  for (var attr in obj){\n    if (index === i){\n      return attr;\n    }\n    i++;\n  }\n  return null;\n}\n\nfunction get_obj_from_array(id, arr){\n    if(arr === null || arr === undefined){\n        return {};\n    }\n\n    if(id instanceof Object){\n        return id ;    \n    }\n\n    var obj = {} ;\n    if(arr !== null && arr.length){\n        for(var i=0; i< arr.length; i++){\n            if(arr[i]._id === id){\n                obj[arr[i]._id] = arr[i] ;\n            }\n        }\n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction calculate_to_page_id(task_obj, details_arr){\n\n    var page_id = false ;\n    if(task_obj !== null && details_arr !== undefined){\n        var task_id = task_obj._id ;\n        if(details_arr.length){\n            for(var i=0; i < details_arr.length; i++){\n                if(details_arr[i].task_id === task_id){\n                  page_id = details_arr[i].to_page_id ;\n                }\n            }\n            if(!page_id){\n              return generate_page_id(6);\n            }else{\n              return page_id;\n            }\n        }else{\n            page_id = task_obj.page_id ;\n        }\n    }else{\n        return generate_page_id(6);\n    }\n}\n\n\nfunction return_page_id(page_id){\n    return generate_page_id() ;\n}\n\nfunction set_from_user(item){\n    if(Object.prototype.toString.call(item) === \"[object Array]\"){\n        return item[0] ;\n    }else{\n        return item || null;\n    }\n}\n\nfunction check_need_to_create_second_detail(item){\n    if(Object.prototype.toString.call(item) === \"[object Array]\"){\n        return true ;\n    }else{\n        return false ;\n    }\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n","outputs":1,"noerr":0,"x":2599.0006408691406,"y":126.62107467651367,"wires":[["56957b9b.d17a34","de1fc588.2ac3e8","2157edf3.940c42","9008376c.230378","ead8c5b1.780278","8e9c1ae8.b29ed8"]]},{"id":"56957b9b.d17a34","type":"switch","z":"3924c8eb.2bafc8","name":"optional task","property":"child_task_id","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"true","outputs":2,"x":2832.0001678466797,"y":275.6211438179016,"wires":[["b7f51c0c.959e4"],["b46f6332.c865d"]]},{"id":"b7f51c0c.959e4","type":"function","z":"3924c8eb.2bafc8","name":"log","func":"node.warn(\"No need to create optional task\");\nmsg.detail = msg.payload ;\nmsg.isCreateOptionalTask = false ;\nreturn msg;","outputs":1,"noerr":0,"x":3029.000175476074,"y":255.62113344669342,"wires":[["7c264cf4.acba74"]]},{"id":"b46f6332.c865d","type":"function","z":"3924c8eb.2bafc8","name":"optional task","func":"var default_task        = msg.child_task ? msg.child_task[0] : null ,\n    detail              = msg.payload ,\n    user_obj            = msg.user_obj ? msg.user_obj[0]: {} ,\n    optional_task       = {}; \n    \nif(!isEmpty(default_task)){\n    optional_task = {\n        table                   : \"task_table\",\n        task_name               : detail.user_incoming.message, \n        user_id                 : user_obj._id || detail.user_id,\n        page_id                 : detail.to_page_id, \n        from_page_id            : detail.page_id,\n        parent_id               : detail.page_id, \n        header_template_id      : default_task.header_template_id || null,\n        detail_template_id      : default_task.detail_template_id || null,\n        footer_template_id      : default_task.footer_template_id || null,\n        timeout_id              : default_task.timeout_id || null,\n        location_id             : default_task.location_id || null,\n        child_default_task_id   : default_task.child_default_task_id || null,\n        child_default_task_name : default_task.child_default_task_name || null,\n        date_created            : new Date().toJSON(),\n        type                    : default_task.type || \"private\",\n        status                  : default_task.status || 0,\n        category                : default_task.category || null,\n        additional_data_fn      : default_task.additional_data_fn || null,\n        optional_data           : default_task.optional_data || {},\n        required_data           : default_task.required_data || {},\n        offline_expiration_time : default_task.offline_expiration_time || 0,\n        display_if_empty        : default_task.display_if_empty || 1 ,\n        count_status : {\n            active : 1,\n            unread : 0,\n        },\n        count : {\n            active : 1,\n            unread : 0,\n        },\n        count_if : {\n            active : 1,\n            unread : 0,\n        }\n    };\n    msg.isCreateOptionalTask = true ;\n    msg.detail = detail ;\n    msg.payload = optional_task ;\n}else{\n    msg.isCreateOptionalTask = false ;\n    msg.detail = detail ;\n    msg.payload = \"No need to create optional task\";\n}\n\nnode.warn(\"Before going to init loop method\");\nnode.warn(msg);\nreturn msg;\n\nfunction isEmpty(obj){\n    if(obj instanceof Object){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(obj instanceof Array){\n        if(obj.length){\n            return false ;\n        }else {\n            return true ;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":3050.000175476074,"y":297.6211334466934,"wires":[["7c264cf4.acba74"]]},{"id":"7c264cf4.acba74","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"isCreateOptionalTask","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","outputs":2,"x":3254.000762939453,"y":256.6211395263672,"wires":[["d54233dd.ffc7b","c242d90a.bf52f8","1967f0c4.36f5cf"],["d54233dd.ffc7b"]]},{"id":"d54233dd.ffc7b","type":"function","z":"3924c8eb.2bafc8","name":"init loop","func":"var detail_obj = msg.detail ;\nif(isEmpty(detail_obj.timeout)){\n    msg.timeoutLength = 0;\n}else{\n    msg.timeoutLength = check_obj(detail_obj.timeout.timeout_list) ;    \n}\nmsg.count = 0;\nreturn msg;\n\n\nfunction check_obj(obj){\n    if(obj !== undefined && obj !== null && obj !== \"\"){\n        return Object.keys(obj).length ;\n    }else{\n        return 0;\n    }\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":3446.000778198242,"y":300.62116146087646,"wires":[["74823ec9.ee25f"]]},{"id":"74823ec9.ee25f","type":"switch","z":"3924c8eb.2bafc8","name":"counter","property":"count","propertyType":"msg","rules":[{"t":"lt","v":"timeoutLength","vt":"msg"},{"t":"else"}],"checkall":"true","outputs":2,"x":3722.1968307495117,"y":294.62118434906006,"wires":[["fea4d0ec.cf133"],["7275d73c.9b5098"]]},{"id":"ee703fa9.4375e","type":"function","z":"3924c8eb.2bafc8","name":"count++","func":"msg.count++ ;\nreturn msg;","outputs":1,"noerr":0,"x":3825.1970748901367,"y":189.62118339538574,"wires":[["74823ec9.ee25f"]]},{"id":"fea4d0ec.cf133","type":"function","z":"3924c8eb.2bafc8","name":"Timeout Processor","func":"var detail_obj      = msg.payload ,\n    template_arr    = msg.templates,\n    users_arr       = msg.user_arr;\n\nif(compare_dates(detail_obj.due_date)){\n    msg.payload = create_detail_by_timeout_processor();\n}else{\n    msg.payload = null;\n    msg.apiStatus = {status: 400, msg: \"Due date already passout so cann't be processed details\"};\n}\n\nreturn msg;\n\nfunction compare_dates(due_date){\n    var current_unix_date   = new Date().getTime(),\n        due_unix_date       = new Date(due_date).getTime();\n        \n    if(due_unix_date > current_unix_date){\n        return true ;\n    }else{\n        return false ;\n    }\n}\n\nfunction create_detail_by_timeout_processor(){\n    var detail = JSON.parse(JSON.stringify(detail_obj));  \n    \n    if(detail.timeout !== null){\n        if(check_obj(detail.timeout.timeout_list) > 0){\n            var clone_obj = {\n                table                       : \"details\",\n                task_id                     : detail_obj.task_id ,\n                child_task_id               : detail_obj.child_task_id,\n                user_id                     : detail_obj.user_id,\n                page_id                     : detail_obj.page_id,\n                synchronized                : detail_obj.synchronized,\n                processed                   : detail_obj.processed,\n                status                      : detail_obj.status,\n                read                        : detail_obj.read,\n                display_if_empty            : detail_obj.display_if_empty,\n                date_created                : detail_obj.date_created,\n                due_date                    : detail_obj.due_date,\n                offline_expiration_seconds  : detail_obj.offline_expiration_seconds,\n                priority                    : detail_obj.priority,\n                user_incoming               : detail_obj.user_incoming ,\n                watson_incoming             : detail_obj.watson_incoming,\n                template                    : detail_obj.template,\n                timeout                     : create_timeout_list_obj(detail.timeout, template_arr, users_arr, \"timeout\") ,\n                user_calculated             : create_timeout_list_obj(detail_obj.timeout, template_arr, users_arr, \"user_calculated\"),\n                location                    : detail_obj.location,\n                default                     : detail_obj.default,\n                createdAt                   : detail_obj.createdAt,\n                count                       : detail_obj.count\n            };\n   \n            return clone_obj ;\n        }else{\n            return {} ;\n        }   \n    }else{\n        return {};\n    }\n}\n\nfunction create_timeout_list_obj(timeout_obj, templates, users, type){\n    switch(type){\n        case \"timeout\" : {\n            if(check_obj(timeout_obj.timeout_list) > 1){\n                \n                for(var list in timeout_obj.timeout_list){\n                    if(parseInt(list) !== getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        timeout_obj.timeout_list[list].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[list].delivery_user_ids, users);\n                        timeout_obj.timeout_list[list].message = timeout_obj.timeout_list[list].message_id ? get_template(timeout_obj.timeout_list[list].message_id, templates) : null;\n                        timeout_obj.timeout_list[list].from = timeout_obj.timeout_list[list].from_id ? get_template(timeout_obj.timeout_list[list].from_id, templates) : null;\n                    }\n                }\n                \n                delete timeout_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)];\n                return timeout_obj ;   \n            }else{\n                return {} ;\n            }\n            break;\n        }\n        \n        case \"user_calculated\" : {\n            if(timeout_obj.timeout_list){\n                for(var key in timeout_obj.timeout_list){\n                    if(parseInt(key) == getAttributeByIndex(timeout_obj.timeout_list, 0)){\n                        timeout_obj.timeout_list[key].delivery_user_ids = get_obj_from_array(timeout_obj.timeout_list[key].delivery_user_ids, users);\n                        timeout_obj.timeout_list[key].template = {\n                            message : timeout_obj.timeout_list[key].message_id ? get_template(timeout_obj.timeout_list[key].message_id, templates) : null ,\n                            from    : timeout_obj.timeout_list[key].from_id ? get_template(timeout_obj.timeout_list[key].from_id, templates) : null\n                        };\n                    }\n                }\n\n                return timeout_obj.timeout_list[getAttributeByIndex(timeout_obj.timeout_list, 0)] ; \n            }else{\n                return {} ; \n            }\n            break;\n        }\n        \n        default: {\n            return {};\n        }\n    }\n}\n\nfunction check_obj(obj){\n    return Object.keys(obj).length ;\n}\n\nfunction get_template(id, template){\n    var obj = {} ;\n    if(template !== null){\n        for(var i=0; i< template.length; i++){\n            if(id === template[i]._id){\n                obj = template[i] ;\n            }\n        }    \n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction get_obj_from_array(id, arr){\n\n    if(id instanceof Object){\n        return id ;    \n    }\n    \n    var obj = {} ;\n    if(arr !== null && arr.length){\n        for(var i=0; i< arr.length; i++){\n            if(arr[i]._id === id){\n                obj[arr[i]._id] = arr[i] ;\n            }\n        }\n        return obj ;\n    }else{\n        return obj ;\n    }\n}\n\nfunction getAttributeByIndex(obj, index){\n  var i = 0;\n  for (var attr in obj){\n    if (index === i){\n      return parseInt(attr);\n    }\n    i++;\n  }\n  return null;\n}","outputs":1,"noerr":0,"x":3935.197090148926,"y":289.04706382751465,"wires":[["ee703fa9.4375e","a6b1f3dd.4e48a","cd928a6e.b94528"]]},{"id":"7275d73c.9b5098","type":"function","z":"3924c8eb.2bafc8","name":"indicator","func":"msg.payload = \"Timeout processor executes sucessfully\";\nreturn msg;","outputs":1,"noerr":0,"x":3865.1971588134766,"y":352.6211853027344,"wires":[["fa370ae8.3c44c8","8ed2b070.71"]]},{"id":"204f3ae7.ac09b6","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":2429.031234741211,"y":96.0468807220459,"wires":[["c7581e40.9f7ae"],["a289fb28.a9a7f8"]]},{"id":"fa370ae8.3c44c8","type":"debug","z":"3924c8eb.2bafc8","name":"Timeout processor","active":true,"console":"false","complete":"payload","x":4072.196762084961,"y":335.04700660705566,"wires":[]},{"id":"e49493fb.adf29","type":"function","z":"3924c8eb.2bafc8","name":"validate","func":"var payload         = msg.payload ,\n    task            = msg.task_obj , \n    user            = msg.user_obj, \n    task_id         = msg.task_id; \n    access_token    = msg.access_token;\n    page_id         = msg.page_id;\n    detail          = msg.details_obj;\n\nif(isEmpty(payload.rows)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Unable to populate records from cloudant views\", data: null};\n}else{\n    var db_records  = populate_records(payload.rows),\n        task_obj    = populate_obj(db_records.tasks, task_id),\n        user        = populate_user(db_records.users, access_token);\n    \n    if(isEmpty(task_obj)){\n        msg.api_status = \"API_ERROR\";\n        msg.payload = {status: 400, error: true, msg: \"Unable to find `task obj` with `task_id`\", data: null};\n    }else if(isEmpty(user)){\n        msg.api_status = \"API_ERROR\";\n        msg.payload = {status: 400, error: true, msg: \"Unable to find `user obj` with `access_token`\", data: null};\n    }else{\n        msg.api_status      = \"API_SUCCESS\";\n        msg.user_obj        = user ;\n        msg.task_obj        = task_obj ;\n        msg.templates_arr   = db_records.templates;\n        msg.details_arr     = db_records.details;\n        msg.users_arr       = db_records.users ;\n        msg.child_task_obj  = task_obj.child_default_task_id ? populate_obj(db_records.tasks, task_obj.child_default_task_id) : null ;\n        msg.timeout_obj     = task_obj.timeout_id ? populate_obj(db_records.timeouts, task_obj.timeout_id) : null;\n        msg.location_obj    = task_obj.location_id ? populate_obj(db_records.locations, task_obj.location_id): null;\n    }\n}\n\nreturn msg;\n\nfunction populate_records(list){\n    var task_arr = [], detail_arr = [], user_arr = [], templates_arr = [], location_arr = [], timeout_arr = [];\n    \n    for(var itr in list){\n        var records = list[itr].value;\n        if(records.table == \"task_table\"){\n            task_arr.push(records);\n        }\n        \n        if(records.table == \"details\"){\n            detail_arr.push(records);\n        }\n        \n        if(records.table == \"users\"){\n            user_arr.push(records);\n        }\n        \n        if(records.table == \"templates\"){\n            templates_arr.push(records);\n        }\n        \n        if(records.table == \"location\"){\n            location_arr.push(records);\n        }\n        \n        if(records.table == \"timeout\"){\n            timeout_arr.push(records);\n        }\n    }\n    var obj = {tasks: task_arr, details: detail_arr, users: user_arr, templates: templates_arr, locations: location_arr, timeouts: timeout_arr};\n    return obj;\n}\n\nfunction populate_obj(list, id){\n    var obj = {};\n    if(isEmpty(list)) return obj;\n    if(isEmpty(id)) return obj;\n    \n    for(var itr in list){\n        if(id == list[itr]._id){\n            obj = list[itr];\n        }\n    }\n    \n    return obj;\n}\n\nfunction populate_user(users, access_token){\n    var obj = {};\n    if(isEmpty(users)) return obj;\n    if(isEmpty(access_token)) return obj;\n    \n    for(var itr in users){\n        if(access_token == users[itr].access_token){\n            obj = users[itr];\n        }\n    }\n    \n    return obj;\n}\n    \nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":2301.0312271118164,"y":132.04687309265137,"wires":[["204f3ae7.ac09b6"]]},{"id":"c7581e40.9f7ae","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2562.0312423706055,"y":66.04689884185791,"wires":[]},{"id":"13c57f60.d30b71","type":"function","z":"3924c8eb.2bafc8","name":"validate","func":"var access_token = msg.req_body.access_token ;\nvar table_data = msg.req_body.table_data ;\n\nif(table_data === null || table_data === undefined){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide valid json object as api request body.\"};\n    return msg;\n}else if(access_token === null || access_token === undefined || access_token === \"\"){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `access_token` in api request body\"};\n    return msg;\n}else if(table_data.note === null || table_data.note === undefined || table_data.note === \"\"){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `note` in api request body\"};\n    return msg;\n}else if(table_data.page_id === null || table_data.page_id === undefined || table_data.page_id === \"\"){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `page_id` in api request body\"};\n    return msg;\n}else if(table_data.from_page_id === null || table_data.from_page_id === undefined ){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `from_page_id` in api request body\"};\n    return msg;\n}else if(table_data.task_id === null || table_data.task_id === undefined ){\n    msg.flow_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, type: \"Validation error\", msg: \"Please provide `task_id` in api request body\"};\n    return msg;\n}else{\n    msg.flow_status = \"API_SUCCESS\";\n    msg.form_data    = table_data ;\n    msg.task_id = table_data.task_id ; \n    msg.access_token = access_token ;\n    msg.page_id = table_data.page_id  ;\n    return msg;\n}\n\n\nfunction check_number(n){\n    if(!isNaN(parseInt(n))){\n        return parseInt(n);\n    }else{\n        return n ;\n    }\n}\n","outputs":1,"noerr":0,"x":1522.031265258789,"y":50.04690933227539,"wires":[["cf3fd7c2.daf058"]]},{"id":"e8e5af47.57b5c","type":"function","z":"3924c8eb.2bafc8","name":"update_create_user_task","func":"var detail_obj          = msg.detail ,\n    ancesstor_arr       = [] ,\n    user_task_arr       = msg.payload ,\n    task_obj            = msg.task_obj[0] ;\n    calculate_user_task = get_user_taskBy_id(detail_obj.user_id, detail_obj.task_id);\n    \nif(check_obj(calculate_user_task) > 0){\n    msg.payload = update_user_task(msg.payload[0], detail_obj.user_id, detail_obj.task_id, 0, 1);\n}else{\n    if(task_obj.parent_id){\n        var user_task = get_user_taskBy_id(detail_obj.user_id, task_obj.parent_id);\n        \n        if(check_obj(user_task) > 0){\n            ancesstor_arr = user_task.ancestors ;   \n            ancesstor_arr.push(task_obj.parent_id);\n        }else{\n            ancesstor_arr.push(task_obj.parent_id);\n        }\n    }\n    \n    msg.payload = {\n        table           : \"user_task\",\n    \ttask_id \t\t: detail_obj.task_id,\n    \tuser_id\t\t\t: detail_obj.user_id,\n    \tpage_id         : parseInt(detail_obj.page_id),\n    \tupdate_read     : 0,\n    \tupdate_active   : 0, \n    \tsynchronized    : 0,\n        status          : 0, \n    \tdate_updated\t: null,\t\n    \tparent_id\t\t: detail_obj.task_id,\n    \tancestors       : ancesstor_arr,\n    \tcount_status\t: {\n    \t   active       : 1,\n    \t   unread       : 1,\n    \t},\n    \tcount\t\t\t: {\n    \t    active      : 1,\n    \t    unread      : 1,\n    \t},\n    \tcount_if\t\t: {\n    \t    active      : 1,\n    \t    unread      : 1\n    \t},\n    \ttemplates\t\t: {},\n    \ttimeout\t\t\t: {},\n    \tcreatedAt       : new Date().getTime()\n    };\n}\nreturn msg;\n\nfunction update_user_task(user_task, user_id, task_id, status, synchronized){\n\n    user_task.synchronized          = synchronized  ;\n    user_task.date_updated          = new Date().toJSON();\n    user_task.templates             = detail_obj.template ;\n    user_task.timeout               = detail_obj.timeout ;\n    user_task.count_status.unread   = detail_obj.read ;\n    user_task.page_id               = parseInt(detail_obj.to_page_id) ;\n    user_task.status                = detail_obj.status || status;\n\n    if(!user_task.update_read){\n        if( ( user_task.count_status.unread === 1 || user_task.count_status.unread === \"1\") && !user_task.count_if.unread ){\n            user_task.count.unread += 1 ;  \n        }\n    }\n\n    if(!user_task.update_active){\n        if( user_task.count_status.active && user_task.count_if.active){\n            user_task.count.active += 1 ;  \n        }\n    }\n    \n    //if(user_task.parent_id) update_user_task(user_task, user_id, user_task.parent_id, 0, 1);\n    \n    user_task.update_read   = 1 ;\n    user_task.update_active = 1 ;\n    \n    return user_task;\n}\n\nfunction get_user_taskBy_id(user_id, task_id){\n    var obj = {};\n    if(user_task_arr){\n        for(var i=0; i< user_task_arr.length; i++){\n            if(\n                user_task_arr[i].user_id        == user_id &&\n                user_task_arr[i].task_id        == task_id \n            ){\n                obj = user_task_arr[i];\n            }\n        }\n    }\n    return obj ;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\n\nfunction check_obj(obj){\n    return Object.keys(obj).length;\n}","outputs":1,"noerr":0,"x":4442.198181152344,"y":384.04706478118896,"wires":[["54100d5f.551b14","4e5e608.a16f4a"]]},{"id":"8ed2b070.71","type":"function","z":"3924c8eb.2bafc8","name":"payload","func":"var task_id = msg.detail.task_id ,\n    user_id = msg.detail.user_id ;\n    \nmsg.payload = {\n    query: \"table:user_page AND user_id:\" + user_id ,\n    sort : \"_id<string>\"\n};\n\nnode.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":4039.1967544555664,"y":389.0470190048218,"wires":[["be715394.bfd63"]]},{"id":"be715394.bfd63","type":"cloudant in","z":"3924c8eb.2bafc8","name":"master_table","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":4212.198379516602,"y":388.0470218658447,"wires":[["e8e5af47.57b5c"]]},{"id":"cf3fd7c2.daf058","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"flow_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":1799.0000228881836,"y":127.0000228881836,"wires":[["97eb7729.660ae8"],["7773682c.f17248"]]},{"id":"97eb7729.660ae8","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1975,"y":101.0000114440918,"wires":[]},{"id":"54100d5f.551b14","type":"cloudant out","z":"3924c8eb.2bafc8","name":"User Task","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":4669.000930786133,"y":346.0002098083496,"wires":[]},{"id":"a045b3bb.cdadb","type":"cloudant out","z":"3924c8eb.2bafc8","name":"Details","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":4307.165946960449,"y":195.00018692016602,"wires":[]},{"id":"c242d90a.bf52f8","type":"cloudant out","z":"3924c8eb.2bafc8","name":"Optional Task","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":3458.9696044921875,"y":188.57428121566772,"wires":[]},{"id":"de1fc588.2ac3e8","type":"cloudant out","z":"3924c8eb.2bafc8","name":"Details","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":2800.9694862365723,"y":101.00000381469727,"wires":[]},{"id":"2157edf3.940c42","type":"change","z":"3924c8eb.2bafc8","name":"API_RESPONSE","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2848.9691619873047,"y":40.00001037120819,"wires":[["7b82b374.242abc"]]},{"id":"7b82b374.242abc","type":"http response","z":"3924c8eb.2bafc8","name":"","x":3025.969169616699,"y":20,"wires":[]},{"id":"3f162438.ee819c","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2269.016086578369,"y":353.00010681152344,"wires":[]},{"id":"50e26ce4.03dc04","type":"function","z":"3924c8eb.2bafc8","name":"update_task","func":"var access_token = msg.access_token ;\n    \n    if(isEmpty(access_token)){\n        msg.api_status = \"API_ERROR\";\n        msg.payload = {status: 400, error: true, msg: \"`access_token` is missing.\", data: null};\n    }else{\n        msg.api_status = \"API_SUCCESS\";\n        msg.payload = {\n            query : \"table:users AND access_token:\" + access_token ,\n            sort  : \"_id<string>\"\n        };\n    }\n    \nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1289.0156211853027,"y":332.0000648498535,"wires":[["eb4252a0.5f338"]]},{"id":"35bd4677.add10a","type":"cloudant out","z":"3924c8eb.2bafc8","name":"Update record","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":2136.0160789489746,"y":311.0001850128174,"wires":[]},{"id":"c2cfd33d.5439c","type":"change","z":"3924c8eb.2bafc8","name":"api result","rules":[{"t":"move","p":"api_result","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2122.0162391662598,"y":355.0001029968262,"wires":[["3f162438.ee819c"]]},{"id":"b74b5a46.beaf28","type":"function","z":"3924c8eb.2bafc8","name":"update_user","func":"var req_body        = msg.payload_data ,\n    access_token    = msg.access_token ;\n\nif(isEmpty(access_token)){\n    msg.statusCode = 400 ;\n    msg.api_status = \"API_ERROR\" ;\n    msg.payload = {status: 400, error: true, msg: \"`access_token` is missing\", data: []};\n    return msg;\n    \n}else{\n    msg.api_status = \"API_SUCESS\" ;\n    msg.payload = {\n        query : \"table:\"+ req_body.table +\"AND access_token:\"+ access_token +\" AND _id:\" + req_body._id ,\n        sort  : \"_id<string>\"\n    };\n    msg.req_body = req_body;\n    return msg;\n}\n\n\nfunction isEmpty(obj){\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1288.265625,"y":419.25002098083496,"wires":[["e1064afd.ea7338"]]},{"id":"e1064afd.ea7338","type":"switch","z":"3924c8eb.2bafc8","name":"split","property":"API_STATUS","propertyType":"msg","rules":[{"t":"eq","v":"SUCESS","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":1436.2656288146973,"y":419.250057220459,"wires":[["6f112c67.5b36f4"],["13f814be.e80e8b"]]},{"id":"2c546a14.b85a56","type":"function","z":"3924c8eb.2bafc8","name":"update_short_detail","func":"var body            = msg.payload_data ,\n    access_token    = msg.access_token ;\n    \nif(isEmpty(access_token)){\n    msg.statusCode = 400 ;\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`access_token` is required to update detail\", data: body};\n}else if(isEmpty(body.detail_id)){\n    msg.statusCode = 400 ;\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`detail_id` is required to update detail\", data: body};\n}else if(isEmpty(body.page_id)){\n    msg.statusCode = 400 ;\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`page_id` is required to update task detail\", data: body};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    msg.payload_content = {\n        access_token : access_token,\n        content: body\n    };\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1321.1408081054688,"y":529.5001735687256,"wires":[["8ecd778e.cdca28"]]},{"id":"13f814be.e80e8b","type":"cloudant in","z":"3924c8eb.2bafc8","name":"User","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1591.7656860351562,"y":447.25002098083496,"wires":[["43e48bc5.db3af4"]]},{"id":"43e48bc5.db3af4","type":"function","z":"3924c8eb.2bafc8","name":"payload","func":"var req_body = msg.req_body;\n    user_obj = msg.payload[0] ;\n\nif(isEmpty(user_obj)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"Unable to find user with `access_token` and `user_id`.\", data: req_body};    \n}else{\n    user_obj.firstname  = req_body.firstname ;\n    user_obj.lastname   = req_body.lastname  ;\n    user_obj.email      = req_body.email     ;\n    user_obj.phone      = req_body.phone     ;\n    //user_obj.image      = req_body.image     ;\n    user_obj.timezone   = req_body.timezone  ;\n    \n    msg.api_status = \"API_SUCCESS\";\n    msg.payload = user_obj ;\n    \n    msg.api_result = {status: 200, error: false, msg: \"Record udpated successfully\", data: msg.payload};    \n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1732.7658920288086,"y":448.2500591278076,"wires":[["3cefc837.fcb408"]]},{"id":"eb2e797e.5fca78","type":"cloudant out","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":2135.766399383545,"y":464.25014209747314,"wires":[]},{"id":"9f3bf610.b0b818","type":"change","z":"3924c8eb.2bafc8","name":"api result","rules":[{"t":"move","p":"api_result","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2127.7666066487627,"y":516.2501293818156,"wires":[["3f137964.cad246","92741733.ffb9b8"]]},{"id":"3f137964.cad246","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2288.767063140869,"y":482.25018310546875,"wires":[]},{"id":"6f112c67.5b36f4","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1590.6289672851562,"y":403.41017723083496,"wires":[]},{"id":"3cefc837.fcb408","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"else"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1897.5007629394531,"y":443.6668472290039,"wires":[["e9dac59.f61b538"],["eb2e797e.5fca78","9f3bf610.b0b818"]]},{"id":"8ecd778e.cdca28","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"else"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1490.8335571289062,"y":529.3335475921631,"wires":[["ac8a7c58.ec439"],["825eeda0.363c5"]]},{"id":"72746fb7.72633","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_SUCCESS","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":1589.1666221618652,"y":332.66675186157227,"wires":[["102a4d88.b11162"],["b0dd828d.89bb9"]]},{"id":"b0dd828d.89bb9","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1712.9999961853027,"y":373.333438873291,"wires":[]},{"id":"102a4d88.b11162","type":"function","z":"3924c8eb.2bafc8","name":"payload & verify user","func":"var task_obj = msg.payload_data;\n\nif(isEmpty(msg.payload)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"Invalid access_token, Unable to find user with this access_token.\", data: null};\n}else{\n    \n    var user = msg.payload[0];\n    \n    if(user._id === task_obj.user_id){\n        msg.api_status = \"API_SUCCESS\";\n        msg.payload = {\n            _id                         : task_obj._id,\n            _rev                        : task_obj._rev,\n            table                       : task_obj.table, \n            task_name                   : task_obj.task_name,\n            user_id                     : task_obj.user_id,\n            page_id                     : task_obj.page_id,\n            from_page_id                : task_obj.from_page_id,\n            parent_id                   : task_obj.parent_id,\n            header_template_id          : task_obj.header_template_id,\n            detail_template_id          : task_obj.detail_template_id,\n            footer_template_id          : task_obj.footer_template_id,\n            timeout_id                  : task_obj.timeout_id,\n            child_default_task_id       : task_obj.child_default_task_id,\n            child_default_task_name     : task_obj.child_default_task_name,\n            date_created                : task_obj.date_created,\n            type                        : task_obj.type,\n            status                      : task_obj.status,\n            category                    : task_obj.category,\n            additional_data_fn          : task_obj.additional_data_fn,\n            optional_data               : task_obj.optional_data,\n            required_data               : task_obj.required_data,\n            offline_expiration_time     : task_obj.offline_expiration_time,\n            display_if_empty            : task_obj.display_if_empty,\n            image                       : task_obj.image\n        };\n        msg.api_result = {status: 200, error: false, msg: \"Record udpated successfully\", data: msg.payload};\n    }else{\n        msg.api_status = \"API_ERROR\";\n        msg.payload    = {status: 400, error: true, msg: \"You are not authrozied to update this record.\", data: null};\n    }\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1763.1666730244956,"y":325.66670862833666,"wires":[["ed8cf514.c01ad8"]]},{"id":"ed8cf514.c01ad8","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_SUCCESS","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":1935.8336906433105,"y":325.6667003631592,"wires":[["35bd4677.add10a","c2cfd33d.5439c"],["e9dac59.f61b538"]]},{"id":"e9dac59.f61b538","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2115.6672019958496,"y":418.333345413208,"wires":[]},{"id":"eb4252a0.5f338","type":"cloudant in","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1449.1666221618652,"y":331.33337783813477,"wires":[["72746fb7.72633"]]},{"id":"9008376c.230378","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"doCreate_optional_detail","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","outputs":2,"x":2803.3597869873047,"y":150.51562118530273,"wires":[["849b324f.7505"],["b873d549.db10f8"]]},{"id":"849b324f.7505","type":"change","z":"3924c8eb.2bafc8","name":"","rules":[{"t":"move","p":"option_detail","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2991.3439178466797,"y":107.99999713897705,"wires":[["e3321221.ede47"]]},{"id":"e3321221.ede47","type":"cloudant out","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":3207.3554916381836,"y":62.367183685302734,"wires":[]},{"id":"b873d549.db10f8","type":"function","z":"3924c8eb.2bafc8","name":"Log","func":"node.warn(\"No need to create optional second task.\");\nnode.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2933.3478202819824,"y":162.3320188522339,"wires":[[]]},{"id":"96e10578.604ca8","type":"function","z":"3924c8eb.2bafc8","name":"delete_detail","func":"var body = msg.req_body.table_data,\n    token = msg.req_body.access_token ;\n        \n    if(isEmpty(body)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"Table data should be valid json object.\", data: null};\n    }else if(isEmpty(token)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"`access_token` must be provided.\", data: null};\n    }else if(isEmpty(body.id)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"`id` must be provided to remove detail.\", data: null};\n    }else{\n        msg.req_data    = {access_token: token, detail_id: body.id};\n        msg.api_status  = \"API_SUCCESS\";\n        msg.method      = \"GET\";\n        msg.url         = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/delete_view_data\";\n    }\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1282.0000762939453,"y":230.00009727478027,"wires":[["9118b4e0.2ecb68"]]},{"id":"9118b4e0.2ecb68","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1435.8635330200195,"y":228.918062210083,"wires":[["732dcd51.b0e584"],["b1ef109c.6222c"]]},{"id":"732dcd51.b0e584","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1586.863380432129,"y":188.3946032524109,"wires":[]},{"id":"b1ef109c.6222c","type":"http request","z":"3924c8eb.2bafc8","name":"bulk_delete_view","method":"use","ret":"obj","url":"","tls":"","x":1625.8672943115234,"y":253.9297637939453,"wires":[["2c0927e1.617ea8"]]},{"id":"2c0927e1.617ea8","type":"function","z":"3924c8eb.2bafc8","name":"populate_content","func":"var req_body = msg.req_data,\n    body     = msg.payload ;\n    \nif(isEmpty(body.rows)){\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error:true, msg: \"Unable to find data using view\", data: null};\n}else{\n    var result_obj          = populate_body(body.rows),\n        user_obj            = populate_user(result_obj.users, req_body.access_token);\n        \n    if(isEmpty(user_obj)){\n        msg.api_status  = \"API_ERROR\";\n        msg.payload     = {status: 400, error: true, msg: \"Unable to find user with `access_token`.\", data: null};\n        return msg;\n    }else{\n        var detail_obj  = populate_detail(result_obj.details, req_body.detail_id);\n        \n        if(isEmpty(detail_obj)){\n            msg.api_status = \"API_ERROR\";\n            msg.payload     = {status: 400, error: true, msg: \"Unable to find detail with `detail_id`.\", data: null};\n            return msg;\n        }else{\n            \n            if(detail_obj.user_id === user_obj._id){\n                var child_details   = populate_sub_detail(result_obj.details, detail_obj.to_page_id),\n                grand_child_details = populate_grand_child(result_obj.details, child_details),\n                user_tasks          = populate_user_task(result_obj.user_task, detail_obj.page_id, user_obj._id),\n                response            = [];\n                \n                grand_child_details.push(detail_obj);\n                delete_records(grand_child_details);\n                delete_records(user_tasks);\n              \n                msg.api_status = \"API_SUCCESS\";\n                msg.method = \"POST\";\n                msg.url    = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs\";\n                msg.payload = {docs: response} ;\n                return msg;\n            }else{\n                var user_tasks      = populate_user_task(result_obj.user_task, detail_obj.page_id, user_obj._id), response=[];\n                delete_records(user_tasks);\n                \n                msg.api_status = \"API_SUCCESS\";\n                msg.method = \"POST\";\n                msg.url    = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs\";\n                msg.payload = {docs: response};\n                return msg;\n            }\n        }\n    }\n}\n\nreturn msg;\n\nfunction delete_records(records){\n    if(records.length){\n        for(var i=0; i <records.length; i++){\n            response.push({\n                _id     : records[i]._id,\n                _rev    : records[i]._rev,\n                _deleted: true\n            });\n        }\n    }\n}\n\nfunction populate_user_task(user_tasks, page_id, user_id){\n    var arr = [];\n    for(var i=0; i<user_tasks.length; i++){\n        if( ( parseInt(user_tasks[i].page_id) === parseInt(page_id) ) &&\n            ( user_tasks[i].user_id === user_id )\n        ){\n            arr.push(user_tasks[i]);    \n        }\n    }\n    return arr;\n}\n\nfunction populate_grand_child(all_details, child_details){\n    var grand_childs = [];\n    if(!isEmpty(child_details)){\n        for(var i=0; i<all_details.length; i++){\n            for(var k=0; k<child_details.length; k++){\n                if(parseInt(all_details[i].page_id) === parseInt(child_details[k].to_page_id)){\n                    grand_childs.push(all_details[i]);\n                }\n            }\n        }\n    }\n    if(grand_childs.length){\n        return child_details.concat(grand_childs);\n    }else{\n        return child_details;\n    }\n}\n\nfunction populate_sub_detail(details, to_page_id){\n    var arr = [];\n    for(var i=0; i<details.length; i++){\n        if(details[i].page_id === to_page_id){\n            arr.push(details[i]);\n        }\n    }\n    return arr;\n}\n\nfunction populate_detail(details, detail_id){\n    var obj = {};\n    for(var i=0; i<details.length; i++){\n        if(details[i]._id === detail_id){\n            obj = details[i];\n        }\n    }\n    return obj ;\n}\n\nfunction populate_user(users, access_token){\n    var obj = {};\n    for(var i=0; i<users.length; i++){\n        if(users[i].access_token === access_token){\n            obj = users[i] ;\n        }\n    }\n    return obj;\n}\n\nfunction populate_body(rows){\n    var details = [], users=[], user_task=[] ;\n    for(var i=0; i<rows.length; i++){\n        if(rows[i].value.table === \"details\"){\n            details.push(rows[i].value);\n        }\n        \n        if(rows[i].value.table === \"users\"){\n            users.push(rows[i].value);\n        }\n        \n        if(rows[i].value.table === \"user_task\"){\n            user_task.push(rows[i].value);\n        }\n    }\n    return {details: details, users: users, user_task: user_task};\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1835.3633880615234,"y":253.4961700439453,"wires":[["8272a9f3.12af98"]]},{"id":"8272a9f3.12af98","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":2001.60982131958,"y":251.92978382110596,"wires":[["90685770.040cc8"],["a166bb0a.a2b708"]]},{"id":"90685770.040cc8","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2140.3598403930664,"y":221.39851570129395,"wires":[]},{"id":"a166bb0a.a2b708","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"use","ret":"obj","url":"","tls":"","x":2160.8754653930664,"y":268.43367195129395,"wires":[["59066575.8bc1ac"]]},{"id":"59066575.8bc1ac","type":"function","z":"3924c8eb.2bafc8","name":"response","func":"if(isEmpty(msg.payload)){\n    msg.payload = {status: 400, error: true, msg: \"Error while removing record from database\", data: msg.payload};\n}else{\n    msg.payload = {status: 200, error: false, msg: \"Record removed successfully from database.\", data: msg.payload};\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":2328.8640060424805,"y":264.24230098724365,"wires":[["1a31e04f.41c0c"]]},{"id":"1a31e04f.41c0c","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2483.7506437301636,"y":246.0000982284546,"wires":[]},{"id":"ac8a7c58.ec439","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1615.500343322754,"y":497.3335666656494,"wires":[]},{"id":"825eeda0.363c5","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"GET","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_short_details","tls":"","x":1637.5003395080566,"y":551.6669044494629,"wires":[["eb91cbce.f77aa8"]]},{"id":"eb91cbce.f77aa8","type":"function","z":"3924c8eb.2bafc8","name":"populate_records","func":"var payload         = msg.payload,\n    access_token    = msg.payload_content.access_token,\n    req_body        = msg.payload_content.content;\n    \nif(isEmpty(payload.rows)){\n    msg.statusCode = 400 ;\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, error: true, msg: \"Unable to fetch record via using views\", data: null};\n}else{\n    var db_records = populate_records(payload.rows),\n        user_obj   = populate_user(db_records.users, access_token),\n        detail_obj = populate_details(db_records.details, req_body.detail_id),\n        task_obj   = populate_task(db_records.tasks_arr, req_body.page_id);\n        \n        if(isEmpty(user_obj)){\n            msg.statusCode = 400 ;\n            msg.api_status = \"API_ERROR\";\n            msg.payload    = {status: 400, error: true, msg: \"Invalid `access_token`. Please retry after logout.\", data: null};\n        }else{\n            if(user_obj._id == detail_obj.user_id){\n                //update detail_obj\n                detail_obj.display_if_empty         = req_body.display_if_empty;\n                detail_obj.user_incoming.note       = req_body.message ;\n                detail_obj.user_incoming.message    = req_body.message ;\n                detail_obj.type                     = req_body.type;\n         \n                //update task_obj \n                task_obj.display_if_empty = req_body.display_if_empty;\n                task_obj.task_name        = req_body.message ;\n                task_obj.type             = req_body.type;\n                \n                msg.api_status = \"API_SUCCESS\";\n                msg.payload = {\n                    docs: [detail_obj, task_obj]\n                };\n            }else{\n                msg.statusCode = 401 ;\n                msg.api_status = \"API_ERROR\";\n                msg.payload    = {status: 400, error: true, msg: \"You are not authrozied to update this record.\", data: null};\n            }\n        }\n}   \n\nreturn msg;\n\nfunction populate_user(users, access_token){\n    var user = {};\n    for(var i=0; i<users.length; i++){\n        if(users[i].access_token == access_token){\n            user = users[i];\n        }\n    }\n    return user;\n}\n\nfunction populate_details(details, detail_id){\n    var obj = {};\n    for(var i=0; i<details.length; i++){\n        if(details[i]._id == detail_id){\n            obj = details[i];\n        }\n    }\n    return obj;\n}\n\nfunction populate_task(tasks, page_id){\n    var obj = {};\n    for(var i=0; i<tasks.length; i++){\n        if((tasks[i].page_id == page_id) && (tasks[i].table == \"task_table\") ){\n            obj = tasks[i];\n        }\n    }\n    return obj;\n}\n\nfunction populate_records(rows){\n    var users = [], details = [], tasks=[];\n    \n    for(var i=0; i<rows.length; i++){\n        if(rows[i].value.table == \"users\"){\n            users.push(rows[i].value);   \n        }\n        \n        if(rows[i].value.table == \"details\"){\n            details.push(rows[i].value);\n        }\n        \n        if(rows[i].value.table == \"task_table\"){\n            tasks.push(rows[i].value);\n        }\n    }\n    return {users: users, details:details, tasks_arr:tasks };\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1829.8335266113281,"y":549.3335304260254,"wires":[["7af04fa8.aa275"]]},{"id":"18aea733.336489","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2247.8336868286133,"y":645.6667976379395,"wires":[]},{"id":"7af04fa8.aa275","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_SUCCESS","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":2125.8335342407227,"y":616.3334617614746,"wires":[["dfc1ab01.7be598"],["18aea733.336489"]]},{"id":"dfc1ab01.7be598","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"POST","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs","tls":"","x":2264.833564758301,"y":588.6667976379395,"wires":[["42e2714f.eb56"]]},{"id":"42e2714f.eb56","type":"function","z":"3924c8eb.2bafc8","name":"res","func":"if(isEmpty(msg.payload)){\n    msg.payload = {status: 400, error: true, msg: \"Unable to update provided documents\", data: msg.payload};\n}else{\n    msg.payload = {status: 200, error: true, msg: \"Record updated successfully.\", data: msg.payload};\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":2414.8336868286133,"y":588.3335456848145,"wires":[["acb9bc7b.1762d"]]},{"id":"acb9bc7b.1762d","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2552.166660308838,"y":586.6668643951416,"wires":[]},{"id":"90fe0291.bf639","type":"function","z":"3924c8eb.2bafc8","name":"add_detail_to_task","func":"var content         = msg.payload_data ,\n    access_token    = msg.access_token ;\n    \nif(isEmpty(content.detail_id)){\n    msg.statusCode  = 400 ;\n    msg.payload     = {status: 400, msg: \"`detaik_id`is missing\", data: content};\n}else if(isEmpty(content.task_id)){\n    msg.statusCode  = 400 ;\n    msg.payload     = {status: 400, msg: \"`task_id`is missing\", data: content};\n}else if(isEmpty(access_token)){\n    msg.statusCode  = 400 ;\n    msg.payload     = {status: 400, msg: \"`access_token`is missing\", data: content};\n}else{\n    msg.url     = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/add_detail_to_task\";\n    msg.method  = \"GET\";\n}\n\nreturn msg;\n\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1310.4999923706055,"y":639.3333950042725,"wires":[["5de994f7.1f263c"]]},{"id":"9840bd60.3e617","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1987.5002365112305,"y":642.6668062210083,"wires":[]},{"id":"5de994f7.1f263c","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"use","ret":"obj","url":"","tls":"","x":1507.5,"y":637.0000476837158,"wires":[["65743c44.db4f54"]]},{"id":"65743c44.db4f54","type":"function","z":"3924c8eb.2bafc8","name":"populate_data","func":"var content         = msg.payload_data,\n    access_token    = msg.access_token,\n    db_records      = msg.payload;\n\nif(isEmpty(db_records.rows)){\n    msg.statusCode = 400;\n    msg.payload    = {status: 400, msg: \"Unable to fetch data via using cloudant view 'add_detail_to_task'\", data: null};\n}else{\n    var records     = populate_record(db_records.rows),\n        detail_obj  = populate_details(records.details, content.detail_id),\n        user_obj    = populate_user(records.users, access_token);\n        \n    if(isEmpty(user_obj)){\n        msg.statusCode  = 400;\n        msg.payload     = {status: 400, msg: \"`access_token` is not valid.\", data: null};\n    }else if(isEmpty(detail_obj)){\n        msg.statusCode  = 400;\n        msg.payload     = {status: 400, msg: \"`detail_id` is not valid.\", data: null};\n    }else{\n\n        if(isEmpty(detail_obj.task_id)){\n            msg.statusCode  = 400;\n            msg.payload     = {status: 400, msg: \"`detail_obj` doesn't contains task_id. please check it once.\", data: null};\n        }\n        else if(Object.prototype.toString.call(detail_obj.task_id) !== \"[object Array]\"){\n            detail_obj.task_id = detail_obj.task_id.push(task_id);    \n            msg.statusCode  = 400;\n            msg.payload     = {status: 400, msg: \"Invalid detail.task_id. Plesae check details_obj once.\", data: null};\n        }else{\n            msg.statusCode     = 200;\n            detail_obj.task_id.push(content.task_id);    \n            msg.payload        = detail_obj;\n        }\n    }\n}\nreturn msg;\n\nfunction populate_user(arr, token){\n    if(isEmpty(token)) return {};\n    \n    if(isEmpty(arr)){\n        return {};\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(arr[i].access_token == token){\n                return arr[i];\n            }\n        }\n    }    \n    \n    return {};\n}\n\nfunction populate_details(arr, id){\n    if(isEmpty(id)) return {};\n    \n    if(isEmpty(arr)){\n        return {};\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(arr[i]._id == id){\n                return arr[i];\n            }\n        }\n    }    \n    \n    return {};\n}\n\nfunction populate_record(list){\n    var users = [],details=[], sorted_detail=[];\n    for(var i=0; i<list.length; i++){\n        if(list[i].value.table == \"details\"){\n            details.push(list[i].value);\n        }\n        \n        if(list[i].value.table == \"users\"){\n            users.push(list[i].value);\n        }\n        \n    }\n    \n    if(!isEmpty(details)){\n        sorted_detail =  details.sort(function(a,b){\n            sorted_detail = sorted_detail.sort(function(a,b){\n        \t\treturn (a.createdAt - b.createdAt);\t\n            });\n        });\n    }else{\n        sorted_detail = details ;\n    }\n    \n    return {users: users, details: sorted_detail} ;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1695.833381652832,"y":682.6667203903198,"wires":[["404dcf75.954d7"]]},{"id":"404dcf75.954d7","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"400","vt":"num"},{"t":"eq","v":"200","vt":"str"}],"checkall":"true","outputs":2,"x":1843.8333358764648,"y":681.0000286102295,"wires":[["9840bd60.3e617"],["8ab833cd.886f","24f5a55e.c7ffaa"]]},{"id":"24f5a55e.c7ffaa","type":"cloudant out","z":"3924c8eb.2bafc8","name":"master_table","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":2009.833610534668,"y":696.3334407806396,"wires":[]},{"id":"8ab833cd.886f","type":"function","z":"3924c8eb.2bafc8","name":"response","func":"var data = msg.payload ;\n\nmsg.payload = {status: 200, msg: \"Record updated successfully.\", data: data};\nreturn msg;","outputs":1,"noerr":0,"x":2001.8333358764648,"y":753.0000286102295,"wires":[["2f9c13b4.e55acc"]]},{"id":"2f9c13b4.e55acc","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2137.833396911621,"y":754.3333721160889,"wires":[]},{"id":"bcd18f9.265767","type":"function","z":"3924c8eb.2bafc8","name":"add_assistant_to_groups","func":"var access_token = msg.access_token;\n    data         = msg.payload_data;\n\nif(isEmpty(access_token)){\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"`access_token` is missing\", record: []};\n}else if(isEmpty(data.assistants)){\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"Assistants list is missing\", record: []};\n}else{\n    msg.API_ERROR   = \"API_SUCCESS\";\n    msg.payload = {\n        query: \"table:users\",\n        sort: \"_id<string>\"\n    };\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1324.5001220703125,"y":822,"wires":[["87ff7e62.cfb4f"]]},{"id":"87ff7e62.cfb4f","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"API_ERROR","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1534.666748046875,"y":820.6665649414062,"wires":[["fc8aacf8.2e7c9"],["ccab8f42.d0813"]]},{"id":"fc8aacf8.2e7c9","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1726.3333740234375,"y":767,"wires":[]},{"id":"ccab8f42.d0813","type":"cloudant in","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1745.3333740234375,"y":835.6666259765625,"wires":[["4cc97afe.576104"]]},{"id":"4cc97afe.576104","type":"function","z":"3924c8eb.2bafc8","name":"populate","func":"var access_token    = msg.access_token,\n    assistants      = msg.payload_data.assistants,\n    payload         = msg.payload ,\n    group_id        = randomString(32);\n    \nif(isEmpty(payload)){\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"Unable to get user records from database.\", record: []};\n}else{\n    \n    var user_obj    = populate_user(access_token, payload);\n    if(isEmpty(user_obj)){\n        msg.API_ERROR   = \"API_ERROR\";\n        msg.statusCode  = 400;\n        msg.payload     = {status:400, msg: \"Invalid `access_token`. Please check it once.\", record: []};\n    }else{\n        msg.API_ERROR   = \"API_SUCCESS\";\n        msg.payload     = {\n            _id  : group_id,\n            table: \"group_table\",\n            owner_id: payload[0]._id,\n            group_name: getRandomGroupName()\n        };\n        \n        msg.update_user =  {\n            docs: populate_updated_users(group_id, payload, assistants)\n        };\n    }\n}\nreturn msg;\n\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\nfunction getRandomGroupName(){\n    var groupName = [\"dri_main\", \"demo_group\", \"test_group\", \"first_responder\", \"second_responder\", \"third_responder\"];\n    return groupName[Math.floor(Math.random() * groupName.length)];\n}\n\nfunction randomString(length) {\n    var result = '',\n        chars  = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    \n    for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];\n    return result;\n}\n\nfunction populate_user(access_token, users){\n    var obj = {};\n    \n    if(isEmpty(access_token)) return obj;\n    if(isEmpty(users)) return obj;\n    \n    for(var itr in users){\n        if(users[itr].access_token == access_token){\n            obj = users[itr];\n        }\n    }\n    return obj;\n}\n\nfunction populate_updated_users(group_id, users, assistants){\n    var assis = [];\n    for(var ass in assistants){\n        for(var itr in users){\n            if(assistants[ass].detail_id == users[itr]._id){\n                delete users[itr].type.virtual_group ;\n                users[itr].data = {groups: {}};\n                users[itr].data.groups[group_id] = true;\n                assis.push(users[itr]);\n            }\n        }\n    }\n    return assis;\n}","outputs":1,"noerr":0,"x":1909.8333740234375,"y":860.3336791992188,"wires":[["5fac6c40.c25e84"]]},{"id":"5fac6c40.c25e84","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"API_ERROR","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":2053.6665992736816,"y":859.000226020813,"wires":[["f3a200b3.cf763"],["585bc269.707c1c","36605ba1.07ba34"]]},{"id":"f3a200b3.cf763","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2189.333438873291,"y":817.3337635993958,"wires":[]},{"id":"585bc269.707c1c","type":"cloudant out","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":2211.833427429199,"y":869.3333415985107,"wires":[]},{"id":"36605ba1.07ba34","type":"function","z":"3924c8eb.2bafc8","name":"bulk_update","func":"msg.payload = msg.update_user;\nmsg.url     = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs\";\nmsg.method  = \"POST\";\nreturn msg;","outputs":1,"noerr":0,"x":2214.8334197998047,"y":914.0000238418579,"wires":[["54f6a0f7.28c8a"]]},{"id":"54f6a0f7.28c8a","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"use","ret":"obj","url":"","tls":"","x":2378.833267211914,"y":911.6666898727417,"wires":[["b03b7b2d.e3f9e8"]]},{"id":"b03b7b2d.e3f9e8","type":"function","z":"3924c8eb.2bafc8","name":"response","func":"node.warn(\"update assistants are as follows\");\nnode.warn(msg.payload);\nmsg.payload = {\n    status: 200,\n    msg: \"Assistants added successfully\",\n    record: msg.updated_user\n};\nreturn msg;","outputs":1,"noerr":0,"x":2546.833366394043,"y":913.6666250228882,"wires":[["723c2899.1f7ab8"]]},{"id":"723c2899.1f7ab8","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2696.8333053588867,"y":915.6665334701538,"wires":[]},{"id":"ead8c5b1.780278","type":"function","z":"3924c8eb.2bafc8","name":"payload","func":"msg.url             = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_selected_user_task\";\nmsg.method          = \"GET\";\nmsg.detail_obj      = msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":2822.8021030426025,"y":220.5742645263672,"wires":[["df3525bb.92cdb8"]]},{"id":"df3525bb.92cdb8","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"GET","ret":"obj","url":"","tls":"","x":3009.802177429199,"y":201.24091815948486,"wires":[["18a6dec7.6efeb1"]]},{"id":"18a6dec7.6efeb1","type":"function","z":"3924c8eb.2bafc8","name":"populate","func":"var detail_obj = msg.detail_obj,\n    payload    = msg.payload ;\n\nif(isEmpty(payload)){\n    msg.statusCode = 400 ;\n    msg.api_status = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`access_token` is required to update detail\", data: body};\n}else{\n    msg.api_status  = \"API_ERROR\";\n    var user_tasks  = populate_user_task(payload.rows, detail_obj);\n    msg.payload     = {detail_obj: detail_obj, subscribed_users: user_tasks};\n}    \nreturn msg;\n\nfunction populate_user_task(lists, obj){\n    var user_tasks = [];\n    \n    for(var itr in lists){\n        if(\n            ( if_exists_in_arr(lists[itr].value.task_id, obj.task_id) )&&\n            (lists[itr].value.page_id  == obj.page_id)\n        ){\n            lists[itr].value.synchronized = 0;\n            lists[itr].value.status       = 0;\n            user_tasks.push(lists[itr].value);\n        }\n    }\n    return user_tasks;\n}\n\n\nfunction if_exists_in_arr(key, array){\n    return array.indexOf(key) > -1;\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":3184.8021965026855,"y":117.57430720329285,"wires":[["47c046cd.cb5f48","ee229a8f.e93598"]]},{"id":"8bce63a2.3bc62","type":"http request","z":"3924c8eb.2bafc8","name":"Bulk Update","method":"use","ret":"obj","url":"","tls":"","x":3567.802215576172,"y":53.90766406059265,"wires":[["52756564.e32e1c"]]},{"id":"47c046cd.cb5f48","type":"http request","z":"3924c8eb.2bafc8","name":"Notify socket server","method":"POST","ret":"obj","url":"https://socket-server.mybluemix.net/accept_request","tls":"","x":3457.469528198242,"y":138.90762209892273,"wires":[["52756564.e32e1c"]]},{"id":"ee229a8f.e93598","type":"function","z":"3924c8eb.2bafc8","name":"payload","func":"msg.url         = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs\";\nmsg.method      = \"POST\";\n\nnode.warn(\">>>>>>>>>>>>>>>>>>>>>>>>\");\nnode.warn(msg.payload);\n\nmsg.payload     = {\n  docs: msg.payload   \n};\nreturn msg;","outputs":1,"noerr":0,"x":3411.4688720703125,"y":68.57432436943054,"wires":[["8bce63a2.3bc62"]]},{"id":"52756564.e32e1c","type":"debug","z":"3924c8eb.2bafc8","name":"Logger","active":true,"console":"false","complete":"true","x":3707.0007934570312,"y":118.00008964538574,"wires":[]},{"id":"7773682c.f17248","type":"function","z":"3924c8eb.2bafc8","name":"payload","func":"msg.url = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/add_detail_data\";\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"noerr":0,"x":1985.4999694824219,"y":149.66666412353516,"wires":[["8271dcb6.2e776"]]},{"id":"8271dcb6.2e776","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"use","ret":"obj","url":"","tls":"","x":2146.500045776367,"y":142.00001907348633,"wires":[["e49493fb.adf29"]]},{"id":"4e5e608.a16f4a","type":"debug","z":"3924c8eb.2bafc8","name":"After update_create_user_task","active":true,"console":"false","complete":"true","x":4741.500930786133,"y":404.33334255218506,"wires":[]},{"id":"1967f0c4.36f5cf","type":"debug","z":"3924c8eb.2bafc8","name":"create_optional_task","active":true,"console":"false","complete":"payload","x":3478.1668701171875,"y":232.33333730697632,"wires":[]},{"id":"8e9c1ae8.b29ed8","type":"debug","z":"3924c8eb.2bafc8","name":"addDetail payload","active":true,"console":"false","complete":"payload","x":2854.500099182129,"y":327.3333282470703,"wires":[]},{"id":"a6b1f3dd.4e48a","type":"debug","z":"3924c8eb.2bafc8","name":"Under Timeout processor","active":true,"console":"false","complete":"payload","x":4368.166923522949,"y":248.00004482269287,"wires":[]},{"id":"cd928a6e.b94528","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"else"},{"t":"null"}],"checkall":"true","outputs":2,"x":4144.499923706055,"y":193.33333778381348,"wires":[["a045b3bb.cdadb"],["a6b1f3dd.4e48a"]]},{"id":"a837f43.0fb6008","type":"function","z":"3924c8eb.2bafc8","name":"add_assistant_into_group","func":"var payload         = msg.payload ,\n    req_user_id     = msg.req_body.table_data.user_id,\n    req_group_id    = msg.req_body.table_data.group_id,\n    phone           = msg.req_body.table_data.phone,\n    type            = msg.req_body.table_data.type,\n    screen          = msg.req_body.table_data.screen,\n    access_token    = msg.access_token;\n\nif(screen === \"MANAGE_ASSISTANT\"){\n    msg.options = \"case1\";\n    msg.payload = {\n        query: \"table:users AND virtual_phone:\" + phone,\n        sort: \"_id<string>\"\n    };\n    msg.req_user_id = req_user_id;\n    msg.operation_type = type;\n    return msg;\n} else if(screen === \"MANAGE_GROUP\"){\n    msg.options = \"case2\";\n    msg.payload = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tportal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tnode_name: req_group_id, //\"EmployeeGroup\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head:false,\n\t\t\t\ttree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n    msg.req_user_id = req_user_id;\n    msg.operation_type = type;\n    return msg;\n}else{\n    node.warn(\"Unspecified case to handel\");\n}\n","outputs":1,"noerr":0,"x":1320.1667442321777,"y":1024.0002603530884,"wires":[["ae409109.4bec2"]]},{"id":"92741733.ffb9b8","type":"debug","z":"3924c8eb.2bafc8","name":"User Update Logger","active":true,"console":"false","complete":"payload","x":2339.1671257019043,"y":536.3334064483643,"wires":[]},{"id":"a7fa7744.1897e8","type":"function","z":"3924c8eb.2bafc8","name":"update_message_schedule","func":"var payload_data = msg.payload_data;\nif(payload_data.type == \"old_message\"){\n    msg.process_type = \"update_schedule\";\n    msg.payload = {\n        query : \"table:details AND _id:\" + payload_data.detail_id ,\n        sort  : \"_id<string>\"\n    };    \n}else{\n    msg.process_type = \"new_schedule\";\n    msg.payload = {\n        query : \"table:users\" ,\n        sort  : \"_id<string>\"\n    };\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1351.5000305175781,"y":1216.0003819465637,"wires":[["6dc21553.3928bc","ee952d6e.abbba"]]},{"id":"3b9e2dba.c27812","type":"cloudant in","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1780.500129699707,"y":1255.667564868927,"wires":[["e2b8e05b.e13d3"]]},{"id":"e2b8e05b.e13d3","type":"function","z":"3924c8eb.2bafc8","name":"payload","func":"var payload_data = msg.payload_data;\n    scheduled_date = populate_scheduled_time(payload_data);\n    \nif(isEmpty(msg.payload)){\n    msg.api_status = \"API_ERROR\";\n    msg.statusCode = 400 ;\n    msg.payload    = {status: 400, msg: \"Unable to find details for this msg\", data: null};\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    var detail_obj = msg.payload[0];\n    \n    if(isEmpty(detail_obj.user_incoming)){\n        msg.api_status = \"API_ERROR\";\n        msg.statusCode = 400 ;\n        msg.payload    = {status: 400, msg: \"Unable to udpate details msg\", data: null};\n    }else{\n        msg.api_status = \"API_SUCCESS\";\n        detail_obj.user_incoming.message = payload_data.message ;\n        detail_obj.processed = 0 ;\n        detail_obj.status = 1 ;\n        detail_obj.due_date = scheduled_date;\n        msg.payload = detail_obj;\n        \n        msg.api_response = {status:200, msg: \"Record updated successfully\", data: detail_obj};\n    }\n\n}\nreturn msg;\n\nfunction populate_scheduled_time(data){\n    var moment   = global.get('moment'),\n    momentTz = global.get('moment_tz');\n    \n    if(isEmpty(data.timzone)){\n\t\tdata.timzone = \"America/New_York\";\n\t}else{\n\t\tdata.timzone = sechduleData.timzone;\n\t}\n\treturn moment().tz(data.timzone).valueOf();\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1971.5001525878906,"y":1246.3338265419006,"wires":[["a30c0c10.99af5"]]},{"id":"a30c0c10.99af5","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":2120.500274658203,"y":1254.6671382188797,"wires":[["ad91fcbc.d7bc8"],["1db049ca.b537b6","6b489024.9e974"]]},{"id":"1db049ca.b537b6","type":"cloudant out","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":2331.8334465026855,"y":1268.000398159027,"wires":[]},{"id":"6b489024.9e974","type":"change","z":"3924c8eb.2bafc8","name":"response","rules":[{"t":"move","p":"api_response","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2322.833450317383,"y":1317.3338980674744,"wires":[["2a3e0e36.37a9d2"]]},{"id":"2a3e0e36.37a9d2","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2480.8335285186768,"y":1314.6670044660568,"wires":[]},{"id":"6dc21553.3928bc","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"process_type","propertyType":"msg","rules":[{"t":"eq","v":"update_schedule","vt":"str"},{"t":"eq","v":"new_schedule","vt":"str"}],"checkall":"true","outputs":2,"x":1618.000129699707,"y":1255.000328540802,"wires":[["3b9e2dba.c27812"],["b71050d.3bc75b"]]},{"id":"f79e7a6b.26c848","type":"function","z":"3924c8eb.2bafc8","name":"populate_records","func":"var payload         = msg.payload_data,\n    users           = msg.payload,\n    company_bot     = populate_company(msg.access_token, users),\n    user_obj        = populate_user(payload, users),\n    scheduled_time  = populate_scheduled_time(payload),\n    company_screen  = populate_company_data(payload),\n    user_screen     = populate_user_data(payload),\n    final_result    = [] ;\n    \n    \nfinal_result.push(company_screen);\nfinal_result.push(user_screen);\nmsg.user_obj = user_obj;\nmsg.payload = {\n    \"docs\": final_result\n};\nmsg.response = {\n    company_detail : company_screen,\n    user_detail : user_screen\n};\nreturn msg;\n\nfunction populate_company(access_token, list){\n    var obj = {};\n    \n    if(isEmpty(access_token)) return obj;\n    if(isEmpty(list))return obj;\n    \n    for(var itr in list){\n        if(list[itr].access_token == access_token){\n            obj = list[itr];\n        }\n    }\n    \n    return obj;\n}\n\nfunction populate_user(task_obj, list){\n    var obj= {};\n    if(isEmpty(list)) return obj;\n    if(isEmpty(task_obj)) return obj;\n    \n    for(var itr in list){\n        if(Number(list[itr].virtual_phone) == Number(task_obj.task_name)){\n            obj = list[itr];\n        }\n    }\n    return obj;\n}\n\nfunction populate_company_data(data){\n    var name = company_bot.firstname + \" \" + company_bot.lastname;\n    return {\n        \"table\": \"details\",\n        \"task_id\": [data.task_id],\n        \"child_task_id\": null,\n        \"user_id\": user_obj._id ,\n        \"from_user_id\": {\n            \"user_id\": company_bot._id, \n            \"first_name\": company_bot.firstname,\n            \"lastname\" : company_bot.lastname,\n            \"phone\": company_bot.phone\n        },\n        \"page_id\": data.page_id,\n        \"from_page_id\": 0,\n        \"to_page_id\": 0,\n        \"synchronized\": 0,\n        \"processed\": 0,\n        \"status\": 1,\n        \"read\": 0,\n        \"display_if_empty\": \"true\",\n        \"date_created\": new Date().toJSON(),\n        \"due_date\": scheduled_time,\n        \"offline_expiration_seconds\": 0,\n        \"priority\": 1,\n        \"type\": {\n            \"public\" : \"public\"\n        },\n        \"image\": \"\",\n        \"from_user\": {},\n        \"user_incoming\": {\n            \"note\"   : data,\n            \"message\": data.message,\n            \"watson\" : data.message,\n            \"annotation\": populate_Char(name.split(\" \"))\n        },\n        \"template\": {},\n        \"timeout\": {},\n        \"user_calculate\": {},\n        \"location\": {},\n        \"default\": {},\n        \"count_status\": {\n            \"active\": 1,\n            \"unread\": 0\n          },\n        \"count\": {\n            \"active\": 1,\n            \"unread\": 1\n        },\n        \"count_if\": {\n            \"active\": 1,\n            \"unread\": 0\n        },\n        \"createdAt\": scheduled_time\n    };\n}\n\nfunction populate_user_data(data){\n    return {\n        \"table\": \"details\",\n        \"task_id\": [\"18_0\"],\n        \"child_task_id\": null,\n        \"user_id\": user_obj._id ,\n        \"from_user_id\": {\n            \"user_id\": user_obj._id, \n            \"first_name\": user_obj.firstname,\n            \"lastname\" : user_obj.lastname,\n            \"phone\": user_obj.virtual_phone\n        },\n        \"page_id\": 18,\n        \"from_page_id\": 0,\n        \"to_page_id\": 0,\n        \"synchronized\": 0,\n        \"processed\": 2,\n        \"status\": 2,\n        \"read\": 0,\n        \"display_if_empty\": \"true\",\n        \"date_created\": new Date().toJSON(),\n        \"offline_expiration_seconds\": 0,\n        \"due_date\": scheduled_time,\n        \"priority\": 1,\n        \"type\": {\n            \"public\" : \"public\"\n        },\n        \"image\": \"\",\n        \"from_user\": {},\n        \"user_incoming\": {\n            \"note\"   : data,\n            \"message\": data.message,\n            \"watson\" : data.message\n        },\n        \"template\": {},\n        \"timeout\": {},\n        \"user_calculate\": {},\n        \"location\": {},\n        \"default\": {},\n        \"count_status\": {\n            \"active\": 1,\n            \"unread\": 0\n          },\n        \"count\": {\n            \"active\": 1,\n            \"unread\": 1\n        },\n        \"count_if\": {\n            \"active\": 1,\n            \"unread\": 0\n        },\n        \"createdAt\": scheduled_time\n    };\n}\n\nfunction populate_scheduled_time(data){\n    var moment   = global.get('moment'),\n        momentTz = global.get('moment_tz');\n    \n    if(isEmpty(data.timzone)){\n\t\tdata.timzone = \"America/New_York\";\n\t}else{\n\t\tdata.timzone = sechduleData.timzone;\n\t}\n\t\n\treturn moment(data.sechduleDate).tz(data.timzone).valueOf(); \n}\n\n\nfunction populate_Char(arr){\n  var str = \"\";\n  for(var itr in arr){\n    if(arr[itr]){\n      str += arr[itr].substr(0,1);\n    }\n  }\n  return \"..(\" + str + \")\";\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n","outputs":1,"noerr":0,"x":2053.0003089904785,"y":1428.0003399848938,"wires":[["c03d997.1943568","a36c98d7.60ab88","490d2b5e.c43f44"]]},{"id":"b71050d.3bc75b","type":"cloudant in","z":"3924c8eb.2bafc8","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1780.5001411437988,"y":1304.6670384407043,"wires":[["f79e7a6b.26c848"]]},{"id":"a36c98d7.60ab88","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"POST","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs","tls":"","x":2252.833786010742,"y":1373.3337121009827,"wires":[["6b5213e7.eb0d7c"]]},{"id":"6b5213e7.eb0d7c","type":"function","z":"3924c8eb.2bafc8","name":"res","func":"msg.payload = {\n    status: 200,\n    msg: \"Message schedule successfully.\",\n    payload: msg.response\n};\nreturn msg;","outputs":1,"noerr":0,"x":2415.8335151672363,"y":1393.000141620636,"wires":[["65270cc0.7d1584","c26c306f.4e273"]]},{"id":"65270cc0.7d1584","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2557.833808898926,"y":1370.666962146759,"wires":[]},{"id":"d83cca2b.0bb218","type":"function","z":"3924c8eb.2bafc8","name":"delete_schedule_message","func":"node.warn(msg);\nreturn msg;","outputs":1,"noerr":0,"x":1359.1668014526367,"y":1441.0001969337463,"wires":[["1e921c8f.12ac33"]]},{"id":"1e921c8f.12ac33","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"GET","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_data_for_chatbot","tls":"","x":1577.8866958618164,"y":1439.6798024177551,"wires":[["84e4d081.46446"]]},{"id":"84e4d081.46446","type":"function","z":"3924c8eb.2bafc8","name":"populate_records","func":"var payload     = msg.payload ,\n    db_records  = populate_db_records(payload.rows),\n    req_data    = msg.payload_data ;      \n\n    var company_detail  = populate_company_detail(req_data, db_records.details),\n        user_detail     = populate_user_detail(req_data, db_records.details);\n\nnode.warn(company_detail);\nnode.warn(user_detail);\n\nif(isEmpty(company_detail) && isEmpty(user_detail)){\n    msg.api_status = \"API_ERROR\";\n    msg.statusCode = 400;\n    msg.payload    = {status: 400, msg: \"Unable to delete record\", data: null};\n}else{\n    msg.api_status      = \"API_SUCCESS\";\n    msg.statusCode      = 200;\n    msg.url             = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs\";\n    msg.method          = \"POST\";\n    msg.payload         = {\n        docs : [{\n            \"_id\": company_detail._id,\n            \"_rev\": company_detail._rev,\n            \"_deleted\": true\n        },{\n            \"_id\": user_detail._id,\n            \"_rev\": user_detail._rev,\n            \"_deleted\": true\n        }]  \n    };\n    msg.api_response    = {status: 200, msg: \"Record deleted successfully\", data: null};\n}\nreturn msg;\n\nfunction populate_company_detail(req_data, details){\n    var obj = {};\n    if(isEmpty(req_data)) return obj;\n    if(isEmpty(details)) return obj;\n    \n    for(var itr in details){\n        if(details[itr]._id == req_data.detail_id){\n            obj = details[itr];\n        }\n    }\n    \n    return obj;\n}\n\nfunction populate_user_detail(req_data, details){\n    var obj = {};\n    if(isEmpty(req_data)) return obj;\n    if(isEmpty(details)) return obj;\n    \n    for(var itr in details){\n        var message     = isEmpty(details[itr].user_incoming) ? null : details[itr].user_incoming.message ,\n            dateStamp   = isEmpty(req_data.sechduleDate) ? new Date().getTime() : new Date(req_data.sechduleDate).getTime();\n            \n        if( (message == req_data.message) && (details[itr].createdAt == dateStamp) ){\n            obj =   details[itr] ;\n        }\n    }\n    return obj;\n}\n\nfunction populate_db_records(list){\n    var details = [], users = [];\n\n    for(var itr in list){\n        if(list[itr].value.table == \"details\"){\n            details.push(list[itr].value);\n        }\n        \n        if(list[itr].value.table == \"users\"){\n            users.push(list[itr].value);\n        }\n    }\n    return {details: details, users: users};\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1770.8749771118164,"y":1439.2305836677551,"wires":[["e91d5501.9c07e8"]]},{"id":"e91d5501.9c07e8","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1949.8828010559082,"y":1518.1683979034424,"wires":[["29781980.a401b6"],["45f2740c.82bf1c"]]},{"id":"29781980.a401b6","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2086.132801055908,"y":1483.6371479034424,"wires":[]},{"id":"45f2740c.82bf1c","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"use","ret":"obj","url":"","tls":"","x":2108.1291580200195,"y":1553.6766090393066,"wires":[["d30639a8.ed1c68"]]},{"id":"d30639a8.ed1c68","type":"function","z":"3924c8eb.2bafc8","name":"res","func":"if(msg.payload.error) {\n    msg.payload = {status: msg.statusCode, msg: \"Unable to delete record.\", data:null};\n}else{\n    msg.payload = msg.api_response;    \n}\n\nnode.warn(msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2264.140613555908,"y":1554.9848041534424,"wires":[["1be86b24.c0ac75"]]},{"id":"1be86b24.c0ac75","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2399.140613555908,"y":1554.3988666534424,"wires":[]},{"id":"ad91fcbc.d7bc8","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2308.3333282470703,"y":1226.3334441184998,"wires":[]},{"id":"490d2b5e.c43f44","type":"function","z":"3924c8eb.2bafc8","name":"Send SMS","func":"var paylaod = msg.user_obj,\n    data    = msg.payload_data ;\n\nmsg.topic = paylaod.virtual_phone || 12145644732;\nmsg.payload = data.message;\nreturn msg;","outputs":1,"noerr":0,"x":2253.500171661377,"y":1441.6669306755066,"wires":[["f1008f3b.77717"]]},{"id":"f1008f3b.77717","type":"twilio out","z":"3924c8eb.2bafc8","service":"_ext_","twilio":"1ceb100b.a8aaa","from":"","number":"","name":"","x":2460.1665534973145,"y":1461.33376455307,"wires":[]},{"id":"ee952d6e.abbba","type":"debug","z":"3924c8eb.2bafc8","name":"","active":true,"console":"false","complete":"true","x":1617.166633605957,"y":1194.3334956169128,"wires":[]},{"id":"c03d997.1943568","type":"debug","z":"3924c8eb.2bafc8","name":"","active":true,"console":"true","complete":"true","x":2221.1667976379395,"y":1492.333538532257,"wires":[]},{"id":"c26c306f.4e273","type":"debug","z":"3924c8eb.2bafc8","name":"","active":true,"console":"false","complete":"false","x":2580.833724975586,"y":1408.0001330375671,"wires":[]},{"id":"260a2ee4.075282","type":"function","z":"3924c8eb.2bafc8","name":"processing","func":"var payload_data = msg.payload_data,\n    user_page    = payload_data.data,\n    user_obj     = payload_data.user;\n\nif(isEmpty(user_obj)){\n    msg.statusCode      = 200;\n    msg.payload         = {status: 200, msg: \"Unable to find user with request_id\", data: null};\n    msg.api_response    = \"API_ERROR\";\n    \n}else if(isEmpty(user_page)){\n    msg.statusCode      = 200;\n    msg.payload         = {status: 200, msg: \"Unable to update user_page user with request\", data: null};\n    msg.api_response    = \"API_ERROR\";\n    \n}else{\n    delete msg.headers;\n    msg.api_response    = \"API_SUCCESS\";\n    msg.method          = \"GET\";\n    msg.url             = 'https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_selected_user_task?key=[\"' + user_obj._id +'\"]';\n    msg.req_user_page   = user_page;    \n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1305.5000305175781,"y":1565.0000252723694,"wires":[["58b342a0.53e57c","e1334f8b.ee1f2"]]},{"id":"d39e3edb.d4481","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2096.5007286071777,"y":1614.6666913032532,"wires":[]},{"id":"e1334f8b.ee1f2","type":"debug","z":"3924c8eb.2bafc8","name":"","active":true,"console":"false","complete":"true","x":1458.5002059936523,"y":1620.6666111946106,"wires":[]},{"id":"8a5020e.0c44ae","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"use","ret":"obj","url":"","tls":"","x":1633.5004577636719,"y":1598.3336882591248,"wires":[["8fc73f47.284d"]]},{"id":"8fc73f47.284d","type":"function","z":"3924c8eb.2bafc8","name":"payload","func":"var payload = msg.payload;\n\nif(isEmpty(payload.rows)){\n    msg.payload = {status: 200, msg: \"Unable to fetch user_pages with user_id\", data: null};\n    msg.api_response = \"API_ERROR\";\n}else{\n    var db_records      = populate_records(msg.payload.rows),\n        req_user_page   = msg.req_user_page,\n        updated_pages   = populate_updated_pages(db_records.user_page, req_user_page);  \n    \n    if(isEmpty(updated_pages)){\n        msg.payload = {status: 200, msg: \"Unable to fetch user_pages with user_id\", data: null};\n        msg.api_response = \"API_ERROR\";\n    }else{\n        msg.api_response = \"API_SUCCESS\";\n        msg.payload = {\n            \"docs\": updated_pages\n        };            \n    }\n}\n\n\nreturn msg;\n\nfunction populate_records(list){\n    var user_page = [];\n    \n    if(!isEmpty(list)){\n        for(var i=0; i<list.length; i++){\n            if(list[i].value.table == \"user_page\"){\n                user_page.push(list[i].value);\n            }\n        }    \n    }\n    return { user_page: user_page } ;\n}\n\nfunction populate_updated_pages(all_user_pages, req_user_page){\n    node.warn(all_user_pages);\n    node.warn(req_user_page);\n    \n    var udpated_pages = [];\n    \n    if(isEmpty(all_user_pages)) return udpated_pages;\n    if(isEmpty(req_user_page)) return udpated_pages;\n    \n    for(var itr in all_user_pages){\n        for(var each in req_user_page){\n            if( \n                (all_user_pages[itr].page_id == req_user_page[each].page_id) &&\n                (all_user_pages[itr].user_id == req_user_page[each].user_id)\n            ){\n                all_user_pages[itr].count.unread = req_user_page[each].counts.unread;\n                all_user_pages[itr].synchronized = req_user_page[each].synchronized;\n                all_user_pages[itr].status = req_user_page[each].status;\n                udpated_pages.push(all_user_pages[itr]);\n            }\n        }\n    }\n    \n    return udpated_pages;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1785.5007133483887,"y":1604.3336825370789,"wires":[["3c64dc2b.566124"]]},{"id":"58b342a0.53e57c","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_response","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1461.5002059936523,"y":1567.6667675971985,"wires":[["685f3acb.7248f4"],["8a5020e.0c44ae"]]},{"id":"685f3acb.7248f4","type":"http response","z":"3924c8eb.2bafc8","name":"","x":1612.4999694824219,"y":1543.666687488556,"wires":[]},{"id":"3c64dc2b.566124","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"api_response","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1932.5007209777832,"y":1634.3335213661194,"wires":[["d39e3edb.d4481"],["310a0e5c.32b0e2"]]},{"id":"310a0e5c.32b0e2","type":"http request","z":"3924c8eb.2bafc8","name":"","method":"POST","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs","tls":"","x":2117.50040435791,"y":1702.0000290870667,"wires":[["c7b65396.c390d"]]},{"id":"c7b65396.c390d","type":"function","z":"3924c8eb.2bafc8","name":"response","func":"node.warn(\"Record updated successfully!\");\n\nmsg.payload = {\"status\": 200, msg: \"Record updated successfully!\", data: msg.req_user_page};\nreturn msg;","outputs":1,"noerr":0,"x":2277.500415802002,"y":1665.0000281333923,"wires":[["8479b024.7f492"]]},{"id":"8479b024.7f492","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2417.500099182129,"y":1663.333523273468,"wires":[]},{"id":"290b3757.d24448","type":"Tree View","z":"3924c8eb.2bafc8","database":"master_table","username":"30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix","password":"3c2e6d7f80557d231bc462ffd3457a3b05625332c1dffc92467d6d8941fcba85","operation":"prod","x":2450.302703857422,"y":1044.4449186325073,"wires":[["ba6de471.615688"]]},{"id":"ba6de471.615688","type":"function","z":"3924c8eb.2bafc8","name":"response","func":"var payload = msg.payload ;\n\nmsg.statusCode = 200;\nif(msg.operation_type === \"DELETE_FROM_GROUP\"){\n    msg.payload = {status: 200, msg: \"User successfully deleted from group.\", data: payload};\n} else if(msg.operation_type === \"ADD_INTO_GROUP\"){\n    msg.payload = {status: 200, msg: \"User successfully added to group.\", data: payload};\n}else{\n    msg.payload = {status: 200, msg: \"Unable to perfom add/delete operator for user\", data: payload};    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2625.0178813934326,"y":1016.7884502410889,"wires":[["f7e60946.ad4418"]]},{"id":"f7e60946.ad4418","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2778.788564682007,"y":1016.2746429443359,"wires":[]},{"id":"fb721a6e.0213a8","type":"Tree View","z":"3924c8eb.2bafc8","database":"master_table","username":"30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix","password":"3c2e6d7f80557d231bc462ffd3457a3b05625332c1dffc92467d6d8941fcba85","operation":"prod","x":2450.6254692077637,"y":997.2086124420166,"wires":[["ba6de471.615688"]]},{"id":"b4407c6b.b4795","type":"cloudant in","z":"3924c8eb.2bafc8","name":"db","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1687.9619827270508,"y":997.153018951416,"wires":[["b0a169d0.f31ff8"]]},{"id":"b0a169d0.f31ff8","type":"function","z":"3924c8eb.2bafc8","name":"userExists?","func":"var payload         = msg.payload ,\n    req_user_id     = msg.req_body.table_data.user_id,\n    req_group_id    = msg.req_body.table_data.group_id,\n    access_token    = msg.access_token;\n\n\nif(isEmpty(payload)){\n    msg.moveForward = false;\n    msg.payload = {status: 200, msg: \"User doesn't exists with system\", data: []};\n}else{\n    if(isEmpty(req_user_id)) req_user_id = payload[0]._id ;\n    msg.moveForward = true;\n}\n\nmsg.req_user_id = req_user_id;\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1830.9655990600586,"y":996.9794626235962,"wires":[["340b9456.75972c"]]},{"id":"340b9456.75972c","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"moveForward","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","outputs":2,"x":1982.7499732971191,"y":997.323112487793,"wires":[["dc43214f.a3852"],["7b0b60de.9aede"]]},{"id":"dc43214f.a3852","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2133.079734802246,"y":967.1181955337524,"wires":[]},{"id":"7b0b60de.9aede","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"operation_type","propertyType":"msg","rules":[{"t":"eq","v":"ADD_INTO_GROUP","vt":"str"},{"t":"eq","v":"DELETE_FROM_GROUP","vt":"str"}],"checkall":"true","outputs":2,"x":2138.406261444092,"y":1032.2258386611938,"wires":[["2c6660c9.5d994"],["4c7719a7.f67288"]]},{"id":"2c6660c9.5d994","type":"function","z":"3924c8eb.2bafc8","name":"add","func":"var req_group_id    = msg.req_body.table_data.group_id,\n    req_user_id     = msg.req_user_id ;\n    \n    msg.statusCode = 200;\n    msg.payload = [\n    \t{\n            payload: {\n                user_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n                portal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id, in future this should be dynamic\n                node_name: req_group_id, //\"EmployeeGroup\",\n                data_id: req_user_id, //company_id\n                master_parents: [],\n                tree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //tree_owner_id,\n                node_id: null,\n                target: checkTarget(req_group_id),\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\", //fn_name_add\n        }\n    ];\nreturn msg;\n\nfunction checkTarget(group){\n    if(group === \"EmployeeGroup\"){\n        return \"parent\";\n    }else if(group === \"Operator1\"){\n        return \"child\";\n    }else if(group === \"Operator2\"){\n        return \"child\";    \n    }else{\n        return \"child\";\n    }\n}","outputs":1,"noerr":0,"x":2288.302230834961,"y":994.43053150177,"wires":[["fb721a6e.0213a8"]]},{"id":"4c7719a7.f67288","type":"function","z":"3924c8eb.2bafc8","name":"delete","func":"var req_group_id    = msg.req_body.table_data.group_id,\n    req_user_id     = msg.req_body.table_data.user_id ;\n    \n    \n    msg.statusCode = 200;\n    msg.payload = [\n\t\t {\n            payload: {\n                user_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n                portal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //company_id, in future this should be dynamic\n                node_name: req_group_id, //\"Operator1\",\n                data_id: req_user_id, //\"8e3384889429685de23b3b4226f13685\",// *CHANGE THIS *,\n                tree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //tree_owner_id,\n                node_id: null,\n                target: checkTarget(req_group_id),\n                parent_node_name: \"\",\n            },\n            fn_name: \"delete_from_node_name_tree\"\n        }\n\t];\nnode.warn(\"Inside delete node >>>>>\");    \nnode.warn(msg.payload);\t\nreturn msg;\n\nfunction checkTarget(group){\n    if(group === \"EmployeeGroup\"){\n        return \"parent\";\n    }else if(group === \"Operator1\"){\n        return \"child\";\n    }else if(group === \"Operator2\"){\n        return \"child\";    \n    }else{\n        return \"child\";\n    }\n}","outputs":1,"noerr":0,"x":2290.298782348633,"y":1059.43053150177,"wires":[["290b3757.d24448"]]},{"id":"ae409109.4bec2","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"options","propertyType":"msg","rules":[{"t":"eq","v":"case1","vt":"str"},{"t":"eq","v":"case2","vt":"str"}],"checkall":"true","outputs":2,"x":1530.5000114440918,"y":1051.6666851043701,"wires":[["b4407c6b.b4795"],["8097e35b.aae39"]]},{"id":"8097e35b.aae39","type":"Tree View","z":"3924c8eb.2bafc8","database":"master_table","username":"30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix","password":"3c2e6d7f80557d231bc462ffd3457a3b05625332c1dffc92467d6d8941fcba85","operation":"prod","x":1697.1667251586914,"y":1090.666690826416,"wires":[["550771ff.ccc13"]]},{"id":"550771ff.ccc13","type":"function","z":"3924c8eb.2bafc8","name":"isExists?","func":"var req_user_id     = msg.req_body.table_data.user_id,\n    req_group_id    = msg.req_body.table_data.group_id,\n    phone           = msg.req_body.table_data.phone,\n    type            = msg.req_body.table_data.type,\n    screen          = msg.req_body.table_data.screen,\n    payload = populateUserGroups(msg.payload, req_user_id);\n    \n    if(isEmpty(payload)){\n        msg.isUserExists = false;\n    }else{\n        msg.isUserExists = true;\n        msg.statusCode = 200;\n        msg.payload = {status: 200, msg: \"User already exists in `Operator1` group.\", data: payload};\n    }\n    \nreturn msg;\n\nfunction populateUserGroups(allEmployees, user_id){\n    allEmployees = allEmployees[0].result;\n    var obj = {};\n    \n    if(isEmpty(allEmployees)) return obj;\n    for(var itr in allEmployees){\n        if(allEmployees[itr]._id === user_id){\n            obj = allEmployees[itr];\n        }\n    }\n    return obj;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1852.1666259765625,"y":1128.0000305175781,"wires":[["969c654.518f798"]]},{"id":"969c654.518f798","type":"switch","z":"3924c8eb.2bafc8","name":"","property":"isUserExists","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":1998.1666259765625,"y":1128.3333740234375,"wires":[["c66d53dc.2d3e8"],["fa2b324f.a3d86"]]},{"id":"c66d53dc.2d3e8","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2148.1666259765625,"y":1096.3333740234375,"wires":[]},{"id":"579006e6.7fe088","type":"Tree View","z":"3924c8eb.2bafc8","database":"master_table","username":"30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix","password":"3c2e6d7f80557d231bc462ffd3457a3b05625332c1dffc92467d6d8941fcba85","operation":"prod","x":2310.0001373291016,"y":1158.6666955947876,"wires":[["77613fb6.41041"]]},{"id":"fa2b324f.a3d86","type":"function","z":"3924c8eb.2bafc8","name":"add","func":"var req_group_id    = msg.req_body.table_data.group_id,\n    req_user_id     = msg.req_user_id ;\n    \n    msg.statusCode = 200;\n    msg.payload = [\n    \t{\n            payload: {\n                user_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n                portal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id, in future this should be dynamic\n                node_name: req_group_id, //\"EmployeeGroup\",\n                data_id: req_user_id, //company_id\n                master_parents: [],\n                tree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //tree_owner_id,\n                node_id: null,\n                target: checkTarget(req_group_id),\n                parent_node_name: \"\"\n            },\n            fn_name: \"add_to_node_name_tree\", //fn_name_add\n        }\n    ];\nreturn msg;\n\nfunction checkTarget(group){\n    if(group === \"EmployeeGroup\"){\n        return \"parent\";\n    }else if(group === \"Operator1\"){\n        return \"child\";\n    }else if(group === \"Operator2\"){\n        return \"child\";    \n    }else{\n        return \"child\";\n    }\n}","outputs":1,"noerr":0,"x":2147.6767616271973,"y":1159.888545036316,"wires":[["579006e6.7fe088"]]},{"id":"77613fb6.41041","type":"function","z":"3924c8eb.2bafc8","name":"response","func":"var payload = msg.payload ;\n\nmsg.statusCode = 200;\nif(msg.operation_type === \"DELETE_FROM_GROUP\"){\n    msg.payload = {status: 200, msg: \"User successfully deleted from group.\", data: payload};\n} else if(msg.operation_type === \"ADD_INTO_GROUP\"){\n    msg.payload = {status: 200, msg: \"User successfully added to group.\", data: payload};\n}else{\n    msg.payload = {status: 200, msg: \"Unable to perfom add/delete operator for user\", data: payload};    \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2468,"y":1155.6666259765625,"wires":[["a0d9fa55.5a7dc8"]]},{"id":"a0d9fa55.5a7dc8","type":"http response","z":"3924c8eb.2bafc8","name":"","x":2621.770683288574,"y":1155.1528186798096,"wires":[]},{"id":"581ee154.004f8","type":"http in","z":"b5aea0cd.480f6","name":"API HANDLER","url":"/master_api_handler","method":"get","swaggerDoc":"","x":87.765625,"y":195.74999237060547,"wires":[["a47b8b56.335488","a9c94a69.aeaa98"]]},{"id":"a47b8b56.335488","type":"function","z":"b5aea0cd.480f6","name":"Handler","func":"var req = msg.payload ;\n\nif(isEmpty(req)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"req params must be specified.\", data: null};\n}else{\n    msg.api_response = \"API_SUCCESS\";\n\n    var obj = populate_content(req.app) ;\n    if(obj.error){\n      msg.api_response = \"API_ERROR\";\n      msg.payload = {status: 400, error: true, msg: \"Unable to parse `app` param json.\", data: null};\n    }else{\n        msg.req_params = obj.data.api;\n    }\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n    if(typeof obj === \"object\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\nfunction populate_content(obj){\n    if(typeof obj === \"string\"){\n        try{\n           var response = JSON.parse(obj);\n           return {error: false, data: response , msg: \"Json parse successfully\"};\n        }catch(e){\n            node.warn(e);\n            return {error: true, data: null, msg: JSON.stringify(e) };\n        }\n    }else{\n       return {error: true, msg: \"Param content must be of `string` class.\", data: null} ;\n    }\n}","outputs":1,"noerr":0,"x":267.765625,"y":281.74999237060547,"wires":[["cc4678f3.b46db8"]]},{"id":"cc4678f3.b46db8","type":"switch","z":"b5aea0cd.480f6","name":"","property":"api_response","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":418.765625,"y":279.74999237060547,"wires":[["ee1dc387.77993"],["9a5be113.6f04c"]]},{"id":"ee1dc387.77993","type":"http response","z":"b5aea0cd.480f6","name":"","x":598.7656173706055,"y":204.75000381469727,"wires":[]},{"id":"9a5be113.6f04c","type":"function","z":"b5aea0cd.480f6","name":"validate body","func":"var params = msg.req_params;\n\nif(isEmpty(params.type)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`type` parameter must be set to get record\", data: null};\n}else if(isEmpty(params.content)){\n    msg.api_response = \"API_ERROR\";\n    msg.payload = {status: 400, error: true, msg: \"`content` parameter must be set to get record\", data: null};    \n}else{\n    msg.api_response = \"API_SUCCESS\";\n    node.warn(\"comes here.......\");\n    node.warn(params.content);\n    \n    if(!checkObj(params.content)){\n        node.warn(\"when already object >>>>>>\");\n        msg.payload_type = params.type ;\n        msg.payload_content = params.content;\n    }else{\n        var obj = populate_content(params.content) ;\n        node.warn(\">>>>>>>>>>>>>>> inside validate body\");\n        node.warn(obj);\n        if(obj.error){\n          msg.api_response = \"API_ERROR\";\n          msg.payload = {status: 400, error: true, msg: \"Unable to parse `content` param json.\", data: null};\n        }else{\n            msg.payload_type    = params.type ;\n            msg.payload_content = obj.data ;\n        }\n    }\n}\nreturn msg;\n\nfunction isEmpty(obj){\n    if(typeof obj === \"object\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\nfunction populate_content(obj){\n    if(Object.prototype.toString.call(obj) === \"[object String]\"){\n        try{\n           var response = JSON.parse(obj);\n           return {error: false, data: response , msg: \"Json parse successfully\"};\n        }catch(e){\n            node.warn(e);\n            return {error: true, data: null, msg: JSON.stringify(e) };\n        }\n    }else{\n       return {error: true, msg: \"Param content must be of `string` class.\", data: null} ;\n    }\n}\n\nfunction checkObj(obj){\n    if(Object.prototype.toString.call(obj)=== \"[object String]\") return true;\n    else return false ;\n}","outputs":1,"noerr":0,"x":587.7655944824219,"y":295.74999237060547,"wires":[["c4440e57.17d21"]]},{"id":"c4440e57.17d21","type":"switch","z":"b5aea0cd.480f6","name":"","property":"api_response","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":739.7655944824219,"y":356.74999237060547,"wires":[["477852c6.dd58ec"],["8e3651b.e7807b"]]},{"id":"477852c6.dd58ec","type":"http response","z":"b5aea0cd.480f6","name":"","x":872.7656364440918,"y":245.7500057220459,"wires":[]},{"id":"8e3651b.e7807b","type":"switch","z":"b5aea0cd.480f6","name":"","property":"payload_type","propertyType":"msg","rules":[{"t":"eq","v":"get_data_for_task","vt":"str"},{"t":"eq","v":"search","vt":"str"},{"t":"eq","v":"update_get_pages","vt":"str"},{"t":"eq","v":"get_all_task","vt":"str"},{"t":"eq","v":"get_all_assistants","vt":"str"},{"t":"eq","v":"get_assistant_by_id","vt":"str"},{"t":"eq","v":"get_users_groups","vt":"str"},{"t":"eq","v":"pagination_data","vt":"str"},{"t":"else"}],"checkall":"true","outputs":9,"x":753.7656707763672,"y":649.7500228881836,"wires":[["973b884.5b17378"],["ae4e2262.d777a"],["115b596e.2f10f7"],["ec063d2a.fbb1"],["14c962c7.5a04ad"],["cecace33.bb614"],["88a5da72.54dcb8"],["8bb4c9d8.1757e8"],["b36cba69.093288"]]},{"id":"b36cba69.093288","type":"function","z":"b5aea0cd.480f6","name":"else case","func":"msg.payload = {staus: 400, error: true, msg:\"Un specified table type\", data: null};\nreturn msg;","outputs":1,"noerr":0,"x":1220.8342971801758,"y":1051.0005550384521,"wires":[["322b1f35.28c06"]]},{"id":"322b1f35.28c06","type":"http response","z":"b5aea0cd.480f6","name":"","x":1359.8342056274414,"y":1052.6672293345134,"wires":[]},{"id":"ae4e2262.d777a","type":"function","z":"b5aea0cd.480f6","name":"search","func":"var query = msg.payload_content.query;\nmsg.payload = {\n    query   : \"table:users\",\n    sort: \"_id<string>\"\n};\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1188.6367492675781,"y":399.52345848083496,"wires":[["18f61925.6f4fa7"]]},{"id":"34b95b4e.150414","type":"http response","z":"b5aea0cd.480f6","name":"","x":1630.3867591023445,"y":396.1719055734575,"wires":[]},{"id":"18f61925.6f4fa7","type":"cloudant in","z":"b5aea0cd.480f6","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1339.1328528523445,"y":399.3320618234575,"wires":[["66085d08.fe1d24"]]},{"id":"66085d08.fe1d24","type":"function","z":"b5aea0cd.480f6","name":"res","func":"var response = msg.payload;\n    query    = msg.payload_content.query ;\nif(isEmpty(response)){\n    msg.payload = {status: 200, error: false, msg: \"No Record found.\", data: []};\n}else{\n    if(response.length){\n        var users = [] ;\n        for(var i=0; i < response.length; i++){\n            if(response[i].virtual_phone){\n                if(response[i].virtual_phone.toString().search(query.toString()) > - 1){\n                    users.push(response[i]);\n                }\n            }\n        }\n        msg.payload = {status: 200, error: false, msg: \"Record fetched successfully\", data: users};    \n    }else{\n        msg.payload = {status: 200, error: false, msg: \"No Record found.\", data: []};\n    }\n}\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1490.1289466023445,"y":398.7734680734575,"wires":[["34b95b4e.150414"]]},{"id":"973b884.5b17378","type":"function","z":"b5aea0cd.480f6","name":"validate","func":"var access_token = msg.payload_content.access_token,\n    task_id      = msg.payload_content.task_id;\nif(isEmpty(access_token)){\n    msg.api_status  = \"API_ERROR\";\n    msg.payload     = {status: 400, error: true, msg: \"`access_token` is mising.\", data: null};\n}else if(isEmpty(task_id)){\n    msg.api_status  = \"API_ERROR\";\n    msg.payload     = {status: 400, error: true, msg: \"`task_id` is mising.\", data: null};\n}else{\n    msg.api_status  = \"API_SUCCESS\";\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1203.5002632141113,"y":325.0000801086426,"wires":[["cb47e126.20db9"]]},{"id":"788a8d9d.10f8e4","type":"comment","z":"b5aea0cd.480f6","name":"get_data_for_task endpoint","info":"","x":1253.500171661377,"y":263.3333988189697,"wires":[]},{"id":"cb47e126.20db9","type":"switch","z":"b5aea0cd.480f6","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1343.500242869059,"y":323.00006230672204,"wires":[["27a24c34.076ee4"],["7d243249.c24f7c"]]},{"id":"27a24c34.076ee4","type":"http response","z":"b5aea0cd.480f6","name":"","x":1471.500242869059,"y":282.6667493184408,"wires":[]},{"id":"7d243249.c24f7c","type":"http request","z":"b5aea0cd.480f6","name":"","method":"GET","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_task_related_data?include_docs=true","tls":"","x":1492.5002326965332,"y":333.66675186157227,"wires":[["6cc347ca.8aa5b8"]]},{"id":"6cc347ca.8aa5b8","type":"function","z":"b5aea0cd.480f6","name":"populate","func":"\nvar payload = msg.payload ,\n    task_id = msg.payload_content.task_id;\n\nif(isEmpty(payload.rows)){\n    msg.payload     = {status: 400, error: true, msg: \"Unable to populate view to get_data_for_task.\", data: null};\n    return msg;\n}else{\n    msg.payload = {status:200, error:true, msg: \"Record fetched successfully.\", data: populate_db_record(payload.rows)};\n    return msg;\n}\n\n\nfunction populate_db_record(rows){\n    var template = [], task_table = [], timeout=[], location=[], users=[], task_obj={}; \n    for(var i=0; i<rows.length; i++){\n        if(rows[i].doc.table == \"template\"){\n            template.push(rows[i].doc);\n        }\n        \n        if(rows[i].doc.table == \"task_table\"){\n            if(rows[i].doc.page_id == task_id){\n                task_obj = rows[i].doc ;\n            }else{\n                task_table.push({\n                    id          : rows[i].doc._id,\n                    task_name   : rows[i].doc.task_name\n                });\n            }\n        }\n        \n        if(rows[i].doc.table == \"timeout\"){\n            timeout.push({\n                id     : rows[i].doc._id,\n                name   : rows[i].doc.name\n            });\n        }\n        \n        if(rows[i].doc.table == \"location\"){\n            location.push({\n                id          : rows[i].doc._id,\n                name        : rows[i].doc.location_name\n            });\n        }\n        \n        if(rows[i].doc.table == \"users\"){\n            users.push({\n                id          : rows[i].doc._id,\n                name        : formulate_name(rows[i].doc)\n            });\n        }\n    }\n    \n    return {\n      formatted_template: template,\n      formatted_task    : task_table,\n      formatted_timeout : timeout,\n      formatted_location: location,\n      formatted_user    : users,\n      task_obj          : task_obj\n    };\n}\n\nfunction formulate_name(obj){\n    var str = \"\";\n    if(obj.firstname){\n        str += obj.firstname;\n    }\n    \n    if(obj.lastname){\n        str += \" \"+ obj.lastname ;\n    }\n    \n    if(!str){\n        str = \"Anynomous User\";\n    }\n    \n    return str;\n}\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1662.500242869059,"y":328.33343633015954,"wires":[["cce7743f.093ce8"]]},{"id":"cce7743f.093ce8","type":"http response","z":"b5aea0cd.480f6","name":"","x":1868.3337287902832,"y":311.0000915527344,"wires":[]},{"id":"ec063d2a.fbb1","type":"function","z":"b5aea0cd.480f6","name":"get_all_task","func":"msg.payload = {\n    query: \"table:task_table\",\n    sort: \"_id<string>\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":1217.8334197998047,"y":573.0000476837158,"wires":[["cc550c64.147a7"]]},{"id":"cc550c64.147a7","type":"cloudant in","z":"b5aea0cd.480f6","name":"all_task","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1377.8334732055664,"y":572.6666870117188,"wires":[["7ea93f3f.62cfd"]]},{"id":"7ea93f3f.62cfd","type":"function","z":"b5aea0cd.480f6","name":"res","func":"var response = msg.payload ;\n\nif(!isEmpty(response)){\n    msg.payload = {status:200, msg: \"Record fectehed successfully.\", data: response};\n}else{\n    msg.statusCode = 400;\n    msg.payload = {status:400, msg: \"Error while fetching record..\", data: response};\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1512.8335361480713,"y":572.6666860580444,"wires":[["f7ae0d74.1e522"]]},{"id":"f7ae0d74.1e522","type":"http response","z":"b5aea0cd.480f6","name":"","x":1638.83349609375,"y":572.0000610351562,"wires":[]},{"id":"14c962c7.5a04ad","type":"function","z":"b5aea0cd.480f6","name":"get_all_assistants","func":"// msg.payload = {\n//     query: \"table:users\",\n//     sort : \"_id<string>\"\n// };\n\nmsg.payload = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tportal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tnode_name: \"EmployeeGroup\", //\"Operator1\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head: false,\n\t\t\t\ttree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\nreturn msg;","outputs":1,"noerr":0,"x":1235.5000839233398,"y":658.0000514984131,"wires":[["12434fc4.e1c7d"]]},{"id":"14cc1bed.138c34","type":"http response","z":"b5aea0cd.480f6","name":"","x":1725.5005111694336,"y":662.3333835601807,"wires":[]},{"id":"dd9f38c0.c257d8","type":"cloudant in","z":"b5aea0cd.480f6","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1428.500114440918,"y":690.666690826416,"wires":[[]]},{"id":"4c7a42f2.30fd2c","type":"function","z":"b5aea0cd.480f6","name":"response","func":"var payload = populateUserGroups(msg.payload);\n    //payload_content = msg.req_params;\n\n// if(isUserAuthenticated(payload, payload_content.access_token)){\n\n//     var filter      = payload_content.content.filters,\n//         isGroupUsers= payload_content.content.group_users,\n//         result      = [], \n//         type        = null;\n        \n//     if(!isEmpty(isGroupUsers)){\n//         type = \"list_assistant\";\n//         for(var itr  in payload){\n//             if(payload[itr].data){\n//                 if(!isEmpty(payload[itr].data.groups)){\n//                     if(filter in payload[itr].data.groups){\n//                         result.push(payload[itr]);\n//                     }\n//                 }\n//             }\n//         }\n//     }else if(!isEmpty(filter)){\n//         type = \"list_assistant\";\n//         for(var itr  in payload){\n//             if(filter in payload[itr].type){\n//                 result.push(payload[itr]);\n//             }\n//         }\n//     }else{\n//         type = \"add_assistant\";\n//         for(var itr in payload){\n//             //node.warn(!(\"admin\" in payload[itr].type));\n//             if(!(\"admin\" in payload[itr].type)){\n//                 result.push({\n//                     user_id     : payload[itr]._id,\n//                     first_name  : payload[itr].firstname,\n//                     last_name   : payload[itr].lastname,\n//                     type        : payload[itr].type,\n//                     data        : payload[itr].data,\n//                     phone       : payload[itr].virtual_phone\n//                 });\n//             }\n//         }\n//     }\n\n//     msg.statusCode  = 200;\n//     msg.payload     = {status: 200, msg: \"Record fecthed successfully.\", record: {type: type, result:result}};\n// }else{\n//     msg.statusCode  = 400;\n//     msg.payload     = {status: 200, msg: \"`access_token` is invalid\", record: []};          \n// }\n\n// return msg;\n\n\n// function isUserAuthenticated(users, access_token){\n//     for(var itr in users){\n//         if(users[itr].access_token == access_token){\n//             return true ;\n//         }\n//     }\n//     return false;\n// }\nmsg.statusCode  = 200;\nmsg.payload     = {status: 200, msg: \"Record fecthed successfully.\", record: {type: \"add_assistant\", result:payload}};\nreturn msg;\nfunction populateUserGroups(payload){\n    payload = payload[0].result;\n    var array = [];\n    \n    if(isEmpty(payload)) return array;\n    for(var itr in payload){\n        if(payload[itr]){\n            var name = payload[itr].firstname + \" \" + payload[itr].lastname;\n            array.push({\n                user_id     : payload[itr]._id,\n                first_name  : payload[itr].firstname,\n                last_name   : payload[itr].lastname,\n                type        : payload[itr].type,\n                data        : payload[itr].data,\n                phone       : payload[itr].virtual_phone\n            });\n        }\n    }\n    return array;\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1595.1668434143066,"y":660.0000500679016,"wires":[["14cc1bed.138c34"]]},{"id":"cecace33.bb614","type":"function","z":"b5aea0cd.480f6","name":"get_assistant_by_id","func":"var params = msg.payload_content ,\n    access_token = params.access_token,\n    user_id      = params.user_id;\n    \nif(isEmpty(access_token)){\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"`access_token` is missing\", record: []};\n}else if(isEmpty(user_id)){\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"`user_id` is missing\", record: []};\n}else{\n    msg.API_ERROR   = \"API_SUCCESS\";\n    msg.payload = {\n        query: \"table:users\",\n        sort: \"_id<string>\"\n    };\n}\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1249.1667404174805,"y":738.3333644866943,"wires":[["70dd8ec6.4fdf2"]]},{"id":"defca839.673408","type":"http response","z":"b5aea0cd.480f6","name":"","x":1579.166847229004,"y":710.6668453216553,"wires":[]},{"id":"70dd8ec6.4fdf2","type":"switch","z":"b5aea0cd.480f6","name":"","property":"API_ERROR","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1431.5002517700195,"y":738.3334288597107,"wires":[["defca839.673408"],["77d6143c.c62bdc"]]},{"id":"77d6143c.c62bdc","type":"cloudant in","z":"b5aea0cd.480f6","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1598.1668434143066,"y":759.3334302902222,"wires":[["16f225a5.bc86aa"]]},{"id":"16f225a5.bc86aa","type":"function","z":"b5aea0cd.480f6","name":"response","func":"var params       = msg.payload_content ,\n    access_token = params.access_token,\n    user_id      = params.user_id,\n    payload      = msg.payload ;\n\nif(isUserAuthenticated(payload, access_token)){\n    var user_obj = isUserExists(payload, user_id);\n    if(isEmpty(user_obj)){\n        msg.API_ERROR   = \"API_ERROR\";\n        msg.statusCode  = 400;\n        msg.payload     = {status:400, msg: \"user doesn't exits with provided `user_id`.\", record: null};    \n    }else{\n        msg.API_ERROR   = \"API_SUCCESS\";\n        msg.statusCode  = 200;\n        msg.payload     = {status: 200, msg: \"Record fetched successfully\", records: user_obj};\n    }\n}else{\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"`access_token` is invalid. Plesae check it once.\", record: null};\n}\nreturn msg;\n\nfunction isUserExists(users, user_id){\n    var obj = {};\n    for(var itr in users){\n        if(users[itr]._id == user_id){\n            obj = users[itr] ;    \n        }\n    }\n    return obj;\n}\n\nfunction isUserAuthenticated(users, access_token){\n    for(var itr in users){\n        if(users[itr].access_token == access_token){\n            return true ;\n        }\n    }\n    return false;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1761.1667404174805,"y":761.0000514984131,"wires":[["45cf6e55.a2e1d"]]},{"id":"45cf6e55.a2e1d","type":"http response","z":"b5aea0cd.480f6","name":"","x":1899.166862487793,"y":761.0001373291016,"wires":[]},{"id":"88a5da72.54dcb8","type":"function","z":"b5aea0cd.480f6","name":"get_users_groups","func":"var params       = msg.req_params,\n    group_name   = params.content.group_name;\n    \nif(isEmpty(group_name)){\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"`group_name` is missing\", record: []};\n}else{\n    msg.API_ERROR   = \"API_SUCCESS\";\n    msg.payload = [\n\t\t{\n\t\t\tpayload: {\n\t\t\t\tuser_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tportal_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id,\n\t\t\t\tnode_name: group_name, //\"Operator1\", //group_name_company,\n\t\t\t\tinclude_data:true,\n\t\t\t\tinclude_head: false,\n\t\t\t\ttree_owner_id: \"f1b5ed9577f69c6b131d94a46b39044f\", //system_id\n\t\t},\n\t\t\tfn_name: \"get_node_name_tree\"\n\t\t}\n\t];\n}\n\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1244.1667709350586,"y":833.6667385101318,"wires":[["5da165f1.7fb62c"]]},{"id":"5da165f1.7fb62c","type":"switch","z":"b5aea0cd.480f6","name":"","property":"API_ERROR","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1410.0000629425049,"y":870.3334426879883,"wires":[["b15ae668.4b1858"],["676ba017.cb5d6"]]},{"id":"ea427e2f.6b9b2","type":"function","z":"b5aea0cd.480f6","name":"response","func":"var payload      = msg.payload ;\n\nuser_id = \"f1b5ed9577f69c6b131d94a46b39044f\"; //system_admin user\nif(isEmpty(payload)){\n    msg.API_ERROR   = \"API_ERROR\";\n    msg.statusCode  = 400;\n    msg.payload     = {status:400, msg: \"There is no group for this user.\", record: []};    \n}else{\n    msg.statusCode  = 200;\n    msg.payload     = {status:200, msg: \"User group fetched successfully.\", record: populateUserGroups(payload) };    \n}    \nreturn msg;\n\nfunction populateUserGroups(allEmployees){\n    allEmployees = allEmployees[0].result;\n    var obj = [];\n    \n    if(isEmpty(allEmployees)) return obj;\n    for(var itr in allEmployees){\n        if(allEmployees[itr]){\n            var name = allEmployees[itr].firstname + \" \" + allEmployees[itr].lastname;\n            obj.push({\n                _id: allEmployees[itr]._id ,\n                group_name: ( isEmpty(name) ? allEmployees[itr].virtual_phone : name ) ,\n                page_id: null,\n                owner_id: null,\n                phone: allEmployees[itr].virtual_phone\n            });\n        }\n    }\n    return obj;\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1755.1668529510498,"y":871.3334159851074,"wires":[["1f64695c.a03207"]]},{"id":"1f64695c.a03207","type":"http response","z":"b5aea0cd.480f6","name":"","x":1918.166862487793,"y":872.0000829696655,"wires":[]},{"id":"973dc1c7.92e6b","type":"http in","z":"b5aea0cd.480f6","name":"","url":"/master_table","method":"get","swaggerDoc":"","x":100.83332824707031,"y":78.66666412353516,"wires":[["e957aba5.4fe568"]]},{"id":"e957aba5.4fe568","type":"cloudant in","z":"b5aea0cd.480f6","name":"master_table","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_all_","design":"","index":"","x":307.8333435058594,"y":78.33333587646484,"wires":[["62e06420.6c3f5c"]]},{"id":"62e06420.6c3f5c","type":"http response","z":"b5aea0cd.480f6","name":"","x":472.8333435058594,"y":78.66666412353516,"wires":[]},{"id":"8bb4c9d8.1757e8","type":"function","z":"b5aea0cd.480f6","name":"get_more_data","func":"var params = msg.payload_content;\n\n\nif(isEmpty(params)){\n    msg.api_status = \"API_ERROR\";\n    msg.statusCode = 400 ;\n    msg.payload    = {status: 400, msg: \"Bad request: please check api params\", data: null};\n\n}else{\n    msg.api_status = \"API_SUCCESS\";\n    \n    msg.payload = {\n        \"selector\": {\n        \t\"createdAt\": {\n           \t\t\"$gt\" : 0\n           \t},\n            \"page_ids\": {\n                \"$in\": [params.page_id]\n            },\n        \t\"table\": \"details\"\n    \t},\n    \t\"sort\": [{\"createdAt\": \"desc\" }],\n        \"limit\": 20,\n        \"bookmark\": params.bookmark\n    };\n}\n\nif(params.user_id) {\n    msg.payload.selector.user_id = params.user_id ;\n}\nnode.warn(JSON.stringify(msg.payload));\nmsg.url = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_find\";\nmsg.method = \"POST\";\nmsg.statusCode = 200 ;\nnode.warn(msg);\nreturn msg;\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\n","outputs":1,"noerr":0,"x":1236.5000305175781,"y":960.6667232513428,"wires":[["187cbe1b.1d7092"]]},{"id":"13110e07.6e68e2","type":"http response","z":"b5aea0cd.480f6","name":"","x":2299.500213623047,"y":1014.0005483627319,"wires":[]},{"id":"5546a81a.b7d9f8","type":"comment","z":"b5aea0cd.480f6","name":"Pagination endpoint ","info":"","x":1249.5,"y":892.3333129882812,"wires":[]},{"id":"6498d241.8fec4c","type":"http request","z":"b5aea0cd.480f6","name":"","method":"use","ret":"obj","url":"","tls":"","x":1587.1667175292969,"y":1016.0003852844238,"wires":[["88313e3d.95ddf","54675b9e.e6fde4"]]},{"id":"187cbe1b.1d7092","type":"switch","z":"b5aea0cd.480f6","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":1408.166790008545,"y":983.0001411437988,"wires":[["c8083437.05c1a8"],["6498d241.8fec4c"]]},{"id":"c8083437.05c1a8","type":"http response","z":"b5aea0cd.480f6","name":"","x":1563.1666870117188,"y":934.6666870117188,"wires":[]},{"id":"a440d9ee.8440a8","type":"function","z":"b5aea0cd.480f6","name":"populate_res","func":"var {docs, bookmark} = msg.paginated_data ,\n    params = msg.payload_content,\n    user_obj         = isEmpty(msg.payload) ? {} : msg.payload[0];\n\nif(isEmpty(docs)){\n    msg.payload = {\n        status: 200,\n        msg: \"Record fectched successfully\",\n        records: docs,\n        bookmark: bookmark,\n        type: params.type\n    };\n}else{\n    if(isEmpty(user_obj)){\n        msg.statusCode = 400;\n        msg.payload = {\n            status: 400,\n            msg: \"Invaid access_token provided\",\n            records: null,\n            bookmark: null,\n            type: params.type\n        };\n    }else{\n        msg.statusCode = 200;\n        msg.payload = {\n            status: 200,\n            msg: \"Record fectched successfully\",\n            records: formulate_details(docs),\n            bookmark: bookmark,\n            type: params.type\n        };\n    }\n}\n\nreturn msg;\n\n\nfunction formulate_details(detail_data){\n    var detailRecord = {\n        \"_id\": \t\"\",\n        \"image\":\t\t\"\",\n        \"to_page_id\": \t\"\",\n        \"user_id\": \t\t\"\",\n        \"task_id\":      \"\",\n        \"page_id\":      \"\",\n        \"from_user_id\": \"\",\n        \"display_if_empty\": \"\",\n        \"processed\": \"\",\n        \"status\": \"\",\n    \t\"user_incoming\":{},\n        \"watson_incoming\":{},\n        \"type\":         {},\n        \"due_date\": \"\",\n        \"createdAt\": \"\",\n        \"from_user\":    {},\n        \"count\":{\"active\":0, \"unread\":0}\n    }, detailObj= [] ;\n    \n    if(detail_data.length){\n        if(!isEmpty(user_obj)){\n            for(var d in detail_data){\n\n                if( (user_obj._id === detail_data[d].user_id) || (user_obj._id == checkFromUserId(detail_data[d]) )){\n                    //when user owns detail record\n                    detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                }\n                else{\n\n                    if((\"public\" in detail_data[d].type) ){ //check if user is admin or detail is public then display\n\n                        detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                    }else { \n\n                        if((\"admin\" in user_obj.type)){\n                            if( (\"public\" in detail_data[d].type)) {\n                                detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                            }else if(hasSameProps(user_obj.data, detail_data[d].type)){\n                                detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                            }else{\n                                if(detail_data[d].user_id == \"fa1785333117ba7c06b9020a6d3c0079\"){ //if record is created super company\n                                    detailObj.push( get_obj_data(detailRecord, detail_data[d]) );    \n                                }else{\n                                    detail_data.splice(d, 0);\n                                }\n                            }\n                        }else{\n                            detail_data.splice(d, 0);\n                        }\n                    }\n                }\n            }\n            detailObj = removeEmptyArrayElements(detailObj);         \n        }else{\n            //when we don't have any user info while using access_token\n            for(var k in detail_data){\n                if(check_isDisplay(detail_data[k].display_if_empty)){\n                    detailObj.push( get_obj_data(detailRecord, detail_data[k]) );\n                }else{\n                    var find_any_child = populate_child_detail(db_record.details, detail_data[k].to_page_id);\n                    if(find_any_child.length){\n                        detailObj.push( get_obj_data(detailRecord, detail_data[k]) );\n                    }else{\n                        detail_data.splice(k, 0);\n                    }\n                }\n            }\n            detailObj = removeEmptyArrayElements(detailObj);         \n        }\n    }\n\n    return detailObj;\n}\n\nfunction checkFromUserId(detail_obj){\n    if(isEmpty(detail_obj.from_user_id)){\n        return null;\n    }else{\n        if(Object.prototype.toString.call(detail_obj.from_user_id) === \"[object Object]\"){\n            return detail_obj.from_user_id.user_id;\n        }else{\n            return detail_obj.from_user_id;\n        }\n    }\n}\n\nfunction get_obj_data(obj1, obj2){\n\tvar obj = {};\n\tfor (var key in obj1) {\n\t\tif(obj2.hasOwnProperty(key))\n\t\t\tobj[key] = obj2[key];\n\t\telse\n\t\t    obj[key] = obj1[key];\n\t}\n\treturn obj;\n}\n\nfunction removeEmptyArrayElements(arr) { \n   if (!isArray(arr)) {\n      return arr;\n   } else {\n       return arr.filter( function(elem) { \n          return elem !== null ;\n       } ).map(removeEmptyArrayElements);\n   }\n}\n\nfunction check_isDisplay(d){\n    \n    if(d === \"1\"){\n        return true;\n    }else if(d === 1){\n        return true;\n    }else if(d === \"true\"){\n        return true;\n    }else if(d === true){\n        return true;\n    }else if(d === \"false\"){\n        return false;\n    }else{\n        return false ;\n    }\n}\n\nfunction populate_child_detail(details, to_page_id){\n    var arr = [];\n    for(var i=0; i<details.length; i++){\n        if( details[i].page_id === to_page_id ){\n            arr.push(details[i]);\n        }\n    }\n    return arr;\n}\n\nfunction isArray(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\n","outputs":1,"noerr":0,"x":2127.500373840332,"y":1018.0003862380981,"wires":[["13110e07.6e68e2"]]},{"id":"88313e3d.95ddf","type":"debug","z":"b5aea0cd.480f6","name":"","active":true,"console":"false","complete":"true","x":1744.1667289733887,"y":1062.666648864746,"wires":[]},{"id":"54675b9e.e6fde4","type":"function","z":"b5aea0cd.480f6","name":"isUserExists","func":"msg.paginated_data  = msg.payload ;\nvar params          = msg.req_params ;\n\n\nmsg.payload = {\n    \"query\": \"access_token:\" + params.access_token,\n    \"sort\": \"_id<string>\"\n};\nreturn msg;","outputs":1,"noerr":0,"x":1770.8333549499512,"y":1018.0000600814819,"wires":[["523bef02.2eeb2"]]},{"id":"523bef02.2eeb2","type":"cloudant in","z":"b5aea0cd.480f6","name":"master_table","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","search":"_idx_","design":"filterBy","index":"filterBy","x":1945.8334121704102,"y":1018.6667318344116,"wires":[["a440d9ee.8440a8"]]},{"id":"a9c94a69.aeaa98","type":"debug","z":"b5aea0cd.480f6","name":"","active":true,"console":"false","complete":"false","x":336.5,"y":186.33333778381348,"wires":[]},{"id":"115b596e.2f10f7","type":"http request","z":"b5aea0cd.480f6","name":"updated_get_pages View","method":"GET","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/updated_get_pages","tls":"","x":1255.6666259765625,"y":510.6666564941406,"wires":[["8cc898db.ffcbc8"]]},{"id":"321d47a3.f88298","type":"comment","z":"b5aea0cd.480f6","name":"Updated_get_pages endpoint","info":"","x":1271.5986442565918,"y":458.5831871032715,"wires":[]},{"id":"8cc898db.ffcbc8","type":"function","z":"b5aea0cd.480f6","name":"count_view ","func":"var payload             = msg.payload ,\n    body                = msg.payload_content,\n    access_token        = body.access_token,\n    all_pages           = body.all_pages,\n    page_id             = body.page_id;\n    \nnode.warn(\"inside count view >>>\");\nnode.warn(msg);\n\nmsg.all_pages_request = false; //if user request for all pages then this flag should set to be true;\nif( page_id !== 1 || page_id !== 11 ){ //no need to calculate counts for login and verification page;\n    var db_record           = populate_records(payload.rows),\n        user_obj            = populate_user(access_token, db_record.users),\n        task_obj            = populate_taskobj(page_id, db_record.tasks);\n    \n    msg.isCount = true ;\n    msg.db_get_page     = payload ;\n    msg.method          = \"GET\";\n    msg.url             = 'https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/page_counts?reduce=false&key=['+ task_obj.page_id +',\"'+ user_obj._id +'\"]';\n    node.warn(\"page_count cloudantUrl ....\");\n    node.warn(msg.url);\n}else{\n    msg.isCount         = false ;\n    msg.db_get_page     = payload ;\n}        \n    \nmsg.db_get_page = payload;\ndelete msg.headers;\nreturn msg;\n\n\nfunction populate_records(list){\n    var users = [], task_table = [];\n    for(var i=0; i<list.length; i++){\n        if(list[i].value.table == \"task_table\"){\n            task_table.push(list[i].value);\n        }\n\n        if(list[i].value.table == \"users\"){\n            users.push(list[i].value);\n        }\n    }\n    \n    return {users: users, tasks: task_table} ;\n}\n\nfunction populate_user(access_token, users){\n    var obj = {} ,\n        phone = body.phone ;\n        \n    for(var i in users){\n        if(users[i] && users[i].virtual_phone){\n            if(\n                (access_token === users[i].access_token) ||\n                (phone == users[i].virtual_phone.toString())\n                ){\n                obj = users[i];\n            }    \n        }\n    }\n    return obj;\n}\n\nfunction populate_taskobj(id, arr){\n    if(isEmpty(id)) return {};\n    \n    if(isEmpty(arr)){\n        return {};\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(arr[i].page_id == id){\n                return arr[i];\n            }\n        }\n    }\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":1469.666347503662,"y":510.66648292541504,"wires":[["2473bb89.875b74"]]},{"id":"6db93c1b.66cc14","type":"http request","z":"b5aea0cd.480f6","name":"Count view","method":"use","ret":"obj","url":"","tls":"","x":1778.1666946411133,"y":473.9999370574951,"wires":[["ce1e91df.04442"]]},{"id":"ce1e91df.04442","type":"switch","z":"b5aea0cd.480f6","name":"","property":"all_pages_request","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","outputs":2,"x":1948.7847023010254,"y":512.3784885406494,"wires":[["138add88.9c9e92"],["97331e52.0c7fb"]]},{"id":"97331e52.0c7fb","type":"function","z":"b5aea0cd.480f6","name":"all_pages_request","func":"var payload             = msg.db_get_page ,\n    counts              = msg.payload || [],\n    req_obj             = msg.payload_content,\n    db_record           = populate_records(payload.rows),\n    user_obj            = populate_user(req_obj, db_record.users),\n    ancestor_conts_array    = [],\n    decendent_counts_array  = [];\n    \nif(isEmpty(user_obj)){\n    msg.statusCode = 400 ;\n    msg.api_status = \"API_ERROR\";\n    msg.payload    = {status: 400, msg: \"Unable to populate user via using `access_token` or `phone`.\", data: null};\n}else{\n    var user_tasks = populate_user_task_pages(db_record.user_tasks, user_obj);\n    //msg.payload    = {status: 200, error:false, msg: \"Record fetched successfully\", records: populated_pages(user_tasks, db_record) };\n    msg.payload    = {status: 200, error:false, msg: \"Record fetched successfully\", records: [] };\n}\nreturn msg;\n\n\nfunction populate_user_task_pages(usersTasks, user){ //list, object\n    if(isEmpty(usersTasks)) return [];\n    if(isEmpty(user)) return [];\n    \n    var result = [];\n    for(var itr in usersTasks){\n        if(usersTasks[itr].user_id == user._id){\n            result.push(usersTasks[itr]);\n        }\n    }\n    return result;\n}\n\nfunction populate_records(list){\n    var users = [], templates = [], details=[], task_table = [], user_task = [], sorted_detail = [];\n    for(var i=0; i<list.length; i++){\n        if(list[i].value.table == \"template\"){\n            templates.push(list[i].value);\n        }\n        if(list[i].value.table == \"details\"){\n            details.push(list[i].value);\n        }\n        \n        if(list[i].value.table == \"task_table\"){\n            task_table.push(list[i].value);\n        }\n\n        if(list[i].value.table == \"users\"){\n            users.push(list[i].value);\n        }\n        \n        if(list[i].value.table == \"user_task\"){\n            user_task.push(list[i].value);\n        }\n    }\n    \n    if(!isEmpty(details)){\n        sorted_detail =  details.sort(function(a,b){\n            sorted_detail = sorted_detail.sort(function(a,b){\n            \tif(typeof a.page_id === 'number'){\n            \t\treturn (a.page_id - b.page_id);\t\n            \t}else{\n            \t\treturn (a.createdAt - b.createdAt);\t\n            \t}\n            });\n        });\n    }else{\n        sorted_detail = details ;\n    }\n    \n    return {users: users, templates: templates, details: sorted_detail, tasks: task_table, user_tasks: user_task} ;\n}\n\nfunction populate_user(body, users){\n    var obj             = {} ,\n        access_token    = body.access_token,\n        phone           = body.phone ;\n        \n    for(var i in users){\n        if(\n            (access_token == users[i].access_token) ||\n            (phone == users[i].virtual_phone.toString())\n            ){\n            obj = users[i];\n        }\n    }\n    return obj;\n}\n\nfunction populated_pages(user_tasks, db_obj){\n    var pages = [] , req_page = {};\n    \n    for(var i=0; i < user_tasks.length; i++){\n        var task_obj        =  populate_taskobj(user_tasks[i].page_id, db_obj.tasks);\n        \n        if(!isEmpty(task_obj)){\n            var details     =  populate_details(task_obj._id, db_obj.details),\n            prepare_task    =  formulate_task(task_obj, db_obj),\n            prepare_details =  formulate_details(details);  \n                    \n            pages.push({\n                page_id :  user_tasks[i].page_id,\n                user    :  user_obj || {},\n                task    :  prepare_task,\n                detail  :  getpage(prepare_details)\n        \t});\n        }\n    }\n        \n    return {req_page : req_page, pages: pages};\n}\n\nfunction getpage(details){\n    var result  = populate_counts(details),\n        detail  = result.detail_array;\n         \n    if(detail.length){\n        return detail ;\n    }else{\n        return [] ;\n    }\n}\n\nfunction populate_counts(details){\n    var detailArr=[];\n\n    for(var loop in details){\n        var isUserTaskExits = checkFromUserTaskList(details[loop], db_record.user_tasks); \n        \n        if( isEmpty(isUserTaskExits) ){ //check if already user_task is not present for that user. if not then do the following steps\n        \n            populate_ancestors(details[loop].page_id, db_record.tasks, \"page_id\"); //calculating ancestor task with request page_id\n            populate_decendents(details[loop].page_id, db_record.details); //calculating sub childs _id with current requested page_id\n\n            msg.updated_user_task = {   // create user_task record if user_task is not present in database \n              table           : \"user_task\",\n            \ttask_id \t\t    : details[loop].task_id[0],\n            \tuser_id\t\t\t : user_obj._id,\n            \tpage_id         : parseInt(details[loop].page_id),\n            \tsynchronized    : 1,\n              status          : 0, \n            \tdate_updated\t : null,\t\n            \tparent_id\t\t : details[loop].task_id[0],\n            \tancestors       : ancestor_conts_array, \n            \tdecendents      : decendent_counts_array,\n            \tcount_status\t : {\n            \t   active       : 1,\n            \t   unread       : 0,\n            \t},\n            \tcount\t\t\t    : {\n            \t    active      : 1,\n            \t    unread      : 0,\n            \t},\n            \tcount_if\t\t    : {\n            \t    active      : 1,\n            \t    unread      : 0\n            \t},\n            \ttemplates\t\t : {},\n            \ttimeout\t\t\t : {},\n            \tcreatedAt       : new Date().getTime()\n            };\n            \n            details[loop].count.active = 0;     //when user_task is not present for that detail\n            details[loop].count.unread = 0;     // just set default values for active and unread\n            detailArr.push(details[loop]);      // and push into detailArr to sent response to client.\n        }else{ //when already user_task present for that user. just get_active and unread counts from cloudant view i.e counts.rows\n            msg.updated_user_task = {};\n            var detail_count = populateDetailObjWithCounts(counts.rows, details[loop]);\n            details[loop].count.active = detail_count.active; \n            details[loop].count.unread = detail_count.unread;\n            detailArr.push(details[loop]); \n        }\n    }\n\n    if(!isEmpty(msg.updated_user_task))  msg.update_my_user_task = true;\n    return {detail_array: detailArr};\n}\n\n\nfunction populateDetailObjWithCounts(rows, detail_obj){                  //this function accepts cloudant view rows and particular details obj\n    var obj = {active: 0, unread: 0};\n\n    if(isEmpty(rows)) return obj;\n    if(isEmpty(detail_obj)) return obj;\n    \n    for(var itr in rows){\n        if(\n            (rows[itr].key[1] == detail_obj.user_id) &&                  //key[1] should contains user_id in user_task count cloudant_view\n            ( if_exists_in_arr(rows[itr].key[2], detail_obj.task_id) )   // for refrence check cloudant view page_count \n        ){                                                               // for e.g emit([doc.ancestors[i], doc.user_id, doc.task_id], {active: doc.count.active, unread: doc.count.unread});\n            obj.active += rows[itr].value.active ;\n            obj.unread += rows[itr].value.unread ;\n        }\n    }\n    \n    return obj;\n}\n\nfunction checkFromUserTaskList(obj, user_tasks){\n    var res = {};\n    if(isEmpty(obj)) return res;\n    if(isEmpty(user_tasks)) return res;\n    \n    for(var loop in user_tasks){\n        if(\n            (user_tasks[loop].user_id == user_obj._id) &&\n            (if_exists_in_arr(user_tasks[loop].task_id, obj.task_id ))\n        ){\n            res = user_tasks[loop];\n        }\n    }\n    return res;\n}\n\nfunction populate_ancestors(id, task_arr, type){\n    if(type == \"page_id\"){\n        for(var index in task_arr){\n            if(task_arr[index].page_id == id){\n                if( !if_exists_in_arr( task_arr[index].parent_id, ancestor_conts_array ) ){\n                    ancestor_conts_array.push(task_arr[index].parent_id.toString());\n                }\n                populate_ancestors( task_arr[index].parent_id, db_record.tasks, \"parent_id\"); \n            }\n        }    \n    }else{\n        for(var itr in task_arr){\n            if(task_arr[itr]._id == id){\n                if(!isEmpty(task_arr[itr].parent_id)) {\n                    if( !if_exists_in_arr( task_arr[itr].parent_id, ancestor_conts_array ) ){\n                        ancestor_conts_array.push(task_arr[itr].parent_id.toString());\n                        populate_ancestors( task_arr[itr].parent_id, db_record.tasks, \"parent_id\");\n                    }\n                }\n            }\n        }    \n    }\n}\n\nfunction populate_decendents(id, details_arr){\n    for(var index in details_arr){\n        if(id == details_arr[index].page_id){\n            if(checkIsPrivate(details_arr[index])) {\n                if(!if_exists_in_arr( details_arr[index]._id, decendent_counts_array)){\n                    decendent_counts_array.push(details_arr[index]._id.toString());\n                }\n            }\n\n            if( \n                !isEmpty(details_arr[index].to_page_id) && \n                ( parseInt(details_arr[index].to_page_id) === 0) &&\n                checkIsPrivate(details_arr[index])\n            ){\n                populate_decendents(details_arr[index].to_page_id, db_record.deatils);\n            }\n        }\n    }\n}\n\n\nfunction checkIsPrivate(detail){\n\n    if(isEmpty(user_obj)){\n        return false;\n    }else{\n        if((\"private\" in detail.type)){\n            if(user_obj._id == detail.user_id){\n                return true;\n            }else{\n                return false;\n            }\n        }else{\n            if(!isEmpty(user_obj.data)){\n                var obj2 = detail.type ,\n                     obj1 = user_obj.data.groups;\n                \n                if(isEmpty(obj1) || isEmpty(obj2)) return true;\n                \n                return Object.keys( obj1 ).every( function( prop ) {\n             \t\treturn obj2.hasOwnProperty( prop );\n             \t});\n            }else{\n                return true;\n            }\n        }\n    }\n}\n\nfunction formulate_details(detail_data){\n    var detailRecord = {\n        \"_id\": \t\"\",\n        \"image\":\t\t\"\",\n        \"to_page_id\": \t\"\",\n        \"user_id\": \t\t\"\",\n        \"task_id\":      \"\",\n        \"page_id\":      \"\",\n        \"from_user_id\": \"\",\n        \"display_if_empty\": \"\",\n        \"processed\": \"\",\n        \"status\": \"\",\n    \t\"user_incoming\":{},\n        \"watson_incoming\":{},\n        \"type\":         {},\n        \"createdAt\": \"\",\n        \"from_user\":    {},\n        \"count\":{\"active\":0, \"unread\":0}\n    }, detailObj= [] ;\n    \n    if(detail_data.length){\n        if(!isEmpty(user_obj)){\n            for(var d=0; d<detail_data.length; d++){\n\n                if( (user_obj._id === detail_data[d].user_id) || (user_obj._id == checkFromUserId(detail_data[d]) )){\n                    //when user owns detail record\n                    detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                }\n                else{\n\n                    if((\"public\" in detail_data[d].type) ){ //check if user is admin or detail is public then display\n\n                        detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                    }else { \n\n                        if((\"admin\" in user_obj.type)){\n                            if( (\"public\" in detail_data[d].type)) {\n                                detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                            }else if(hasSameProps(user_obj.data, detail_data[d].type)){\n                                detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                            }else{\n                                if(detail_data[d].user_id == \"fa1785333117ba7c06b9020a6d3c0079\"){ //if record is created super company\n                                    detailObj.push( get_obj_data(detailRecord, detail_data[d]) );    \n                                }else{\n                                    detail_data.splice(d, 0);\n                                }\n                            }\n                        }else{\n                            detail_data.splice(d, 0);\n                        }\n                    }\n                }\n            }\n            detailObj = removeEmptyArrayElements(detailObj);         \n        }else{\n            //when we don't have any user info while using access_token\n            for(var k=0; k<detail_data.length; k++){\n                if(check_isDisplay(detail_data[k].display_if_empty)){\n                    detailObj.push( get_obj_data(detailRecord, detail_data[k]) );\n                }else{\n                    var find_any_child = populate_child_detail(db_record.details, detail_data[k].to_page_id);\n                    if(find_any_child.length){\n                        detailObj.push( get_obj_data(detailRecord, detail_data[k]) );\n                    }else{\n                        detail_data.splice(k, 0);\n                    }\n                }\n            }\n            detailObj = removeEmptyArrayElements(detailObj);         \n        }\n    }\n\n    return detailObj;\n}\n\nfunction hasSameProps( obj1, obj2 ) {\n    var isExists = false;\n    \n    if(!isEmpty(obj1)){\n        obj1 = obj1.groups ;\n        if(!isEmpty(obj1)){\n            isExists = Object.keys( obj1 ).every( function( prop ) {\n     \t\t    return obj2.hasOwnProperty( prop );\n     \t    });    \n        }\n    }\n    \n \treturn isExists;\n}\n\nfunction checkFromUserId(detail_obj){\n    if(isEmpty(detail_obj.from_user_id)){\n        return null;\n    }else{\n        if(Object.prototype.toString.call(detail_obj.from_user_id) === \"[object Object]\"){\n            return detail_obj.from_user_id.user_id;\n        }else{\n            return detail_obj.from_user_id;\n        }\n    }\n}\n\nfunction populate_child_detail(details, to_page_id){\n    var arr = [];\n    for(var i=0; i<details.length; i++){\n        if( details[i].page_id === to_page_id ){\n            arr.push(details[i]);\n        }\n    }\n    return arr;\n}\n\nfunction formulate_task(task_obj, db_data){\n    var template_data       = db_data.templates ,\n    task_data               = task_obj,\n    templateObj             = {},\n    header_template_id      = task_data.header_template_id,\n    detail_template_id      = task_data.detail_template_id,\n    footer_template_id      = task_data.footer_template_id;\n    \n    for(var ind=0; ind<template_data.length; ind++){\n        if(header_template_id == template_data[ind]._id){\n            templateObj.header = template_data[ind];\n        }\n        if(detail_template_id == template_data[ind]._id){\n            templateObj.detail = template_data[ind];\n        }\n        if(footer_template_id == template_data[ind]._id){\n            templateObj.footer = template_data[ind];\n        }\n    }\n\n    var taskObj = {\n        \"task_id\":\t\t    task_data._id,\n        \"task_name\":\t\ttask_data.task_name,\n        \"page_id\":          task_data.page_id,\n        \"parent_id\":        task_data.parent_id,\n        \"template\": \t\ttemplateObj,\n        \"from_page_id\":\t\ttask_data.from_page_id,\n        \"child_task_id\":    task_data.child_default_task_id,\n        \"date_created\":     task_data.date_created\n    };\n    \n    return taskObj;\n}\n\nfunction populate_details(id, arr){\n\n    var result = [];\n    \n    if(isEmpty(id)) return result;\n    \n    if(isEmpty(arr)){\n        return result;\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(if_exists_in_arr(id, arr[i].task_id)){\n                result.push(arr[i]);\n            }\n        }\n    }    \n    \n    return result;\n}\n\nfunction populate_taskobj(id, arr){\n    if(isEmpty(id)) return {};\n    \n    if(isEmpty(arr)){\n        return {};\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(arr[i].page_id == id){\n                return arr[i];\n            }\n        }\n    }\n}\n\nfunction populate_user_task(user, user_tasks){\n    var users_task = [];\n    \n    for(var i=0; i<user_tasks.length; i++){\n        if( \n            (user_tasks[i].user_id == user._id) &&\n            (parseInt(user_tasks[i].synchronized) === 0)\n        ){\n            users_task.push(user_tasks[i]);\n        }\n    }\n    \n    return users_task;\n}\n\nfunction removeEmptyArrayElements(arr) { \n   if (!isArray(arr)) {\n      return arr;\n   } else {\n       return arr.filter( function(elem) { \n          return elem !== null ;\n       } ).map(removeEmptyArrayElements);\n   }\n}\n\nfunction get_obj_data(obj1, obj2){\n\tvar obj = {};\n\tfor (var key in obj1) {\n\t\tif(obj2.hasOwnProperty(key))\n\t\t\tobj[key] = obj2[key];\n\t\telse\n\t\t    obj[key] = obj1[key];\n\t}\n\treturn obj;\n}\n\nfunction if_exists_in_arr(key, array){\n    return array.indexOf(key) > -1;\n}\n\nfunction isArray(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":2124.9626083374023,"y":542.8019962310791,"wires":[["19993678.8598da"]]},{"id":"138add88.9c9e92","type":"function","z":"b5aea0cd.480f6","name":"paginated_detail","func":"var body            = msg.payload_content,\n    page_id         = body.page_id ,\n    access_token    = body.access_token,\n    payload         = msg.db_get_page;\n \n    msg.counts      = populate_counts(msg.payload);\n    msg.db_record   = populate_records(payload.rows);\n    msg.user_obj    = populate_user(access_token, msg.db_record.users);\n    msg.user_tasks  = populate_user_task(msg.user_obj, msg.db_record.user_tasks);\n    msg.task_obj    = populate_taskobj(page_id, msg.db_record.tasks);\n\nmsg.payload = {\n    \"selector\": {\n    \t\"createdAt\": {\n       \t\t\"$gt\" : 0\n       \t},\n       \t\"$or\": [\n       \t    {\n       \t        \"page_ids\": {\n                    \"$in\": [msg.task_obj.page_id]\n                }\n            }\n       \t],\n    \t\"table\": \"details\"\n\t},\n\t\"sort\": [{\"createdAt\": \"desc\" }],\n    \"limit\": 20,\n};\nif(page_id == 18) {\n    msg.payload.selector.user_id = msg.user_obj._id ;\n}\nmsg.url = \"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_find\";\nmsg.method = \"POST\";\nmsg.statusCode = 200 ;\n\ndelete msg.headers;\nreturn msg;\n\nfunction populate_counts(payload){\n    if(isEmpty(payload.rows)){\n        return {};\n    }else{\n        if(Object.prototype.toString.call(payload.rows) === \"[object Array]\"){\n            if(isEmpty(payload.rows)){\n                return {};\n            }else{\n                var values          = payload.rows;\n                    reducedData     = [];\n\n                for (var each_value in values)  {\n                \tif(values[each_value]){\n                \t\treducedData.push(reduceFn(null, [values[each_value]], false)[0]);\t\n                \t}\n                }\n                return reduceFn(null, reducedData, true);\n            }\n        }else{\n            return {};\n        }\n    }\n}\n\nfunction reduceFn(key, values, rereduce){\n    if(rereduce){\n\t\tvar result_object = {}, out_array = {}, reduce_pages = {};\n\n\t\t// first convert values array to an object-- values_object = {page1: {}, page2:{}, etc.}\n\t\tfor (var i in values) {\n\t\t\tif (values[i].value) {\n\t\t\t\tvar record = values[i].value;\n\t\t\t\tvar page_id = record.page_id;\n\t\t\t\treduce_pages[page_id] = record;\n\t\t\t\t//result_object[page_id] = record.count;\n\t\t\t\tresult_object[page_id] = JSON.parse(JSON.stringify(record.count)); // not sure if needed, but to make a unlinked copy to from original\n\t\t\t}\n\t\t}\n\t\t\n\t\t// reduce_pages (object) is a copy of incoming values array \n\t\t// result_object will be the result of the recuce keyed by page_id\n\n\t\tfor(var pages in reduce_pages){\t\t\t\t\t\t\t\t\t\t// go through each page in values\n\t\t\tif(reduce_pages[pages]){\n\t\t\t\tvar local_obj = reduce_pages[pages],\n\t\t\t\t    ancestors = local_obj.ancestors;\n\n\t\t\t\tfor (var itr in ancestors) {\t\t\t\t\t\t\t\t// go through each ancestor in the current page being calculated \n\t\t\t\t\tvar this_ancestor = ancestors[itr];\n\t\t\t\t\tif(reduce_pages[this_ancestor]){\t\t\t\t\t\t\n\t\t\t\t\t\tvar single_obj = reduce_pages[this_ancestor];\t\t// get the record associated with this ancestor\n\t\t\t\t\t\tvar single_obj_page_id = single_obj.page_id;\n\n\t\t\t\t\t\t// now update each of the result objects for each ancestor\n\t\t\t\t\t\tif (single_obj.count_if.active) {\n\t\t\t\t\t\t\tresult_object[single_obj_page_id].active += single_obj.count.active;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\t\t\t\t\t\t\n\t\t}\n\n\t\t// now convert result_object to an array \n\t\tif (Object.keys(result_object).length > 0) {\n\t\t\tfor (var j in result_object) {\n\t\t\t\tif (Object.keys(result_object[j]).length) {\n\t\t\t\t\tout_array[j] = result_object[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t    return out_array;\n    }else{\n    \treturn values;\n    }\n}\n\nfunction populate_records(list){\n    var users = [], templates = [], details=[], task_table = [], user_task = [], sorted_detail = [];\n    for(var i=0; i<list.length; i++){\n        if(list[i].value.table == \"template\"){\n            templates.push(list[i].value);\n        }\n\n        if(list[i].value.table == \"task_table\"){\n            task_table.push(list[i].value);\n        }\n\n        if(list[i].value.table == \"users\"){\n            users.push(list[i].value);\n        }\n        \n        if(list[i].value.table == \"user_page\"){\n            user_task.push(list[i].value);\n        }\n    }\n\n    return {users: users, templates: templates, details: details, tasks: task_table, user_tasks: user_task} ;\n}\n\nfunction populate_user(access_token, users){\n    var obj = {} ,\n        phone = body.phone ;\n        \n    for(var i =0; i<users.length; i++){\n        if(users[i].virtual_phone){\n            if(\n                (access_token === users[i].access_token) ||\n                (phone == users[i].virtual_phone.toString())\n                ){\n                obj = users[i];\n            }    \n        }\n    }\n    return obj;\n}\n\nfunction populate_user_task(user, user_tasks){\n    var users_task = [];\n    \n    for(var i=0; i<user_tasks.length; i++){\n        if( \n            (user_tasks[i].user_id == user._id) &&\n            (parseInt(user_tasks[i].synchronized) === 0)\n        ){\n            users_task.push(user_tasks[i]);\n        }\n    }\n    \n    return users_task;\n}\n\nfunction populate_taskobj(id, arr){\n    if(isEmpty(id)) return {};\n    \n    if(isEmpty(arr)){\n        return {};\n    }else{\n        for(var i=0; i<arr.length; i++){\n            if(arr[i].page_id == id){\n                return arr[i];\n            }\n        }\n    }\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":2124.739631652832,"y":496.23248291015625,"wires":[["e15e79ac.3d6328"]]},{"id":"e15e79ac.3d6328","type":"http request","z":"b5aea0cd.480f6","name":"SearchFilter","method":"use","ret":"obj","url":"","tls":"","x":2306.0729446411133,"y":496.2324619293213,"wires":[["d21c84af.cbeab8","dcedcd3c.ba67"]]},{"id":"19993678.8598da","type":"http response","z":"b5aea0cd.480f6","name":"","x":2292.9744186401367,"y":543.2161431312561,"wires":[]},{"id":"d21c84af.cbeab8","type":"function","z":"b5aea0cd.480f6","name":"populate","func":"var body                    = msg.payload_content,\n    page_id                 = body.page_id ,\n    access_token            = body.access_token,\n    payload                 = msg.db_get_page,\n    counts                  = msg.counts ,\n    db_record               = msg.db_record,\n    user_obj                = msg.user_obj,\n    user_tasks              = msg.user_tasks,\n    task_obj                = msg.task_obj,\n    ancestor_conts_array    = [] ,\n    paginated_details       = populate_paginated_details(msg.payload);\n    //paginated_details       = db_record.details,\n    \n    msg.updated_user_task = {}; //this will hold the user_task is not present in database.\n    \n    if(isEmpty(payload.rows)){\n        msg.api_status = \"API_ERROR\";\n        msg.payload    = {status: 400, msg: \"Unable to fetch data using Cloudant views\", data: null};\n    }else{\n        msg.update_my_user_task = false;\n\n        if(isEmpty(user_obj)){\n            msg.api_status = \"API_SUCCESS\";\n            page_id = 1 ;\n            msg.api_response    = {status: 200, error:false, msg: \"Record fetched successfully\", records: populate_login_verify_pages(page_id, db_record), bookmark: paginated_details.bookmark};\n            \n        }else if(page_id == 1){\n            msg.api_status = \"API_SUCCESS\";\n            page_id = 1 ;\n            msg.api_response    = {status: 200, error:false, msg: \"Record fetched successfully\", records: populate_login_verify_pages(page_id, db_record), bookmark: paginated_details.bookmark };\n            \n        }else{\n            if(!user_obj.security_level){\n                msg.api_status = \"API_SUCCESS\";\n                page_id = 11 ;\n                msg.api_response    = {status: 200, error:false, msg: \"Record fetched successfully\", records: populate_login_verify_pages(page_id, db_record), bookmark: paginated_details.bookmark};\n            }else{\n                msg.api_status = \"API_SUCCESS\";\n                if(isEmpty(body.user_task_list)){\n                    msg.update_my_user_task = false;\n                }else{\n                   msg.method  = \"GET\";\n                   msg.url     = 'https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_design/filterBy/_view/get_selected_user_task?key=[\"' + user_obj._id +'\"]';\n                   msg.update_my_user_task = true;\n                }\n                msg.api_response = {status: 200, error:false, msg: \"Record fetched successfully\", records: populated_pages(user_tasks, db_record), bookmark: paginated_details.bookmark };\n            }\n        }    \n    }\ndelete msg.headers;\nreturn msg;\n\n/*********************** login and verify page functions *******************/\n\nfunction populate_login_verify_pages(page_id, db_obj){\n    var req_page = {};\n    if(!isEmpty(task_obj)){\n        var single_prepare_task   =  formulate_task(task_obj, db_obj),\n            single_prepare_detail =  formulate_details(paginated_details.data ? paginated_details.data : paginated_details);\n        \n        req_page = {\n           page_id : page_id,\n           user    : {},\n           task    : single_prepare_task,\n           detail  : single_prepare_detail\n        };\n    }\n    return {req_page: req_page, pages: []};\n}\n\n/*********************** login and verify page functions ends here*******************/\n\nfunction populated_pages(user_tasks, db_obj){\n    var pages = [] , req_page = {};\n   \n    if(!isEmpty(page_id)){\n        if(!isEmpty(task_obj)){\n            var single_prepare_task   =  formulate_task(task_obj, db_obj),\n                single_prepare_detail =  formulate_details(paginated_details.data ? paginated_details.data : paginated_details);\n            \n            req_page = {\n               page_id : page_id,\n               user    : (page_id == 11 ) ? {} : user_obj ,\n               task    : single_prepare_task,\n               detail  : getpage(single_prepare_detail)\n            };\n        }\n    }\n    if(!isEmpty(user_tasks)){\n        for(var i in user_tasks){\n            if(!isEmpty(task_obj)){\n            var prepare_task    =  formulate_task(task_obj, db_obj),\n                prepare_details =  formulate_details(paginated_details.data ? paginated_details.data : paginated_details);\n       \n                pages.push({\n                    page_id :  user_tasks[i].page_id,\n                    user    :  user_obj || {},\n                    task    :  prepare_task,\n                    detail  :  getpage(prepare_details)\n            \t});\n            }\n        }   \n    }\n\n    return {req_page : req_page, pages: pages};\n}\n\nfunction getpage(details){\n    if(page_id == 1 || page_id == 11){ // no need to store user_task for login and verify page\n        return details ;\n    }else{\n        var result  = populate_counts(details),\n            detail  = result.detail_array;\n             \n        if(detail.length){\n            return detail ;\n        }else{\n            return [] ;\n        }    \n    }\n}\n\nfunction populate_counts(details){\n    var detailArr=[];\n\n    for(var loop in details){\n        if(isEmpty(counts[details[loop].to_page_id])){\n            details[loop].count = {active: 0, unread: 0};    \n        }else{\n            details[loop].count = counts[details[loop].to_page_id];\n        }\n        detailArr.push(details[loop]); \n    }\n\n    var isUserTaskExits = checkFromUserTaskList(task_obj.page_id, task_obj._id, db_record.user_tasks); \n    if( isEmpty(isUserTaskExits) ){ //check if already user_task is not present for that user. if not then do the following steps\n        node.warn(\"when userTask is not present\");\n        populate_ancestors(task_obj.page_id, db_record.tasks, \"page_id\"); //calculating ancestor task with request page_id\n\n        msg.updated_user_task = {   // create user_task record if user_task is not present in database \n            table           : \"user_page\",\n        \ttask_id \t\t: task_obj._id,\n        \tuser_id\t\t\t: user_obj._id,\n        \tpage_id         : parseInt(task_obj.page_id),\n        \tsynchronized    : 1,\n            status          : 0, \n        \tdate_updated\t: null,\t\n        \tparent_id\t\t: task_obj.from_page_id,\n        \tancestors       : ancestor_conts_array, \n        \tcount_status\t: {\n        \t   active       : 1,\n        \t   unread       : 0,\n        \t},\n        \tcount\t\t\t: {\n        \t    active      : 1,\n        \t    unread      : 0,\n        \t},\n        \tcount_if\t\t: {\n        \t    active      : 1,\n        \t    unread      : 0\n        \t},\n        \ttemplates\t\t: {},\n        \ttimeout\t\t\t: {},\n        \tcreatedAt       : new Date().getTime()\n        };\n    }else{\n        msg.updated_user_task = {};\n    }\n    \n    if(!isEmpty(msg.updated_user_task))  msg.update_my_user_task = true;\n    return {detail_array: detailArr};\n}\n\nfunction checkFromUserTaskList(page_id, task_id, user_tasks){\n    var res = {};\n    if(isEmpty(user_tasks)) return res;\n    \n    for(var loop in user_tasks){\n        if(\n            (user_tasks[loop].user_id == user_obj._id) &&\n            (user_tasks[loop].page_id == page_id ) &&\n            (user_tasks[loop].task_id == task_id )\n        ){\n            res = user_tasks[loop];\n        }\n    }    \n    return res;\n}\n\nfunction populate_ancestors(id, task_arr, type){\n    if(type == \"page_id\"){\n        for(var index in task_arr){\n            if(task_arr[index].page_id == id){\n                if( !if_exists_in_arr( task_arr[index].parent_id, ancestor_conts_array ) ){\n                    if(task_arr[index].page_id){\n                        ancestor_conts_array.push(task_arr[index].from_page_id);\n                        populate_ancestors( task_arr[index].from_page_id, db_record.tasks, \"from_page_id\");\n                    }\n                }\n            }\n        }    \n    }else{\n        for(var itr in task_arr){\n            if(!isEmpty(task_arr[itr].page_id)){\n                if(task_arr[itr].page_id == id) {\n                    if( !if_exists_in_arr( task_arr[itr].from_page_id, ancestor_conts_array ) ){\n                        if(task_arr[itr].from_page_id){\n                            ancestor_conts_array.push(task_arr[itr].from_page_id);\n                            populate_ancestors( task_arr[itr].from_page_id, db_record.tasks, \"from_page_id\");    \n                        }\n                    }\n                }\n            }\n        }    \n    }\n}\n\nfunction checkIsPrivate(detail){\n\n    if(isEmpty(user_obj)){\n        return false;\n    }else{\n        if((\"private\" in detail.type)){\n            if(user_obj._id == detail.user_id){\n                return true;\n            }else{\n                return false;\n            }\n        }else{\n            if(!isEmpty(user_obj.data)){\n                var obj2 = detail.type ,\n                     obj1 = user_obj.data.groups;\n                \n                if(isEmpty(obj1) || isEmpty(obj2)) return true;\n                \n                return Object.keys( obj1 ).every( function( prop ) {\n             \t\treturn obj2.hasOwnProperty( prop );\n             \t});\n            }else{\n                return true;\n            }\n        }\n    }\n}\n\nfunction formulate_details(detail_data){\n    var detailRecord = {\n        \"_id\": \t\"\",\n        \"image\":\t\t\"\",\n        \"to_page_id\": \t\"\",\n        \"user_id\": \t\t\"\",\n        \"page_ids\":      \"\",\n        \"page_id\":      \"\",\n        \"from_user_id\": \"\",\n        \"display_if_empty\": \"\",\n        \"processed\": \"\",\n        \"status\": \"\",\n    \t\"user_incoming\":{},\n        \"watson_incoming\":{},\n        \"type\":         {},\n        \"due_date\": \"\",\n        \"createdAt\": \"\",\n        \"from_user\":    {},\n        \"count\":{\"active\":0, \"unread\":0}\n    }, detailObj= [] ;\n    \n    if(detail_data.length){\n        if(!isEmpty(user_obj)){\n            for(var d in detail_data){\n\n                if( (user_obj._id === detail_data[d].user_id) || (user_obj._id == checkFromUserId(detail_data[d]) )){\n                    //when user owns detail record\n                    detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                }\n                else{\n\n                    if((\"public\" in detail_data[d].type) ){ //check if user is admin or detail is public then display\n\n                        detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                    }else { \n\n                        if((\"admin\" in user_obj.type)){\n                            if( (\"public\" in detail_data[d].type)) {\n                                detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                            }else if(hasSameProps(user_obj.data, detail_data[d].type)){\n                                detailObj.push( get_obj_data(detailRecord, detail_data[d]) );\n                            }else{\n                                if(detail_data[d].user_id == \"fa1785333117ba7c06b9020a6d3c0079\"){ //if record is created super company\n                                    detailObj.push( get_obj_data(detailRecord, detail_data[d]) );    \n                                }else{\n                                    detail_data.splice(d, 0);\n                                }\n                            }\n                        }else{\n                            detail_data.splice(d, 0);\n                        }\n                    }\n                }\n            }\n            detailObj = removeEmptyArrayElements(detailObj);         \n        }else{\n            //when we don't have any user info while using access_token\n            for(var k in detail_data){\n                if(check_isDisplay(detail_data[k].display_if_empty)){\n                    detailObj.push( get_obj_data(detailRecord, detail_data[k]) );\n                }else{\n                    var find_any_child = populate_child_detail(db_record.details, detail_data[k].to_page_id);\n                    if(find_any_child.length){\n                        detailObj.push( get_obj_data(detailRecord, detail_data[k]) );\n                    }else{\n                        detail_data.splice(k, 0);\n                    }\n                }\n            }\n            detailObj = removeEmptyArrayElements(detailObj);         \n        }\n    }\n\n    return detailObj;\n}\n\nfunction hasSameProps( obj1, obj2 ) {\n    var isExists = false;\n    \n    if(!isEmpty(obj1)){\n        obj1 = obj1.groups ;\n        if(!isEmpty(obj1)){\n            isExists = Object.keys( obj1 ).every( function( prop ) {\n     \t\t    return obj2.hasOwnProperty( prop );\n     \t    });    \n        }\n    }\n    \n \treturn isExists;\n}\n\nfunction checkFromUserId(detail_obj){\n    if(isEmpty(detail_obj.from_user_id)){\n        return null;\n    }else{\n        if(Object.prototype.toString.call(detail_obj.from_user_id) === \"[object Object]\"){\n            return detail_obj.from_user_id.user_id;\n        }else{\n            return detail_obj.from_user_id;\n        }\n    }\n}\n\nfunction populate_child_detail(details, to_page_id){\n    var arr = [];\n    for(var i=0; i<details.length; i++){\n        if( details[i].page_id === to_page_id ){\n            arr.push(details[i]);\n        }\n    }\n    return arr;\n}\n\nfunction formulate_task(task_obj, db_data){\n    var template_data       = db_data.templates ,\n    task_data               = task_obj,\n    templateObj             = {},\n    header_template_id      = task_data.header_template_id,\n    detail_template_id      = task_data.detail_template_id,\n    footer_template_id      = task_data.footer_template_id;\n    \n    for(var ind=0; ind<template_data.length; ind++){\n        if(header_template_id == template_data[ind]._id){\n            templateObj.header = template_data[ind];\n        }\n        if(detail_template_id == template_data[ind]._id){\n            templateObj.detail = template_data[ind];\n        }\n        if(footer_template_id == template_data[ind]._id){\n            templateObj.footer = template_data[ind];\n        }\n    }\n    var taskObj = {\n        \"task_id\":\t\t    task_data._id,\n        \"task_name\":\t\ttask_data.task_name,\n        \"page_id\":          task_data.page_id,\n        \"parent_id\":        task_data.parent_id,\n        \"template\": \t\ttemplateObj,\n        \"from_page_id\":\t\ttask_data.from_page_id,\n        \"child_task_id\":    task_data.child_default_task_id,\n        \"date_created\":     task_data.date_created\n    };\n    \n    return taskObj;\n}\n\nfunction check_isDisplay(d){\n    \n    if(d === \"1\"){\n        return true;\n    }else if(d === 1){\n        return true;\n    }else if(d === \"true\"){\n        return true;\n    }else if(d === true){\n        return true;\n    }else if(d === \"false\"){\n        return false;\n    }else{\n        return false ;\n    }\n}\n\nfunction removeEmptyArrayElements(arr) { \n   if (!isArray(arr)) {\n      return arr;\n   } else {\n       return arr.filter( function(elem) { \n          return elem !== null ;\n       } ).map(removeEmptyArrayElements);\n   }\n}\n\nfunction isArray(obj) {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\nfunction get_obj_data(obj1, obj2){\n\tvar obj = {};\n\tfor (var key in obj1) {\n\t\tif(obj2.hasOwnProperty(key))\n\t\t\tobj[key] = obj2[key];\n\t\telse\n\t\t    obj[key] = obj1[key];\n\t}\n\t//2nd operator check stated here...\n\tif(!isEmpty(obj2.operator_type) && obj2.operator_type == \"1\") {\n\t    obj.isSecondOperator = true ;\n\t}else{\n\t    obj.isSecondOperator = false ;\n\t}\n\treturn obj;\n}\n\nfunction if_exists_in_arr(key, array){\n    return array.indexOf(key) > -1;\n}\n\nfunction populate_paginated_details(list){\n    var {docs, bookmark} = list ;\n    \n    if( !isEmpty(docs) ){\n        return {data: docs, bookmark: bookmark};\n    }else{\n        return {data: [], bookmark: null};\n    }\n}\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}\n\n","outputs":1,"noerr":0,"x":2469.834617614746,"y":496.00009059906006,"wires":[["7e7842da.61891c","ee5b0fc3.12d13","11ffd0fb.9e63cf"]]},{"id":"ee5b0fc3.12d13","type":"switch","z":"b5aea0cd.480f6","name":"","property":"api_status","propertyType":"msg","rules":[{"t":"eq","v":"API_ERROR","vt":"str"},{"t":"eq","v":"API_SUCCESS","vt":"str"}],"checkall":"true","outputs":2,"x":2617.2125549316406,"y":556.0621271133423,"wires":[["660e88cd.a77528"],["bed8893c.abccf8"]]},{"id":"bed8893c.abccf8","type":"switch","z":"b5aea0cd.480f6","name":"","property":"update_my_user_task","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","outputs":2,"x":2802.71240234375,"y":608.0621109008789,"wires":[["34b3e11a.c0436e","fa08be93.87af8"],["fa08be93.87af8"]]},{"id":"660e88cd.a77528","type":"http response","z":"b5aea0cd.480f6","name":"","x":2795.5466289520264,"y":533.7288627624512,"wires":[]},{"id":"34b3e11a.c0436e","type":"function","z":"b5aea0cd.480f6","name":"insert user_task","func":"if(isEmpty(msg.updated_user_task)){\n    msg.payload = null;\n    node.warn(\"when msg.payload = null\");\n}else{\n    msg.payload = msg.updated_user_task ;\n}\n\ndelete msg.headers;\nreturn msg;\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":3000.546073913574,"y":530.395378112793,"wires":[["a5b382ba.8c8b3"]]},{"id":"fa08be93.87af8","type":"switch","z":"b5aea0cd.480f6","name":"isUpdateUserTasks","property":"isUpdateUserTasks","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","outputs":2,"x":3017.2137145996094,"y":618.0623779296875,"wires":[["57c93766.cf4798"],["1703d32d.a0e41d"]]},{"id":"1703d32d.a0e41d","type":"debug","z":"b5aea0cd.480f6","name":"","active":true,"console":"false","complete":"false","x":3227.6674003601074,"y":654.3333692550659,"wires":[]},{"id":"57c93766.cf4798","type":"http request","z":"b5aea0cd.480f6","name":"","method":"use","ret":"obj","url":"","tls":"","x":3225.2142906188965,"y":592.3958101272583,"wires":[["354aae54.2a2302"]]},{"id":"a5b382ba.8c8b3","type":"switch","z":"b5aea0cd.480f6","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":3176.8338470458984,"y":528.333399772644,"wires":[["ca28a85.8065458","50311e1b.95e8e"]]},{"id":"ca28a85.8065458","type":"debug","z":"b5aea0cd.480f6","name":"Un-unsed usertask inserted","active":true,"console":"false","complete":"payload","x":3406.1675186157227,"y":450.3334321975708,"wires":[]},{"id":"354aae54.2a2302","type":"function","z":"b5aea0cd.480f6","name":"payload","func":"var content                 = msg.payload_content, \n    users_all_task          = simplfyUserTask(msg.payload);\n    msg.isUpdateUserPage    = false;\n\nvar updated_user_task = populate_updated_user_task(content.user_task_list, users_all_task);\n\nif(!isEmpty(updated_user_task)){\n    msg.isUpdateUserPage = true;\n    msg.payload = { \"docs\": updated_user_task };   \n}else{\n    msg.payload = \"Nothing to update for user_page\";\n}\n\n//node.warn(\"API_SUCCESS >>> if case level 2 step 3\");\ndelete msg.headers;\n\nreturn msg;\n\nfunction simplfyUserTask(user_task){\n    if(isEmpty(user_task)){\n        return [];\n    }else{\n        var d = [], rows = user_task.rows;\n        for(var i=0; i<rows.length; i++){\n            d.push(rows[i].value);\n        }\n        return d;\n    }    \n}\n\nfunction populate_updated_user_task(user_task_list, users_all_task){\n\n    if(!isEmpty(user_task_list) && !isEmpty(user_task_list)){\n        var user_task = [];\n\n        for(var i=0; i<users_all_task.length; i++){\n            for(j=0; j<user_task_list.length; j++){\n                if(\n                    (users_all_task[i].user_id == user_task_list[j].user_id) &&\n                    (users_all_task[i].page_id == user_task_list[j].page_id)  \n                ){\n                    users_all_task[i].synchronized = user_task_list[j].synchronized || 1 ;\n                    users_all_task[i].status       = user_task_list[j] || 1 ;\n                    users_all_task[i].count        = user_task_list[j].count ;\n                    users_all_task[i].date_updated = new Date().getTime();\n                    \n                    //push to new array which is going to update into db.\n                    user_task.push(users_all_task[i]);\n                }\n            }\n        }\n        return user_task ;\n    }else{\n        return null;\n    }\n}\n\n\nfunction isEmpty(obj){\n\n    if(Object.prototype.toString.call(obj) === \"[object Object]\"){\n        if( Object.keys(obj).length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else if(Object.prototype.toString.call(obj) === \"[object Array]\"){\n        if( obj.length ){\n            return false;\n        }else{\n            return true;\n        }\n    }else{\n        if( obj ){\n            return false;\n        }else{\n            return true;\n        }\n    }   \n}","outputs":1,"noerr":0,"x":3382.547508239746,"y":593.0624513626099,"wires":[["568fd19b.2aa55"]]},{"id":"b8f09f23.680b6","type":"http request","z":"b5aea0cd.480f6","name":"","method":"POST","ret":"obj","url":"https://30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix.cloudant.com/master_table/_bulk_docs","tls":"","x":3694.8823013305664,"y":564.7292032241821,"wires":[["6066a866.d7ed48"]]},{"id":"6ff21650.ed1aa8","type":"debug","z":"b5aea0cd.480f6","name":"bulk payload","active":true,"console":"false","complete":"payload","x":3698.880344390869,"y":619.7289600372314,"wires":[]},{"id":"6066a866.d7ed48","type":"debug","z":"b5aea0cd.480f6","name":"","active":true,"console":"false","complete":"payload","x":3871.880683898926,"y":563.395947933197,"wires":[]},{"id":"7e7842da.61891c","type":"function","z":"b5aea0cd.480f6","name":"response","func":"msg.payload = msg.api_response;\n//node.warn(\"API_SUCCESS >>> if case level 3 step 1\");\nreturn msg;","outputs":1,"noerr":0,"x":2620.000648498535,"y":464.666766166687,"wires":[["99a52105.747b"]]},{"id":"99a52105.747b","type":"http response","z":"b5aea0cd.480f6","name":"API Response","x":2798.001739501953,"y":465.0003786087036,"wires":[]},{"id":"2473bb89.875b74","type":"switch","z":"b5aea0cd.480f6","name":"","property":"isCount","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":1616.8333740234375,"y":511.3333511352539,"wires":[["6db93c1b.66cc14"],["b7d40a1a.7eee98"]]},{"id":"b7d40a1a.7eee98","type":"function","z":"b5aea0cd.480f6","name":"login/verify","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1779.8333587646484,"y":545.0000114440918,"wires":[["ce1e91df.04442"]]},{"id":"11ffd0fb.9e63cf","type":"debug","z":"b5aea0cd.480f6","name":"logger","active":true,"console":"false","complete":"true","x":2618.1667404174805,"y":612.0001010894775,"wires":[]},{"id":"50311e1b.95e8e","type":"cloudant out","z":"b5aea0cd.480f6","name":"","cloudant":"","database":"master_table","service":"dev-platform-cloudantNoSQLDB","payonly":true,"operation":"insert","x":3356.500198364258,"y":508.33332443237305,"wires":[]},{"id":"dcedcd3c.ba67","type":"debug","z":"b5aea0cd.480f6","name":"Search Log","active":true,"console":"false","complete":"true","x":2472.166488647461,"y":411.00006771087646,"wires":[]},{"id":"568fd19b.2aa55","type":"switch","z":"b5aea0cd.480f6","name":"","property":"isUpdateUserPage","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","outputs":2,"x":3532.833465576172,"y":592.6667022705078,"wires":[["b8f09f23.680b6"],["6ff21650.ed1aa8"]]},{"id":"b15ae668.4b1858","type":"http response","z":"b5aea0cd.480f6","name":"","x":1547.167049407959,"y":822.0002765655518,"wires":[]},{"id":"676ba017.cb5d6","type":"Tree View","z":"b5aea0cd.480f6","database":"master_table","username":"30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix","password":"3c2e6d7f80557d231bc462ffd3457a3b05625332c1dffc92467d6d8941fcba85","operation":"prod","x":1557.9654178619385,"y":877.555645942688,"wires":[["ea427e2f.6b9b2","22c2b8ca.dd8f98"]]},{"id":"12434fc4.e1c7d","type":"Tree View","z":"b5aea0cd.480f6","database":"master_table","username":"30175cba-a69e-4ff0-9a79-788abcf0f585-bluemix","password":"3c2e6d7f80557d231bc462ffd3457a3b05625332c1dffc92467d6d8941fcba85","operation":"prod","x":1419.8542823791504,"y":637.7709636688232,"wires":[["4c7a42f2.30fd2c"]]},{"id":"22c2b8ca.dd8f98","type":"debug","z":"b5aea0cd.480f6","name":"logger","active":true,"console":"false","complete":"true","x":1746.5140266418457,"y":912.3473148345947,"wires":[]},{"id":"1de90dec.33d782","type":"http in","z":"6f1d88a3.034e28","name":"GET API","url":"api/master_api_handler","method":"get","upload":false,"swaggerDoc":"","x":88.18055725097656,"y":472.35069465637207,"wires":[["411c75bf.04df4c"]]},{"id":"411c75bf.04df4c","type":"switch","z":"6f1d88a3.034e28","name":"","property":"payload.api_name","propertyType":"msg","rules":[{"t":"eq","v":"homepage","vt":"str"},{"t":"eq","v":"getchild","vt":"str"},{"t":"eq","v":"back","vt":"str"},{"t":"eq","v":"sorting","vt":"str"},{"t":"eq","v":"showdeletedRecords","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":256.5243263244629,"y":1336.8056259155273,"wires":[["d63fec7c.6130a"],["dee8f93d.9e2c08"],["bd4bd0fa.63a23"],["57051252.db1bbc"],["cadec980.9dec98"]]}]